<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Wed May 02 14:25:22 KST 2018-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.icignal.loyalty.product.mapper.LoyProductMapper">  

	<!-- /**************************************
    -   관련 파일            : LOYCommonPopupDAO.java (getCategoryListPop)
    ============================================
    -   제목                   : 공통 팝업 (카테고리 조회)
    -   설명                   : 
    -   결과형태             : 복수
    ============================================
    -   입력			  : accountId, pgm_rid
    -	출력			  :	
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.13
    ***************************************/ -->
    <select id="getCategoryListPop" parameterType="com.icignal.loyalty.common.dto.request.LoyCommonReqDto" 
    										resultType="com.icignal.loyalty.product.dto.response.LoyCategoryListResDto">
        /* LoyProductMapper.getCategoryListPop */
		select 
			  lpc1.rid          as rid
			, lpc1.rid_pgm      as ridPgm
			, lpc1.par_rid      as parRid
			, lpc2.cat_id       as parCatId
			, lpc2.cat_nm       as parCatNm
			, lpc1.cat_id       as catId
			, lpc1.cat_nm       as catNm
			, lpc1.cat_desctxt  as catDesctxt
		from loy.loy_prod_category lpc1 WITH (NOLOCK)
			left join loy.loy_prod_category lpc2 WITH (NOLOCK) on lpc1.par_rid = lpc2.rid and lpc2.flag = 1
		where ${strSVCType}
		    and ${strWhere}
		    and lpc1.flag 		= 1
		    <!-- and lpc1.rid_pgm 	= #{loyProgramId} -->
	  	order by ${strOrderby}
	 		${strEndPaging}
    </select>

	<!-- /**************************************
    -   관련 파일            : LOYCommonPopupDAO.java (getProdListPop)
    ============================================
    -   제목                   : 공통 팝업 (상품 조회)
    -   설명                   : 
    -   결과형태             : 복수
    ============================================
    -   입력			  : accountId, pgm_rid
    -	출력			  :	
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.13
    ***************************************/ -->
    <select id="getProdListPop" parameterType="com.icignal.loyalty.common.dto.request.LoyCommonReqDto" 
    									resultType="com.icignal.loyalty.product.dto.response.LoyProdListResDto">
        /* LoyProductMapper.getProdListPop */
		select 
			   lp.RID as rid
		     , lp.PROD_ID as prodId
		     , lp.PROD_NM as prodNm
		     , lp.PROD_AMT as prodAmt
		     , lp.RID_BRD_CAT as brdId
		     , lbc.BRD_NM as brdNm
		     , lp.RID_PROD_CAT catId
		     , lpc.CAT_NM as catNm 
		     , lp.RID_CHNL as chnlId
		     , lc.CHNL_NM as chnlNm
		  from loy.loy_prod lp WITH (NOLOCK)
			  left join loy.loy_brd_category lbc WITH (NOLOCK) on lp.RID_BRD_CAT = lbc.RID and lbc.FLAG = 1
			  left join loy.loy_prod_category lpc WITH (NOLOCK) on lp.RID_PROD_CAT = lpc.RID and lpc.FLAG = 1
			  left join LOY.LOY_CHNL lc WITH (NOLOCK) on lp.RID_CHNL = lc.RID and lc.FLAG = 1
		  where ${strSVCType} 
		    and ${strWhere}
		    and lp.flag 		= 1
		    and lp.rid_pgm 	= #{loyProgramId}
		  order by ${strOrderby}
		 ${strEndPaging}	
    </select>
	
	<!-- /**************************************
    -   관련 파일            : LoyProductMapperDAO.java (getProdList)
    ============================================
    -   제목                   : 상품 목록 조회
    -   설명                   : 상품 목록 조회
    -   결과형태             : 복수
    ============================================
    -   입력			  : accountId
    -	출력			  :	
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.09
    -   수정자                : 노형래
    -   수정일                : 2020.07.22
    ***************************************/ -->
   <select id="getProdList" parameterType="com.icignal.loyalty.product.dto.request.LoyGetProdListReqDto" 
   									resultType="com.icignal.loyalty.product.dto.response.LoyGetProdListResDto">
    /* LoyProductMapper.getProdList */
	   SELECT lp.RID AS rid
		  , lp.RID_PGM AS ridPgm /* 로열티 프로그램 rid*/
		  , lp.RID_PROD_CAT AS ridProdCat /* 상품 카테고리 rid*/
		  , lp.RID_CHNL AS ridChnl /* 채널 마스터 rid*/
		  , lp.PROD_ID AS prodId
		  , lp.PROD_NM AS prodNm /* 상품명 */
		  , lp.PROD_AMT AS prodAmt
		  , e.NAME       AS createBy
		  , lp.PROD_TYPE AS prodTypeCd
		  , lp.RID_CHNL AS ridChnl
		  , lp.BASE_YMD AS baseYmd
		  , lp.COLOR AS color
		  , lpc.CAT_NM AS catNm
		  , lc.CHNL_NM AS chnlNm
		  , convert(varchar, lp.CREATE_DATE, 120) AS createDate
		  , ${strColumn}
		FROM LOY.LOY_PROD lp WITH (NOLOCK)
			LEFT OUTER JOIN loy.LOY_PROD_CATEGORY lpc WITH (NOLOCK) ON lpc.RID = lp.RID_PROD_CAT AND lpc.FLAG = 1
			JOIN LOY.LOY_CHNL lc WITH (NOLOCK) ON lc.RID = lp.RID_CHNL AND lc.FLAG = 1
			LEFT OUTER JOIN com.CRM_USER cu WITH (NOLOCK) ON lp.CREATE_BY = cu.rid AND cu.FLAG = 1
			LEFT OUTER JOIN com.EMPLOYEE e  WITH (NOLOCK) ON cu.ID_EMPLOYEE = e.id AND e.FLAG = 1
		WHERE ${strCondWhere}
			and ${strSVCType}
			and ${strWhere}
			and lp.FLAG = 1
		 order by ${strOrderby}
				${strEndPaging}
    </select>

	<!--  /**************************************
    -   관련 파일            : LoyProductMapperDAO.java (getProdDtl)
    ============================================
    -   제목                   : 상품 목록 상세조회
    -   설명                   : 상품 목록 상세조회
    -   결과형태             : 단수
    ============================================
    -   입력			  : accountId
    -	출력			  :	
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.09
    ***************************************/ -->
   <select id="getProdDtl" parameterType="com.icignal.loyalty.product.dto.request.LoyGetProdListReqDto" 
   									resultType="com.icignal.loyalty.product.dto.response.LoyGetProdListResDto">
        /* LoyProductMapper.getProdDtl */
		 select lp.rid            as rid          
		      , lp.rid_pgm        as ridPgm           /* 로열티 프로그램 rid*/
		     <!--  , lp.rid_brd_cat    as ridBrdCat -->        /* 브랜드 카테고리 rid*/
		     <!--  , lbc.brd_nm        as brdNm -->
		      , lp.rid_prod_cat   as ridProdCat       /* 상품 카테고리 rid*/
		      , lpc.cat_nm        as catNm
		      , lp.rid_chnl       as ridChnl          /* 채널 마스터 rid*/
		      , lc.chnl_nm        as chnlNm
		      , lp.prod_id        as prodId
		      , lp.prod_nm        as prodNm           /* 상품명 */
		      , lp.prod_amt       as prodAmt
		      , e.NAME            as createBy
		     <!--  , t1.CODE_NAME	  as prodType -->
		      , lp.PROD_TYPE as prodTypeCd
		      , convert(varchar, lp.create_date, 120) as createDate
		      , lp.color		  as color 
		   from loy.loy_prod lp WITH (NOLOCK)
			   left outer join loy.loy_brd_category lbc WITH (NOLOCK) on lbc.rid = lp.rid_brd_cat and lbc.flag = 1
			   left outer join loy.loy_prod_category lpc WITH (NOLOCK) on lpc.rid = lp.rid_prod_cat and lpc.flag = 1
			   left outer join LOY.LOY_CHNL lc WITH (NOLOCK) on lc.rid = lp.rid_chnl and lc.flag = 1
			   left outer join com.crm_user cu WITH (NOLOCK) on lp.create_by = cu.rid
			   left outer join com.employee e WITH (NOLOCK) on cu.id_employee = e.id
		   <!-- LEFT OUTER JOIN com.COMM_CODE t1 ON	t1.CODE_NAME = lp.PROD_TYPE AND t1.GROUP_CODE = 'LOY_PROD_TYPE'	AND t1.FLAG = 1 -->
		  where ${strSVCType} 
		    and lp.flag 		= 1
		    and lp.rid_pgm 	= #{loyProgramId}
		    and lp.rid 		= #{rid}
    </select>
 	
 	<!-- /**************************************
    -   관련 파일            : LoyProductMapperDAO.java (setProdDtl)
    ============================================
    -   제목                   : 상세상품 저장
    -   설명                   : 상세상품 저장
    -   결과형태             : 단수
    ============================================
    -   입력			  : accountId
    -	출력			  :	
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.09
    ***************************************/ -->
     <insert id="setProdDtl" parameterType="com.icignal.loyalty.product.dto.request.LoySetProdListReqDto">
	 /* LoyProductMapper.setProdDtl */
		insert into loy.loy_prod( 
		       rid
		     , flag
		     , create_date
		     , create_by
		     , modify_date
		     , modify_by
		     , prod_id
		     , prod_nm
		     , prod_amt
		     , rid_chnl
		     , rid_pgm
		     , rid_prod_cat
		     <!-- , rid_brd_cat -->
		     , prod_type
		     , base_ymd
		     , color
		) values (
		       #{rid}
		     , 1
		     , getdate()
		     , #{createBy}
		     , getdate()
		     , #{modifyBy}
		     , #{prodId}
		     , #{prodNm}
		     , #{prodAmt}
		     , #{ridChnl}
		     , #{loyProgramId}
		     , #{ridProdCat}
		    <!--  , #{ridBrdCat} -->
		     , #{prodType}
		     , convert(varchar(8), getdate(), 112)
		     , #{prodColor} 
		)	 
		
	</insert>

	<!-- /**************************************
    -   관련 파일            : LoyProductMapperDAO.java (editProdDtl)
    ============================================
    -   제목                   : 상세상품 수정
    -   설명                   : 상세상품 수정
    -   결과형태             : 단수
    ============================================
    -   입력			  : accountId
    -	출력			  :	
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.09
    ***************************************/ -->
	<update id="editProdDtl" parameterType="com.icignal.loyalty.product.dto.request.LoyEditProdListReqDto">
		/* LoyProductMapper.editProdDtl */
		update loy.loy_prod
	   	set modify_date   = getdate()
		     , modify_by     = #{modifyBy}
		     , prod_id       = #{prodId}
		     , prod_nm       = #{prodNm}
		     , rid_chnl      = #{ridChnl}
		     , rid_prod_cat  = #{ridProdCat}
		    <!--  , rid_brd_cat   = #{ridBrdCat} -->
		     , PROD_AMT	= #{prodAmt} 
		     , PROD_TYPE 	= #{prodType} 
		     , color		 = #{prodColor}
	 	where rid           = #{rid}
	</update>   

	<!-- /**************************************
    -   관련 파일            : LoyProductMapperDAO.java (getProdChk)
    ============================================
    -   제목                   : 상품명 중복 체크
    -   설명                   : 상품명 중복 체크
    -   결과형태             : 단수
    ============================================
    -   입력			  : accountId
    -	출력			  :	
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.09
    ***************************************/ -->
	<select id="getProdChk" parameterType="com.icignal.loyalty.product.dto.request.LoyGetProdListReqDto" 
									resultType="com.icignal.loyalty.product.dto.response.LoyGetProdListResDto">
        /* LoyProductMapper.getProdChk */
		select count(*) as cnt
		from loy.loy_prod lp
	  	where ${strSVCType}
			and lp.flag 		= 1
			and lp.rid_pgm 	= #{loyProgramId}
			and lp.prod_id  = #{prodId}
    </select>
   
   <!-- /**************************************
    -   관련 파일            : LoyProductMapperDAO.java (getCategoryList)
    ============================================
    -   제목                   : 상품카테고리 조회
    -   설명                   : 상품카테고리 조회
    -   결과형태             : 복수
    ============================================
    -   입력			  : accountId
    -	출력			  :	
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.09
    ***************************************/ --> 
   <select id="getCategoryList" parameterType="com.icignal.loyalty.product.dto.request.LoyGetCategoryListReqDto" 
   											resultType="com.icignal.loyalty.product.dto.response.LoyGetCategoryListResDto">
        /* LoyProductMapper.getCategoryList */
		SELECT lpc.RID           as rid
			 , lpc.RID_PGM       as ridPgm
			 , lpc.PAR_RID       as parRid
			 , lpc2.CAT_ID         as parCatId
			 , lpc2.CAT_NM         as parCatNm          /* 상위 카테고리 명 */
			 , lpc.CAT_ID        as catId
			 , lpc.CAT_NM        as catNm             /* 카테고리 명 */
			 , lpc.CAT_DESCTXT   as catDesctxt        /* 카테고리 설명 */
			 , e.NAME            as createBy
			 , convert(varchar, lpc.CREATE_DATE, 120) as createDate
			 , ${strColumn}
		  FROM LOY.LOY_PROD_CATEGORY lpc WITH (NOLOCK)
			  LEFT OUTER JOIN LOY.LOY_PROD_CATEGORY lpc2 WITH (NOLOCK) on lpc2.RID = lpc.PAR_RID and lpc2.FLAG = 1
			  LEFT OUTER JOIN COM.CRM_USER cu WITH (NOLOCK)	ON lpc.CREATE_BY = cu.RID
			  LEFT OUTER JOIN COM.EMPLOYEe e WITH (NOLOCK) ON cu.ID_EMPLOYEE = e.ID
		  WHERE ${strCondWhere}
		  	AND ${strWhere}
		    AND lpc.FLAG = 1
		   <!--  and lpc.RID_PGM 	= #{loyProgramId} -->
		  ORDER BY ${strOrderby}
		 ${strEndPaging}	  
    </select>    

	<!-- /**************************************
    -   관련 파일            : LoyProductMapperDAO.java (getCategoryDtl)
    ============================================
    -   제목                   : 상품카테고리 상세조회
    -   설명                   : 상품카테고리 상세조회
    -   결과형태             : 단수
    ============================================
    -   입력			  : accountId
    -	출력			  :	
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.09
    ***************************************/ -->
   <select id="getCategoryDtl" parameterType="com.icignal.loyalty.product.dto.request.LoyGetCategoryListReqDto" 
   											resultType="com.icignal.loyalty.product.dto.response.LoyGetCategoryListResDto">
        /* LoyProductMapper.getCategoryDtl */
		select lpc.rid           as rid
		     , lpc.rid_pgm       as ridPgm
		     , lpc.par_rid       as parRid
		     , lp.cat_id         as parCatId
		     , lp.cat_nm         as parCatNm          /* 상위 카테고리 명 */
		     , lpc.cat_id        as catId
		     , lpc.cat_nm        as catNm             /* 카테고리 명 */
		     , lpc.cat_desctxt   as catDesctxt        /* 카테고리 설명 */
		     , e.NAME            as createBy
		     , convert(varchar, lpc.create_date, 120) as createDate
		  from loy.loy_prod_category lpc WITH (NOLOCK)
			  left join loy.loy_prod_category lp 	WITH (NOLOCK) on lp.rid 			= lpc.par_rid and lp.flag = 1
			  left outer join com.crm_user cu 	WITH (NOLOCK) on lpc.create_by 	= cu.rid
			  left outer join com.employee e 	WITH (NOLOCK) on cu.id_employee 	= e.id
		  where ${strSVCType} 
		    and lpc.flag 		= 1
		    and lpc.rid_pgm 	= #{loyProgramId}
		    and lpc.rid         = #{rid} 
		    and lpc.cat_id      = #{catId}
    </select> 
   
   	<!-- /**************************************
    -   관련 파일            : LoyProductMapperDAO.java (setCategoryDtl)
    ============================================
    -   제목                   : 상품카테고리 저장
    -   설명                   : 상품카테고리 저장
    -   결과형태             : 단수
    ============================================
    -   입력			  : accountId
    -	출력			  :	
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.09
    ***************************************/ --> 
    <insert id="setCategoryDtl" parameterType="com.icignal.loyalty.product.dto.request.LoySetCategoryListReqDto">
	 /* LoyProductMapper.setCategoryDtl */
		insert into loy.loy_prod_category( 
		       rid
		     , rid_pgm
		     , cat_id
		     , cat_nm
		     , par_rid
		     , cat_desctxt
		     , flag
		     , mod_num
		     , create_date
		     , create_by
		     , modify_date
		     , modify_by
		     , CTG_TYPE_CD
		) values (
		       #{rid}
		     , #{loyProgramId}
		     , #{catId}  
		     , #{catNm}
		     , #{parRid}
		     , #{catDesctxt}
		     , 1
		     , 0
		     , getdate()
		     , #{createBy}
		     , getdate()
		     , #{modifyBy}
		     , 'PROD'
		) 
	
	</insert>

	<!-- /**************************************
    -   관련 파일            : LoyProductMapperDAO.java (editCategoryDtl)
    ============================================
    -   제목                   : 상품카테고리 수정
    -   설명                   : 상품카테고리 수정
    -   결과형태             : 단수
    ============================================
    -   입력			  : accountId
    -	출력			  :	
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.09
    ***************************************/ -->
	<update id="editCategoryDtl" parameterType="com.icignal.loyalty.product.dto.request.LoyEditCategoryListReqDto">
		/* LoyProductMapper.editCategoryDtl */
		update loy.loy_prod_category
		   set cat_id        = #{catId}
		     , cat_nm        = #{catNm}
		     , par_rid       = #{parRid}
		     , cat_desctxt   = #{catDesctxt}
		     , modify_date   = getdate()
		     , modify_by     = #{modifyBy}
		     , mod_num       = mod_num+1
		 where rid           = #{rid}		
	</update>   

	<!-- /**************************************
    -   관련 파일            : LoyProductMapperDAO.java (getCategoryChk)
    ============================================
    -   제목                   : 상품카테고리명 중복 체크
    -   설명                   : 상품카테고리명 중복 체크
    -   결과형태             : 단수
    ============================================
    -   입력			  : accountId
    -	출력			  :	
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.09
    ***************************************/ -->	
	<select id="getCategoryChk" parameterType="com.icignal.loyalty.product.dto.request.LoyGetCategoryListReqDto" 
											resultType="com.icignal.loyalty.product.dto.response.LoyGetCategoryListResDto">
        /* LoyProductMapper.getCategoryChk */
			select count(*) as cnt
			from loy.loy_prod_category lpc
			where ${strSVCType}
				and lpc.flag 		= 1
				and lpc.rid_pgm 	= #{loyProgramId}
				and lpc.cat_id  	= #{catId}
    </select>
    
<!-- /**************************************
    -   관련 파일             : LoyProductMappeructDAO.java
    ============================================
    -   제목                  : 제품 조회 팝업 
    -   설명                  : SearchHelp
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원  
    -   작성일                : 2017.10.16
    ***************************************/ -->    
    <select id="getProdSearchHelp" parameterType="com.icignal.loyalty.product.dto.request.LoyProductSearchHelpReqDto" 
    											resultType="com.icignal.loyalty.product.dto.response.LoyProductSearchHelpResDto">
        /* LoyProductMapper.getProdSearchHelp */
		 select 
		 	 a.rid     			   as rid
		 	,b.chnl_no             as chnlNo
			,b.chnl_nm             as chnlNm
			,a.prod_type_lv1       as prodTypeLv1
			,a.prod_type_lv2       as prodTypeLv2
			,a.prod_id             as prodId
			,a.prod_nm             as prodNm
			,a.compn_use_yn        as compnUseYn
			,a.desc1               as desc1
	   	from loy.loy_prod a  WITH (NOLOCK)
		   left outer join LOY.LOY_CHNL b WITH (NOLOCK) on a.rid_chnl = b.rid
	   	where ${strCondWhere}
		    and ${strSVCType} 
		  	and ${strWhere}
		    and a.flag 		= 1
<!-- 		    and a.rid_pgm 	= #{loyProgramId} -->
	  	order by ${strOrderby}
	 		${strEndPaging}
    </select>	
    
    
    <!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 목록
    -   설명                  : 상품 목록 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
    <select id="getProductList" parameterType="com.icignal.loyalty.product.dto.request.LoyProductListReqDto" 
    										resultType="com.icignal.loyalty.product.dto.response.LoyProductListResDto">
	 /* LoyProductMapper.getProductList */   
	    SELECT 
	    	lc.CHNL_NO as chnlNo
		   ,lc.CHNL_NM as chnlNm
	       ,lp.PROD_ID as prodId
	       ,lp.PROD_NM as prodNm
	       ,lp.DESC1 as desc1
	       <!-- ,cc3.MARK_NAME as statusCd -->
	       , lp.STATUS_CD as statusCdNm
	       ,lc.rid as ridChnl
	       ,lp.rid as rid
		FROM loy.loy_prod lp WITH (NOLOCK)
			LEFT OUTER JOIN  LOY.LOY_CHNL lc WITH (NOLOCK) on lp.RID_CHNL = lc.RID
		<!-- LEFT OUTER JOIN com.comm_code cc3 on cc3.CODE_NAME = lp.STATUS_CD and cc3.GROUP_CODE = 'PRODUCT_STATUS' and cc3.FLAG=1 and cc3.LANG=#{lang} -->
    	WHERE ${strCondWhere}
			AND ${strSVCType}
			AND ${strWhere}
		ORDER by ${strOrderby}
			${strEndPaging}
     </select>
    
    
    <!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 상세 정보 등록
    -   설명                  : 상품 상세 정보 등록
    -   결과형태              : 
    ============================================
    -   입력
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
     <insert id="insertProductDetail" parameterType="com.icignal.loyalty.product.dto.request.LoyProductInsertReqDto">
     /* LoyProductMapper.insertProductDetail */
    	insert into loy.loy_prod(
			RID
			,CREATE_BY
			,MODIFY_BY
			,CREATE_DATE
			,MODIFY_DATE
			,FLAG
			,RID_CHNL
			,PROD_TYPE_LV1
			,PROD_TYPE_LV2
			,PROD_ID
			,PROD_NM
			,COMPN_USE_YN
			,DESC1
			,STATUS_CD
			,ENIS_SETL_METH
			,TAXTN_YN
			<if test="taxtnOccAmt != null and taxtnOccAmt != ''">
			,TAXTN_OCC_AMT
			</if>
			<if test="taxtnRate != null and taxtnRate != ''">
			,TAXTN_RATE
			</if>
			,TAXTN_PROD_CD
			,RID_TAXTN
			,TAXFR_PROD_CD
			,RID_TAXFR
			,COPLEX_PROD_FLG
			,PROD_NICK_NM
			,BARCODE
			,PRICE
			,PRICE_FLG
		)
		values(
			#{rid}
			,#{empId}
			,#{empId}
			,getdate()
			,getdate()
			,1
			,#{ridChnl}
			,#{prodTypeLv1}
			,#{prodTypeLv2}
			,#{prodId}
			,#{prodNm}
			,#{compnUseYn}
			,#{desc1}
			,#{statusCd}
			,#{enisSetlMeth}
			,#{taxtnYn}
			<if test="taxtnOccAmt != null and taxtnOccAmt != ''">
			,#{taxtnOccAmt}
			</if>
			<if test="taxtnRate != null and taxtnRate != ''">
			,#{taxtnRate}
			</if>
			,#{taxtnProdCd}
			,#{ridTaxtn}
			,#{taxfrProdCd}
			,#{ridTaxfr}
			,#{coplexProdFlg}
			,#{prodNickNm}
			,#{barcode}
			<if test="price == null or price == ''">
			,null
			</if>
			<if test="price != null and price != ''">
			,#{price}
			</if>
			,#{priceFlg}
		)
		<selectKey keyProperty="" resultType="java.lang.Integer">
				select 1
		</selectKey>
    </insert>
   
   
    <!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 상세 정보
    -   설명                  : 상품 상세 정보 조회
    -   결과형태              : 리스트
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
     <select id="getProductDetail" parameterType="com.icignal.loyalty.product.dto.request.LoyProductListReqDto" 
     											resultType="com.icignal.loyalty.product.dto.response.LoyProductListResDto">
     /* LoyProductMapper.getProductDetail */
	    SELECT 
	    	lc.CHNL_NO as chnlNo
		   ,lc.CHNL_NM as chnlNm
	       ,lp.PROD_TYPE_LV1 as prodTypeLv1
	       ,lp.PROD_TYPE_LV2 as prodTypeLv2
	       ,lp.PROD_ID as prodId
	       ,lp.PROD_NM as prodNm
	       ,lp.COMPN_USE_YN as compnUseYn
	       ,lp.DESC1 as desc1
	       ,lp.STATUS_CD as statusCdNm
	       ,lp.ENIS_SETL_METH as enisSetlMeth
	       ,lp.TAXTN_YN as taxtnYn
	       ,lp.TAXTN_OCC_AMT as taxtnOccAmt
	       ,lp.TAXTN_RATE as taxtnRate
	       ,lp.TAXTN_PROD_CD as taxtnProdCd
	       ,lp2.PROD_NM as taxtnProdNm
	       ,lp.TAXFR_PROD_CD as taxfrProdCd
	       ,lp3.PROD_NM as taxfrProdNm
	       ,lp.RID_TAXTN as ridTaxtn
	       ,lp.RID_TAXFR as ridTaxfr
	       ,lc.rid as ridChnl
	       ,lp.rid as rid
	       ,lp.COPLEX_PROD_FLG   as coplexProdFlg
	       ,lp.PROD_NICK_NM as prodNickNm 
	       ,lp.BARCODE as barcode
	       ,lp.PRICE as  price
	       ,lp.PRICE_FLG as priceFlg
		FROM loy.loy_prod lp WITH (NOLOCK)
			LEFT OUTER JOIN  LOY.LOY_CHNL lc WITH (NOLOCK) on lp.RID_CHNL = lc.RID
			<!-- LEFT OUTER JOIN com.comm_code cc3 on cc3.CODE_NAME = lp.STATUS_CD and cc3.GROUP_CODE = 'PRODUCT_STATUS' and cc3.FLAG=1 and cc3.LANG=#{lang}   -->
			LEFT OUTER JOIN loy.loy_prod lp2 WITH (NOLOCK) ON lp2.RID = lp.RID_TAXTN
			LEFT OUTER JOIN loy.loy_prod lp3 WITH (NOLOCK) ON lp3.RID = lp.RID_TAXFR
		WHERE lp.rid = #{rid}
     </select>
    
    
   <!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 가격 목록 
    -   설명                  : 상품 가격 목록 조회
    -   결과형태              : 리스트
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
     <select id="getProductPriceList" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto" 
     											resultType="com.icignal.loyalty.product.dto.response.LoyProductDtlTabInfoResDto">    
    	/* LoyProductMapper.getProductPriceList */
    	SELECT  
    		lpp.POINT_APPLY_PRICE as pointApplyPrice
			,lpp.MBRBS_SPL_PRICE as mbrbsSplPrice
			,lpp.APLY_START_DD as aplyStartDd
			,lpp.APLY_END_DD as aplyEndDd
			,lpp.RID_PROD as ridProd
			,lpp.rid as rid
		FROM loy.loy_prod_price lpp WITH (NOLOCK)
			INNER JOIN loy.loy_prod lp WITH (NOLOCK) on lpp.RID_PROD =  lp.rid
		WHERE ${strCondWhere}
			AND ${strSVCType}
			AND lp.rid = #{rid}
			AND lpp.flag = 1
			AND ${strWhere}
		ORDER by ${strOrderby}
			${strEndPaging}	
	</select>
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 날짜 유효성 체크
    -   설명                  : 날짜 유효성 체크
    -   결과형태              : 리스트
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
	<select id="checkProdPriceValidationDate" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto" 
																resultType="com.icignal.loyalty.product.dto.response.LoyProductDtlTabInfoResDto"> 
	/* LoyProductMapper.checkProdPriceValidationDate */   
		SELECT  
			rid as rid
			,RID_PROD as ridProd
			,MBRBS_SPL_PRICE as mbrbsSplPrice
			,POINT_APPLY_PRICE as pointApplyPrice
		FROM loy.loy_prod_price
		WHERE 1=1
			AND rid != #{rid}
			AND FLAG=1
			AND RID_PROD =#{ridProd}
			AND  (APLY_START_DD  &lt;= convert(varchar(10), #{aplyStartDd}, 120) and APLY_END_DD &gt;=  convert(varchar(10), #{aplyStartDd}, 120)
				  OR APLY_START_DD &lt;= convert(varchar(10), #{aplyEndDd}, 120) and APLY_END_DD &gt;= convert(varchar(10), #{aplyEndDd}, 120)
				  OR APLY_START_DD  &gt;=  convert(varchar(10), #{aplyStartDd}, 120) and APLY_END_DD  &lt;= convert(varchar(10), #{aplyEndDd}, 120)
			  )
	</select>
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 가격 정보 등록
    -   설명                  : 상품 가격 정보 등록
    -   결과형태              : 
    ============================================
    -   입력			   : 
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
    <insert id="insertProductPrice" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto">
    /* LoyProductMapper.insertProductPrice */
    	insert into loy.loy_prod_price(
			RID
			,CREATE_BY
			,MODIFY_BY
			,CREATE_DATE
			,MODIFY_DATE
			,FLAG
			,RID_PROD
			<if test="mbrbsSplPrice != null and mbrbsSplPrice != ''">
			,MBRBS_SPL_PRICE
			</if>

			,POINT_APPLY_PRICE
			,APLY_START_DD
			,APLY_END_DD
		)
		values(
			#{rid}
			,#{empId}
			,#{empId}
			,getdate()
			,getdate()
			,1
			,#{ridProd}
			 <if test="mbrbsSplPrice != null and mbrbsSplPrice != ''">
				,#{mbrbsSplPrice}
			</if>

			,#{pointApplyPrice}
			, convert(varchar(10), #{aplyStartDd}, 120)
			, convert(varchar(10), #{aplyEndDd}, 120)
		)
		<selectKey keyProperty="" resultType="java.lang.Integer">
				select 1
		</selectKey>
    </insert>
    
    
   <!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 삭제 유효성 체크
    -   설명                  : 삭제 유효성 체크
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
    <select id="checkDelPriceValidation" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto" 
    													resultType="com.icignal.loyalty.product.dto.response.LoyProductDtlTabInfoResDto">  
    /* LoyProductMapper.checkDelPriceValidation */  
		SELECT 
			rid as rid
		FROM loy.loy_prod_price
		WHERE 1=1
			AND rid =#{rid}
			AND FLAG=1
			AND   (
				APLY_START_DD  &lt;= getdate()
		 		AND  APLY_END_DD  &gt;= getdate()
		 	)
	</select>
    
    <!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 가격 삭제
    -   설명                  : 상품 가격 삭제
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
    <update id="deleteProductPrice" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto">
    /* LoyProductMapper.deleteProductPrice */
	    UPDATE loy.loy_prod_price
		set flag = flag + 1
			,MODIFY_DATE = getdate()
	   		,MODIFY_BY = #{empId}
		WHERE rid=#{rid}
    </update>
    
    <!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 삭제
    -   설명                  : 상품 삭제
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : dw.ekum  
    -   작성일                : 2019.06.14
    ***************************************/ -->
    <update id="deleteProd" parameterType="com.icignal.loyalty.product.dto.request.LoyProdSpecReqDto">
    /* LoyProductMapper.deleteProd */
	    UPDATE loy.loy_prod
		set flag = flag + 1
			,MODIFY_DATE = getdate()
	   		,MODIFY_BY = #{modifyBy}
		WHERE rid=#{rid}
    </update>
    
     <!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 코드 목록
    -   설명                  : 상품 코드 목록 조회
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
    <select id="getProductCodeList" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto" 
    											resultType="com.icignal.loyalty.product.dto.response.LoyProductDtlTabInfoResDto">   
    /* LoyProductMapper.getProductCodeList */ 
		SELECT  
			lpch.START_DD as startDd
		   ,lpch.END_DD as endDd
		   ,lpch.PROD_NM as prodNm
		   ,lc.CHNL_NM as chnlNm
		   ,lc.CHNL_NO as chnlNo
		   ,lpch.DESC1 as desc1
		   ,lpch.RID_CHNL as ridChnl
		   ,lpch.RID_PROD as ridProd
		   ,lpch.rid as rid
		FROM LOGS.loy_prod_chg_hist lpch WITH (NOLOCK)
			INNER JOIN LOY.LOY_CHNL lc WITH (NOLOCK) on lc.rid = lpch.RID_CHNL
			INNER JOIN loy.loy_prod lp WITH (NOLOCK) on lp.rid = lpch.RID_PROD
		WHERE ${strCondWhere}
			AND ${strSVCType}
			AND lp.rid = #{rid}
			AND lpch.flag = 1
			AND ${strWhere}
		ORDER by ${strOrderby}
			${strEndPaging}
	</select>
	
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 코드 상세정보 등록
    -   설명                  : 상품 코드 상세정보 등록
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
	<insert id="insertProductCodeDetail" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto">
	/* LoyProductMapper.insertProductCodeDetail */
    	insert into LOGS.loy_prod_chg_hist(
			RID
			,CREATE_BY
			,MODIFY_BY
			,CREATE_DATE
			,MODIFY_DATE
			,FLAG
			,START_DD
			,END_DD
			,PROD_NM
			,DESC1
			,RID_CHNL
			,RID_PROD
		)
		values(
			#{rid}
			,#{empId}
			,#{empId}
			,getdate()
			,getdate()
			,1
			,convert(varchar(10), #{startDd}, 120)
			,convert(varchar(10), #{endDd}, 120)
			,#{prodNm}
			,#{desc1}
			,#{ridChnl}
			,#{ridProd}
		)
		<selectKey keyProperty="" resultType="java.lang.Integer">
				select 1
		</selectKey>
    </insert>
    
   	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 날짜 유효성 체크
    -   설명                  : 날짜 유효성 체크
    -   결과형태              : 
    ============================================
    -   입력			   : ridProd
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
    <select id="checkProdCodeValidationDate" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto" 
    														resultType="com.icignal.loyalty.product.dto.response.LoyProductDtlTabInfoResDto">    
    /* LoyProductMapper.checkProdCodeValidationDate */
		SELECT rid
		FROM LOGS.loy_prod_chg_hist
		WHERE 1=1
			AND FLAG=1
			AND RID_PROD =#{ridProd}
			AND  ( (START_DD  &lt;= convert(varchar(10), #{startDd}, 120) and END_DD &gt;=  convert(varchar(10), #{startDd}, 120))
				  OR (START_DD &lt;= convert(varchar(10), #{endDd}, 120) and END_DD &gt;= convert(varchar(10), #{endDd}, 120))
				  OR (START_DD  &gt;=  convert(varchar(10), #{startDd}, 120) and END_DD  &lt;= convert(varchar(10), #{endDd}, 120))
			  )
	</select>
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 날짜 유효성 체크
    -   설명                  : 날짜 유효성 체크
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
    <select id="checkDelCodeValidation" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto" 
    													resultType="com.icignal.loyalty.product.dto.response.LoyProductDtlTabInfoResDto">   
    /* LoyProductMapper.checkDelCodeValidation */ 
		SELECT 
			rid as rid
		FROM LOGS.loy_prod_chg_hist
		WHERE 1=1
			AND rid =#{rid}
			AND FLAG=1
			AND   (START_DD  &lt;= getdate()
				 AND  END_DD  &gt;= getdate()
		 	)
	</select>
    
   <!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 코드 삭제
    -   설명                  : 상품 코드 삭제
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
    <update id="deleteProductCode" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto">
    /* LoyProductMapper.deleteProductCode */
	    UPDATE LOGS.loy_prod_chg_hist
		set flag = flag + 1
			,MODIFY_DATE = getdate()
	   		,MODIFY_BY = #{empId}
		WHERE rid=#{rid}
    </update>
    
    
    <!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 코드id 조회
    -   설명                  : 상품 코드id 조회
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
    <select id="getProdutCodeId" parameterType="com.icignal.loyalty.product.dto.request.LoyProductInsertReqDto" 
    											resultType="com.icignal.loyalty.product.dto.response.LoyProductListResDto">
	 /* LoyProductMapper.getProdutCodeId */ 
	    SELECT rid as rid
	    FROM loy.loy_prod
	    WHERE PROD_ID = #{prodId}
	</select>
	
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 상세 정보 수정
    -   설명                  : 상품 상세 정보 수정
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
	<update id="updateProductDetail" parameterType="com.icignal.loyalty.product.dto.request.LoyProductInsertReqDto">
	/* LoyProductMapper.updateProductDetail */
		UPDATE loy.loy_prod
		SET    MODIFY_DATE = getdate()
			   ,MODIFY_BY = #{empId}
			   ,PROD_TYPE_LV1 = #{prodTypeLv1}
		       ,PROD_TYPE_LV2 = #{prodTypeLv2}
		       ,PROD_ID = #{prodId}
		       ,PROD_NM = #{prodNm}
		       ,COMPN_USE_YN = #{compnUseYn}
		       ,DESC1 = #{desc1}
		       ,STATUS_CD = #{statusCd}
		       ,ENIS_SETL_METH = #{enisSetlMeth}
		       ,TAXTN_YN = #{taxtnYn}
		       <if test="taxtnOccAmt != null and taxtnOccAmt != ''">
		            ,TAXTN_OCC_AMT = #{taxtnOccAmt}
		       </if>
		       <if test="taxtnRate != null and taxtnRate != ''">
		            ,TAXTN_RATE = #{taxtnRate}
		       </if>
		       ,TAXTN_PROD_CD = #{taxtnProdCd}
		       ,TAXFR_PROD_CD = #{taxfrProdCd}
		       ,RID_TAXTN = #{ridTaxtn}
		       ,RID_TAXFR = #{ridTaxfr}
		       ,RID_CHNL = #{ridChnl}
		       ,COPLEX_PROD_FLG =  #{coplexProdFlg}  
		       ,PROD_NICK_NM =  #{prodNickNm}
		       ,BARCODE =  #{barcode}
		       <if test="price == null or price == ''">
		       	,PRICE = null
		       </if>
		       <if test="price != null and price != ''">
		       ,PRICE =  #{price}
		       </if>
		       ,PRICE_FLG = #{priceFlg}
		WHERE RID = #{rid}
	</update>
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 상태 수정
    -   설명                  : 상품 상태 수정
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
	<update id="updateProdStatusCd" parameterType="com.icignal.loyalty.product.dto.request.LoyProductInsertReqDto">
	/* LoyProductMapper.updateProdStatusCd */
		UPDATE loy.loy_prod
		SET  STATUS_CD = 10
		WHERE RID = #{rid}
	</update>
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 가격 상세정보
    -   설명                  : 상품 가격 상세정보 조회
    -   결과형태              : 단일
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
	<select id="getProductPriceDtl" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto" 
												resultType="com.icignal.loyalty.product.dto.response.LoyProductDtlTabInfoResDto">
	/* LoyProductMapper.getProductPriceDtl */
		SELECT POINT_APPLY_PRICE as pointApplyPrice
		   	   ,MBRBS_SPL_PRICE as mbrbsSplPrice
	       	   ,convert(varchar(10), APLY_START_DD,120) as aplyStartDd
	       	   ,convert(varchar(10), APLY_END_DD,120) as aplyEndDd
	       	   ,RID_PROD as ridProd
		FROM loy.loy_prod_price lpp WITH (NOLOCK)
			INNER JOIN loy.loy_prod lp WITH (NOLOCK) on lpp.RID_PROD = lp.rid
		where 1=1
			AND lpp.RID=#{rid}
			AND lpp.flag=1
	</select>
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 가격 수정
    -   설명                  : 상품 가격 수정
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
	<update id="updateProductPrice" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto">
	/* LoyProductMapper.updateProductPrice */
		UPDATE loy.loy_prod_price
		SET MODIFY_BY = #{empId}
		   ,MODIFY_DATE = getdate()
			<if test="mbrbsSplPrice != null and mbrbsSplPrice != ''">
				,MBRBS_SPL_PRICE = #{mbrbsSplPrice}
			</if>
			,POINT_APPLY_PRICE  = #{pointApplyPrice}
			,APLY_START_DD =  convert(varchar(10), #{aplyStartDd}, 120)
			,APLY_END_DD =  convert(varchar(10), #{aplyEndDd}, 120)
		WHERE rid = #{rid}
	</update>
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 코드 상세 
    -   설명                  : 상품 코드 상세 조회
    -   결과형태              : 단일
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
	<select id="getProductCodeDetail" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto" 
													resultType="com.icignal.loyalty.product.dto.response.LoyProductDtlTabInfoResDto"> 
	/* LoyProductMapper.getProductCodeDetail */
	 	SELECT  convert(varchar(10), lpch.START_DD, 120)  as startDd
			   ,convert(varchar(10), lpch.END_DD, 120)  as endDd
		       ,lpch.PROD_NM as prodNm
		       ,lc.CHNL_NM as chnlNm
		       ,lc.CHNL_NO as chnlNo
		       ,lpch.DESC1 as desc1
		       ,lpch.rid as rid 
	 	FROM  LOGS.loy_prod_chg_hist  lpch WITH (NOLOCK)
	    	INNER JOIN LOY.LOY_CHNL lc WITH (NOLOCK) on lc.rid = lpch.RID_CHNL
	 	WHERE lpch.rid = #{rid}
	 		AND   lpch.flag = 1
	</select>
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 코드 정보 수정
    -   설명                  : 상품 코드 정보 수정
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
	<update id="updateProductCode" parameterType="com.icignal.loyalty.product.dto.request.LoyProductDtlTabInfoReqDto">
	/* LoyProductMapper.updateProductCode */
		UPDATE  LOGS.loy_prod_chg_hist 
		SET 	START_DD  = convert(varchar(10), #{startDd}, 120)
		    	,END_DD    = convert(varchar(10), #{endDd}, 120)
		    	,PROD_NM   = #{prodNm}
		    	,DESC1     = #{desc1}
		    	,RID_CHNL  = #{ridChnl}
		WHERE   RID = #{rid}
	</update>
	
	<!-- /**************************************
    -   관련 파일            : LoyProductMapperDAO.java (getProdSpecList)
    ============================================
    -   제목                   : 상품 스펙 목록 조회
    -   설명                   : 상품 스펙 목록 조회
    -   결과형태             : 복수
    ============================================
    -   입력			  :
    -	출력			  :
    ============================================
    -   작성자                : 이필수
    -   작성일                : 2018.05.21
    ***************************************/ -->
   <select id="getProdSpecList" parameterType="com.icignal.loyalty.product.dto.request.LoyProdSpecReqDto" 
   											resultType="com.icignal.loyalty.product.dto.response.LoyGetProdSpecListResDto">
        /* LoyProductMapper.getProdSpecList */
		SELECT 
			  lps.rid										as prodSpecRid
			, lps.rid_prod									as ridProd
			, lps.spec_type									as specType
			<!-- , c1.mark_name									as specTypeMark -->
			, lps.spec_type 								as specTypeCd
			, lps.spec_type_val								as specTypeVal
			, convert(varchar, lps.create_date, 120) 	as createDate
			, convert(varchar, lps.modify_date, 120) 	as modifyDate
			, ${strColumn}
		FROM loy.loy_prod_spec lps
		<!-- LEFT OUTER JOIN com.comm_code c1 ON c1.code_name = lps.spec_type and c1.GROUP_CODE = 'loy_prod_spec'	and c1.FLAG = 1	and c1.LANG = #{lang} -->
		WHERE ${strCondWhere}
		    and ${strSVCType} 
		    and ${strWhere}
		    and lps.rid_prod = #{ridProd}
		    and lps.flag = 1
		ORDER by ${strOrderby}
		${strEndPaging}	
    </select>
    
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 스펙 등록
    -   설명                  : 상품 스펙 등록
    -   결과형태              : 
    ============================================
    -   입력			  : rid
    ============================================
    -   작성자                : 이필수
    -   작성일                : 2018.05.21
    ***************************************/ -->
	<insert id="insertProdSpec" parameterType="com.icignal.loyalty.product.dto.request.LoyProdSpecReqDto">
	/* LoyProductMapper.insertProdSpec */
    	insert into loy.loy_prod_spec(
			RID
			, CREATE_BY
			, MODIFY_BY
			, CREATE_DATE
			, MODIFY_DATE
			, FLAG
			, RID_PROD
			, SPEC_TYPE
			, SPEC_TYPE_VAL
		) values (
			#{prodSpecRid} 
			, #{createBy} 
			, #{modifyBy} 
			, getdate()
			, getdate()
			, 1
			, #{ridProd}
			, #{specType}
			, #{specTypeVal}
		)
		<selectKey keyProperty="" resultType="java.lang.Integer">
				select 1
		</selectKey> 
    </insert>

	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 코드 정보 수정
    -   설명                  : 상품 코드 정보 수정
    -   결과형태              : 
    ============================================
    -   입력			   : rid
    ============================================
    -   작성자                : 김준기  
    -   작성일                : 2017.12.06
    ***************************************/ -->
	<update id="updateProdSpec" parameterType="com.icignal.loyalty.product.dto.request.LoyProdSpecReqDto">
	/* LoyProductMapper.updateProdSpec */
		UPDATE  loy.loy_prod_spec 
		SET 	MODIFY_BY  	= #{modifyBy} 
		    	, MODIFY_DATE   = getdate()
		    	, SPEC_TYPE   	= #{specType}
		    	, SPEC_TYPE_VAL = #{specTypeVal}
		WHERE   RID = #{prodSpecRid}
	</update>
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 상품 코드 브랜드명으로 조회
    -   설명                  :
    -   결과형태              : 
    ============================================
    -   입력			   : brdId
    ============================================
    -   작성자                : 김태욱
    -   작성일                : 2017.12.06
    ***************************************/ -->
	<!-- <select id="getProductByBrd"
											parameterType="com.icignal.loyalty.product.dto.request.LoyProductByBrdDto"
											resultType="com.icignal.loyalty.product.dto.request.LoyProductByBrdDto">
	/* LoyProductMapper.getProductByBrd */
		select 
			    lp.rid            as rid
			  , lp.rid_pgm        as ridPgm           /* 로열티 프로그램 rid*/
			  , lp.rid_brd_cat    as ridBrdCat        /* 브랜드 카테고리 rid*/
			  , lp.rid_prod_cat   as ridProdCat       /* 상품 카테고리 rid*/
			  , lp.rid_chnl       as ridChnl          /* 채널 마스터 rid*/
			  , lp.prod_id        as code
			  , lp.prod_nm        as value           /* 상품명 */
			  , lp.prod_amt       as prodAmt
	from loy.loy_prod lp
  INNER join loy.loy_brd_category lbc on lp.RID_BRD_CAT = lbc.RID
  and BRD_ID = #{brdId}
	</select> -->
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 중복상품 체크
    -   설명                  :
    -   결과형태              : 
    ============================================
    -   입력			   : brdId
    ============================================
    -   작성자                : dw.keum
    -   작성일                : 2019.06.14.
    ***************************************/ -->
	<select id="prodValidCnt" parameterType="String" resultType="com.icignal.loyalty.product.dto.response.LoyGetProdListResDto">
	/* LoyProductMapper.prodValidCnt */
		SELECT COUNT(*) AS cnt
		FROM LOY.LOY_PROD
		WHERE PROD_ID = #{rid}
	</select> 
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 중복상품 체크후 상품테이블에 insert
    -   설명                  :
    -   결과형태              : 
    ============================================
    -   입력			   : 
    ============================================
    -   작성자                : jh.seo
    -   작성일                : 2019.12.09.
    ***************************************/ -->
	<update id="tempTableInsert" parameterType="com.icignal.loyalty.product.dto.request.LoySetProdListReqDto">
	/* LoyProductMapper.tempTableInsert */
		MERGE INTO loy.LOY_PROD lp
            USING
      	(                               
			SELECT  *
			FROM loy.TEMP_LOY_PRD tlp2
			WHERE NOT EXISTS 
 			(
		 		SELECT  1
 		 		FROM loy.loy_prod lp
 		 		WHERE lp.prod_id=tlp2.prd_id
 			)
		) tlp
            ON (1=2)
		    WHEN NOT MATCHED THEN
		    INSERT 
		    (
		    		lp.RID
		    	   ,lp.FLAG
		    	   ,lp.CREATE_DATE
		    	   ,lp.CREATE_BY
		    	   ,lp.MODIFY_DATE
		    	   ,lp.MODIFY_BY
		    	   ,lp.PROD_ID
		    	   ,lp.PROD_NM
		    	   ,lp.PROD_TYPE
		    	   ,lp.RID_CHNL
		    	   ,lp.RID_PGM
		    	   ,lp.RID_PROD_CAT
		    	   <!-- ,lp.RID_BRD_CAT -->
		    	   ,lp.BASE_YMD
		    	   ,lp.COLOR
		    )
		    VALUES 
		    (
	 	    		#{rid}
		    	   ,1
		    	   ,getdate()
		    	   ,#{createBy}
		    	   ,getdate()
		    	   ,#{createBy}
		    	   ,tlp.PRD_ID
		    	   ,tlp.PRD_ID
		    	   ,#{prodType}
		    	   ,#{ridChnl}
		    	   ,#{loyProgramId}
		    	   ,#{ridProdCat}
		    	   <!-- ,(SELECT RID FROM loy.LOY_BRD_CATEGORY WHERE BRD_NM = tlp.BRD_TYPE) -->
		    	   ,tlp.BASE_YMD
		    	   ,tlp.color
		    )
		    
	</update>
	
	<!-- /**************************************
    -   관련 파일             : LoyProductMapperDAO.java
    ============================================
    -   제목                  : 임시 상품테이블 데이터 비우기
    -   설명                  :
    -   결과형태              : 
    ============================================
    -   입력			   : 
    ============================================
    -   작성자                : jh.seo
    -   작성일                : 2019.12.09.
    ***************************************/ -->
	<select id="deleteTempTable" parameterType="String" resultType="com.icignal.loyalty.product.dto.response.LoyGetProdListResDto">
	/* LoyProductMapper.dropTempTable */
		truncate table TEMP_LOY_PRD
		
	</select>
	
	<update id="deleteCategory" parameterType="com.icignal.loyalty.common.dto.request.LoyCommonReqDto">
	/* LoyProductMapper.deleteCategory */
		UPDATE LOY.LOY_PROD_CATEGORY
		SET
			MODIFY_BY = #{empId}
			, MODIFY_DATE = getdate()
			, flag = flag + 1
		WHERE RID = #{rid}
	</update>
	
	<update id="deleteProduct" parameterType="com.icignal.loyalty.common.dto.request.LoyCommonReqDto">
	/* LoyProductMapper.deleteProduct */
	<!-- UPDATE LOY.LOY_PROD
	SET
		MODIFY_BY = #{empId}
		, MODIFY_DATE = getdate()
		, flag = flag + 1
	WHERE RID = #{rid} -->
		DELETE FROM LOY.LOY_PROD WHERE RID = #{rid}
	</update>
	
	<update id="deleteProdSpec" parameterType="com.icignal.loyalty.product.dto.request.LoyProdSpecReqDto">
	/* LoyProductMapper.deleteProdSpec */
		UPDATE LOY.LOY_PROD_SPEC
		SET
			MODIFY_BY = #{empId}
			, MODIFY_DATE = getdate()
			, flag = flag + 1
		WHERE RID IN
			<foreach collection="rids" item="item" open="(" close=")" separator=",">
				#{item}
			</foreach>
	</update>
	
</mapper>