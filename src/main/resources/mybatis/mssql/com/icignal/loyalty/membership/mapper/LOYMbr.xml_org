<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Wed May 02 14:06:40 KST 2018-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.icignal.loyalty.memebership.mapper.LoyMbr">

<!-- 
     **** XML 파일  coding gide ****
          1. 반드시 엘리먼트 추가시 아래의 샘플 주석을 복사하여 해당 쿼리의 내용을 알 수 있도록 상세히 작성. 
          2. sql  쿼리는 대문자로 작성
          3. id 명명규칙 : 
             select 문장 -> selectXXX
             insert 문장 -> insertXXX
             update 문장 -> updateXXX
             delete 문장 -> deleteXXX
     
    /*
    *****************************************
    -   관련 파일            :    XXXX.java
    ============================================
    -   제목                  : 멤버십 회원 조회
    -   설명                  : 
    -   결과형태             : 목록
    ============================================
    -   입력     
      hhpNo     : 핸드폰 번호
      custNm    : 회원명
      cardNo    : 보너스 카드 번호
      birthDt   : 생년월일
      mbrNo   : 회원번호
      wbMemId   : 웬회원ID
      emailAddr   : email
    - 출력
      mbrNo   : 회원번호
      custNm    : 회원명
      hhpNo     : 핸드폰 번호
      birthDt   : 생년월일
      memDiv    : 회원구분
      tierCd    : 회원 등급
      emailAddr : email
      wbMemId   : 웬회원ID
    ============================================
    -   작성자                : knlee
    -   작성일                : 2017-10-10
    -   변경이력             : 2020-02-07 T10 변경 작업 .  by knlee
    ***************************************/ 
    -->



<!--  <typeAlias alias="mbrResponse" type="infavor.loyalty.member.mbr.dto.response.LOYMbrResponseDTO" />
   <typeAlias alias="mbrRequest"           	type="infavor.loyalty.member.mbr.dto.request.LOYMbrRequestDTO" />

     -->
    <!-- 
    /******************************************
    -   관련 파일            :    
    ============================================
    -   제목                  : 멤버십 회원 조회
    -   설명                  : 
    -   결과형태             : 목록
    ============================================
    -   입력
      hhpNo     : 핸드폰 번호
      custNm    : 회원명
      cardNo    : 보너스 카드 번호
      birthDt   : 생년월일
      mbrNo   : 회원번호
      wbMemId   : 웬회원ID
      emailAddr   : email
    - 출력
      mbrNo   : 회원번호
      custNm    : 회원명
      hhpNo     : 핸드폰 번호
      birthDt   : 생년월일
      memDiv    : 회원구분
      tierCd    : 회원 등급
      emailAddr : email
      wbMemId   : 웬회원ID
    ============================================
    -   작성자                : knlee
    -   작성일                : 2017-10-10
    -   변경이력             : 2020-02-07 T10 작업 .  by knlee
    ***************************************/ 
    -->
    <select id="selectMbrList" parameterType="mbrRequest" resultType="mbrResponse">
     /* LOYMbr.selectMbrList */
	select aa.rid,
	        aa.mbrno,
	        aa.custNm,
	        aa.hhpNo,
	        aa.birthDt,
	        aa.emailAddr,
	        aa.wbMemId,
	        aa.tierCd,
	        aa.tierNm,
			aa.underForteenYn,
	        aa.mbrLockYn,
	       	aa.custTypeCd,
	        aa.identiTypeCd,
	        aa.identiVal,
	        aa.realnmCertiDate,
	        aa.mbrLockYn,
	        bb.totalCount
	from (
	    SELECT /*+ use_nl(lm lc) use_nl(lm lt) */
	<!--     /*+ use_nl(lm lc) use_nl(lm lt) index_desc(lm LOY_MBR_IX03) */ DISTINCT -->
	        LM.RID 				AS rid,
	        LM.MBR_NO 			AS mbrNo,
	        <!--
	        LC.CUST_NM 			AS custNm,
	         -->
	        LOY.FN_GET_MBRNM_MASKING(secu.fn_getDecrypt(#{cipherKey},LC.CUST_NM)) AS custNm,
	        secu.fn_getDecrypt(#{cipherKey}, lm.HHP_NO, 'PHONE_NUM2') AS hhpNo,
	        LC.BIRTH_DT 		AS birthDt,
	        <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
	        L
	        M.MEM_DIV 		AS memDivCd,
	        CD.MARK_NAME 		AS memDiv,
	         -->
	        secu.fn_getDecrypt(#{cipherKey},lm.email_addr, 'EML') AS emailAddr,
	        secu.fn_getDecrypt(#{cipherKey}, LM.WEB_ID)		AS wbMemId,
	        LM.RID_TIER_CUR 	AS tierCd,
	        LT.TIER_NM 			AS tierNm,
			case when NVL(lm.MKT_AGRE_PARENT_DT, '') IS NOT NULL then 'Y' else 'N' end AS underForteenYn,
	        lm.mbr_lock_yn AS mbrLockYn
	        , cd1.mark_name   as    custTypeCd		/*고객 유형 코드*/
      		, cd.mark_name as identiTypeCd		/*식별 유형*/
      		, case lc.identi_type_cd
	                      when '01' then '**********'
	                      when '02' then secu.fn_getDecrypt(#{cipherKey}, lc.identi_val, 'PHONE_NUM2')
	                      when '03' then secu.fn_getDecrypt(#{cipherKey}, lc.identi_val, 'CARD_NUM')
	                      when '04' then secu.fn_getDecrypt(#{cipherKey}, lc.identi_val, 'PASSPORT_NUM')
	                      when '05' then secu.fn_getDecrypt(#{cipherKey}, lc.identi_val, 'L_PERSON_NUM')
	                      else '****' end as identiVal  /* 식별 값 */
	         ,to_char(lc.realnm_certi_date,'YYYY-MM-DD')     as    realnmCertiDate     /* 실명 인증 일자 */
	    	 ,lm.ecomm_mbr_no as ecommMbrNo
	    from loy.loy_mbr lm
	    INNER JOIN loy.loy_cust lc on lm.RID_CUST = lc.RID
	    <!-- left outer join loy.loy_mbr_card lmc on lm.rid = lmc.RID_MBR -->
	    LEFT OUTER JOIN loy.loy_tiers lt on lm.RID_TIER_CUR = lt.RID
	       left outer join com.comm_code cd on lc.identi_type_cd = cd.code_name and cd.group_code = 'LOY_IDENTI_TYPE_CD' and cd.country = #{country} and cd.flag = 1 and cd.lang = #{lang}
	    left outer join com.comm_code cd1 on lc.cust_type_cd = cd1.code_name and cd1.group_code = 'LOY_CUST_TYPE_CD' and cd1.country = #{country} and cd1.flag = 1 and cd1.lang = #{lang}
	  
	    WHERE ${strCondWhere}
	    AND ${strSVCType}
	    AND ${strWhere}
	    AND lm.accnt_id = #{accountId}
	    AND lm.flag  = 1
	    <!--  AND lm.mbr_stat_cd = 'A' /* 활성회원만*/ -->
	    <!-- AND lm.mbr_lock_yn = 'N' /* 휴면회원제외*/ -->
	        <!-- AND lm.mbr_type_cd = 'A'/* '개인'회원만 */ -->
	    <if test="hhpNo != null and hhpNo != ''">
            AND lm.hhp_no =  #{hhpNo}
        </if>
	    order by ${strOrderby}
	    ${strEndPaging}
	    ) aa,
	    (
		    SELECT count(*) as totalCount
		    from loy.loy_mbr lm
		    INNER JOIN loy.loy_cust lc on lm.RID_CUST = lc.RID
		    <!-- left outer join loy.loy_mbr_card lmc on lm.rid = lmc.RID_MBR -->
		    LEFT OUTER JOIN loy.loy_tiers lt on lm.RID_TIER_CUR = lt.RID
		    <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
		    LEFT OUTER JOIN com.comm_code cd ON lm.MEM_DIV = cd.code_name and cd.flag = 1 and cd.group_code = 'MEMBER_TYPE' and cd.lang = #{lang}  and cd.country = #{country}
		     -->
		    WHERE ${strCondWhere}
		    AND ${strSVCType}
		    AND ${strWhere}
		    AND lm.accnt_id = #{accountId}
		    AND lm.flag  = 1
		   <!-- AND lm.mbr_stat_cd = 'A' /* 활성회원만*/ -->
		    <!-- AND lm.mbr_lock_yn = 'N' /* 휴면회원제외*/ -->
		        <!-- AND lm.mbr_type_cd = 'A'/* '개인'회원만 */ -->
		    <!-- order by ${strOrderby} -->
<!-- 		    ${strEndPaging} -->
	    ) bb


    </select>





    <!--
    /**************************************
    -   관련 파일            : LOYMbrDAO.java (getMbr)
    ============================================
    -   제목                   : 회원 상세 조회
    -   설명                   : 회원 상세 조회
    -   결과형태             : 단건
    ============================================
    -   입력            :  rid
    -   출력            :
    ============================================
    -   작성자                : swlim
    -   작성일                : 2017.10.20.
    ***************************************/
    -->
    <select id="selectMbr" parameterType="mbrItemRequest" resultType="mbrItemResponse">
    /* LOYMbr.selectMbr */
      SELECT
        lm.rid 		AS rid,
        secu.fn_getDecrypt(#{cipherKey},lc.CUST_NM) 	AS custNm,
        lm.MBR_NO 	AS mbrNo,
        lc.GEN_GBN_CD                AS  genGbnCd,
        <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
        cd.MARK_NAME AS memDivMarkName,
        lm.MBR_TYPE_CD AS memDiv,
        lm.ADDR1_DTL AS addr1Dtl,
        lm.GIFT_AVL_POINT AS giftAvlPoint,
        lm.GIFT_POINT AS giftPoint,
        lm.SBSC_CHNL_DTL_CD AS sbscChnlDtlCd,
         -->
        lm.RID_TIER_CUR AS ridTierCur,
        lt.TIER_CD as tierCd,
        lt.TIER_NM AS tierNm,
        lm.HHP_NO AS hhpNo,
        nvl(secu.fn_getDecrypt(#{cipherKey},lm.HHP_NO, 'PHONE_NUM2'),'') AS hhpNoIn,
        nvl(secu.fn_getDecrypt(#{cipherKey},lm.HHP_NO, null        ),'') AS hhpNoDec,
        lm.EMAIL_ADDR AS emailAddr,
        secu.fn_getDecrypt(#{cipherKey}, lm.EMAIL_ADDR, 'EML') AS emailAddrIn,
        secu.fn_getDecrypt(#{cipherKey}, lm.EMAIL_ADDR, null  ) AS emailAddrDec,
        lc.LUNAR_GBN_CD AS lunarGbnCd,
        lc.BIRTH_DT AS birthDt,
        secu.fn_getDecrypt(#{cipherKey},lm.WEB_ID) AS wbMemId,
        <!--
        lm.SBSC_CHNL_CD AS sbscChnlCd,
        cd2.MARK_NAME AS sbscChnlCdMarkName,
         -->
        lm.RID_CHNL_JOIN as ridChnlJoin
        ,lm.MBR_STAT_CD AS mbrStatCd
        ,cc.mark_name   as mbrStatNm
        ,lm.CHNL_AGRE_SMS             AS  chnlAgreSms
        ,lm.CHNL_AGRE_EMAIL           AS  chnlAgreEmail
        ,lm.APP_NEWS_YN               AS  appNewsYn
        ,lc.rid AS ridCust
        ,lm.CHNL_AGRE_EMAIL_DT as chnlAgreEmailDt
        ,lc.MARRY_YN AS marryYn
        ,lc.MARRY_ANIV AS marryAniv
        ,lm.ADDR1_ZIP AS addr1Zip
        ,lm.ADDR1_DFLT AS addr1Dflt
        <!--
        ,lm.AVL_POINT AS avlPoint
         -->
        ,lm.ADDR1_ZIP AS addr1Zip
        ,lm.ADDR1_DFLT as addr1Dflt
        ,lc2.chnl_nm as chnlJoinNm <!-- 가입채널명 -->
        <!-- ,case when lm.rid_join_rcmmd is not null then lm2.web_id || '(' || lct2.cust_nm || ')' else '' end as joinRcmmdNm 가입 추천 회원 (웹회원ID + 회원명) -->
<!--         ,(secu.fn_getDecrypt(#{cipherKey},lct2.cust_nm)) AS joinRcmmdNm -->
		, CASE WHEN lct2.cust_nm IS NULL THEN 
				CASE WHEN lm2.RCMMD_CD IS NULL THEN '' 
				  ELSE lm2.RCMMD_CD || '(탈회)' END
		    ELSE lm2.RCMMD_CD END AS joinRcmmdNm
        <!-- , case when lm.rid_chnl_join = '7985C23021E6056BE0530100007FC987' loy_channel.rid 간편가입매장
	        then
	      		case when nvl(lm.web_id, '') is not null then 'Y' else 'N' end
	      	else 'N'
          end as simpleMbrSwitchYn --> <!-- 간편가입 전환회원 -->
        ,lm.new_user_yn as newUserYn
           , lc.cust_type_cd   as    custTypeCd		/*고객 유형 코드*/
      		, lc.identi_type_cd as identiTypeCd		/*식별 유형*/
      		, secu.fn_getDecrypt(#{cipherKey},lc.identi_val) as identiVal
   		,lm.rcmmd_cd	as rcmmdCd
   		,secu.fn_getDecrypt(#{cipherKey},lm.ADDR1_DTL) as addr1Dtl
   		,to_char(lc.REALNM_CERTI_DATE,'YYYY-MM-DD HH24:MI') as realNmCertiDate
   		,lm.ecomm_mbr_no as ecomMbrNo
        <!-- 없는 필드들 주석 -->
      	<!--
        lm.HOME_TEL_NO AS HomeTelNoIn,
        secu.fn_getDecrypt(#{cipherKey},lm.HOME_TEL_NO, 'PHONE_NUM2') AS HomeTelNo,
        lm.ADDR1_ZIP AS addr1Zip,
        lm.OWNHOME_ADR_CHG_DT AS ownhomeAdrChgDt,
        lm.ADDR1_JI_DFLT AS addr1JiDflt,
        lm.ADDR1_JI_DTL  AS addr1JiDtl,
        lm.ADDR1_JI_ZIP  AS addr1JiZip,
        lm.H_CITY     AS hCity,
        lm.H_GU     AS hGu,
        lm.TOT_CHARGE_POINT AS totChangePoint,
        lm.EXTNC_PAM_MONTH AS extncPamMonth,
        lm.EXTNC_PAM_POINT AS  extncPamPoint,
        lm.WB_MEM_YN AS wbMemYn,
        cd3.MARK_NAME AS sbscChnlDtlCdMarkName,
        lm.pnt_use_pw as pntUsePw,
        lm.MKT_AGRE_PRV_INFO_OPT    AS  mktAgrePrvInfoOpt,
        lm.CORP_TAXI_YN             AS corpTaxiYn,
        lm.OWNHOME_ADR_CHG_DT       AS ownhomeAdrChgDt,
        lm.APP_BENEFIT_YN           AS  appBenefitYn,
        lm.EVENT_TGT_YN AS eventTgtYn,
        (select START_DT from loy.loy_semi_vip_hist where RID_MBR = lm.RID order by START_DT DESC limit 1) AS semiVipStartDt,
        (select END_DT from loy.loy_semi_vip_hist where RID_MBR = lm.RID order by END_DT DESC limit 1) AS semiVipEndDt,
        lm.MEM_YN AS e1MemYn,
        -->
    FROM loy.loy_mbr lm
    LEFT JOIN loy.loy_cust 			lc  ON lm.rid_cust = lc.rid
    LEFT JOIN loy.loy_tiers 		lt  ON lm.RID_TIER_CUR = lt.RID
    LEFT OUTER JOIN LOY.LOY_CHANNEL lc2 on lc2.flag = 1 and lm.rid_chnl_join = lc2.rid
    left outer join com.comm_code   cc  on lm.mbr_stat_cd  = cc.code_name and cc.flag = 1 and cc.group_code = 'LOY_MEM_STAT_CD' and cc.lang = #{lang} and cc.country = #{country}
    left outer join loy.loy_mbr lm2     on lm2.rid = lm.rid_join_rcmmd
    left outer join loy.loy_cust lct2    on lct2.rid = lm2.rid_cust
    <!-- LEFT JOIN loy.loy_semi_vip_hist lvh ON lm.rid = lvh.rid_mbr -->
    <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
    LEFT OUTER JOIN com.comm_code cd ON lm.MBR_TYPE_CD = cd.code_name
            AND cd.group_code = 'MEMBER_TYPE'
            AND cd.flag = 1
            AND cd.lang=#{lang}
            AND cd.country  = #{country}
             -->
	<!--
    LEFT OUTER JOIN com.comm_code cd2 ON lm.SBSC_CHNL_CD = cd2.code_name
            AND cd2.group_code = 'MEMBER_CHANNEL'
            AND cd2.flag = 1
            AND cd.lang=#{lang}
            AND cd.country  = #{country}
     -->
    <!-- LEFT OUTER JOIN com.comm_code cd3 ON lm.SBSC_CHNL_DTL_CD = cd3.code_name
            AND cd3.group_code = 'MEMBER_CHANNEL_DTL'
            AND cd3.flag = 1
            AND cd.lang=#{lang}
            AND cd.country  = #{country} -->
    WHERE 1=1
    <if test="rid != null and rid != ''"> and lm.rid = #{rid} </if>
    <if test="rid == null or rid == ''">
      <if test="ridCust != null and ridCust != ''">
        and lc.rid = #{ridCust} and lm.mbr_stat_cd &lt;&gt;'20'
      </if>
      <if test="ridCust == null or ridCust == ''">
        <if test="mbrNo != null and mbrNo != ''">
          and lm.mbr_no = #{mbrNo}
        </if>
      </if>
    </if>
    and rownum=1
    </select>


    <!--
    /**************************************
    -   관련 파일            : LOYMbrDAO.java (getMbr)
    ============================================
    -   제목                   : 비밀번호 수정일시
    -   설명                   : 비밀번호 수정일시
    -   결과형태             : 단건
    ============================================
    -   입력            :  rid
    -   출력            :
    ============================================
    -   작성자                : sw.lim
    -   작성일                : 2017.11.27
    ***************************************/
    -->
    <select id="selectMbrPwChgDate" parameterType="mbrRequest" resultType="mbrResponse">
    select PWD_AMD_DD as pwdAmdDd from loy.loy_mbr where rid = #{rid};
    </select>

    <!--
    /*******************************************
    -   관련 파일            : LOYMbrDAO.java (getMbr)
    ============================================
    -   제목                   : 미인증거래정보
    -   설명                   : 미인증 거래 정보
    -   결과형태             : 다건
    ============================================
    -   입력            :  chnl_no
            chaegePrice
            searchYM
            searchDef
    -   출력            :
    ============================================
    -   작성자                : sw.lim
    -   작성일                : 2017.10.19
    ***************************************/
    -->
    <select id="selectChargeInfo" parameterType="mbrRequest" resultType="chargeResponseDTO">
    SELECT
     T1.CHNL_NO  AS chnlNo
    ,T1.CHNL_NM AS chnlNm
    , #{searchYM} AS searchYM
    , #{dealAmount} AS chargePrice
    ,T2.UNIT_PRICE AS prodUnitCost
    ,TRUNC((#{dealAmount}/T2.UNIT_PRICE),5) AS chargeAmt
    FROM loy.loy_channel  T1

    INNER JOIN ifl.b2b_StationUnitPrice  T2 ON T1.CHNL_NO = T2.STATION_CD

    AND LEFT(T2.START_DT, 7) &lt;= #{searchYM}
        AND LEFT(T2.END_DT, 7) &gt;= #{searchYM}

    WHERE  1=1
    AND    T1.CHNL_NO = #{chnlNo}
    ORDER BY T2.START_DT DESC;

    </select>


     <!--
    /**************************************
    -   관련 파일            : LOYMbrDAO.java (clearMaskMbr)
    ============================================
    -   제목                   : 회원 상세 조회 (마스킹해제)
    -   설명                   : 회원 상세 조회 (마스킹해제)
    -   결과형태             : 단건
    ============================================
    -   입력            :  rid
    -   출력            :
    ============================================
    -   작성자                : knlee
    -   작성일                : 2016.12.29.
    ***************************************/
    -->
    <select id="clearMaskMbr" parameterType="mbrRequest" resultType="mbrResponse">
        /* LOYMbr.clearMaskMbr */
		select
			  a.rid     as    rid  /** RID */

            /* 고객정보  */
            , a.rid_cust           as ridCust  		/* rid cust */
            , secu.fn_getDecrypt(#{cipherKey}, b.cust_nm)            as mbrNm  		/** 고객 명 */
            , b.cust_type_cd       as custTypeCd    /** 고객 유형  */
            , b.identi_type_cd     as identiTypeCd  /** 식별 유형 */
            , case b.identi_type_cd
               when '01' then secu.fn_getDecrypt(#{cipherKey}, b.identi_val, null)
               when '02' then secu.fn_getDecrypt(#{cipherKey}, b.identi_val, null)
               when '03' then secu.fn_getDecrypt(#{cipherKey}, b.identi_val, null)
               when '04' then secu.fn_getDecrypt(#{cipherKey}, b.identi_val, null)
               when '05' then secu.fn_getDecrypt(#{cipherKey}, b.identi_val, null)
               else '****'
			 end as identiVal  /* 식별 값 */

            /* 기본정보  */
            ,a.mbr_no                as    mbrNo           /* 회원 번호 */
            ,a.mbr_stat_cd           as    mbrStatCd       /* 회원 상태 코드 */
            ,a.mbr_type_cd           as    mbrTypeCd       /* 회원 유형 코드 */
            ,to_char(a.join_date,'YYYY-MM-DD')   as    joinDate        /* 가입 일자 */
            ,a.rid_tier_cur          as    ridTierCur      /* RID_등급 현재 */
            ,e.tier_nm               as    tierNm          /* 현재등급명 */

            ,a.rid_chnl_join         as    ridChnlJoin     /* RID_채널_가입 */
            ,d.chnl_nm               as    chnlJoinNm      /* 가입채널명*/
            ,c.pgm_nm                as    pgmNm           /* 프로그램명 */
            ,a.rid_pgm               as    ridPgm          /* RID_PGM */

            /* 연락처정보 */
            ,secu.fn_getDecrypt(#{cipherKey},a.hhp_no, null)       as    hhpNo      	/* 휴대폰 번호 */
            ,secu.fn_getDecrypt(#{cipherKey},a.email_addr, null)   as    emailAddr      /* 이메일 주소 */

            /* 마케팅 동의  */
            ,a.mkt_agre_prv_info     as    mktAgrePrvInfo     /* 개인정보수집동의 */
            ,a.mkt_agre_use          as    mktAgreUse         /* 마케팅 활용 동의 */

            ,a.chnl_agre_sms         as    chnlAgreSms        /* 문자메시지 수신 동의 */
            ,a.chnl_agre_email       as    chnlAgreEmail      /* 이메일 수신 동의 */
            ,a.chnl_agre_tel         as    chnlAgreTel        /* TM 수신 동의 */
            ,a.chnl_agre_dm          as    chnlAgreDm         /* DM 수신 동의 */
            ,a.chnl_agre_push        as    chnlAgrePush       /* 앱푸시 메시지 수신 동의 */
        from loy.loy_mbr a
        inner join loy.loy_cust b on a.rid_cust = b.rid
        left outer join loy.loy_pgm c on a.rid_pgm = c.rid
        left outer join loy.loy_channel d on a.rid_chnl_join = d.rid
        left outer join loy.loy_tiers e on a.rid_tier_cur = e.rid
		where 1=1
		  and a.rid = #{rid}

       <!--   ,a.addr1_zip             as    addr1Zip        /* 주소1_우편번호 */
            ,a.grp_cust_emp_name     as    grpCustEmpName  /* 단체고객 컨택 */
            ,secu.fn_getDecrypt(#{cipherKey},a.home_tel_no, null)  as    homeTelNo  /* 집전화 번호 */
            ,to_char(a.cur_tier_sel_date,'YYYY-MM-DD')   as    curTierSelDate  /* 현재 등급 선정 일자 */
            ,a.mkt_agre_third_snd    as    mktAgreThirdSnd    /* 제3자 정보제공 동의 */
             ,secu.fn_getDecrypt(#{cipherKey},a.addr1_dtl, null)   as    addr1Dtl        /* 주소1_상세 */
             ,a.addr1_dflt            as    addr1Dflt       /* 주소1_기본 */
             -->
    </select>



    <select id="selectMbrCardList" parameterType="mbrCardRequest" resultType="mbrCardResponse">
        /* LOYMbr.selectMbrCardList */
        select
               a.rid              as rid          /** rid mbr card */
              ,a.rid_mbr          as ridMbr       /** rid Mbr */
              ,secu.fn_getDecrypt(#{cipherKey},a.card_no, 'CARD_NUM')  as cardNo       /** 카드번호 */
              ,to_char(a.issue_date,'YYYY-MM-DD')  as issueDate    /** 발급일자 */
              ,a.stat             as stat         /** 카드상태 */
              ,cd.mark_name       as statNm       /** 카드상태명 */
              ,cd.seq             as statSeq      /** 카드상태 순번 */
              ,c.card_knd_nm      as cardKndNm    /** 카드유형명 */
              ,concat(d.chnl_nm, e.tier_nm, f.club_nm)    AS typeDesc  /** 유형상세 */
               <!-- , ${strColumn} -->
        from loy.loy_mbr_card a
        inner join loy.loy_mbr b on a.rid_mbr = b.rid
        inner join loy.loy_card_kind c on a.rid_card_kind=c.rid
        left outer join loy.loy_channel d on c.rid_ref = d.rid
        left outer join loy.loy_tiers e on c.rid_ref = e.rid
        left outer join loy.loy_club f on c.rid_ref = f.rid
        left outer join com.comm_code cd  on a.stat = cd.code_name  and cd.group_code   = 'LOY_CARD_MBR_STAT_CD' and cd.flag  = 1  and cd.lang=#{lang} and cd.country = #{country}
        where ${strSVCType}
          <!-- and ${strWhere} -->
          and a.rid_mbr = #{ridMbr}
          <!-- and a.flag = 1 -->
        order by ${strOrderby}
        ${strEndPaging}
    </select>




    <update id="updateMbrCardStat" parameterType="mbrCardRequest">
        /* LOYMbr.updateMbrCardStat */
        update loy.loy_mbr_card
        set   stat = #{stat}
            , mod_num = mod_num +1
            , modify_date = sysdate
            , modify_by = #{modifyBy}
        where 1 = 1
          and rid   = #{rid}
    </update>

	<!-- 멤버십 회원의 포인트 거래내역 목록 조회 -->
   	<select id="selectMbrPtnTxnHistList" parameterType="mbrPtnTxnHistRequest" resultType="mbrPtnTxnHistResponse">
		/* LOYMbr.selectMbrPtnTxnHistList */
       	SELECT    /*+ index(lpt loy_pnt_txn_ix03)*/
			  lpt.txn_uniq_no  							    AS txnUniqNo
          	, to_char(lpt.TXN_DT,'YYYY-MM-DD HH24:MI:SS')    AS txnDt
          	, to_char(lpt.APPR_DT,'YYYY-MM-DD HH24:MI:SS')   AS apprDate
          	, TRUNC(lpt.TOTAL_PNT_AVL,0) 				AS totalPntAvl
          	, cc.MARK_NAME								AS pntTxnType1Cd
          	, cc1.MARK_NAME								AS pntTxnType2Cd
<!--           	, case when mcm.id is null then '' else c11.MARK_NAME end							AS pntTxnType3Cd -->
<!--           	, case when mcm.id is null then '' else c12.MARK_NAME end							AS pntTxnType4Cd -->
          	, lm.MBR_NO 								AS mbrNo
            , lct.CUST_NM 								AS custNm
          	<!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
          	, cc2.MARK_NAME AS memDiv
          	 -->
          	, cc3.MARK_NAME 							AS memGrade
          	<!--
          	, case when CARD_NUM is null or CARD_NUM = '' then CARD_NUM
                   when lpt.card_type_cd='10' or lpt.card_type_cd='30' then com.fn_getCardNum(secu.fn_getDecrypt(#{cipherKey} ,CARD_NUM, null ))
                   else secu.fn_getDecrypt(#{cipherKey} ,CARD_NUM, 'CARD_NUM')
              end as cardNoDecoding -->
            , case when lpt.pnt_txn_type_1_cd = '200' then '-' || TRUNC(lpt.PNT_AMT,0) else to_char(TRUNC(lpt.PNT_AMT,0)) end AS pntAmt <!-- 거래유형 '사용'인 경우 '-' prefix -->
            , TRUNC(lpt.USE_PNT,0) 		AS usePnt
            , TRUNC(lpt.GIFT_PNT,0) 	AS giftPnt
<!--             , lp.PROD_NM 				AS prodNm -->
            , NVL(lpt.TXN_AMT,0) 		AS txnAmt
            , lc.rid   					AS ridChnl
            , lc.CHNL_NO 				AS chnlNo
            , lc.CHNL_NM 				AS chnlNm
            , lpt.rid 					AS rid
            , lm.rid 					AS ridMbr
            , lck.card_type 			AS mbrType
            , lmc.cprt_card_cd 			AS cprtCardCd
            , cc4.mark_name           	AS cardKndNm
            , d.mark_name             	AS cprtCard
            , nvl((SELECT TRUNC(sum(acrl_amt),0) FROM loy.loy_pnt_acrl WHERE RID_PNT_TXN = lpt.rid group by rid_pnt_txn),0) AS promoCnt
            , lpt.APPR_NO 				AS dtlApprNo
            , lpt.rcpt_no				AS rcptNo
            , lpt.txn_type_dtl_desc		AS txnTypeDtlDesc
            , liv.voc_desc 				AS acrlDesc
<!--             , CASE WHEN nvl(lpa.VALID_START_DATE,'') IS not null THEN to_char(lpa.VALID_START_DATE, 'YYYY-MM-DD') || ' ~ ' || to_char(lpa.VALID_END_DATE, 'YYYY-MM-DD') ELSE '' end as validDate -->
			,lpt.orgn_appr_no			AS orgnApprNo
			,case when lpt.orgn_appr_date is not null then to_char(to_date(lpt.orgn_appr_date, 'YYYY-MM-DD'), 'YYYY-MM-DD') else '' end as orgnApprDate <!-- 원 승인번호 -->
            ,lpt.TXN_STAT_CD  as txnStatCd
            ,lpt.APPR_DATE    AS apprDateYYYYMMDD
            ,lpt.PNT_TXN_TYPE_1_CD as pntTxnType1code
			,lpt.PNT_TXN_TYPE_2_CD as pntTxnType2code
			,cc5.MARK_NAME 				AS txnStat
            , ${strColumn}
      	FROM <if test="pntTxnDateType == &quot;A&quot;">loy.loy_pnt_txn</if>
      		<if test="pntTxnDateType != &quot;A&quot;">loy.loy_pnt_txn_archive</if> lpt
      	join loy.loy_mbr lm on lpt.RID_MBR = lm.RID and lm.flag = 1

<!--       	left outer join loy.loy_pnt_acrl lpa on lpa.rid_pnt_txn = lpt.rid -->
<!--       	left outer join mkt.mkt_cam_mst mcm on mcm.disp_no = lpa.cam_no  -->

      	JOIN loy.loy_cust lct on lct.rid= lm.RID_CUST and lct.flag = 1
<!--       	left outer join loy.loy_prod lp on lp.rid= lpt.RID_PROD -->
      	left outer join loy.loy_channel lc on lc.rid= lpt.rid_chnl and lc.flag = 1
      	LEFT OUTER JOIN loy.loy_mbr_card lmc on lmc.card_no = lpt.card_num  and lmc.flag = 1
      	LEFT OUTER JOIN loy.loy_card_kind lck on lck.rid = lmc.RID_CARD_KIND and lck.flag = 1
      	left outer join com.comm_code d  on lmc.cprt_card_cd = d.code_name  and d.group_code = 'CARD_CORP_TYPE' and d.flag  = 1  and d.lang=#{lang} and d.country = #{country}
      	inner join com.comm_code cc  on cc.CODE_NAME = lpt.PNT_TXN_TYPE_1_CD  AND cc.lang = #{lang}   AND cc.GROUP_CODE  ='PNT_TXN_TYPE' and cc.flag = 1	  <!-- asis = 'TXN_TYPE_CD_TM'  -->
      	inner join com.comm_code cc1 on cc1.CODE_NAME = lpt.PNT_TXN_TYPE_2_CD AND cc1.lang = #{lang}  AND cc1.GROUP_CODE ='PNT_TXN_DTL_TYPE' and cc1.flag = 1  <!-- asis = 'TXN_SUB_TYPE_CD' -->
        <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
        left outer join com.comm_code cc2 on cc2.CODE_NAME = lpt.MEM_DIV AND cc2.lang = #{lang}  AND cc2.GROUP_CODE='MEMBER_TYPE'
         -->
      	left outer join com.comm_code cc3 on cc3.CODE_NAME = lpt.MEM_GRADE AND cc3.lang = #{lang}  AND cc3.GROUP_CODE='MEMBER_GRADE' and cc3.flag = 1
      	left outer join com.comm_code cc4 on cc4.CODE_NAME = lpt.CARD_TYPE_CD AND cc4.lang = #{lang}  AND cc4.GROUP_CODE='MEMBER_CARD_CD' and cc4.flag = 1
      	left outer join com.comm_code cc5 on cc5.CODE_NAME = lpt.TXN_STAT_CD AND cc5.lang = #{lang}  AND cc5.GROUP_CODE='PNT_TXN_STAT_CD' and cc5.flag = 1
		LEFT OUTER JOIN loy.loy_intact_voc liv on liv.flag = 1 and liv.rid = lpt.rid_intact_data
<!--           left outer join com.comm_code c9 -->
<!--             on c9.flag = 1 and c9.lang = #{lang} and c9.code_name = mcm.PNT_ACCNT_BIG_TYPE_CD and c9.group_code = 'PNT_TXN_TYPE' -->
<!--           left outer join com.comm_code c10 -->
<!--             on c10.flag = 1 and c10.lang = #{lang} and c10.code_name = mcm.PNT_ACCNT_MID_TYPE_CD and c10.group_code = 'PNT_TXN_DTL_TYPE' -->
<!--           left outer join com.comm_code c11 -->
<!--             on c11.flag = 1 and c11.lang = #{lang} and c11.code_name = mcm.PNT_ACCNT_SML_TYPE_CD and c11.group_code = 'DA_PNT_ACCNT_SML_TYPE' -->
<!--           left outer join com.comm_code c12 -->
<!--             on c12.flag = 1 and c12.lang = #{lang} and c12.code_name = mcm.PNT_ACCNT_DETAIL_TYPE_CD and c12.group_code = 'DA_PNT_ACCNT_DETAIL_TYPE' -->

      	where ${strWhere}
          and lm.rid = #{rid}
            <if test="searchType == &quot;DATE&quot;">
             and lpt.TXN_DT BETWEEN TO_DATE(#{startDt},'YYYY-MM-DD') AND TO_DATE(#{endDt},'YYYY-MM-DD')
            </if>
            <if test="searchType == &quot;ACRL&quot;">
          and lpt.PNT_TXN_TYPE_1_CD = '100'
            </if>
            <if test="searchType == &quot;RDM&quot;">
              and lpt.PNT_TXN_TYPE_1_CD ='200'
            </if>
            <if test="searchType == &quot;PARTNER&quot;">
              and lmc.cprt_card_cd is not null and  lmc.cprt_card_cd !=''
            </if>
            <if test="searchType == &quot;BUTANE&quot;">
              and lpt.RID_PROD ='1-VGCR'
            </if>
	  order by ${strOrderby}, lpt.rowid DESC <!-- , lpa.rid -->
	  ${strEndPaging}
    </select>

	<select id="selectMbrTotAcrlAmt" parameterType="mbrPtnTxnHistRequest" resultType="mbrPtnTxnHistResponse">
		SELECT /*+ index(lpt loy_pnt_txn_ix03)*/
             CASE
             	WHEN SUM(lpt.PNT_AMT)IS NOT NULL THEN SUM(lpt.PNT_AMT)
             	ELSE 0
             END AS acrlAmt
      	FROM loy.loy_pnt_txn lpt
		join loy.loy_mbr lm on lpt.RID_MBR = lm.RID
		where lm.rid = #{rid}
		  <if test="searchType == &quot;DATE&quot;">
		   and lpt.TXN_DT BETWEEN TO_DATE(#{startDt},'YYYY-MM-DD') AND TO_DATE(#{endDt},'YYYY-MM-DD')
		  </if>
		  AND lpt.TXN_STAT_CD ='A'
          AND lpt.pnt_txn_type_1_cd = '100'
          AND lpt.pnt_txn_type_2_cd  NOT IN  ('130' , '131') 
	</select>

	<select id="selectMbrTotRdmAmt" parameterType="mbrPtnTxnHistRequest" resultType="mbrPtnTxnHistResponse">
		SELECT /*+ index(lpt loy_pnt_txn_ix03)*/
             CASE
             	WHEN SUM(lpt.PNT_AMT) IS NOT NULL THEN SUM(lpt.PNT_AMT)
             	ELSE 0
             END AS rdmAmt
      	FROM loy.loy_pnt_txn lpt
		join loy.loy_mbr lm on lpt.RID_MBR = lm.RID
		where lm.rid = #{rid}
		<if test="searchType == &quot;DATE&quot;">
		   and lpt.TXN_DT BETWEEN TO_DATE(#{startDt},'YYYY-MM-DD') AND TO_DATE(#{endDt},'YYYY-MM-DD')
		  </if>
		  AND lpt.TXN_STAT_CD ='A'
          AND lpt.pnt_txn_type_1_cd = '200'
          AND lpt.pnt_txn_type_2_cd  NOT IN  ('210' , '211')
	</select>

   <select id="selectMbrTierHistList" parameterType="mbrTierHistRequest" resultType="mbrTierHistResponse">
        /* LOYMbr.selectMbrTierHistList */
        select
                a.rid                           as rid              /* RID */
               ,a.rid_mbr                       as ridMbr           /* RID_MEM */
               ,a.rid_cur_tier                  as ridCurTier       /* RID_현재 등급 */
               ,b.tier_nm                       as curTierNm            /* 현재 등급명*/
               ,a.valid_hist_yn                 as validHistYn      /* 유효 이력 여부 */
               ,to_char(a.tier_calc_date,'YYYY-MM-DD')     as tierCalcDate     /* 등급 산출 일자 */
               ,to_char(a.valid_start_dt,'YYYY-MM-DD')     as validStartDt     /* 유효 시작 일자 */
               ,to_char(a.valid_end_dt,'YYYY-MM-DD')       as validEndDt      /* 유효 종료 일자 */
               ,a.rid_bef_tier                  as ridBefTier       /* RID_이전 등급 */
               ,c.tier_nm                       as befTierNm        /* 이전 등급명*/
               ,to_char(a.rslt_extr_start_dt,'YYYY-MM-DD')  as rsltExtrStartDt  /* 실적 추출 시작 일자 */
               ,to_char(a.rslt_extr_end_dt,'YYYY-MM-DD')    as rsltExtrEndDt    /* 실적 추출 종료 일자 */
               ,a.rid_next_tier                 as ridNextTier      /* RID_다음 등급 */
               ,d.tier_nm                       as nextTierNm       /* 다음 등급명*/
               ,trunc( a.cur_tier_apply_bas_amt  , 0 )        as curTierApplyBasAmt     /* 현재 등급 적용 기준 금액 */
               ,trunc( a.next_tier_tierup_bas_amt , 0 )       as nextTierTierupBasAmt   /* 다음 등급 승급 기준 금액 */
                <!-- , ${strColumn} -->
        from loy.loy_tier_hist a
        left outer join loy.loy_tiers b on a.rid_cur_tier = b.rid
        left outer join loy.loy_tiers c on a.rid_bef_tier = c.rid
        left outer join loy.loy_tiers d on a.rid_next_tier = d.rid
        where ${strSVCType}
          <!-- and ${strWhere} -->
          and a.rid_mbr = #{ridMbr}
          <!-- and a.flag = 1 -->
        order by ${strOrderby}
        ${strEndPaging}
    </select>


   <select id="selectMbrIntactPurList" parameterType="mbrIntactPurRequest" resultType="mbrIntactPurResponse">
        /* LOYMbr.selectMbrIntactPurList */
        select
               a.rid                   as    rid     /* RID */
              ,a.rid_chnl              as    ridChnl     /* RID_채널 */
              ,b.chnl_nm               as    chnlNm     /* 채널명 */
              ,a.rid_mbr               as    ridMbr     /* RID_회원 */
              ,a.rid_card_corp_chnl    as    ridCardCorpChnl     /* 카드 법인 채널 */
              ,a.rid_mbr_card          as    ridMbrCard     /* RID 카드 번호 */
              ,a.rid_intact_type       as    ridIntactType     /* RID_INTACT_TYPE */
              ,to_char(a.occu_date,'YYYY-MM-DD')             as    occuDate           /* 발생 일자 */
              ,to_char(a.calc_cmplt_date,'YYYY-MM-DD')       as    calcCmpltDate     /* 산출 완료 일자 */
              ,to_char(a.acrl_cmplt_date,'YYYY-MM-DD')       as    acrlCmpltDate     /* 적립 완료 일자 */
              ,a.acrl_excpt_reas_cd    as    acrlExcptReasCd     /* 적립 예외 사유 코드 */
              ,cd.mark_name            as    acrlExcptReasNm     /* 적립 예외 사유명 */
              ,trunc( a.amt  , 0 )    as    amt            /* 금액 */
              ,a.pay_methd_cd          as    payMethdCd     /* 결제 수단 코드 */
              ,cd1.mark_name           as    payMethdNm     /* 결제 수단 코드 */
              ,a.delv_methd_cd         as    delvMethdCd     /* 배송 수단 코드 */
              ,cd2.mark_name           as    delvMethdNm     /* 배송 수단명 */
              ,to_char(a.pay_cmplt_date,'YYYY-MM-DD')        as    payCmpltDate     /* 결제 완료 일자 */
              ,to_char(a.delv_cmplt_date,'YYYY-MM-DD')       as    delvCmpltDate     /* 배송 완료 일자 */
              ,a.pur_stat_cd           as    purStatCd     /* 구매 상태 코드 */
              ,cd3.mark_name           as    purStatNm     /* 구매 상태명 */
              ,to_char(a.canc_date,'YYYY-MM-DD')             as    cancDate     /* 취소 일자 */
              ,a.pos_no                as    posNo     /* 단말기 번호 */
              ,a.rcpt_no               as    rcptNo     /* 영수증 번호 */
              ,a.orgn_rcpt_no          as    orgnRcptNo     /* 원 영수증 번호 */
              <!-- , ${strColumn} -->
        from loy.loy_intact_pur a
        left outer join loy.loy_channel b on a.rid_chnl = b.rid
        /* 산출로직 호출후 적립예외 function(ex: 블랙리스트 등) 호출하여 결과 넣어줌. */
        left outer join com.comm_code cd on a.acrl_excpt_reas_cd = cd.code_name and cd.group_code  = 'LOY_ACRL_EXCPT_REAS_CD' and cd.flag  = 1  and cd.lang = #{lang} and cd.country = #{country}
        left outer join com.comm_code cd1 on a.pay_methd_cd = cd1.code_name and cd1.group_code  = 'LOY_INTACT_PUR_PAY_CD' and cd1.flag  = 1  and cd1.lang = #{lang} and cd1.country = #{country}
        left outer join com.comm_code cd2 on a.delv_methd_cd = cd2.code_name and cd2.group_code  = 'LOY_INTACT_PUR_DELI_CD' and cd2.flag  = 1  and cd2.lang = #{lang} and cd2.country = #{country}
        left outer join com.comm_code cd3 on a.pur_stat_cd = cd3.code_name and cd3.group_code  = 'LOY_INTACT_PUR_STAT_CD' and cd3.flag  = 1  and cd3.lang = #{lang} and cd3.country = #{country}

        where ${strSVCType}
          <!-- and ${strWhere} -->
          and a.rid_mbr = #{ridMbr}
          <!-- and a.flag = 1 -->
        order by ${strOrderby}
        ${strEndPaging}
    </select>



    <select id="selectMbrCampHistList" parameterType="mbrCampHistRequest" resultType="mbrCampHistResponse">
        /* LOYMbr.selectMbrCampHistList */
        select
               applyDate        /** 적용일자 */
              ,camNo            /**캠페인번호 */
              ,camNm            /**캠페인명*/
              ,camTypeCd        /**캠페인유형코드*/
              ,camTypeNm        /**캠페인유형명*/
              ,offerNm          /**오퍼명*/
              ,promType         /**프로모션유형코드*/
              ,promTypeNm       /**프로모션혜택*/
              ,promSubType      /**프로모션서브유형*/
              ,promSubTypeNm    /**프로모션서브유형*/
              ,camStartDd       /**시작일*/
              ,camEndDd         /**종료일*/
              ,camStatusCd      /**캠페인상태코드*/
              ,camStatusNm      /**캠페인상태코드*/
              ,createDate      /*생성일*/
        from (
              /* 거래내역내에서 캠페인 이력 조회*/
              select
                     to_char(b.acrl_date,'YYYY-MM-DD')     as applyDate
                    ,c.disp_no                               as camNo
                    ,c.cam_nm                                as camNm
                    ,c.cam_type_cd                           as camTypeCd
                    ,cd.mark_name                            as camTypeNm
                    ,e.offer_nm                              as offerNm
                    ,c.prom_type                             as promType
                    ,cd1.mark_name                           as promTypeNm
                    ,c.prom_sub_type                         as promSubType
                    ,cd2.mark_name                           as promSubTypeNm
                    ,to_char(c.cam_start_dd,'YYYY-MM-DD')  as camStartDd
                    ,to_char(c.cam_end_dd,'YYYY-MM-DD')    as camEndDd
                    ,c.cam_status_cd                         as camStatusCd
                    ,cd3.mark_name                           as camStatusNm
                    ,a.create_date                           as createDate
                     <!-- , ${strColumn} -->
               from loy.loy_pnt_txn a
              inner join loy.loy_pnt_acrl b on  a.rid = b.rid_pnt_txn
              inner join mkt.mkt_cam_mst c on b.cam_no = c.disp_no
              inner join mkt.mkt_cam_offer_rel d on c.id = d.cam_id
              inner join mkt.mkt_offer_mst e on d.offer_id = e.id
              left outer join com.comm_code cd  on c.cam_type_cd = cd.code_name  and cd.group_code   = 'MKT_CAM_TYPE_CD'   and cd.flag   = 1  and cd.lang = #{lang}  and cd.country = #{country}
              left outer join com.comm_code cd1  on c.prom_type = cd1.code_name  and cd1.group_code  = 'LOY_PROM_TYPE'     and cd1.flag   = 1  and cd1.lang = #{lang}  and cd1.country = #{country}
              left outer join com.comm_code cd2  on c.prom_sub_type = cd2.code_name  and cd2.group_code  = 'LOY_PROM_SUB_TYPE'     and cd2.flag   = 1  and cd2.lang = #{lang}  and cd2.country = #{country}
              left outer join com.comm_code cd3  on c.cam_status_cd = cd3.code_name  and cd3.group_code  = 'MKT_CAM_STAT'     and cd3.flag   = 1  and cd3.lang = #{lang}  and cd3.country = #{country}
              where 1=1
                and a.rid_mbr = #{ridMbr} /* 'recMbr00001' */
                and a.txn_stat_cd  = 'A'

              union all

             /* 캠페인 타겟팅에서 캠페인이력 조회 */
             select to_char(a.create_date,'YYYY-MM-DD')    as applyDate
                   ,c.disp_no                                as camNo
                   ,c.cam_nm                                 as camNm
                   ,c.cam_type_cd                            as camTypeCd
                   ,cd.mark_name                             as camTypeNm
                   ,e.offer_nm                               as offerNm
                   ,c.prom_type                              as promType
                   ,cd1.mark_name                            as promTypeNm
                   ,c.prom_sub_type                          as promSubType
                   ,cd2.mark_name                            as promSubTypeNm
                   ,to_char(c.cam_start_dd,'YYYY-MM-DD')   	 as camStartDd
                   ,to_char(c.cam_end_dd,'YYYY-MM-DD')     	 as camEndDd
                   ,c.cam_status_cd                          as camStatusCd
                   ,cd3.mark_name                            as camStatusNm
                   ,a.create_date                            as createDate
               from mkt.mkt_tgt_dtl a
             inner join mkt.mkt_cam_mst c on a.cam_id = c.id and c.cam_status_cd = 'E'
             left outer join mkt.mkt_cam_offer_rel d on c.id = d.cam_id
             left outer join mkt.mkt_offer_mst e on d.offer_id = e.id
             left outer join com.comm_code cd  on c.cam_type_cd = cd.code_name  and cd.group_code   = 'MKT_CAM_TYPE_CD'   and cd.flag   = 1  and cd.lang=#{lang}  and cd.country = #{country}
             left outer join com.comm_code cd1  on c.prom_type = cd1.code_name  and cd1.group_code  = 'LOY_PROM_TYPE'     and cd1.flag   = 1  and cd1.lang=#{lang}  and cd1.country = #{country}
             left outer join com.comm_code cd2  on c.prom_sub_type = cd2.code_name  and cd2.group_code  = 'LOY_PROM_SUB_TYPE'     and cd2.flag   = 1  and cd2.lang=#{lang}  and cd2.country = #{country}
             left outer join com.comm_code cd3  on c.cam_status_cd = cd3.code_name  and cd3.group_code  = 'MKT_CAM_STAT'     and cd3.flag   = 1  and cd3.lang=#{lang}  and cd3.country = #{country}
             where 1=1
               and a.mem_id =  #{ridMbr}   /* 'recMbr00001' */
        ) t
        where ${strWhere}
        ORDER BY ${strOrderby}
        ${strEndPaging}
    </select>



   <select id="selectMbrChnlRelList" parameterType="mbrChnlRelRequest" resultType="mbrChnlRelResponse">
        /* LOYMbr.selectMbrChnlRelList */
        select
               a.rid           		as    rid     			/* RID */
              ,b.chnl_no       		as    chnlNo  			/** 채널번호 */
              ,b.chnl_nm       		as    chnlNm   			/** 채널명 */
              ,a.chnl_rel_type_cd   as    chnlRelTypeCd     /* 채널 관계 유형 코드 */
              ,cd.mark_name         as    chnlRelTypeNm     /* 채널 관계 유형 코드 */
              ,a.mkt_agre_prv_info  as    mktAgrePrvInfo    /* 개인정보활용동의 */
              ,a.mkt_agre_lbs_biz   as    mktAgreLbsBiz     /* 위치정보사업동의 */
              ,a.mkt_agre_lbs_svc   as    mktAgreLbsSvc     /* 위치정보서비스활용동의 */
              ,a.mkt_agre_third_snd as    mktAgreThirdSnd   /* 3자정보제공동의 */
              ,a.mkt_agre_use       as    mktAgreUse        /* 마케팅활용동의 */
              ,a.rid_mbr            as    ridMbr            /* RID_MEM */
              ,a.rid_chnl           as    ridChnl           /* RID_CHNL */
              ,a.addr1_zip          as    addr1Zip          /* 주소1_우편번호 */
              ,a.addr1_dflt         as    addr1Dflt         /* 주소1_기본 */
               <if test="clearMask != null">
              ,secu.fn_getDecrypt(#{cipherKey},a.addr1_dtl, null)            as    addr1Dtl     /* 주소1_상세 */
              </if>
              <if test="clearMask == null">
              ,secu.fn_getDecrypt(#{cipherKey},a.addr1_dtl, 'ADDR_DETAIL')            as    addr1Dtl     /* 주소1_상세 */
              </if>
              <!-- ,a.addr2_zip            as    addr2Zip            /* 주소2_우편번호 */ 없어진 필드 입니다.-->
              <!-- ,a.addr2_dflt           as    addr2Dflt           /* 주소2_기본 */ -->
              <if test="clearMask != null">
              <!-- ,secu.fn_getDecrypt(#{cipherKey},a.addr2_dtl, null)            as    addr2Dtl     /* 주소2_상세 */ -->
              </if>
              <if test="clearMask == null">
              <!-- ,secu.fn_getDecrypt(#{cipherKey},a.addr2_dtl, 'ADDR_DETAIL')            as    addr2Dtl     /* 주소2_상세 */ -->
              </if>
              , to_char(a.reg_dt,'YYYY-MM-DD HH24:MI:SS') as regDt
		      , ${strColumn}
        from loy.loy_chnl_mbr a
        inner join loy.loy_channel b on a.rid_chnl = b.rid
        left outer join com.comm_code cd  on a.chnl_rel_type_cd = cd.code_name
        and cd.group_code = 'LOY_CHNL_REL_TYPE_CD'
        and cd.flag = 1
        and cd.lang = #{lang}
        and cd.country = #{country}
        where <!-- ${strSVCType}
          and  -->${strWhere}
          and a.rid_mbr = #{ridMbr}
          and a.active_flg = 'Y'
          <!-- and a.chnl_rel_type_cd != 'C' --> <!-- 단골매장 관계('C')는 보여주지 않는다. -->
          and a.flag = 1
        order by ${strOrderby}
        ${strEndPaging}
    </select>




     <!-- /**************************************
    -   관련 파일            : LOYMbrDAO.java (delMbr)
    ============================================
    -   제목                   : 회원  삭제
    -   설명                   : 회원 삭제
    -   결과형태             : 단건
    ============================================
    -   입력            : rid
    -   출력            :
    ============================================
    -   작성자                : knlee
    -   작성일                : 2016.12.13.
    ***************************************/ -->
    <update id="updateMbrDel" parameterType="mbrRequest">
        /* LOYMbr.updateMbrDel */
        update loy.loy_mbr
           set modify_date  = sysdate
              , modify_by   = #{modifyBy}
              , flag        = 0
         where 1 = 1
           and rid = #{rid}
    </update>


     <!-- /**************************************
    -   관련 파일            : LOYMbrDAO.java ()
    ============================================
    -   제목                   :  프로그램 번호, 채널번호, 식별유형(값) 가져오기
    -   설명                   : 회원가입을 위해 화면에서 받은 rid (pgm, chnl, cust)로  pgmNo, chnlNo, identiTypeCd, identiVal값을 가져옴
    -   결과형태             : 단건
    ============================================
    -   입력            : ridPgm, ridChnl, ridCust
    -   출력            :
    ============================================
    -   작성자                : knlee
    -   작성일                : 2017.01.17
    ***************************************/ -->
    <select id="getNoFromRid" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        /* LOYMbr.getNoFromRid */
        select t1.pgm_no        as pgmNo
          ,t2.chnl_no           as chnlNo
          ,t3.custNm           as custNm
          ,t3.cust_type_cd      as custTypeCd
          ,t3.identi_type_cd    as identiTypeCd
          ,t3.identiVal         as identiVal
         from (
                select pgm_no
                  from loy.loy_pgm
                  where rid = #{ridPgm} /* 'recId00001' */
               ) t1,
               (
                 select  chnl_no
                   from loy.loy_channel
                  where rid =  #{ridChnl} /*'recChnlId000003' */
                ) t2,
                (
                  select
                          secu.fn_getDecrypt(#{cipherKey}, cust_nm, null)  as custNm
                         ,cust_type_cd
                         ,identi_type_cd
                         ,secu.fn_getDecrypt(#{cipherKey}, identi_val, null)  as identiVal
                    from loy.loy_cust
                   where rid = #{ridCust}  /*A24899091649535912*/
                ) t3
    </select>

     <select id="selectMbrFamilyList" parameterType="mbrFamilyRequest" resultType="mbrFamilyResponse">
        /* LOYMbr.selectMbrFamilyList */
        select
        * from (
             select
               a.rid as rid,
               c.mbr_no as mbrNo,
               secu.fn_getDecrypt(#{cipherKey},d.cust_nm, 'CUST_NM' )  as custNm,
               cd.mark_name   as famlwkRel,
               CASE WHEN a.rep_mbr_id = b.rid_mbr THEN 'O'
               ELSE  '' END              as repFlag,
               to_char(b.faml_join_date,'YYYY-MM-DD')   as famlJoinDate,
               to_char(b.faml_leav_date,'YYYY-MM-DD')   as famlLeavDate,
               cd2.mark_name as famlCompsStat,
               a.app_service_type,
              a.country,
              b.create_date
               <!-- , ${strColumn} -->
            from
             loy.loy_family  a inner join loy.loy_mbr_faml  b on a.rid = b.rid_faml
             inner join loy.loy_mbr  c on c.rid = b.rid_mbr
             inner join loy.loy_cust  d on d.rid = c.rid_cust
             left join com.comm_code cd on b.famlwk_rel_cd  = cd.code_name and cd.group_code = 'LOY_FAML_REL_CD' and cd.country = #{country} and cd.flag = 1 and cd.lang = #{lang}
             left join com.comm_code cd2 on a.faml_comps_stat_cd  = cd2.code_name and cd2.group_code = 'LOY_FAML_STAT_CD' and cd2.country = #{country} and cd2.flag = 1 and cd2.lang = #{lang}
             where a.rid in
            (
            select
               a.rid
            from
             loy.loy_family  a inner join loy.loy_mbr_faml  b on a.rid = b.rid_faml
             where  b.rid_mbr = #{ridMbr}
             )

             ) a
               where ${strSVCType}
                and ${strWhere}
                order by ${strOrderby}
                ${strEndPaging}

    </select>

    <!--
    /**************************************
    -   관련 파일            : LOYMbrDAO.java (getMbrstatus)
    ============================================
    -   제목                   : 회원 상태 조회
    -   설명                   : 회원 상태 조회
    -   결과형태             : 단건
    ============================================
    -   입력            :  rid
    -   출력            :
    ============================================
    -   작성자                : 유영진
    -   작성일                : 2017.04.17.
    ***************************************/
    -->
    <select id="selectMbrstatus" parameterType="mbrRequest" resultType="mbrResponse">
    /* LOYMbr.selectMbrstatus */

        SELECT lm.mbr_no          AS    mbrNo           /* 회원 번호 */
             , lm.mbr_stat_cd     AS    mbrStatCd       /* 회원 상태 코드 */
             , lm.mbr_type_cd     AS    mbrTypeCd       /* 회원 유형 코드 */
             , SUM( CASE WHEN  lpa.valid_start_date &lt;= sysdate
                         AND   lpa.valid_end_date   &gt;= sysdate
                          THEN  lpa.balnc
                         ELSE  0
                    END
                  ) AS availablePoints    /* 회원 가용포인트 */
             , secu.fn_getDecrypt(#{cipherKey},lm.hhp_no, null)       AS hhpNo     /* 휴대폰 번호 */
             , secu.fn_getDecrypt(#{cipherKey},lm.email_addr, null)   AS emailAddr  /* 이메일 주소 */
        FROM   loy.loy_mbr lm
        LEFT OUTER JOIN loy.loy_pnt_txn lpt
            ON  lm.rid = lpt.rid_mbr
            AND lpt.txn_stat_cd  = 'A'
        LEFT OUTER JOIN loy.loy_pnt_acrl lpa
            ON  lpt.rid = lpa.rid_pnt_txn
        WHERE lm.rid = #{rid}

    </select>


    <select id="selectMemberDup" parameterType="mbrRequest" resultType="mbrResponse">
        select  mbr.rid_cust    as ridCust
                ,mbr.rid        as rid
                ,mbr.mbr_no     as mbrNo
                ,mbr.mbr_stat_cd as mbrStatCd
        from    loy.loy_mbr mbr
        join    loy.loy_pgm pgm on mbr.rid_pgm = pgm.rid
        where   pgm.pgm_no   = #{pgmNo}
        and     mbr.rid_cust = #{ridCust}
        and     mbr.accnt_id = #{accountId}
        and     (mbr.mbr_stat_cd = 'A' or mbr.mbr_stat_cd = 'W')
    </select>


    <select id="getMbrNo" resultType="java.lang.String">
        select loy.fn_get_seq_no('SEQ_MBR_NO')
    </select>

    <insert id="insertMember" parameterType="mbrRequest">

        insert into loy.loy_mbr
        (rid,
        rid_cust,
        rid_pgm,
        mbr_no,
        rid_chnl_join,
        rid_chnl_primary,
        mbr_type_cd,
        mbr_stat_cd,
        join_date,
        leav_date,
        rid_tier_cur,
        cur_tier_sel_date,
        mkt_agre_prv_info,
        mkt_agre_use,
        mkt_agre_lbs_biz,
        mkt_agre_lbs_svc,
        chnl_agre_sms,
        chnl_agre_tel,
        chnl_agre_dm,
        chnl_agre_push,
        chnl_agre_email,
        addr1_zip,
        addr1_dflt,
        addr1_dtl,
        <!-- addr2_zip,없어진 필드 입니다. -->
        <!-- addr2_dflt, -->
        <!-- addr2_dtl, -->
        hhp_no,
        <!-- home_tel_no, -->
        <!-- off_tel_no, -->
        email_addr,
        token_id,
        grp_cust_emp_name,
        accnt_id,
        app_service_type,
        country,
        flag,
        mod_num,
        create_date,
        create_by,
        modify_date,
        modify_by

        ) values (

        #{rid},
        #{ridCust},
        (select rid from loy.loy_pgm where pgm_no = #{pgmNo}),
        (SELECT mbr_no from loy.loy_mbr_no WHERE seq_no = #{mbrNo} ),
        #{ridChnlJoin},
        #{ridChnlPrimary},
        #{mbrTypeCd},
        'A',
        sysdate,
        NULL,
        (select t2.rid_tier_dflt from loy.loy_pgm t1 inner join loy.loy_tier_group t2 on t1.rid_tier_grp_pr=t2.rid and t1.pgm_no=#{pgmNo}),
        sysdate,
        #{mktAgrePrvInfo},
        #{mktAgreUse},
        #{mktAgreLbsBiz},
        #{mktAgreLbsSvc},
        #{chnlAgreSms},
        #{chnlAgreTel},
        #{chnlAgreDm},
        #{chnlAgrePush},
        #{chnlAgreEmail},
        #{addr1Zip},
        #{addr1Dflt},
        #{addr1Dtl},
        <!-- #{addr2Zip}, 없어진 필드 입니다.-->
        <!-- #{addr2Dflt}, -->
        <!-- #{addr2Dtl}, -->
        #{hhpNo},
        <!-- #{homeTelNo}, -->
        <!-- #{offTelNo}, -->
        #{emailAddr},
        #{tokenId},
        #{grpCustEmpName},
        #{accountId},
        #{appServiceId},
        #{country},
        1,
        0,
        sysdate,
        #{createBy},
        sysdate,
        #{modifyBy}

        )
        <selectKey keyProperty="" resultType="java.lang.String">
           SELECT rid FROM loy.loy_mbr WHERE rid = #{rid} limit 1
        </selectKey>

    </insert>


    <insert id="insertChnlMbrRel" parameterType="mbrRequest">

        insert into loy.loy_chnl_mbr
            (
            rid,
            chnl_rel_type_cd,
            mkt_agre_prv_info,
            mkt_agre_lbs_biz,
            mkt_agre_lbs_svc,
            mkt_agre_third_snd,
            mkt_agre_use,
            rid_mbr,
            rid_chnl,
            addr1_zip,
            addr1_dflt,
            addr1_dtl,
            <!-- addr2_zip, 없어진 필드 입니다.-->
            <!-- addr2_dflt, -->
            <!-- addr2_dtl, -->
            accnt_id,
            app_service_type,
            country,
            flag,
            mod_num,
            create_date,
            create_by,
            modify_date,
            modify_by
            )
            values
            (
            #{ridChnlMbrRel},
            'T',
            #{mktAgrePrvInfo},
            #{mktAgreLbsBiz},
            #{mktAgreLbsSvc},
            #{mktAgreThirdSnd},
            #{mktAgreUse},
            #{rid},
            #{ridChnlJoin},
            #{addr1Zip},
            #{addr1Dflt},
            #{addr1Dtl},
            <!-- #{addr2Zip},없어진 필드 입니다. -->
            <!-- #{addr2Dflt}, -->
            <!-- #{addr2Dtl}, -->
            #{accountId},
            #{appServiceId},
            #{country},
            1,
            0,
            sysdate,
            #{createBy},
            sysdate,
            #{modifyBy})
    <selectKey keyProperty="" resultType="java.lang.String">
           SELECT rid FROM loy.loy_chnl_mbr WHERE rid = #{ridChnlMbrRel} limit 1
    </selectKey>



    </insert>



     <select id="getTierList" parameterType="mbrRequest" resultType="mbrTierListResponse">

        SELECT b.rid AS ridTier,
               b.rid_tier_group AS ridTierGroup,
               b.tier_cd AS tierCd,
               b.seq_no AS seqNo,
               b.valid_start_date AS validStartDate,
               b.valid_end_date AS validEndDate,
               c.rid_tier_dflt as ridTierDflt,
               c.valid_period_mm_val as validPeriodMmVal
         FROM  loy.loy_pgm a
         LEFT OUTER JOIN   loy.loy_tiers b  ON a.rid_tier_grp_pr = b.rid_tier_group
         LEFT OUTER JOIN   loy.loy_tier_group c ON a.rid_tier_grp_pr = c.rid
        WHERE   a.pgm_stat = 'A'
          <!-- AND a.country =  #{country}
          AND a.flag = 1 -->
          AND b.tier_cd_stat_cd = 'A'
          <!-- AND b.country =#{country}
          AND b.flag = 1
          AND a.rid = #{loyProgramId}
          AND a.accnt_id = #{accountId} -->
          <!-- AND a.app_service_type = #{appServiceId}
          AND b.accnt_id = #{accountId}
          AND b.app_service_type = #{appServiceId} -->
          AND   b.valid_start_date &lt;= sysdate and b.valid_end_date &gt;=  sysdate
          ORDER BY b.seq_no
    </select>



    <insert id="insertTierMbrHist" parameterType="mbrTierHistRequest">
    insert into loy.loy_tier_hist (
             RID
            ,RID_MBR
            ,RID_CUR_TIER
            ,VALID_HIST_YN
            ,TIER_CALC_DATE
            ,VALID_START_DT
            ,VALID_END_DT
            ,RID_BEF_TIER
            ,RSLT_EXTR_START_DT
            ,RSLT_EXTR_END_DT
            ,RID_NEXT_TIER
            ,ACCNT_ID
            ,APP_SERVICE_TYPE
            ,COUNTRY
            ,FLAG
            ,MOD_NUM
            ,CREATE_DATE
            ,CREATE_BY
            ,MODIFY_DATE
            ,MODIFY_BY
        ) values (
               #{rid}
             , #{ridMbr}
             , #{ridCurTier}
             , 'Y'
             , to_char(sysdate,'YYYYMMDD' )
             , replace(#{validStartDt},'-','')
             , replace(#{validEndDt},'-','')
             , #{ridBefTier}
             , replace(#{validStartDt},'-','')
             , replace(#{rsltExtrEndDt},'-','')
             , #{ridNextTier}
             , #{accountId}
             , #{appServiceId}
             , #{country}
             , 1
             , 0
             , sysdate
             , #{createBy}
             , sysdate
             , #{modifyBy}

         )

     <selectKey keyProperty="" resultType="java.lang.String">
           SELECT rid FROM loy.loy_tier_hist WHERE rid = #{rid} limit 1
    </selectKey>
    </insert>



    <update id="updateTierMbr" parameterType="mbrRequest">
         update loy.loy_mbr
            set CUR_TIER_SEL_DATE = sysdate
                ,RID_TIER_CUR =  #{ridTierCur}
                ,modify_by =  #{modifyBy}
                ,modify_date = sysdate
          where 1=1
            and rid = #{rid}


    </update>


    <select id="getCardKindNo" parameterType="mbrRequest" resultType="java.lang.String">
        /* getCardKindNo */
        select card_kind_no
        from loy.loy_pgm a
        left outer join loy.loy_card_kind  b on a.rid_card_kind_pr = b.rid
        where pgm_no = #{pgmNo}

    </select>


    <insert id="registerCard" parameterType="mbrCardCreateRequest">

        /* LOYApiCard.insertCard */
        insert into loy.loy_mbr_card
        (
             rid
            ,rid_mbr
            ,rid_card_kind
            ,card_no
            ,issue_date
            ,rid_chnl
            ,card_leav_date
            ,stat
            ,pswd_no
            ,rid_faml
            ,accnt_id
            ,app_service_type
            ,country
            ,flag
            ,mod_num
            ,create_date
            ,create_by
            ,modify_date
            ,modify_by
        )
        values
        (
             #{ridCard}
            ,#{ridMbr}
            ,(select rid
              from loy.loy_card_kind
              where card_kind_no = #{cardKindNo}
              and country = #{country}
              and accnt_id = #{accountId}
              and flag = 1)
            ,#{cardNo}
            ,#{cardIssueDt}
            ,#{ridChnl}
            ,NULL
            ,'A'
            ,#{cardUsePw}
            ,#{ridFaml}
            ,#{accountId}
            ,#{appServiceId}
            ,#{country}
            ,1
            ,0
            ,sysdate
            ,#{createBy}
            ,sysdate
            ,#{modifyBy}
        )
    <selectKey keyProperty="" resultType="java.lang.String">
           SELECT rid FROM loy.loy_mbr_card WHERE rid = #{ridCard} limit 1
    </selectKey>
    </insert>


    <update id="updateMbr" parameterType="mbrRequest">
        update  loy.loy_mbr
           set  addr1_dflt = #{addr1Dflt},
                addr1_dtl = #{addr1Dtl},
                <!-- addr2_dflt = #{addr2Dflt}, -->
                <!-- addr2_dtl = #{addr2Dtl}, -->
                addr1_zip = #{addr1Zip},
                <!-- addr2_zip = #{addr2Zip}, 없어진 필드 입니다.-->
                <!-- home_tel_no = secu.fn_getEncrypt(#{cipherKey}, #{homeTelNo}), -->
                email_addr = #{emailAddr},
                hhp_no = #{hhpNo},
                <!-- off_tel_no = #{offTelNo}, -->
                chnl_agre_dm = #{chnlAgreDm},
                chnl_agre_email = #{chnlAgreEmail},
                chnl_agre_push = #{chnlAgrePush},
                chnl_agre_sms = #{chnlAgreSms},
                chnl_agre_tel = #{chnlAgreTel},
                mkt_agre_prv_info = #{mktAgrePrvInfo},
                mkt_agre_third_snd = #{mktAgreThirdSnd},
                mkt_agre_use = #{mktAgreUse},
                grp_cust_emp_name = #{grpCustEmpName},

                modify_date = sysdate,
                modify_by = #{modifyBy}
          where rid =  #{rid}

    </update>

    <select id="getOfferList" parameterType="mbrRequest" resultType="java.util.HashMap">
        /* LOYMbr.getOfferList */
        select distinct
               nullif(offer.offer_type_cd ,'')  as offerTypeCd
             , nullif(offer.offer_sub_type_cd,'')  as offerSubTypeCd
             , c1.mark_name as offerType
             , c2.mark_name as offerSubType
         from mkt.mkt_offer_mst offer
        join com.comm_code c1 on c1.flag = 1 and c1.code_name = offer.offer_type_cd and c1.lang = #{lang} and c1.group_code = 'OFFER_TYPE_CD'
        left outer join com.comm_code c2 on c2.flag = 1 and c2.code_name = offer.offer_sub_type_cd and c2.lang = #{lang} and c2.group_code = 'OFFER_SUB_TYPE_CD'
        <!-- where offer.rid_pgm = #{loyProgramId}
        and offer.app_service_type = #{appServiceId}
        and offer.accnt_id = #{accountId} -->
    </select>

    <!-- 로얄티 프로그램 회원의 비밀번호 조회 -->
    <select id="selectMbrPwdDetail" parameterType="mbrPasswordRequest" resultType="mbrPasswordResponse">
        /* LOYMbr.selectMbrPwdDetail */

        SELECT
            pnt_use_pw as pntUsePw,
            case when pnt_use_pw is null or pnt_use_pw = '' then 0
                 else 1 end as isEmptyPntUsePw
        FROM loy.loy_mbr
        WHERE flag = 1
          AND rid = #{rid}

    </select>

    <!-- 로얄티 프로그램 회원의 비밀번호 변경 -->
    <update id="updateMbrPwd" parameterType="mbrPasswordRequest">
        /* LOYMbr.updateMbrPwd */

        UPDATE loy.loy_mbr
        SET
              WEB_PWD = #{pntUsePw}
            , modify_by = #{modifyBy}
            , modify_date = sysdate
            , mod_num = mod_num + 1
        WHERE flag = 1
          AND rid = #{rid}
    </update>



    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 SearchHelp조회
    -   설명                  : 회원 SearchHelp조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.16
    ***************************************/ -->
    <select id="selectMbrSearchHelp" parameterType="mbrSearchHelpRequest" resultType="mbrSearchHelpResponse">
        /* LOYMbr.selectMbrSearchHelp */
        select
                a.rid                	 as rid       /** rid mbrcard */
              , a.mbr_no                 as mbrNo
              , LOY.FN_GET_MBRNM_MASKING(secu.fn_getDecrypt(#{cipherKey} ,b.cust_nm))  as custNm    /* 회원명 */
              , a.WEB_ID                 as webMemId
              , a.MBR_STAT_CD 			 AS mbrStatCd
              , cc.mark_name             as mbrStatNm
              , secu.fn_getDecrypt(#{cipherKey},a.hhp_no, 'PHONE_NUM2')  as hhpNo
              , secu.fn_getDecrypt(#{cipherKey},a.email_addr, 'EML')    as emailAddr
              , b.birth_dt          as realBirthDt
              , d.tier_nm           as tierNm
              <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
              , a.mem_div as memDiv
              , c.mark_name              as mbrType
               -->
              , d.TIER_CD as tierCd
              , b.rid as ridCust
              , a.mbr_lock_yn as mbrLockYn
              , ${strColumn}
        from  loy.loy_mbr a
    	inner join loy.loy_cust b on a.rid_cust = b.rid
        <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
        left outer join com.comm_code c  on a.mem_div = c.code_name  and c.group_code   = 'MEMBER_TYPE' and c.flag  = 1  and c.lang=#{lang} and c.country = #{country}
         -->
        left outer join com.comm_code cc on a.mbr_stat_cd  = cc.code_name and cc.flag = 1 and cc.group_code = 'LOY_MEM_STAT_CD' and cc.lang = #{lang} and cc.country = #{country}
        left outer join loy.loy_tiers d  on a.rid_tier_cur = d.rid
        where ${strCondWhere}
          and ${strSVCType}
          and ${strWhere}
          and a.flag = 1
          AND a.mbr_stat_cd = 'A' /* 활성회원만*/
          <!-- and a.mbr_stat_cd != '20' -->
          <if test="first == &quot;X&quot;">
          and 1 = 2
          </if>
          <if test="hhpSearhFlag == &quot;Y&quot;">
            <if test="hhpSearhOpType == &quot; = &quot;">
                and a.hhp_no = secu.fn_getEncrypt(#{cipherKey}, #{hhpSearhValue})
            </if>
            <if test="hhpSearhOpType == &quot; LIKE &quot;">
                and a.HHP_NO_TAIL = #{hhpSearhValue}
            </if>
          </if>
        order by ${strOrderby}
        ${strEndPaging}
    </select>



    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 탈회 회원 회원  리스트 조회
    -   설명                  : 탈회 회원 회원  리스트 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.16
    ***************************************/ -->
    <select id="selectDropMbrList" parameterType="dropMbrRequest" resultType="dropMbrResponse">
        /* LOYMbr.selectDropMbrList */
        select
             a.rid					as rid
            ,a.mbr_no             as mbrNo
      		<!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
      		,a.mem_div             as memDivCd
      		,cd.mark_name          as memDiv
      		 -->
      ,b.tier_nm             as tierNm
      ,to_char(a.leave_date,'yyyy-mm-dd hh24:mi:ss')			 as leaveDate
   <!--    ,a.rtrmmb_dd             as rtmmbDd
      ,a.mem_yn             as e1MemYn
      ,a.wb_mem_yn             as webMemYn -->
      ,LOY.FN_GET_MBRNM_MASKING(secu.fn_getDecrypt(#{cipherKey}, c.web_id))		as webId
      ,c.rid				as ridMbrDrop
      ,cc1.MARK_NAME         AS reasonCd
      ,d.DROP_COMMENT      AS dropComment
      ,d.REASON_CD  AS reasonCode
        from loy.loy_mbr a
        LEFT OUTER JOIN  loy.loy_tiers b on a.rid_tier_cur = b.rid
        LEFT OUTER JOIN  loy.LOY_MBR_DROP c on c.rid_mbr = a.rid and c.NEXT_JOIN_DT  <![CDATA[>]]> SYSDATE
        LEFT OUTER JOIN  loy.LOY_MBR_DROP_REASON d ON d.RID_REG_USER =c.RID_MBR
        LEFT OUTER JOIN com.comm_code cc1 ON cc1.seq=d.REASON_CD AND cc1.GROUP_CODE='REASON_CD'
         <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
        LEFT OUTER JOIN com.comm_code cd ON a.MEM_DIV = cd.code_name and cd.flag  = 1 and cd.group_code  = 'MEMBER_TYPE' and cd.lang=#{lang}  and cd.country  = #{country}
         -->
        where ${strCondWhere}
          and ${strSVCType}
          and ${strWhere}
          <!-- and a.accnt_id = #{accountId}
          and a.flag = 1 -->
          <!-- and a.rid_pgm = #{loyProgramId} -->
          and a.mbr_stat_cd='C' <!-- 'LOY_MEM_STAT_CD' 탈퇴 -->
          and cc1.flag='1'
        order by ${strOrderby}
        ${strEndPaging}


    </select>

    <!-- 탈퇴회원 마스킹 해제 -->
    <select id="clearMaskDrop" parameterType="dropMbrRequest" resultType="dropMbrResponse">
        /* LOYMbr.selectDropMbrList */
        select
             a.rid					as rid
            ,a.mbr_no             as mbrNo
      		<!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
      		,a.mem_div             as memDivCd
      		,cd.mark_name          as memDiv
      		 -->
      ,b.tier_nm             as tierNm
      ,to_char(a.leave_date,'yyyy-mm-dd hh24:mi:ss')			 as leaveDate
   <!--    ,a.rtrmmb_dd             as rtmmbDd
      ,a.mem_yn             as e1MemYn
      ,a.wb_mem_yn             as webMemYn -->
      ,secu.fn_getDecrypt(#{cipherKey}, c.web_id) 			as webId
      ,c.rid				as ridMbrDrop
        from loy.loy_mbr a
        LEFT OUTER JOIN  loy.loy_tiers b on a.rid_tier_cur = b.rid
        LEFT OUTER JOIN  loy.LOY_MBR_DROP c on c.rid_mbr = a.rid and c.NEXT_JOIN_DT  <![CDATA[>]]> SYSDATE
        <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
        LEFT OUTER JOIN com.comm_code cd ON a.MEM_DIV = cd.code_name and cd.flag  = 1 and cd.group_code  = 'MEMBER_TYPE' and cd.lang=#{lang}  and cd.country  = #{country}
         -->
        where 1 = 1
        AND a.rid = #{rid}

    </select>

    <select id="selectDropMbrListCnt" parameterType="dropMbrRequest" resultType="java.lang.Integer">
        /* LOYMbr.selectDropMbrListCnt */
        select count(*)
        from loy.loy_mbr a
		LEFT OUTER JOIN  loy.LOY_MBR_DROP c on c.rid_mbr = a.rid
		LEFT OUTER JOIN  loy.LOY_MBR_DROP_REASON d ON d.RID_REG_USER =c.RID_MBR
        where ${strCondWhere}
          and ${strSVCType}
          <!-- and ${strWhere} -->
          and a.mbr_stat_cd='C'

    </select>


    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 단체  리스트 조회
    -   설명                  : 회원 단체  리스트 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.16
    ***************************************/ -->
    <select id="selectMbrGroupList" parameterType="mbrGroupRequest" resultType="mbrGroupResponse">
        /* LOYMbr.selectMbrGroupList */
        select
            a.rid
            ,a.mbr_no         as mbrNo         /* 회원 번호 */
            ,b.chnl_nm    as chnlNm
            <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
            ,e.mark_name    as memDiv
             -->
            ,c.tier_nm    as tierNm
            ,d.mark_name    as mbrStat
            <!-- , ${strColumn} -->
        from loy.loy_mbr a
        left outer join loy.loy_channel b on a.rid_org = b.rid
        left outer join loy.loy_tiers c on a.rid_tier_cur = c.rid
        left outer join com.comm_code d on a.mbr_stat_cd = d.code_name and d.flag = 1 and d.group_code = 'LOY_MEM_STAT_CD' and d.lang=#{lang} and d.country = #{country}
        <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
        left outer join com.comm_code e on a.mem_div = e.code_name and e.flag = 1 and e.group_code = 'MEMBER_TYPE_ONLY_G' and e.lang=#{lang} and e.country = #{country}
         -->
        where  ${strCondWhere}
          and ${strSVCType}
          and ${strWhere}
          <!-- and a.accnt_id = #{accountId} -->
          <!-- and a.flag = 1 -->
          <!-- and a.rid_pgm = #{loyProgramId} -->
          and a.mbr_type_cd ='20'
          and a.mbr_stat_cd ='10'
          <if test="chnlRid != null and chnlRid != ''">
      and a.rid_chnl_primary = #{chnlRid}
      </if>
        order by ${strOrderby}
        ${strEndPaging}

    </select>


     <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 단체   조회
    -   설명                  : 회원 단체   조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.16
    ***************************************/ -->
    <select id="selectMbrGroup" parameterType="mbrGroupRequest" resultType="mbrGroupResponse">
        /* LOYMbr.selectMbrGroup */
        select a.rid
              ,a.mbr_no          as    mbrNo         /* 회원 번호 */
            ,b.chnl_nm    as chnlNm
            <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
            ,a.MEM_DIV	 AS memDiv
          	,e.mark_name AS memDivMarkName
            ,e.mark_name    as memDiv
             -->
            ,c.tier_nm    as tierNm
            ,c.tier_cd    as tierCd
            ,d.mark_name    as mbrStat
            ,a.avl_point    as avlPoint
            ,f.mark_name    as mbrType
            ,a.mbr_type_cd  as mbrTypeCd
            ,a.mbr_stat_cd  as mbrStatCd
            ,b.rid            as chnlRid
        from loy.loy_mbr a
        left outer join loy.loy_channel b on a.rid_org = b.rid
        left outer join loy.loy_tiers c on a.rid_tier_cur = c.rid
        left outer join com.comm_code d on a.mbr_stat_cd = d.code_name and d.flag = 1 and d.group_code = 'LOY_MEM_STAT_CD' and d.lang=#{lang} and d.country = #{country}
        <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
        left outer join com.comm_code e on a.mem_div = e.code_name and e.flag = 1 and e.group_code = 'MEMBER_TYPE' and e.lang=#{lang} and e.country = #{country}
         -->
        left outer join com.comm_code f on a.mbr_type_cd = f.code_name and f.flag = 1 and f.group_code = 'LOY_MEM_TYPE_CD' and f.lang=#{lang} and f.country = #{country}
        where 1=1
        and a.rid = #{rid}

    </select>




    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 직원조회서치핼프
    -   설명                  : 직원조회서치핼프
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.16
    ***************************************/ -->
    <select id="selectEmpSearchHelp" parameterType="empSearchHelpRequest" resultType="empSearchHelpResponse">
        /* LOYMbr.selectEmpSearchHelp */
    select
        distinct e.id  as rid
        ,e.name        as name
        ,f.user_id     as userId
        ,g.div_nm      as divNm
        <!-- ,${strColumn} -->
    from  com.auth  a
        inner join com.auth_group_rel  b on a.id = b.aut_id
        inner join com.auth_group  c on b.aut_group_id = c.id
        inner join com.auth_user_rel  d on c.id = d.aut_group_id
    left join com.crm_user  f on d.rid_user = f.rid
        inner join com.employee  e on f.id_employee = e.id
        left outer join com.crm_division  g on e.rid_division = g.rid
        where ${strCondWhere}
          and ${strSVCType}
          and ${strWhere}
          <!-- and a.flag = 1 -->
          and a.aut_nm = #{authNm}
        order by ${strOrderby}
        ${strEndPaging}
    </select>





    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 개명요청 리스트 조회
    -   설명                  : 개명요청 리스트 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.16
    ***************************************/ -->
    <select id="selectMbrRenameReqList" parameterType="mbrRenameRequest" resultType="mbrRenameResponse">
        /* LOYMbr.selectMbrRenameReqList */
    select
        distinct a.rid
            ,a.create_date             as createDate
        ,b.mbr_no             as mbrNo
        ,a.old_name             as oldName
        ,a.rmark             as remark
        ,a.new_name             as newName
        ,a.renm_yn             as renmYn
        ,a.modify_date             as modifyDate
        ,c.name             as empName
        ,a.rid_mbr      as ridMbr
        <!-- , ${strColumn} -->
    from loy.loy_renm_rqt a
    left outer join loy.loy_mbr b on a.rid_mbr = b.rid
    left outer join com.employee c on a.modify_by = c.id
        where ${strCondWhere}
          and ${strSVCType}
          and ${strWhere}
          <!-- and a.flag = 1 -->
        order by ${strOrderby}
        ${strEndPaging}
    </select>



    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 개명요청 상세 조회
    -   설명                  : 개명요청 상세 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.16
    ***************************************/ -->
    <select id="selectMbrRenameReqDetail" parameterType="mbrRenameRequest" resultType="mbrRenameResponse">
        /* LOYMbr.selectMbrRenameReqDetail */
    select   a.rid
            ,a.create_date             as createDate
        ,b.mbr_no             as mbrNo
        ,a.old_name             as oldName
        ,a.rmark             as remark
        ,a.new_name             as newName
        ,a.renm_yn             as renmYn
        ,a.modify_date             as modifyDate
        ,c.name             as empName
        ,a.rid_mbr      as ridMbr
    from loy.loy_renm_rqt a
    left outer join loy.loy_mbr b on a.rid_mbr = b.rid
    left outer join com.employee c on a.modify_by = c.id
        where a.rid = #{rid}
    </select>


    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 개명요청 저장
    -   설명                  : 개명요청 저장
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.16
    ***************************************/ -->
    <insert id="insertMbrRenameReqDetail" parameterType="mbrRenameRequest">
     /* LOYMbr.insertMbrRenameReqDetail */
     INSERT INTO loy.loy_renm_rqt
     (RID
     , CREATE_BY
     , MODIFY_BY
     , CREATE_DATE
     , MODIFY_DATE
     , FLAG
     , COUNTRY
     , CURRENCY
     , APP_SERVICE_TYPE
     , TYPE
     , ACCNT_ID
     , RID_MBR
     , RID_EMP_OF_TRTR
     , RENM_YN
     , RENM_DATE
     , NEW_NAME
     , OLD_NAME
     , RMARK)
     VALUES (#{rid},
      #{createBy},
      #{modifyBy},
      sysdate,
      sysdate,
      1,
      #{country},
      'KRW',
      #{appServiceId},
      '',
      #{accountId},
      #{ridMbr},
      null,
      'N',
      null,
      #{newName},
      #{oldName},
      #{remark} );


    </insert>

    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 개명요청 변경
    -   설명                  : 개명요청 변경
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.16
    ***************************************/ -->
    <update id="updateMbrRenameReqDetail" parameterType="mbrRenameRequest">
     /* LOYMbr.updateMbrRenameReqDetail */
     UPDATE loy.loy_renm_rqt
     SET MODIFY_DATE= sysdate,
     RID_MBR= #{ridMbr},
     NEW_NAME= #{newName},
     OLD_NAME= #{oldName},
     RMARK = #{remark}
     WHERE RID= #{rid};


    </update>



    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 오랜지카드 조회
    -   설명                  : 회원 오랜지카드 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.16
    ***************************************/ -->
    <select id="selectMbrOrangeCardList" parameterType="mbrOrangeCardRequest" resultType="mbrOrangeCardResponse">
     /* LOYMbr.selectMbrOrangeCardList */
     select
             b.rid              as rid
           <!-- ,case
               when c.card_type='10' or c.card_type='30' then com.fn_getCardNum(secu.fn_getDecrypt(#{cipherKey} ,b.card_no, null ))
              else
               secu.fn_getDecrypt(#{cipherKey} ,b.card_no, 'CARD_NUM')
              end as cardNo
               -->
      ,secu.fn_getDecrypt(#{cipherKey} ,b.card_no, 'CARD_NUM') as cardNo
      ,c.card_knd_nm             as cardKndNm
      ,d.mark_name             as cprtCard
      ,cc.mark_name             as cprtCardItemCd
      ,e.mark_name             as stat
      ,b.stat         as statCd
      ,c.card_type        as mbrType
      ,f.mark_name             as regChnlCd
      ,b.create_date             as createDate
      ,i.name            as createBy
      ,b.lose_dt             as loseDt
      ,j.name            as loseTrTr
      ,b.card_leav_date             as cardLeavDate
      ,nvl(b.cprt_card_cd,'')     as cprtCardCd
      <!-- , ${strColumn} -->
    from loy.loy_mbr a
    inner join loy.loy_mbr_card  b on a.rid = b.rid_mbr
    left outer join loy.loy_card_kind c on b.rid_card_kind  = c.rid
    left outer join com.comm_code d  on b.cprt_card_cd = d.code_name  and d.group_code   = 'CARD_CORP_TYPE' and d.flag  = 1  and d.lang=#{lang} and d.country = #{country}
    left outer join com.comm_code e  on b.stat = e.code_name  and e.group_code   = 'MEMBER_CARD_STATUS' and e.flag  = 1  and e.lang=#{lang} and e.country = #{country}
    left outer join com.comm_code f  on b.reg_chnl_cd = f.code_name  and f.group_code   = 'CARD_REGIST_CHANNEL' and f.flag  = 1  and f.lang=#{lang} and f.country = #{country}
    left outer join com.comm_code cc  on b.cprt_card_item_cd =cc.code_name  and cc.group_code   = 'CARD_CORP_ITEM' and cc.flag  = 1  and cc.lang=#{lang} and cc.country = #{country}

    left outer join com.crm_user g on  b.create_by = g.rid
    left outer join  com.employee i on g.ID_EMPLOYEE = i.id
    left outer join com.crm_user h on  b.rid_lose_trtr = h.rid
    left outer join com.employee j on h.ID_EMPLOYEE = j.id

    where ${strSVCType}
          and ${strWhere}
          and a.rid = #{rid}
          <!-- and a.flag = 1 -->
        order by ${strOrderby}
        ${strEndPaging}
       </select>

    <select id="selectMbrDaisoCardList" parameterType="mbrOrangeCardRequest" resultType="mbrOrangeCardResponse">
     /* LOYMbr.selectMbrDaisoCardList */
     select
             b.rid              as rid
           <!-- ,case
               when c.card_type='10' or c.card_type='30' then com.fn_getCardNum(secu.fn_getDecrypt(#{cipherKey} ,b.card_no, null ))
              else
               secu.fn_getDecrypt(#{cipherKey} ,b.card_no, 'CARD_NUM')
              end as cardNo
               -->
      <!-- ,secu.fn_getDecrypt(#{cipherKey} ,b.card_no, 'CARD_NUM') as cardNo -->
      ,b.card_no as cardNo
      ,c.card_knd_nm             as cardKndNm
      ,d.mark_name             as cprtCard
      ,cc.mark_name             as cprtCardItemCd
      ,e.mark_name             as stat
      ,b.stat         as statCd
      ,c.card_type        as mbrType
      ,f.mark_name             as regChnlCd
      ,to_char(b.create_date,'YYYY-MM-DD HH24:MI:SS')             as createDate
      ,case when nvl(i.name,'') is not null then i.name else '시스템' end            as createBy
      ,b.lose_dt             as loseDt
      ,j.name            as loseTrTr
      ,b.card_leav_date             as cardLeavDate
      ,nvl(b.cprt_card_cd,'')     as cprtCardCd
      , ${strColumn}
    from loy.loy_mbr a
    inner join loy.loy_mbr_card  b on a.rid = b.rid_mbr
    left outer join loy.loy_card_kind c on b.rid_card_kind  = c.rid
    left outer join com.comm_code d  on b.cprt_card_cd = d.code_name  and d.group_code   = 'CARD_CORP_TYPE' and d.flag  = 1  and d.lang=#{lang} and d.country = #{country}
<!--     left outer join com.comm_code e  on b.stat = e.code_name  and e.group_code   = 'MEMBER_CARD_STATUS' and e.flag  = 1  and e.lang=#{lang} and e.country = #{country} -->
    left outer join com.comm_code e  on b.stat = e.code_name  and e.group_code   = 'LOY_CARD_MBR_STAT_CD' and e.flag  = 1  and e.lang=#{lang} and e.country = #{country}
    left outer join com.comm_code f  on b.reg_chnl_cd = f.code_name  and f.group_code   = 'CARD_REGIST_CHANNEL' and f.flag  = 1  and f.lang=#{lang} and f.country = #{country}
    left outer join com.comm_code cc  on b.cprt_card_item_cd =cc.code_name  and cc.group_code   = 'CARD_CORP_ITEM' and cc.flag  = 1  and cc.lang=#{lang} and cc.country = #{country}

    left outer join com.crm_user g on  b.create_by = g.rid
    left outer join  com.employee i on g.ID_EMPLOYEE = i.id
    left outer join com.crm_user h on  b.rid_lose_trtr = h.rid
    left outer join com.employee j on h.ID_EMPLOYEE = j.id

    where ${strSVCType}
          and ${strWhere}
          and a.rid = #{rid}
          and b.stat = 'A' <!-- 활성화 카드만 조회 -->
          <!-- and a.flag = 1 -->
        order by ${strOrderby}
        ${strEndPaging}
       </select>


    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 상담 조회
    -   설명                  : 회원 상담 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.16
    ***************************************/ -->
    <select id="selectMbrVocList" parameterType="mbrVocListRequest" resultType="mbrVocListResponse">
     /* LOYMbr.selectMbrVocList */
     select
             a.rid              as rid
           <!--  ,a.rid_mbr       as mbrRid -->
      ,a.sr_no             as srNo
      ,a.rcp_dt             as rcp_dt
<!--      ,a.sr_trt_status             as srTrtStatus -->
      ,c1.mark_name             as srTrtStatus
      ,a.mem_no             as memNo
      ,a.mem_nm             as memNm
      <!-- ,secu.fn_getDecrypt(#{cipherKey},a.cntc_desk , 'PHONE_NUM2')     as cnctDesk -->
      <!-- ,secu.fn_getDecrypt(#{cipherKey},a.mem_ptbl_no , 'PHONE_NUM2')   as memPtblNo -->
      ,b.mark_name             as cnslgTypeCdL
      ,c.mark_name             as cnslgTypeCdM
      ,d.mark_name             as cnslgTypeCdS
      ,a.cnslg_title             as cnslgTitle
      ,a.cnslg_sbst             as cnslgSbst
      <!-- , ${strColumn} -->
    from voc.voc_svc_req a
    left outer join com.comm_code b  on a.cnslg_type_cd_l = b.code_name  and b.group_code   = 'SR_AREA_L' and b.flag  = 1  and b.lang=#{lang} and b.country = #{country}
    left outer join com.comm_code c  on a.cnslg_type_cd_m = c.code_name  and c.group_code   = 'SR_AREA_M' and c.flag  = 1  and c.lang=#{lang} and c.country = #{country}
    left outer join com.comm_code d  on a.cnslg_type_cd_s = d.code_name  and d.group_code   = 'SR_AREA_S' and d.flag  = 1  and d.lang=#{lang} and d.country = #{country}
    left outer join com.comm_code c1 on c1.flag = 1 and c1.group_code = 'SR_STATUS' and c1.code_name = a.sr_trt_status

    where <!-- ${strSVCType}
          and --> ${strWhere}
          and a.rid_cust = #{ridCust}
          <!-- and a.flag = 1 -->
        order by ${strOrderby}
        ${strEndPaging}

    </select>

    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 스탬프 거래이력
    -   설명                  : 회원 스탬프 거래이력
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.23
    ***************************************/ -->
    <select id="selectMbrStmpTxnHistList" parameterType="mbrStmpTxnHistListRequest" resultType="mbrStmpTxnHistListResponse">
     /* LOYMbr.selectMbrStmpTxnHistList */
     select <!-- SQL_CALC_FOUND_ROWS STRAIGHT_JOIN -->
             a.rid              as rid
            ,a.txn_no             as txnNo
      ,a.appr_dt             as apprDt
      ,a.appr_no             as apprNo
      ,f.mark_name             as txnType1Cd
      ,g.mark_name             as txnType2Cd
      ,a.acrl_stamp             as acrlStamp
      ,a.use_stamp        as useStamp
      ,a.gift_stamp             as giftStamp
      ,a.avl_stamp             as avlStamp
      ,b.mbr_no             as mbrNo
      ,case when b.mbr_type_cd  ='20' then b.mbr_hid_nm
                  else c.cust_nm
          end         as custNm
      ,d.chnl_no             as chnlNo
      ,d.chnl_nm             as chnlNm
      ,e.prod_id             as prodId
      ,e.prod_nm             as prodNm
      ,a.unit_cost             as unitCost
    from loy.loy_stmp_txn a
    left outer join loy.loy_mbr b on a.rid_mbr_transfer = b.rid
    left outer join loy.loy_cust c on b.rid_cust = c.rid
    left outer join loy.loy_channel d on a.rid_chnl = d.rid
    left outer join loy.loy_prod e on a.rid_prod = e.rid
    left outer join com.comm_code f on f.CODE_NAME = a.TXN_TYPE_1_CD AND f.lang=#{lang}  AND f.GROUP_CODE='STAMP_TXN_TYPE_CD'
      left outer JOIN com.comm_code g on g.CODE_NAME = a.TXN_TYPE_2_CD AND g.lang=#{lang}  AND g.GROUP_CODE='STAMP_TXN_SUB_TYPE_CD'
    where ${strSVCType}
          and ${strWhere}
          and a.rid_mbr = #{mbrRid}
          <!-- and a.flag = 1 -->
        order by ${strOrderby}
        ${strEndPaging}

    </select>

     <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 스탬프 정보
    -   설명                  : 회원 스탬프 정보
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.23
    ***************************************/ -->
    <select id="selectMbrStmpInfo" parameterType="mbrStmpTxnHistListRequest" resultType="mbrStmpInfoResponse">
     /* LOYMbr.selectMbrStmpInfo */
     select  nvl(sum(a.recp_stamp_cnt),0)   as recpStampCnt
        ,nvl(sum(a.use_stamp_cnt),0)  as useStampCnt
        ,nvl(sum(a.avl_stamp_cnt),0)  as avlStampCnt
    from loy.loy_stmp a
    where a.rid_mbr = #{mbrRid}
          <!-- and a.flag = 1 -->


    </select>




    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 충전소 거래 이력
    -   설명                  : 회원 충전소 거래 이력
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.23
    ***************************************/ -->
    <select id="selectMbrStnPntTxnList" parameterType="mbrStnPntTxnListRequest" resultType="mbrStnPntTxnListResponse">
     /* LOYMbr.selectMbrStnPntTxnList */
     select <!-- SQL_CALC_FOUND_ROWS STRAIGHT_JOIN -->
             a.rid              as rid
            ,a.rid_chnl       as ridChnl
            ,b.chnl_no             as chnlNo
      ,b.chnl_nm             as chnlNm
      ,a.usable_points             as usablePoints
      ,a.rmark             as rmark
    from loy.loy_stn_pnt a
    left outer join loy.loy_channel b on a.rid_chnl = b.rid
    where ${strSVCType}
          and ${strWhere}
          and a.rid_mbr = #{mbrRid}
          <!-- and a.flag = 1 -->
        order by ${strOrderby}
        ${strEndPaging}

    </select>

    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 차량이력 조회
    -   설명                  : 회원 차량이력 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : swlim
    -   작성일                : 2017.10.23
    ***************************************/ -->
    <select id="selectMbrCarHistList" parameterType="mbrRequest" resultType="mbrCarHistListResponse">
     /* LOYMbr.selectMbrCarHistList */
     SELECT
    lci.REG_DT AS regDt /*등록 일자 */
    , lci.makr AS makr /* 제조사 */
    , cc1.MARK_NAME as makrCode
    , lci.CAR_MODEL AS carModel /* 차량모델 */
    , cc2.MARK_NAME as carModelCode
    , lci.CAR_NM AS carNm /* 차량명 */
    , lci.CAR_NO AS carNo /* 차량번호 */
    , lci.DSPMT AS dspmt /* 배기량 */
    , lci.AUTO_YN AS autoYn /* 차량기어 */
    , cc3.MARK_NAME as autoYnCode
    , lci.USE_YN AS useYn /* 주요사용여부 */
    , cc5.MARK_NAME AS useYnCode /* 주요사용여부 */
    , lci.PU_DD AS puDd /* 구입일자 */
    , lci.INSUR_DD AS insurDd /* 보험일자 */
    , lci.icom AS icom /* 보험사 */
    , lci.MKNG_YY AS mkngYy /* 연식 */
    , lci.USE_PRPS AS usePrps /* 사용용도 */
    , cc4.MARK_NAME as usePrpsCode
    , lci.rid as rid
    <!-- , ${strColumn} -->
  FROM loy.loy_car_info lci
  LEFT JOIN com.comm_code cc1 ON cc1.code_name = lci.MAKR AND cc1.group_code='MEMBER_CAR_COMP' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 ON cc2.code_name = lci.CAR_MODEL AND cc2.group_code='MEMBER_CAR_CD' AND cc2.lang=#{lang}  AND cc2.country  = #{country}
    LEFT JOIN com.comm_code cc3 ON cc3.code_name = lci.AUTO_YN AND cc3.group_code='MEMBER_CAR_GEAR' AND cc3.lang=#{lang}  AND cc3.country  = #{country}
    LEFT JOIN com.comm_code cc4 ON cc4.code_name = lci.USE_PRPS AND cc4.group_code='CAR_USAGE_TYPE' AND cc4.lang=#{lang}  AND cc4.country  = #{country}
    LEFT JOIN com.comm_code cc5 ON cc5.code_name = lci.USE_YN AND cc5.group_code='YES_NO_FLAG' AND cc5.lang=#{lang}  AND cc5.country  = #{country}
  WHERE ${strSVCType}
    AND ${strWhere}
    <!-- AND lci.flag = 1 -->
  AND lci.RID_MBR = #{rid}
    ORDER BY ${strOrderby}
    ${strEndPaging}

    </select>

    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 차량이력 상세
    -   설명                  : 회원 차량이력 상세
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : swlim
    -   작성일                : 2017.10.23
    ***************************************/ -->
    <select id="selectMbrCarHistInfo" parameterType="mbrCarHistRequest" resultType="mbrCarHistListResponse">
     /* LOYMbr.selectMbrCarHistInfo */
     SELECT
    lci.REG_DT AS regDt /*등록 일자 */
    , lci.makr AS makr /* 제조사 */
    , cc1.MARK_NAME as makrCode
    , lci.CAR_MODEL AS carModel /* 차량모델 */
    , cc2.MARK_NAME as carModelCode
    , lci.CAR_NM AS carNm /* 차량명 */
    , lci.CAR_NO AS carNo /* 차량번호 */
    , lci.DSPMT AS dspmt /* 배기량 */
    , lci.AUTO_YN AS autoYn /* 차량기어 */
    , cc3.MARK_NAME as autoYnCode
    , lci.USE_YN AS useYn /* 주요사용여부 */
    , cc5.MARK_NAME AS useYnCode /* 주요사용여부 */
    , lci.PU_DD AS puDd /* 구입일자 */
    , lci.INSUR_DD AS insurDd /* 보험일자 */
    , lci.icom AS icom /* 보험사 */
    , lci.MKNG_YY AS mkngYy /* 연식 */
    , lci.USE_PRPS AS usePrps /* 사용용도 */
    , cc4.MARK_NAME as usePrpsCode
    , lci.rid as rid
  FROM loy.loy_car_info lci
  LEFT JOIN com.comm_code cc1 ON cc1.code_name = lci.MAKR AND cc1.group_code='MEMBER_CAR_COMP' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 ON cc2.code_name = lci.CAR_MODEL AND cc2.group_code='MEMBER_CAR_CD' AND cc2.lang=#{lang}  AND cc2.country  = #{country}
    LEFT JOIN com.comm_code cc3 ON cc3.code_name = lci.AUTO_YN AND cc3.group_code='MEMBER_CAR_GEAR' AND cc3.lang=#{lang}  AND cc3.country  = #{country}
    LEFT JOIN com.comm_code cc4 ON cc4.code_name = lci.USE_PRPS AND cc4.group_code='CAR_USAGE_TYPE' AND cc4.lang=#{lang}  AND cc4.country  = #{country}
    LEFT JOIN com.comm_code cc5 ON cc5.code_name = lci.USE_YN AND cc5.group_code='YES_NO_FLAG' AND cc5.lang=#{lang}  AND cc5.country  = #{country}
  WHERE lci.rid=#{rid}

    </select>


    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 세그먼트이력 조회
    -   설명                  : 회원 세그먼트이력 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : swlim
    -   작성일                : 2017.10.23
    ***************************************/ -->
    <select id="selectMbrSegHistList" parameterType="mbrRequest" resultType="mbrSegHistListResponse">
    /* LOYMbr.selectMbrSegHistList */
      SELECT
      lsh.APLY_DD AS aplyDd
      , lsh.CAM_GROUP AS camGroupCode
      , cc1.MARK_NAME AS camGroup
      , lsh.CUST_VALUE AS custValueCode
      , cc2.MARK_NAME AS custValue
      , lsh.GROTH_TYPE AS grothTypeCode
      , cc3.MARK_NAME AS grothType
      , lsh.LIFE_CYCL AS lifeCyclCode
      , cc4.MARK_NAME AS lifeCycl
      <!-- , ${strColumn} -->
    FROM loy.loy_seg_hst lsh
    INNER JOIN loy.loy_mbr lm ON lsh.RID_MBR = lm.RID
    INNER JOIN loy.loy_cust lc ON lm.RID_CUST = lc.RID
    LEFT JOIN com.comm_code cc1 ON lsh.CAM_GROUP = cc1.CODE_NAME AND cc1.GROUP_CODE = 'CAMP_CON_TYPE' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 ON lsh.CUST_VALUE = cc2.CODE_NAME AND cc2.GROUP_CODE = 'MEMBER_VALUE' AND cc2.lang=#{lang}  AND cc2.country  = #{country}
    LEFT JOIN com.comm_code cc3 ON lsh.GROTH_TYPE = cc3.CODE_NAME AND cc3.GROUP_CODE = 'MEM_GROW_TYPE' AND cc3.lang=#{lang}  AND cc3.country  = #{country}
    LEFT JOIN com.comm_code cc4 ON lsh.LIFE_CYCL = cc4.CODE_NAME AND cc4.GROUP_CODE = 'MEMBER_LIFE_CYCLE' AND cc4.lang=#{lang}  AND cc4.country  = #{country}
    WHERE ${strSVCType}
      AND ${strWhere}
      <!-- AND lsh.flag = 1 -->
    AND lm.RID = #{rid}
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>



    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 등급이력 조회
    -   설명                  : 회원 등급이력 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : swlim
    -   작성일                : 2017.10.23
    ***************************************/ -->
    <select id="selectEMbrTierHistList" parameterType="mbrRequest" resultType="mbrTierHistResponse">
    /* LOYMbr.selectEMbrTierHistList */
      select
      lth.VALID_START_DT AS validStartDt
      , lth.BEF_MEM_DIV AS befMemDivCode
      , cc1.MARK_NAME AS befMemDiv
      , lth.CUR_MEM_DIV AS curMemDivCode
      , cc2.MARK_NAME AS curMemDiv
      , lth.RID_BEF_TIER AS ridBefTierCode
      , cc3.MARK_NAME AS ridBefTier
      , lth.RID_CUR_TIER AS ridCurTierCode
      , cc4.MARK_NAME AS ridCurTier
      , lth.CUR_TIER_APPLY_BAS_CNT AS curTierApplyCnt
      , lth.CUR_TIER_APPLY_BAS_AMT AS curTierApplyAmt
      <!-- , ${strColumn} -->
    FROM loy.loy_tier_hist lth
    LEFT JOIN com.comm_code cc1 ON lth.BEF_MEM_DIV = cc1.CODE_NAME AND cc1.GROUP_CODE = 'MEMBER_TYPE' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 ON lth.CUR_MEM_DIV = cc2.CODE_NAME AND cc2.GROUP_CODE = 'MEMBER_TYPE' AND cc2.lang=#{lang}  AND cc2.country  = #{country}
    LEFT JOIN com.comm_code cc3 ON lth.RID_BEF_TIER = cc3.CODE_NAME AND cc3.GROUP_CODE = 'MEMBER_GRADE' AND cc3.lang=#{lang}  AND cc3.country  = #{country}
    LEFT JOIN com.comm_code cc4 ON lth.RID_CUR_TIER = cc4.CODE_NAME AND cc4.GROUP_CODE = 'MEMBER_GRADE' AND cc4.lang=#{lang}  AND cc4.country  = #{country}
    WHERE ${strSVCType}
      AND ${strWhere}
      <!-- AND lth.flag = 1 -->
    AND lth.RID_MBR = #{rid}
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>



    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 정보 변경 이력
    -   설명                  : 회원 정보 변경 이력
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 임소원
    -   작성일                : 2017.10.25
    ***************************************/ -->
    <select id="selectMbrChangeHistList" parameterType="mbrChangeHistListRequest" resultType="mbrChangeHistListResponse">
    /* LOYMbr.selectMbrChangeHistList */
      select
         a.rid
        ,a.create_date             as createDate
        ,A.CREATE_BY             as createBy
        <!-- ,(select if(nvl(b.MARK_NAME, '')='', a.chg_col, b.MARK_NAME) ) as chgCol -->
        , (select decode(nvl(b.MARK_NAME, ''),'', a.chg_col, b.MARK_NAME) from dual ) as chgCol
        , ( CASE WHEN (	SELECT ATTRIB03
                    	FROM mkt.mkt_srch_col_list
                    	WHERE country = #{country}
                    	  AND LOWER(tbl_eng_nm) IN ('loy_mbr', 'loy_cust')
                    	  AND UPPER(col_eng_nm) = UPPER(a.chg_col)
                    	  AND rownum = 1) = 'CARD_PWD'
                 THEN (SELECT '****' from dual)

        		 WHEN (	SELECT ATTRIB03
            			FROM mkt.mkt_srch_col_list
            			WHERE country = #{country}
                    	  AND LOWER(tbl_eng_nm) IN ('loy_mbr', 'loy_cust')
                    	  AND UPPER(col_eng_nm) = UPPER(a.chg_col) AND rownum = 1) IS NOT NULL
				 THEN secu.fn_getDecrypt( #{cipherKey}, a.bchng_data, (SELECT ATTRIB03 FROM mkt.mkt_srch_col_list WHERE country = #{country} AND LOWER(tbl_eng_nm) IN ('loy_mbr' , 'loy_cust') AND UPPER(col_eng_nm) = UPPER(a.chg_col) AND rownum = 1))

            	 WHEN (	SELECT ATTRIB02
            			FROM mkt.mkt_srch_col_list
            			WHERE country = #{country}
                    	  AND LOWER(tbl_eng_nm) IN ('loy_mbr', 'loy_cust')
                    	  AND UPPER(col_eng_nm) = UPPER(a.chg_col) AND rownum = 1) IS NOT NULL
                 THEN (	SELECT MARK_NAME
                 		FROM com.comm_code
                 		WHERE country = #{country}
                 		  AND LANG = #{lang}
                 		  AND CODE_NAME = a.bchng_data
                 		  AND GROUP_CODE = (
                 		  	SELECT ATTRIB02
						 	FROM mkt.mkt_srch_col_list
						 	WHERE country = #{country}
						 	  AND LOWER(tbl_eng_nm) IN ('loy_mbr', 'loy_cust')
						 	  AND UPPER(col_eng_nm) = UPPER(a.chg_col)
						 	  AND rownum = 1
						  )
				 )
				 WHEN A.CHG_COL = 'ADDR1_DTL'
				 THEN secu.fn_getDecrypt(#{cipherKey},A.BCHNG_DATA)

        		 ELSE a.bchng_data END
      	  ) AS bchngData
		, ( CASE WHEN (	SELECT ATTRIB03
						FROM mkt.mkt_srch_col_list
						WHERE country = #{country}
                          AND LOWER(tbl_eng_nm) IN ('loy_mbr', 'loy_cust')
                          AND UPPER(col_eng_nm) = UPPER(a.chg_col)
                          AND rownum = 1) = 'CARD_PWD'
            	 THEN (SELECT '****' from dual)

        		 WHEN (	SELECT ATTRIB03
            			FROM mkt.mkt_srch_col_list
                        WHERE country = #{country}
                          AND LOWER(tbl_eng_nm) IN ('loy_mbr', 'loy_cust')
                          AND UPPER(col_eng_nm) = UPPER(a.chg_col)
                          AND rownum = 1) IS NOT NULL
            	 THEN secu.fn_getDecrypt(#{cipherKey}, a.achng_data, (	SELECT ATTRIB03
            	 														FROM mkt.mkt_srch_col_list
            	 														WHERE country = #{country}
            	 														  AND LOWER(tbl_eng_nm) IN ('loy_mbr', 'loy_cust')
            	 														  AND UPPER(col_eng_nm) = UPPER(a.chg_col)
            	 														  AND rownum = 1))

           		 WHEN (	SELECT ATTRIB02
           		 		FROM mkt.mkt_srch_col_list
            			WHERE country = #{country}
                    	  AND LOWER(tbl_eng_nm) IN ('loy_mbr', 'loy_cust')
                    	  AND UPPER(col_eng_nm) = UPPER(a.chg_col)
                    	  AND rownum = 1) IS NOT NULL
             	 THEN (	SELECT MARK_NAME
             	 		FROM com.comm_code
             	 		where country = #{country}
             	 		  AND LANG = #{lang}
             	 		  AND CODE_NAME = a.achng_data
             	 		  and GROUP_CODE = (	SELECT ATTRIB02
             	 		  						FROM mkt.mkt_srch_col_list
             	 		  						WHERE country = #{country}
             	 		  						  AND LOWER(tbl_eng_nm) IN ('loy_mbr', 'loy_cust')
             	 		  						  AND UPPER(col_eng_nm) = UPPER(a.chg_col)
             	 		  						  AND rownum = 1)
				 )
				 WHEN A.CHG_COL = 'ADDR1_DTL'
				 THEN secu.fn_getDecrypt(#{cipherKey},A.ACHNG_DATA)

			  	 ELSE a.achng_data END
		  ) AS achngData
        , cc.mark_name   	as chgPstn
        , rmark         as rmark
        , ${strColumn}
    FROM loy.loy_mbr_chg_hist 	a
    LEFT JOIN com.crm_user 		cu ON cu.rid = a.CREATE_BY
    LEFT JOIN com.employee 		e  ON cu.ID_EMPLOYEE = e.id
    LEFT JOIN com.comm_code 	b  ON a.chg_col = b.CODE_NAME AND b.GROUP_CODE = 'HISTORY_MEMBER_COLUMN' AND b.lang = #{lang} AND b.country = #{country}
    LEFT JOIN com.comm_code 	cc  ON a.chg_pstn = cc.CODE_NAME AND cc.GROUP_CODE = 'HISTORY_CHG_PSTN' AND cc.lang = #{lang} AND cc.country = #{country}
    WHERE ${strSVCType}
      AND ${strWhere}
      <!-- AND a.flag = 1 -->
      AND a.rid_mbr = #{mbrRid}
	ORDER BY ${strOrderby}
    ${strEndPaging}
  </select>

  <select id="selectMbrPointLimitInfo" parameterType="mbrRequest" resultType="mbrPointLimitResponse">
    CALL loy.getMbrPointLimit(#{mbrNo});
  </select>

  <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 포인트 한도 변경 이력
    -   설명                  : 포인트 한도 변경 이력
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : swlim
    -   작성일                : 2017.10.25
    ***************************************/ -->
  <select id="selectMbrPointLimiList" parameterType="mbrRequest" resultType="mbrPointLimitListResponse">
    SELECT
      lmch.CREATE_DATE AS createDate
      , lmch.CREATE_BY AS createById
      , em1.NAME AS createBy
      , lmch.BCHNG_DATA AS bchngData
      , lmch.ACHNG_DATA AS achngData
      , lmch.CHG_PSTN AS chgPstn
      , lmch.RMARK AS rmark
      <!-- , ${strColumn} -->
    FROM loy.loy_mbr_chg_hist lmch
    LEFT JOIN com.crm_user cu1 ON cu1.rid = lmch.CREATE_BY
    INNER JOIN com.employee em1 ON cu1.id_employee = em1.id
    WHERE ${strSVCType}
      AND ${strWhere}
      <!-- AND lmch.flag = 1 -->
    AND lmch.RID_MBR = #{rid}
    AND (lmch.CHG_COL = 'LIMIT_AMT' OR  lmch.CHG_COL = 'E1 Mem Personal PntLimit Amt' )
      ORDER BY ${strOrderby}
      ${strEndPaging}
    ;
  </select>

  <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 부정 이력
    -   설명                  : 회원 부정 이력
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : swlim
    -   작성일                : 2017.10.25
    ***************************************/ -->
  <select id="selectMbrBlackList" parameterType="mbrRequest" resultType="mbrBlackListResponse">
    SELECT
      lbh.REG_STAT_CD AS regStatCd
      , cc1.MARK_NAME AS regStat
      , lbh.ACTN_DIV AS actnDiv
      , cc2.MARK_NAME AS actnDivName
      , lbh.REG_DTL_RSN_MEMO AS regDtlRsnMemo
      , lbh.CREATE_DATE AS createDate
      , lbh.CREATE_BY AS createById
      , em1.NAME AS createBy
      , lbh.RID_CHNL AS ridChnl
      , lbh.CARD_NO AS cardNo
      , lbh.TOT_ACU_POINT AS totAcuPoint
      , lbh.TGT_MONTH AS tgtMonth
      , lbh.MAX_CHARGE_EXCS_POINT AS maxChargeExcsPoint
      , lbh.BLLST_ADMR_ID AS bllstAdmrId
      , em2.NAME AS bllstAdmr
      , lbh.APPLY_START_DATE AS applyStartDate
      , lbh.RID AS rid
      , lm.RID AS ridMbr
      <!-- , ${strColumn} -->
    FROM loy.loy_black_hist lbh
    LEFT JOIN loy.loy_mbr lm ON lbh.RID_CUST = lm.RID_CUST
    LEFT JOIN com.comm_code cc1 ON cc1.CODE_NAME = lbh.REG_STAT_CD AND cc1.GROUP_CODE='MEMBER_CLAIM_CD' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 ON cc2.CODE_NAME = lbh.ACTN_DIV AND cc2.GROUP_CODE='CLAIM_MANAGE_TYPE' AND cc2.lang=#{lang}  AND cc2.country  = #{country}
    LEFT JOIN com.crm_user cu1 ON cu1.rid = lbh.CREATE_BY
    LEFT JOIN com.employee em1 ON cu1.id_employee = em1.id
    LEFT JOIN com.crm_user cu2 ON cu2.rid = lbh.BLLST_ADMR_ID
    LEFT JOIN com.employee em2 ON cu2.id_employee = em2.id
    WHERE ${strSVCType}
      AND ${strWhere}
      <!-- AND lbh.flag = 1 -->
    AND lm.RID = #{rid}
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>

  <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 부정 이력 상세조회
    -   설명                  : 회원 부정 이력 상세조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : swlim
    -   작성일                : 2017.10.25
    ***************************************/ -->
  <select id="selectMbrBlackInfo" parameterType="mbrBlackListRequest" resultType="mbrBlackListResponse">
    SELECT
      lbh.REG_STAT_CD AS regStatCd
      , cc1.MARK_NAME AS regStat
      , lbh.ACTN_DIV AS actnDiv
      , cc2.MARK_NAME AS actnDivName
      , lbh.REG_DTL_RSN_MEMO AS regDtlRsnMemo
      , lbh.CREATE_DATE AS createDate
      , lbh.CREATE_BY AS createById
      , em1.NAME AS createBy
      , lbh.RID_CHNL AS ridChnl
      , lbh.CARD_NO AS cardNo
      , lbh.TOT_ACU_POINT AS totAcuPoint
      , lbh.TGT_MONTH AS tgtMonth
      , lbh.MAX_CHARGE_EXCS_POINT AS maxChargeExcsPoint
      , lbh.BLLST_ADMR_ID AS bllstAdmrId
      , em2.NAME AS bllstAdmr
      , lbh.APPLY_START_DATE AS applyStartDate
      , lbh.RID AS rid
    FROM loy.loy_black_hist lbh
    LEFT JOIN com.comm_code cc1 ON cc1.CODE_NAME = lbh.REG_STAT_CD AND cc1.GROUP_CODE='MEMBER_CLAIM_CD' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 ON cc2.CODE_NAME = lbh.ACTN_DIV AND cc2.GROUP_CODE='CLAIM_MANAGE_TYPE' AND cc2.lang=#{lang}  AND cc2.country  = #{country}
    LEFT JOIN com.crm_user cu1 ON cu1.rid = lbh.CREATE_BY
    LEFT JOIN com.employee em1 ON cu1.id_employee = em1.id
    LEFT JOIN com.crm_user cu2 ON cu2.rid = lbh.BLLST_ADMR_ID
    LEFT JOIN com.employee em2 ON cu2.id_employee = em2.id
    WHERE lbh.rid = #{rid}
  </select>

  <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 동호회 이력
    -   설명                  : 회원 동호회  이력
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : swlim
    -   작성일                : 2017.10.25
    ***************************************/ -->
  <select id="selectMbrClubList" parameterType="mbrRequest" resultType="mbrClupListResponse">
    SELECT
      lc.CHNL_NM as chnlNm,
      lcm.REG_DT as regDt,
      lcm.DEL_DT as delDt,
      lcm.ACTIVE_FLG as activeFlg
      <!-- , ${strColumn} -->
    FROM loy.loy_chnl_mbr  lcm
    INNER JOIN loy.loy_mbr  lm ON lcm.RID_MBR = lm.RID
    INNER JOIN loy.loy_channel  lc ON lcm.RID_CHNL = lc.RID
    WHERE ${strSVCType}
      AND ${strWhere}
      <!-- AND lcm.flag = 1 -->
    AND lcm.RID_MBR = #{rid}
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>





    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 정보 변경 이력
    -   설명                  : 회원 정보 변경 이력
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이성원
    -   작성일                : 2017.10.25
    ***************************************/ -->
    <select id="selectMbrGroupCardList" parameterType="mbrGroupCardListRequest" resultType="mbrGroupCardListResponse">
    /* LOYMbr.selectMbrGroupCardList */
      select
         a.rid
        <!-- ,secu.fn_getDecrypt(#{cipherKey} ,a.card_no, 'CARD_NUM')  as cardNo -->
        ,''             as cardPwd
        ,b.card_knd_nm             as cardKndNm
        ,c.mark_name             as stat
        ,a.create_date             as createDate
        ,a.lose_dt             as loseDt
        <!-- , ${strColumn} -->
    FROM loy.loy_mbr_card a
    LEFT OUTER JOIN loy.loy_card_kind b on a.rid_card_kind = b.rid
    LEFT JOIN com.comm_code c ON a.stat = c.CODE_NAME AND c.GROUP_CODE = 'MEMBER_CARD_STATUS' AND c.lang=#{lang}  AND c.country  = #{country}
    WHERE ${strSVCType}
      AND ${strWhere}
      <!-- AND a.flag = 1 -->
    AND a.rid_mbr = #{mbrRid}
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>







  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 블랙 리스트 추가
      -   설명                  : 회원 블랙 리스트 추가
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
    <insert id="insertMbrBlackHist" parameterType="mbrBlackListRequest">
        INSERT INTO loy.loy_black_hist
      (RID,
      CREATE_BY,
      MODIFY_BY,
      CREATE_DATE,
      MODIFY_DATE,
      FLAG,
      COUNTRY,
      CURRENCY,
      APP_SERVICE_TYPE,
      ACCNT_ID,
      RID_CUST,
      REG_STAT_CD,
      REG_DTL_RSN_MEMO,
      RELEA_RSN_MEMO,
      CANDI_EXTR_DATE,
      <if test="bllstAdmrId != null and bllstAdmrId != ''">
      APPLY_START_DATE,
      </if>
      APPLY_END_DATE,
      REGR_ID,
      CARD_NO,
      <if test="maxChargeExcsPoint != null and maxChargeExcsPoint != ''">
      MAX_CHARGE_EXCS_POINT,
      </if>
      TGT_MONTH,
      <if test="totAcuPoint != null and totAcuPoint != ''">
      TOT_ACU_POINT,
      </if>
      RID_CHNL,
      ACTN_DIV,
      BLLST_ADMR_ID,
      DESC1)
    VALUES
    ( com.getNewID('A'),
      #{createBy},
      #{modifyBy},
      sysdate,
      sysdate,
      1,
      #{country},
      'KRW',
      #{appServiceId},
      #{accountId},
      #{ridCust},
      #{regStatCd},
      #{regDtlRsnMemo},
      #{releaRsnMemo},
      #{candiExtrDate},
      <if test="bllstAdmrId != null and bllstAdmrId != ''">
      sysdate,
      </if>
      #{applyEndDate},
      #{regrId},
      #{cardNo},
      <if test="maxChargeExcsPoint != null and maxChargeExcsPoint != ''">
      #{maxChargeExcsPoint},
      </if>
      #{tgtMonth},
      <if test="totAcuPoint != null and totAcuPoint != ''">
      #{totAcuPoint},
      </if>
      #{ridChnl},
      #{actnDiv},
      #{bllstAdmrId},
      #{desc1})

        <selectKey keyProperty="" resultType="java.lang.String">
           SELECT rid FROM loy.loy_black_hist WHERE RID_CUST = #{ridCust} limit 1
        </selectKey>

    </insert>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 상태 변경
      -   설명                  : 회원 상태 변경
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
  <update id="updateMbrStat" parameterType="mbrBlackListRequest">
    UPDATE loy.loy_mbr
            SET MBR_STAT_CD =  #{mbrStatCd}
                ,modify_by =  #{modifyBy}
                ,modify_date = sysdate
                ,fraud_mem_div = #{regStatCd}
                <!-- <if test="regStatCd == &quot;C20&quot;">
                  ,actn_div = #{actnDiv}
                </if>

                  ,actn_div = null
 -->
          WHERE 1=1
            AND rid = #{ridMbr}
  </update>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 블랙 리스트 이력 추가
      -   설명                  : 회원 블랙 리스트 이력 추가
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
  <update id="updateMbrBlackHist" parameterType="mbrBlackListRequest">
    UPDATE loy.loy_black_hist
            SET
              REG_STAT_CD = #{regStatCd}
        , REG_DTL_RSN_MEMO = #{regDtlRsnMemo}
        , RELEA_RSN_MEMO = #{releaRsnMemo}
        , CANDI_EXTR_DATE = #{candiExtrDate}
        <if test="bllstAdmrId != null and bllstAdmrId != ''">
        , APPLY_START_DATE = sysdate
        </if>
        , APPLY_END_DATE = #{applyEndDate}
        , REGR_ID = #{regrId}
        , CARD_NO = #{cardNo}
        <if test="maxChargeExcsPoint != null and maxChargeExcsPoint != ''">
        , MAX_CHARGE_EXCS_POINT = #{maxChargeExcsPoint}
        </if>
        , TGT_MONTH = #{tgtMonth}
        <if test="totAcuPoint != null and totAcuPoint != ''">
        , TOT_ACU_POINT = #{totAcuPoint}
        </if>
        , RID_CHNL = #{ridChnl}
        , ACTN_DIV = #{actnDiv}
        , BLLST_ADMR_ID = #{bllstAdmrId}
                , modify_by =  #{modifyBy}
                , modify_date = sysdate
          WHERE 1=1
            AND rid = #{rid}

  </update>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 포인트 한도 수정
      -   설명                  : 회원 포인트 한도 수정
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
  <update id="updateMbrPointLimit" parameterType="mbrPointLimitRequest">
    UPDATE loy.loy_mbr
    SET LIMIT_AMT = #{achngData}
      , LIMIT_YN = 'Y'
      , APV_SRVR_TRM_DT = sysdate
      , APV_SRVR_TRM_YN = 'Y'
    WHERE 1=1
    AND rid = #{ridMbr}
  </update>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 변경이력 추가
      -   설명                  : 회원 변경이력 추가
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
  <insert id="insertMbrChgHist" parameterType="mbrChgHistRequest">
    INSERT into loy.loy_mbr_chg_hist
      (RID,
      CREATE_BY,
      MODIFY_BY,
      CREATE_DATE,
      MODIFY_DATE,
      FLAG,
      COUNTRY,
      CURRENCY,
      APP_SERVICE_TYPE,
      ACCNT_ID,
      RID_MBR,
      CHG_PSTN,
      MEM_NO,
      RMARK,
      CHG_TBL,
      CHG_COL,
      BCHNG_DATA,
      ACHNG_DATA)
    VALUES
    (com.getNewID('A'),
      #{createBy},
      #{modifyBy},
      sysdate,
      sysdate,
      1,
      #{country},
      'KRW',
      #{appServiceId},
      #{accountId},
      #{ridMbr},
      #{chgPstn},
      #{mbrNo},
      NULL,
      NULL,
      #{chgCol},
      #{bchngData},
      #{achngData}
		<!--
      (SELECT IF((select ATTRIB03 from mkt.mkt_srch_col_list where country = #{country} AND tbl_eng_nm in ('loy_mbr', 'loy_cust') and col_eng_nm = #{chgCol}) IS NULL,
      #{bchngData},
      secu.fn_getEncrypt(#{cipherKey}, #{bchngData}))),

      (SELECT IF((select ATTRIB03 from mkt.mkt_srch_col_list where country = #{country} AND tbl_eng_nm in ('loy_mbr', 'loy_cust') and col_eng_nm = #{chgCol}) IS NULL,
      #{achngData},
      secu.fn_getEncrypt(#{cipherKey}, #{achngData})))
		 -->
    )
  </insert>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 택시이력 리스트
      -   설명                  : 회원 택시이력 리스트
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
  <select id="selectMbrTaxiHistList" parameterType="mbrRequest" resultType="mbrTaxiHistListResponse">
    /* LOYMbr.selectMbrTaxiHistList */
      SELECT
          tch.CONV_SBST AS convSbst
          , tch.CONV_DT AS convDt
          , tch.create_by AS createById
      , em1.NAME AS createBy
      <!-- , ${strColumn} -->
    FROM loy.loy_taxi_conv_hst tch
    LEFT JOIN com.crm_user cu1 ON cu1.rid = tch.CREATE_BY
        LEFT JOIN com.employee em1 ON cu1.id_employee = em1.id
    WHERE ${strSVCType}
      AND ${strWhere}
      AND tch.rid_mbr = #{rid}
      <!-- AND tch.flag = 1 -->
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 택시 포인트 이력추가
      -   설명                  : 회원 택시 포인트 이혁추가
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
  <select id="selectMbrTaxiPntHistList" parameterType="mbrRequest" resultType="mbrTaxiPntHistListResponse">
    /* LOYMbr.selectMbrTaxiPntHistList */
      select
        tcp.CONF_NCST AS confNcst
        , tcp.TAXI_CONV_POINT AS taxiConvPoint
      , tcp.STN_PARTAKE_POINT AS stnPartakePoint
      , tcp.APD_POINT AS apdPoint
      , tcp.PRVD_FORML AS prvdFormlCode
      , cc1.MARK_NAME AS prvdForml
      , tcp.REAL_CHARG_AMT AS realChargAmt
      , tcp.PRVD_CALCU_AMT AS prvdCalcuAmt
      , tcp.CHARG_AMT AS chargAmt
      , tcp.CHARG_TMSCNT AS chargTmscnt
      , tcp.APV_DAY AS apvDay
      , tcp.APV_NO AS apvNo
      , tcp.TRM_STATUS AS trmStatusCode
      , cc2.MARK_NAME AS trmStatus
      , tcp.TRM_RQT_DAY AS trmRqtDay
      , tcp.TRM_RQT_TIME AS trmRqtTime
      , tcp.TRM_NO AS trmNo
      , tcp.APD_POINT_TRM_STATUS AS apdPointTrmStatusCode
      , cc3.MARK_NAME AS apdPointTrmStatus
      , tcp.APD_POINT_APV_DAY AS apdPointApvDay
      , tcp.APD_POINT_APV_NO AS apdPointApvNo
      , tcp.RID AS rid
      <!-- , ${strColumn} -->
    FROM loy.loy_taxi_conv_point tcp
    LEFT JOIN com.comm_code cc1 ON cc1.CODE_NAME = tcp.PRVD_FORML AND cc1.GROUP_CODE = 'TAXI_POINT_PAY_CD' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 ON cc2.CODE_NAME = tcp.TRM_STATUS AND cc2.GROUP_CODE = 'TAXI_POINT_SEND_CD' AND cc2.lang=#{lang}  AND cc2.country  = #{country}
    LEFT JOIN com.comm_code cc3 ON cc3.CODE_NAME = tcp.APD_POINT_TRM_STATUS AND cc3.GROUP_CODE = 'TAXI_POINT_SEND_CD' AND cc3.lang=#{lang}  AND cc3.country  = #{country}
    WHERE ${strSVCType}
      AND ${strWhere}
      AND tcp.rid_mbr = #{rid}
      <!-- AND tcp.flag = 1 -->
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 택시 포인트 상세
      -   설명                  : 회원 택시 포인트 상세
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
  <select id="selectMbrTaxiPntDetailList" parameterType="mbrRequest" resultType="mbrTaxiPntDetailResponse">
    /* LOYMbr.selectMbrTaxiPntDetailList */
      SELECT
        tdp.CALCU_MONTH_GROUP AS calcuMonthGroup
      , tdp.CALCU_DT_GROUP AS calcuDtGroup
      , lc.CHNL_NO AS chnlNo
      , lc.MBRBS_CDADD AS mbrbsCdadd
      , tdp.TAXI_CONV_POINT AS taxiConvPoint
      , tdp.STN_PARTAKE_POINT AS stnPartakePoint
      , tdp.APD_POINT AS apdPoint
      , tdp.REAL_CHARG_AMT AS realChargAmt
      , tdp.CHARG_AMT AS chargAmt
      , tdp.TOTAL_CALCU_AMT AS totalCalcuAmt
      , tdp.PRVD_CALCU_AMT AS prvdCalcuAmt
      , tdp.STBL_CALCU_AMT AS stblCalcuAmt
      , lpt.PNT_TXN_TYPE_2_CD AS pntTxnType2Cd
      , lpt.APPR_DT AS apprDt
      , lpt.APPR_NO AS apprNo
      , lpt.PNT_AMT AS pntAmt
      <!-- , ${strColumn} -->
    FROM loy.loy_taxi_conv_dtl_point tdp
    <!--  INNER JOIN loy.loy_taxi_conv_point tcp on tcp.RID = tdp.RID_TAXI_CONV -->
    INNER JOIN loy.loy_channel lc on tdp.RID_CHNL = lc.RID
    LEFT OUTER JOIN loy.loy_pnt_txn lpt on tdp.RID_TXN = lpt.RID
    WHERE ${strSVCType}
      AND ${strWhere}
      AND tdp.rid_mbr = #{rid}
      <!-- AND tdp.flag = 1 -->
      AND tdp.RID_TAXI_CONV = #{ridConfNcst}
      ORDER BY ${strOrderby}
      ${strEndPaging}

  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 가입정보
      -   설명                  : 회원 가입정보
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
  <select id="selectMbrSignInfo" parameterType="mbrRequest" resultType="mbrSignInfoResponse">
    SELECT lc.EMP_NO AS empNo
      , lc.SBSC_TMSCNT AS sbscTmscnt
      , lc.FIRST_SBSC_DT AS firstSbscDt
      , lc.FIRST_CARD_REG_DT AS firstCardRegDt
      , lc.SBSC_POINT_PRVD_YN AS sbscPointPrvdYn
      , lc.SBSC_POINT_PRVD_DT AS sbscPointPrvdDt
      , lc.DNAT_POINT_PRVD_YN AS dnatPointPrvdYn
      , lc.DNAT_POINT_PRVD_DT AS dnatPointPrvdDt
      , lc.FRAUD_CUST_REG_DT AS fraudCustRegDt
    FROM loy.loy_cust lc
    INNER JOIN loy.loy_mbr lm ON lc.rid = lm.RID_CUST
    WHERE lm.rid=#{rid};
  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 채널 이력
      -   설명                  : 회원 채널 이력
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
   <select id="selectMbrChnlHistListCnt" parameterType="mbrRequest" resultType="java.lang.Integer">
      SELECT count(*)
      FROM (
        <!--
        SELECT cam_rspns_id as rid
        FROM mkt.mkt_send_rspns_info
        WHERE 1=1
        AND rid_mbr =#{rid}
        AND cam_rspns_id in ( 'PUSH10','COUPON10' ,'EMAIL10','SMS10','KAKAO10')

        UNION ALL
      -->
        SELECT
            vah.rid
        FROM voc.voc_atvy_hist vah
        INNER JOIN loy.loy_mbr lm ON vah.RID_CUST = lm.RID_CUST
        WHERE lm.rid=#{rid}

      UNION ALL

      SELECT
        a.ID  as rid
      from mkt.HIST_CAM_I a
      inner join loy.loy_mbr b on a.mbr_no = b.mbr_no
      inner join mkt.HIST_CAM_MSG c on a.disp_no = c.disp_no
      where  b.rid = #{rid} AND a.SMS_SEND_DT is not null

      UNION ALL

      SELECT
        a.ID  as rid
      from mkt.HIST_CAM_I_RESP a
      inner join loy.loy_mbr b on a.mbr_no = b.mbr_no
      where  b.rid = #{rid} AND a.CRE_DT is not null
      <!--
        UNION ALL

        SELECT
            a.ID  as rid
      from mkt.HIST_CAM_I a
      inner join loy.loy_mbr b on a.mbr_no = b.mbr_no
      where  b.rid = #{rid}
      AND TYPE_CD = '채널전송'
      -->
      UNION ALL

            SELECT
          mksl.ID  as rid
      FROM  mkt.mkt_kakao_send_log  mksl
      INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mksl.RECV_MEM_ID
      WHERE lm.RID = #{rid}

      UNION ALL

      SELECT
          mmsl.ID  as rid
      FROM mkt.mkt_msg_send_log  mmsl
      INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mmsl.RECV_MEM_ID
      WHERE lm.RID = #{rid}

      UNION ALL

      SELECT
          mpsl.ID  as rid
      FROM mkt.mkt_push_send_log  mpsl
      INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mpsl.RECV_MEM_ID
      WHERE lm.RID = #{rid}

      UNION ALL

      SELECT
          bcsl.rid  as rid
      FROM ifl.bat_channel_send_log  bcsl
      INNER JOIN loy.loy_mbr  lm on lm.RID = bcsl.rid_mbr
      where lm.rid = #{rid}

      UNION ALL

      SELECT
          mesl.ID  as rid
      FROM mkt.mkt_email_send_log  mesl
      INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mesl.RECV_MEM_ID
      WHERE lm.RID = #{rid}
      ) a


   </select>
  <select id="selectMbrChnlHistList" parameterType="mbrRequest" resultType="mbrChnlHistListResponse">
  /*selectMbrChnlHistList*/
  SELECT
    rid       AS rid,
    chnlTypeCd    AS chnlTypeCd,
    cc2.mark_name   AS atvyType,
    cc1.mark_name   AS atvySubType,
    acdCallDuration,
    ridMbr,
    reqDate     AS chnlSendDt,
    openDate    AS chnlRpyDt,
    open_yn     AS openYn,
    rspnsDate,
    failDate,
    failDesc    AS chnlRpyRsn,
    Content     AS comments,
        createBy    AS creatorLogin
    FROM (

        SELECT
          vah.rid         AS rid,
      vah.ATVY_TYPE       AS chnlTypeCd,
      vah.ATVY_SUB_TYPE     AS chnlSubType,
      vah.ACD_CALL_DURATION   AS acdCallDuration,
            lm.rid          AS ridMbr,
      vah.CHNL_SEND_DT    AS reqDate,
      vah.CHNL_RPY_DT     AS openDate,
      (CASE WHEN vah.CHNL_RPY_DT is not null then 'Y'
            ELSE '' END)    AS open_yn,
            null          AS rspnsDate,
      vah.CALL_ID       AS callId,
            e.NAME          AS createBy,
            null          AS failDate,
            (CASE WHEN vah.ATVY_TYPE = '40' then vah.COMMENTS_LONG
          WHEN vah.ATVY_TYPE = '20' then vah.MSG_SUBJECT
            ELSE vah.COMMENTS_LONG END) AS Content,
            vah.CHNL_RPY_RSN    AS failDesc
    FROM
      voc.voc_atvy_hist vah
        INNER JOIN
      loy.loy_mbr lm ON vah.RID_CUST = lm.RID_CUST
        LEFT JOIN
      com.crm_user cu ON vah.CREATOR_LOGIN = cu.USER_ID
        LEFT JOIN
      com.employee e ON cu.ID_EMPLOYEE = e.id

    WHERE <!-- ${strSVCType}
    AND  --> ${strWhere}
    AND lm.RID = #{rid}
          UNION ALL
          SELECT
          mksl.ID  as rid,
          mksl.MSG_SEND_TYPE as chnlTypeCd,
          '20' as chnlSubType,
          null AS acdCallDuration,
          lm.rid as ridMbr,
          TO_DATE(mksl.SEND_PLAN_DT, 'YYYYMMDDHH24MISS') as reqDate ,
          null as openDate,
          null    AS open_yn,
          mksl.SEND_SUCES_DT  as rspnsDate,
          null AS callId,
          mksl.CREATE_BY as createBy,
          mksl.SEND_FAIL_DT  as failDate,
          mksl.MSG_SBST as Content,
          mksl.SEND_FAIL_RSN  as failDesc
      FROM  mkt.mkt_kakao_send_log  mksl
      INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mksl.RECV_MEM_ID
      WHERE lm.RID = #{rid}
      UNION ALL
      SELECT
          mmsl.ID  as rid,
          mmsl.MSG_SEND_TYPE as chnlTypeCd,
          '20' as chnlSubType,
          null AS acdCallDuration,
          lm.rid as ridMbr,
          TO_DATE(mmsl.SEND_PLAN_DT, 'YYYYMMDDHH24MISS') as reqDate ,
          null as openDate,
          null    AS open_yn,
          mmsl.SEND_SUCES_DT  as rspnsDate,
          null AS callId,
          mmsl.CREATE_BY as createBy,
          mmsl.SEND_FAIL_DT  as failDate,
          (CASE WHEN mmsl.MSG_SEND_TYPE = 'LMS' then mmsl.MSG_SUBJECT
              WHEN mmsl.MSG_SEND_TYPE = 'SMS' then mmsl.MSG_SBST
                ELSE mmsl.MSG_SUBJECT END) as Content,
          mmsl.SEND_FAIL_RSN  as failDesc
      FROM mkt.mkt_msg_send_log  mmsl
      INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mmsl.RECV_MEM_ID
      WHERE lm.RID = #{rid}
      UNION ALL
      SELECT
          mpsl.ID  as rid,
          '90' as chnlTypeCd,
          '20' as chnlSubType,
          null AS acdCallDuration,
          lm.rid as ridMbr,
          TO_DATE(mpsl.SEND_PLAN_DT, 'YYYYMMDDHH24MISS') as reqDate ,
          null as openDate,
          null    AS open_yn,
          mpsl.SEND_SUCES_DT  as rspnsDate,
          null AS callId,
          mpsl.CREATE_BY as createBy,
          mpsl.SEND_FAIL_DT  as failDate,
          (CASE WHEN mpsl.PUSH_TYPE_CD = 'HTML' then mpsl.MSG_SUBJECT
                WHEN mpsl.PUSH_TYPE_CD = 'Notification' then mpsl.MSG_SBST
                ELSE mpsl.MSG_SUBJECT END) as Content,
          mpsl.SEND_FAIL_RSN  as failDesc
      FROM mkt.mkt_push_send_log  mpsl
      INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mpsl.RECV_MEM_ID
      WHERE lm.RID = #{rid}
      UNION ALL
      SELECT
          mesl.ID  as rid,
          '70' as chnlTypeCd,
          '20' as chnlSubType,
          null AS acdCallDuration,
          lm.rid as ridMbr,
          TO_DATE(mesl.SEND_PLAN_DT, 'YYYYMMDDHH24MISS') as reqDate ,
          mesl.OPEN_SUCES_DT as openDate,
          (CASE WHEN mesl.OPEN_SUCES_DT is not null then 'Y'
            ELSE '' END)    AS open_yn,
          mesl.SEND_SUCES_DT  as rspnsDate,
          null AS callId,
          mesl.CREATE_BY as createBy,
          mesl.SEND_FAIL_DT  as failDate,
          mesl.MSG_SUBJECT as Content,
          mesl.SEND_FAIL_RSN  as failDesc
      FROM mkt.mkt_email_send_log  mesl
      INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mesl.RECV_MEM_ID
      WHERE lm.RID = #{rid}

      UNION ALL

      SELECT
          bcsl.rid  as rid,
          bcsl.chnl_type as chnlTypeCd,
          '20' as chnlSubType,
          null AS acdCallDuration,
          lm.rid as ridMbr,
          bcsl.trans_request_dt as reqDate ,
          null as openDate,
          null    AS open_yn,
          null as rspnsDate,
          null AS callId,
          null as createBy,
          bcsl.trans_result_dt  as failDate,
          (CASE WHEN bcsl.chnl_type = 'S' then  dbms_lob.substr(bcsl.trans_msg,4000,1)
              WHEN bcsl.chnl_type = 'E' then bcsl.trans_subject
                ELSE bcsl.trans_subject END) as Content,
          bcsl.trans_result_msg  as failDesc
      FROM ifl.bat_channel_send_log  bcsl
      INNER JOIN loy.loy_mbr  lm on lm.RID = bcsl.rid_mbr
      where lm.rid = #{rid}

      UNION ALL

      SELECT
        a.ID  as rid
       , (CASE WHEN a.MSG_TYPE = 'S' then 'OCS'
             WHEN a.MSG_TYPE = 'M' then 'OCM'
           WHEN a.MSG_TYPE = 'P' then 'OCP'
            ELSE '' END) chnlTypeCd
       , '20' as chnlSubType
       , null as acdCallDuration
       , b.rid as ridMbr
       , a.SMS_SEND_DT as reqDate
       , null as openDate
       , null as open_yn
       , null as rspnsDate
       , null as callId
       , null as createBy
       , null as failDate
       , (CASE WHEN a.MSG_TYPE = 'S' then c.MSG_VAL
             WHEN a.MSG_TYPE = 'M' then c.X_SUBJECT
           WHEN a.MSG_TYPE = 'P' then c.MSG_VAL
            ELSE '' END) as Content
       , a.RESPONSE_MSG as  failDesc
      from mkt.HIST_CAM_I a
      inner join loy.loy_mbr b on a.mbr_no = b.mbr_no
      inner join mkt.HIST_CAM_MSG c on a.disp_no = c.disp_no
      where  b.rid = #{rid} AND a.SMS_SEND_DT is not null

      UNION ALL

      SELECT
        a.ID  as rid
       , (CASE WHEN a.RESP_TYPE_CD = 'E-Mail' then 'OCE'
             ELSE '' END) AS chnlTypeCd
       , '20' as chnlSubType
       , null as acdCallDuration
       , b.rid as ridMbr
       , a.CRE_DT as reqDate
       , null as openDate
       , a.OFCR_DIR_FLG as open_yn
       , null as rspnsDate
       , null as callId
       , null as createBy
       , null as failDate
       , a.TRT_NAME as Content
       , a.DESC_TEXT as  failDesc
      from mkt.HIST_CAM_I_RESP a
      inner join loy.loy_mbr b on a.mbr_no = b.mbr_no
      where  b.rid = #{rid} AND a.CRE_DT is not null

      ) a
      LEFT JOIN com.comm_code cc1 ON cc1.code_name = a.chnlSubType AND cc1.GROUP_CODE = 'ACTION_SUB_TYPE' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
      LEFT JOIN com.comm_code cc2 ON cc2.code_name = a.chnlTypeCd AND cc2.GROUP_CODE = 'TODO_TYPE_SR' AND cc2.lang=#{lang}  AND cc2.country  = #{country}

    ORDER BY ${strOrderby}
    ${strEndPaging}






    <!-- SELECT
      vah.ATVY_SUB_TYPE AS atvySubTypeCode
      , cc2.mark_name AS atvyType
      , cc1.mark_name AS atvySubType
      , vah.ACD_CALL_DURATION AS acdCallDuration
      , vah.CALL_ID AS callId
      , e.NAME AS creatorLogin
      , vah.CHNL_SEND_DT  as chnlSendDt
            , vah.CHNL_RPY_DT as chnlRpyDt
            , vah.CHNL_RPY_RSN  as chnlRpyRsn
      , vah.COMMENTS_LONG AS comments
    FROM voc.voc_atvy_hist vah
    INNER JOIN loy.loy_mbr lm ON vah.RID_CUST = lm.RID_CUST
    LEFT JOIN com.crm_user cu ON vah.CREATOR_LOGIN = cu.rid
    LEFT JOIN com.employee e on cu.ID_EMPLOYEE = e.id
    LEFT JOIN com.comm_code cc1 on cc1.code_name = vah.ATVY_SUB_TYPE and cc1.GROUP_CODE = 'ACTION_SUB_TYPE' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 on cc2.code_name = vah.ATVY_TYPE  and cc2.GROUP_CODE = 'TODO_TYPE_SR' AND cc2.lang=#{lang}  AND cc2.country  = #{country}
    WHERE ${strSVCType}
      AND ${strWhere}
      AND lm.RID=#{rid}
      AND vah.flag = 1
      ORDER BY ${strOrderby}
      ${strEndPaging} -->
  </select>


  <select id="selectMbrChnlHistContents" parameterType="mbrChnlHistContentsRequest" resultType="mbrChnlHistContentsResponse">
    <if test="chnlTypeCd == &quot;KAKAO&quot;">
  select MSG_SBST as contents from mkt.mkt_kakao_send_log where ID = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == 90">
    select MSG_SBST as contents from mkt.mkt_push_send_log where ID = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == &quot;LMS&quot;">
    select MSG_SBST as contents from mkt.mkt_msg_send_log where ID = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == &quot;SMS&quot;">
    select MSG_SBST as contents from mkt.mkt_msg_send_log where ID = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == &quot;MMS&quot;">
    select MSG_SBST as contents from mkt.mkt_msg_send_log where ID = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == 70">
    select MSG_SBST as contents from mkt.mkt_email_send_log where ID = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == &quot;E&quot;">
    select MSG_SBST as contents from mkt.mkt_email_send_log where ID = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == &quot;L&quot;">
    select MSG_SBST as contents from mkt.mkt_email_send_log where ID = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == &quot;S&quot;">
    select MSG_SBST as contents from mkt.mkt_email_send_log where ID = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == &quot;M&quot;">
    select MSG_SBST as contents from mkt.mkt_email_send_log where ID = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == &quot;P&quot;">
    select MSG_SBST as contents from mkt.mkt_email_send_log where ID = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == &quot;OCS&quot;">
    SELECT t2.MSG_VAL as contents FROM mkt.HIST_CAM_I as t1 inner join mkt.HIST_CAM_MSG as t2 on t1.DISP_NO = t2.DISP_NO where t1.id = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == &quot;OCM&quot;">
    SELECT t2.MSG_VAL as contents FROM mkt.HIST_CAM_I as t1 inner join mkt.HIST_CAM_MSG as t2 on t1.DISP_NO = t2.DISP_NO where t1.id = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == &quot;OCP&quot;">
    SELECT t2.MSG_VAL as contents FROM mkt.HIST_CAM_I as t1 inner join mkt.HIST_CAM_MSG as t2 on t1.DISP_NO = t2.DISP_NO where t1.id = #{rid} limit 1
  </if>

  <if test="chnlTypeCd == &quot;OCE&quot;">
    SELECT t2.MSG_VAL as contents FROM mkt.HIST_CAM_I as t1 inner join mkt.HIST_CAM_MSG as t2 on t1.DISP_NO = t2.DISP_NO where t1.id = #{rid} limit 1
  </if>

  select COMMENTS_LONG as contents FROM voc.voc_atvy_hist where rid = #{rid} limit 1


  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 보험이력
      -   설명                  : 회원 보험이력
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
  <select id="selectMbrInsurHistList" parameterType="mbrRequest" resultType="mbrInsurHistListResponse">
  /*selectMbrInsurHistList*/
    SELECT
      <!-- lic.INSU_TYPE AS insuType -->
      cc1.MARK_NAME as insuType
      , lic.POLICY_NUM AS policyNumas
      <!-- , lic.EDU_MEMBER_TYPE_CD AS eduMemberTypeCd -->
      , cc2.MARK_NAME as eduMemberTypeCd
      , lic.START_DT AS startDt
      , lic.END_DT AS endDt
      , lic.CANCEL_DT AS cancelDt
      , lm1.MBR_NO AS conMbrNo
      , lic.CONTRACT_NAME AS contractName
      , lm2.MBR_NO AS insMbrNo
      , lic.INSURE_NAME AS insureName
      , lic.INSURE_GET_YN AS insureGetYn
      , lic.LIG_PROMO_MEM_SEQ AS ligPromoMemSeq
      , lic.COMMENTS1 AS comments1
      , lic.COMMENTS2 AS comments2
      <!-- , ${strColumn} -->
    FROM loy.loy_insur_mem  lim
    INNER JOIN loy.loy_insur_cont  lic ON lim.RID_INSRD_CUST = lic.RID
    LEFT OUTER JOIN loy.loy_cust  lc1 ON lic.CONTRACT_CI_KEY = lc1.IDENTI_VAL
    LEFT OUTER JOIN loy.loy_mbr  lm1 ON lc1.RID = lm1.RID_CUST
    LEFT OUTER JOIN loy.loy_cust  lc2 ON lic.INSURE_CI_KEY = lc2.IDENTI_VAL
    LEFT OUTER JOIN loy.loy_mbr  lm2 ON lc2.RID = lm2.RID_CUST
    LEFT JOIN com.comm_code cc1 on cc1.code_name = lic.INSU_TYPE and cc1.GROUP_CODE = 'PROMO_ALI_TYPE' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 on cc2.code_name = lic.EDU_MEMBER_TYPE_CD  and cc2.GROUP_CODE = 'EDU_MEM_TYPE' AND cc2.lang=#{lang}  AND cc2.country  = #{country}
    WHERE ${strSVCType}
      AND ${strWhere}
      AND lm2.RID=#{rid}
      AND lim.MEM_SRCH_YN = 'Y'
      <!-- AND lim.flag = 1 -->
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 채널 이력
      -   설명                  : 회원 채널 이력
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
  <select id="selectMbrChnlHistSubList" parameterType="mbrRequest" resultType="mbrChnlHistListResponse">
    SELECT
      vah.SMS_RPY_MSG AS smsRpyMsg
      , vah.SEND_DT AS sendDt
      , vah.SMS_STAGE AS smsStage
      , vah.MSG_TYPE AS msgType
      , vah.MSG_TITLE AS msgTitle
      , vah.MSG_CONTENT AS msgContent
      <!-- , ${strColumn} -->
    FROM voc.voc_atvy_hist vah
    WHERE ${strSVCType}
      AND ${strWhere}
      AND vah.RID_CUST=#{rid}
      <!-- AND vah.flag = 1 -->
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>

  	<!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 상세 정보
      -   설명                  : 회원 상세 정보
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
  	<select id="selectMbrDetailInfo" parameterType="mbrDetailInfoRequest" resultType="mbrDetailInfoResponse">
  	/* LOYMbr.selectMbrDetailInfo */
   	SELECT
		lm.rid                       AS  rid
      , lm.mbr_no                    AS  mbrNo
      , lc.MARRY_YN                  AS  marryYn
      , lc.MARRY_ANIV                AS  marryAniv
      , lc.GEN_GBN_CD                AS  genGbnCd
      , cc1.MARK_NAME                AS  genGbnCdMarkName
      , lm.EMAIL_ADDR                AS  emailAddrIn
      , lm.EMAIL_ADDR                AS  emailAddr
      , secu.fn_getDecrypt(#{cipherKey}, lm.EMAIL_ADDR, null) AS emailAddrDec <!-- 'EML' -->
      , lm.CHNL_AGRE_SMS             AS  chnlAgreSms
      , lm.CHNL_AGRE_EMAIL           AS  chnlAgreEmail
      , lm.APP_NEWS_YN               AS  appNewsYn
      , lc.IDENTI_TYPE_CD            AS  identiTypeCd
      , cc11.MARK_NAME               AS  identiTypeCdMarkName
      , lc.IPIN_NO                   AS  ipinNo
      , lc.AUTH_AGEGRD               AS  authAgegrd
      , cc12.MARK_NAME               AS  authAgegrdMarkName
      , lc.AUTH_RESLT                AS  authReslt
      , cc13.MARK_NAME               AS  authResltMarkName
      , lm.MBR_TYPE_CD               AS  mbrTypeCd
      , cc7.MARK_NAME                AS  mbrTypeCdMarkName
      , lm.MBR_STAT_CD               AS  mbrStatCd
      , cc8.MARK_NAME                AS  mbrStatCdMarkName
      , lc.SPOUS_LUNAR_GBN_CD        AS  spousLunarGbnCdCode
      , cc9.MARK_NAME                AS  spousLunarGbnCd
      , lc.CHILD_FLG                 AS  childFlg
      , lc.SPOUS_BTHDAY              AS  spousBthday
      , lm.CHNL_AGRE_DM              AS  chnlAgreDm
      , lm.CHNL_AGRE_TEL             AS  chnlAgreTel
      <!-- 추가정보 -->
      , lm.RID_CHNL_PRIMARY			 AS  ridChnlPrimary		<!-- 단골매장 -->
      , lcn2.CHNL_NM				 as  chnlPrimaryNm
      , lcn2.CHNL_NO				 as  chnlPrimaryNo
      <!-- 연락처 및 동의정보 -->
      , lm.mbr_terms_agre            as  mbrTermsAgre		<!-- 다이소 멤버십 이용동의 -->
      , lm.MKT_AGRE_PRV_INFO         as  mktAgrePrvInfo		<!-- 개인정보 수집 및 활용동의 -->
      , lm.MKT_AGRE_USE         	 as  mktAgreUse			<!-- 마케팅정보 수신동의 -->
      , lm.mkt_agre_third_snd        as  mktAgreThirdSnd	<!-- 개인정보 제3자 제공동의 -->
      , lm.mkt_agre_lbs_biz          as  mktAgreLbsBiz		<!-- 위치정보 수집동의 -->
      , lm.CHNL_AGRE_PUSH            AS  chnlAgrePush		<!-- push 기본 수신동의        -->
      , lm.CHNL_AGRE_KAKAO           AS  chnlAgreKakao		<!-- 카카오톡 수신동의         -->
      , case when nvl(lm.E_RECEIPT_USE_YN,'') is not null
      	then case when lm.E_RECEIPT_USE_YN = 'Y' then 'Y' else 'N' end
      	else 'N' end                 AS  eReceiptUseYn		<!-- 영수증 용지 발행 전환여부 2019.01.22 jk.kim 영수증값 그대로 뿌려주게끔 수정요청와서 수정   -->
      <!-- 기타정보 -->
      , lm.FRAUD_MEM_DIV             AS  fraudMemDiv		<!-- 부정회원 구분 -->
      , lc.FOREIGN_CD          		 AS  foreignCd			<!-- 내외국인 구분 -->
      , cc10.MARK_NAME         		 AS  foreignCdMarkName
      <!-- 가입정보 -->
      , lm.RID_CHNL_JOIN		     as  ridChnlJoin		<!-- 가입채널 -->
      , lcn.CHNL_NM                  as  chnlJoinNm
      , lcn.CHNL_NO                  as  chnlJoinNo
      , TO_CHAR(lm.JOIN_DATE, 'YYYY-MM-DD HH24:MI:SS')     		     as  joinDate     		<!-- 가입일시     -->
      , TO_CHAR(lc.REALNM_CERTI_DATE, 'YYYY-MM-DD HH24:MI:SS') 	     as  realnmCertiDate	<!-- 가입인증일시 -->

      <!-- 이메일 변경일시 -->
      , (select create_date from loy.loy_mbr_chg_hist where rid_mbr = #{rid} and chg_col = 'EMAIL_ADDR' and app_service_type = #{appServiceId} and country = #{country} order by create_date desc offset 0 ROWS FETCH NEXT 1 ROWS ONLY) as emailChgDt
      <!-- 핸드폰 변경일시 -->
      , (select create_date from loy.loy_mbr_chg_hist where rid_mbr = #{rid} and chg_col = 'HHP_NO' and app_service_type = #{appServiceId} and country = #{country} order by create_date desc offset 0 ROWS FETCH NEXT 1 ROWS ONLY) as hpChgDt
      <!-- 주소 변경일시 -->
      , (select create_date from loy.loy_mbr_chg_hist where rid_mbr = #{rid} and (chg_col = 'ADDR1_ZIP' or chg_col = 'ADDR1_DFLT' or chg_col = 'ADDR1_DTL') and app_service_type = #{appServiceId} and country = #{country} order by create_date desc offset 0 ROWS FETCH NEXT 1 ROWS ONLY) as ownhomeAdrChgDt
      <!-- 기념일 변경일시 -->
      , case when nvl(aniv_upd_dt, '') IS NOT NULL then TO_CHAR(aniv_upd_dt, 'YYYY-MM-DD HH24:MI:SS') else '' end AS anivUpdDt

      , case when nvl(lm.aniv_dt, '') IS NOT NULL then TO_CHAR(to_date(lm.aniv_dt, 'MMDD'), 'YYYY-MM-DD') else '' end as anivDt
      , lm.PNT_ACRL_YN as pntAcrlYn
      , lm.PNT_USE_YN as pntUseYn
      , lm.PNT_ACRL_N_MSG as pntAcrlNMsg
      , lm.PNT_USE_N_MSG as pntUserNMsg
      , case when NVL(lm.MKT_AGRE_PARENT_DT, '') IS NOT NULL then 'Y' else 'N' end AS underForteenYn
      , lm.mkt_agre_third_snd as mktAgreThirdSnd
      , case when nvl(lmai.last_login_date,'') is not null then to_char(lmai.last_login_date,'YYYY-MM-DD HH24:MI:SS') else '' end as lastLoginDate
      , case when nvl(lmai.svr_last_dt,'') is not null then to_char(lmai.svr_last_dt,'YYYY-MM-DD HH24:MI:SS') else '' end as svrLastDt
      , lcn3.chnl_nm as svrLastChnlNm
      , lcn4.chnl_nm as chnlLastStoreNm
      , lm.WEBID_REG_DT   as webIdRegDt
      , lm.smoking_yn as smokingYn
      , lc.REALNM_CERTI_YN as realNmCertiYn
      , lc.REALNM_CERTI_DATE as realNmCertiDate
   	FROM loy.loy_mbr lm
   	left join loy.loy_mbr_access_info lmai on lmai.rid_mbr = lm.rid
    LEFT JOIN loy.loy_cust    lc   ON lm.RID_CUST = lc.RID
    LEFT JOIN loy.LOY_CHANNEL lcn  ON lcn.RID = lm.RID_CHNL_JOIN
    LEFT JOIN loy.LOY_CHANNEL lcn2 ON lcn2.RID = lm.RID_CHNL_PRIMARY
    LEFT JOIN loy.LOY_CHANNEL lcn3 ON lcn3.RID = lmai.rid_svr_last_chnl
    LEFT JOIN loy.LOY_CHANNEL lcn4 ON lcn4.RID = lmai.rid_chnl_last_store
    LEFT JOIN com.comm_code cc1  ON lc.GEN_GBN_CD 		  = cc1.CODE_NAME and cc1.GROUP_CODE = 'LOY_GEN_CD' 			AND cc1.lang = #{lang}
    LEFT JOIN com.comm_code cc7  ON lm.MBR_TYPE_CD 		  = cc7.CODE_NAME and cc7.GROUP_CODE = 'LOY_MEM_TYPE_CD' 		AND cc7.lang = #{lang}
    LEFT JOIN com.comm_code cc8  ON lm.MBR_STAT_CD 		  = cc8.CODE_NAME and cc8.GROUP_CODE = 'LOY_MEM_STAT_CD' 		AND cc8.lang = #{lang}
    LEFT JOIN com.comm_code cc9  ON lc.SPOUS_LUNAR_GBN_CD = cc9.CODE_NAME and cc9.GROUP_CODE = 'BIRTHDAY_CD' 			AND cc9.lang = #{lang}
    LEFT JOIN com.comm_code cc10 ON lc.FOREIGN_CD 		  = cc10.CODE_NAME and cc10.GROUP_CODE = 'FOREIGN_CD' 			AND cc10.lang = #{lang}
    LEFT JOIN com.comm_code cc11 ON lc.IDENTI_TYPE_CD 	  = cc11.CODE_NAME and cc11.GROUP_CODE = 'MEM_IDENTI_TYPE'      AND cc11.lang = #{lang}
    LEFT JOIN com.comm_code cc12 ON lc.AUTH_AGEGRD 		  = cc12.CODE_NAME and cc12.GROUP_CODE = 'MEMBER_AGE' 			AND cc12.lang = #{lang}
    LEFT JOIN com.comm_code cc13 ON lc.AUTH_RESLT 		  = cc13.CODE_NAME and cc13.GROUP_CODE = 'CERTIFICATION_RESULT' AND cc13.lang = #{lang}
    WHERE lm.rid=#{rid}
	and rownum = 1 <!-- 변경이력 N건인 경우 N개의 ROW가 나오므로 1건만 조회하도록 한다. -->

    <!--   lm.rid                         AS rid
      , lm.mbr_no                    AS mbrNo
      , lc.MARRY_YN                  AS  marryYn
      , lc.MARRY_ANIV                AS  marryAniv
      , lm.JOB                       AS  job
      , cc14.MARK_NAME               AS  jobMarkName
      , lc.GEN_GBN_CD                AS  genGbnCd
      , cc1.MARK_NAME                AS  genGbnCdMarkName
      , lm.OWNHOME_ADR_CHG_DT      AS ownhomeAdrChgDt

      , lm.ADDR1_JI_DFLT         AS addr1JiDflt
      , lm.ADDR1_JI_DTL          AS addr1JiDtl
      , lm.ADDR1_JI_ZIP        AS addr1JiZip
      , lm.H_CITY              AS hCity
      , lm.H_GU            AS hGu
      , lm.RID_MNBSN_STN             AS  ridMnbsnStn
      , lcn.CHNL_NM            AS chnlNm
      , lm.PSTMATR_RECV_DESK         AS  pstmatrRecvDesk
      , cc2.MARK_NAME                AS  pstmatrRecvDeskMarkName
      , lm.OFF_TEL_NO                AS  offTelNo
      , lm.HP_CHG_DT                 AS  hpChgDt
      , lm.FAX_NO                    AS  faxNo
      , lm.EMAIL_ADDR AS emailAddrIn
        , secu.fn_getDecrypt(#{cipherKey}, lm.EMAIL_ADDR, 'EML') AS emailAddr
      , lm.EMAIL_CHG_DT              AS  emailChgDt
      , lc.REALNM_CERTI_YN           AS  realnmCertiYn
      , lm.PH_CERTI_YN               AS  phCertiYn
      , lm.HP_ERR_YN                 AS  hpErrYn
      , lm.EMAIL_ERR_YN              AS  emailErrYn
      , lm.SMARTPH_PSSN_YN           AS  smartphPssnYn
      , lm.CHNL_AGRE_SMS             AS  chnlAgreSms
      , lm.CHNL_AGRE_EMAIL           AS  chnlAgreEmail
      , lm.APP_NEWS_YN               AS  appNewsYn
      , lm.APP_BENEFIT_YN            AS  appBenefitYn
      , lm.APP_DOWNL_YN              AS  appDownlYn
      , lm.IPARK_INFO_PRV_AGREE_YN   AS  iparkInfoPrvAgreeYn
      , lm.AUTORDM_AGREE_YN          AS  autordmAgreeYn
      , lm.AUTORDM_POINT             AS  autordmPoint
      , lm.AUTORDM_CHG_DT            AS  autordmChgDt
      , lm.PCLR_MTR                  AS  pclrMtr
      , lc.IDENTI_TYPE_CD            AS  identiTypeCd
      , cc11.MARK_NAME               AS  identiTypeCdMarkName
      , lm.WB_SBSC_DT                AS  wbSbscDt
      , lm.CAL_CENTR_SBSC_DT         AS  calCentrSbscDt
      , lm.FRAUD_MEM_DIV             AS  fraudMemDiv
      , cc3.MARK_NAME                AS  fraudMemDivMarkName
      , lm.ACTN_DIV                  AS  actnDiv
      , cc4.MARK_NAME                AS  actnDivMarkName
      , lm.WKPLC_NM                  AS  wkplcNm
      , lm.DEPT_NM                   AS  deptNm
      , lm.ADDR2_JI_ZIP              AS  addr2JiZip
      , lm.WKPLC_ADR_CHG_DT          AS  wkplcAdrChgDt
      , lm.ADDR2_JI_DFLT             AS  addr2JiDflt
      , lm.ADDR2_JI_DTL              AS  addr2JiDtl
      , lm.INTRST_FILD_1             AS  intrstFild1
      , cc5.MARK_NAME                AS  intrstFild1MarkName
      , lm.INTRST_FILD_2             AS  intrstFild2
      , cc6.MARK_NAME                AS  intrstFild2MarkName
      , lm.WKPLC_ADR_CHG_DT          AS  wkplcAdrChgDt
      , lm.ADDR2_DFLT                AS  addr2Dflt
      , lm.ADDR2_DTL                 AS  addr2Dtl
      , lm.INDV_TAXI_CONV_RQT        AS  indvTaxiConvRqt
      , lc.IPIN_NO                   AS  ipinNo
      , lm.ALTR_VRF_MSG              AS  altrVrfMsg
      , lc.AUTH_AGEGRD               AS  authAgegrd
      , cc12.MARK_NAME               AS  authAgegrdMarkName
      , lc.AUTH_RESLT                AS  authReslt
      , cc13.MARK_NAME               AS  authResltMarkName
      , lm.RQT_NO                    AS  rqtNo
      , lm.IPADR                     AS  ipadr
      , lm.MBR_TYPE_CD               AS  mbrTypeCd
      , cc7.MARK_NAME                AS  mbrTypeCdMarkName
      , lm.MBR_STAT_CD               AS  mbrStatCd
      , cc8.MARK_NAME                AS  mbrStatCdMarkName
      , lm.CAM_TGT_MEM               AS  camTgtMem
      , cc15.MARK_NAME               AS  camTgtMemMarkName
      , lm.PMON_CHARG_AMT            AS  pmonChargAmt
      , lc.SPOUS_LUNAR_GBN_CD        AS  spousLunarGbnCdCode
      , cc9.MARK_NAME                AS  spousLunarGbnCd
      , lc.CHILD_FLG                 AS  childFlg
      , lm.CUST_VALUE                AS  custValue
      , lm.MEM_LC_STAGE              AS  memLcStage
      , lm.CAR_USE_PURP              AS  carUsePurp
      , lc.SPOUS_BTHDAY              AS  spousBthday
      , lm.OWNHOME_TEL_ERR_YN        AS  ownhomeTelErrYn
      , lm.CMPN_TEL_ERR_YN           AS  cmpnTelErrYn
      , lm.CHNL_AGRE_DM              AS  chnlAgreDm
      , lm.CHNL_AGRE_TEL             AS  chnlAgreTel
      , lm.PMON_CHAGR_QNT            AS  pmonChagrQnt
      , lc.FOREIGN_CD          AS  foreignCd
      , cc10.MARK_NAME         AS  foreignCdMarkName
      , lm.MKT_AGRE_PRM_EVT      AS  mktAgrePrmEvt
      , lm.MKT_AGRE_PRV_INFO_OPT     AS  mktAgrePrvInfoOpt
      , lm.CHNL_AGRE_KKATLK      AS  chnlAgreKkaTlk
      , cd.div_nm            AS  divNm
      , lm.KKATLK_RCV_YN         AS  kkatlkRcvYn
      , lm.HOME_TEL_NO         AS  homeTelNo
    FROM loy.loy_mbr lm
    LEFT JOIN loy.loy_cust lc ON lm.RID_CUST = lc.RID
    LEFT JOIN loy.loy_channel lcn ON lm.RID_MNBSN_STN = lcn.rid
    LEFT JOIN com.crm_division cd on lcn.rid_stn_mgmt_div = cd.rid
    LEFT JOIN com.comm_code cc1 ON lc.GEN_GBN_CD = cc1.CODE_NAME and cc1.GROUP_CODE = 'LOY_GEN_CD' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 ON lm.PSTMATR_RECV_DESK = cc2.CODE_NAME and cc2.GROUP_CODE = 'MEMBER_POST_LOC' AND cc2.lang=#{lang}  AND cc2.country  = #{country}
    LEFT JOIN com.comm_code cc3 ON lm.FRAUD_MEM_DIV = cc3.CODE_NAME and cc3.GROUP_CODE = 'MEMBER_CLAIM_CD' AND cc3.lang=#{lang}  AND cc3.country  = #{country}
    LEFT JOIN com.comm_code cc4 ON lm.ACTN_DIV = cc4.CODE_NAME and cc4.GROUP_CODE = 'CLAIM_MANAGE_TYPE' AND cc4.lang=#{lang}  AND cc4.country  = #{country}
    LEFT JOIN com.comm_code cc5 ON lm.INTRST_FILD_1 = cc5.CODE_NAME and cc5.GROUP_CODE = 'MEMBER_HOBBY' AND cc5.lang=#{lang}  AND cc5.country  = #{country}
    LEFT JOIN com.comm_code cc6 ON lm.INTRST_FILD_2 = cc6.CODE_NAME and cc6.GROUP_CODE = 'MEMBER_HOBBY' AND cc6.lang=#{lang}  AND cc6.country  = #{country}
    LEFT JOIN com.comm_code cc7 ON lm.MBR_TYPE_CD = cc7.CODE_NAME and cc7.GROUP_CODE = 'LOY_MEM_TYPE_CD' AND cc7.lang=#{lang}  AND cc7.country  = #{country}
    LEFT JOIN com.comm_code cc8 ON lm.MBR_STAT_CD = cc8.CODE_NAME and cc8.GROUP_CODE = 'LOY_MEM_STAT_CD' AND cc8.lang=#{lang}  AND cc8.country  = #{country}
    LEFT JOIN com.comm_code cc9 ON lc.SPOUS_LUNAR_GBN_CD = cc9.CODE_NAME and cc9.GROUP_CODE = 'BIRTHDAY_CD' AND cc9.lang=#{lang}  AND cc9.country  = #{country}
    LEFT JOIN com.comm_code cc10 ON lc.FOREIGN_CD = cc10.CODE_NAME and cc10.GROUP_CODE = 'FOREIGN_CD' AND cc10.lang=#{lang}  AND cc10.country  = #{country}
    LEFT JOIN com.comm_code cc11 ON lc.IDENTI_TYPE_CD = cc11.CODE_NAME and cc11.GROUP_CODE = 'CERTIFICATION_METHOD' AND cc11.lang=#{lang}  AND cc11.country  = #{country}
    LEFT JOIN com.comm_code cc12 ON lc.AUTH_AGEGRD = cc12.CODE_NAME and cc12.GROUP_CODE = 'MEMBER_AGE' AND cc12.lang=#{lang}  AND cc12.country  = #{country}
    LEFT JOIN com.comm_code cc13 ON lc.AUTH_RESLT = cc13.CODE_NAME and cc13.GROUP_CODE = 'CERTIFICATION_RESULT' AND cc13.lang=#{lang}  AND cc13.country  = #{country}
    LEFT JOIN com.comm_code cc14 ON lm.JOB = cc14.CODE_NAME and cc14.GROUP_CODE = 'MEMBER_JOB' AND cc14.lang=#{lang}  AND cc14.country  = #{country}
    LEFT JOIN com.comm_code cc15 ON lm.CAM_TGT_MEM = cc15.CODE_NAME and cc15.GROUP_CODE = 'CAMP_CON_TYPE' AND cc15.lang=#{lang}  AND cc15.country  = #{country}
    WHERE lm.rid=#{rid} -->
  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 단체회원 상세 정보 수정
      -   설명                  : 단체회원 상세 정보 수정
      -   결과형태              :
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.07
      ***************************************/ -->
  <update id="updateMbrGroupeDetail" parameterType="mbrPointLimitRequest">
    <!-- 카드 비밈번호 필드 미정
    UPDATE loy.loy_mbr
    SET LIMIT_AMT = #{achngData}
      , LIMIT_YN = 'Y'
      , APV_SRVR_TRM_DT = sysdate
      , APV_SRVR_TRM_YN = 'Y'
    WHERE 1=1
    AND rid = #{ridMbr} -->
  </update>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 단체회원 추가 정보 조회
      -   설명                  : 단체회원 추가 정보 조회
      -   결과형태              :
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.07
      ***************************************/ -->
  <select id="selectMbrGroupAddInfo" parameterType="mbrRequest" resultType="mbrGroupAddInfoResponse">
    SELECT
      lm.rid                      AS rid
      , lc.rid                    AS chnlId
      , lc.CHNL_NM                AS chnlNm
      , lc.MBRBS_CDADD            AS mbrbsCdadd
      , lc.ZIP_CD                 AS zipCd
      <!-- , lc.ADR_DTL                AS adrDtl -->
      , lc.JIBUN_ADDR_DTL         AS adrDtl
      , lc.EMAIL                  AS email
      <!-- , lc.OU_TYPE_CD         AS ouTypeCd -->
      <!-- , cc1.MARK_NAME             AS ouTypeCdMarkName -->
      , lc.PAR_RID                AS parRid
      , lc1.CHNL_NO               AS parChnlNo
      , lc1.CHNL_NM               AS parChnlNm
      , lc.REPR_NM                AS reprNm
      , lc.BIZR_NO                AS bizrNo
      , lc.FAX_NO                 AS faxNo
      , lc.TEL_NO                 AS telNo
      , lc.HP_NO                  AS hpNo
      <!-- , secu.fn_getDecrypt(#{cipherKey},
            lc.HP_NO,
            'PHONE_NUM2') AS hpNo -->
      , lc.SBSC_DD                AS sbscDd
      , lc.RID_ACRL_RULE          AS ridAcrlRule
      , pb.RULE_CD                AS ruleCd
      , pb.RULE_TYPE_CD           AS ruleTypeCd
      , lc.TRMN_DD                AS trmnDd
      , lc.RMARK                  AS rmark
      , lc.DNAT_START_DAY         AS dnatStartDay
      , lc.DNAT_END_DAY           AS dnatEndDay
      , lc.FND_DD                 AS fndDd
      , lc.OPRT_PRPS              AS oprtPrps
      , lc.FRAUD_DIV              AS fraudDiv
      , cc2.MARK_NAME             AS fraudDivMarkName
      , lc.FRAUD_MBRBS_ACTN_DIV   AS fraudMbrbsActnDiv
      , cc3.MARK_NAME             AS fraudMbrbsActnDivMarkName
      , lc.FRAUD_MBRBS_ACTN_DESC  AS fraudMbrbsActnDesc
      <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
      , lm.mem_div        AS memDiv
       -->
      , lc.sido         AS sido
      , lc.gugun          AS gugun
      , lc.road_nm_adr_zipcd    AS roadNmAdrZipCd
      , lc.road_nm_adr      AS roadNmAdr
    FROM loy.loy_mbr lm
    LEFT JOIN loy.loy_channel lc  ON lm.RID_ORG = lc.RID
    LEFT JOIN loy.loy_channel lc1 ON lc.PAR_RID = lc1.RID
    LEFT JOIN loy.loy_pnt_base_adm pb ON lc.RID_ACRL_RULE = pb.RID
    <!-- LEFT JOIN com.comm_code cc1 ON cc1.code_name = lc.OU_TYPE_CD AND cc1.group_code = 'PARTNER_TYPE' AND cc1.lang=#{lang}  AND cc1.country  = #{country} -->
    left join com.comm_code cc2 on cc2.code_name = lc.FRAUD_DIV AND cc2.group_code = 'PARTNER_BL_TYPE' AND cc2.lang=#{lang}  AND cc2.country  = #{country}
    left join com.comm_code cc3 on cc3.code_name = lc.FRAUD_MBRBS_ACTN_DIV AND cc3.group_code = 'PARTNER_BL_RESULT' AND cc3.lang=#{lang}  AND cc3.country  = #{country}
    WHERE lm.rid = #{rid};
  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 단체 회원 - 동호회 회원 리스트
      -   설명                  : 단체 회원 - 동호회 회원 리스트
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.7
      ***************************************/ -->
  <select id="selectMbrGroupUserList" parameterType="mbrRequest" resultType="mbrGroupClubListResponse">
    /*selectMbrGroupClubList*/
    SELECT
      lm.MBR_NO     AS mbrNo
      , lc.CUST_NM        AS custNm
      , lcm.REG_DT        AS regDt
      , lcm.DEL_DT        AS delDt
      , lcm.ACTIVE_FLG    AS activeFlg
      , lm.RID_CUST       AS ridCust
      , lm.rid            AS ridMbr
      , lcn.rid           AS ridChnl
      <!-- , ${strColumn} -->
    FROM loy.loy_chnl_mbr lcm
    LEFT JOIN loy.loy_channel lcn ON lcm.RID_CHNL = lcn.RID
    LEFT JOIN loy.loy_mbr lm ON lcm.RID_MBR = lm.RID
    LEFT JOIN loy.loy_cust lc ON lm.RID_CUST = lc.rid
    WHERE lcm.RID_CHNL=#{ridChnl}
    <!-- AND lcn.OU_TYPE_CD='6' -->
    AND ${strSVCType}
      AND ${strWhere}
      <!-- AND lcm.flag = 1 -->
      ORDER BY ${strOrderby}
      ${strEndPaging}

  </select>


  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 단체 회원 - 동호회 회원 초인트 거래 리스트
      -   설명                  : 단체 회원 - 동호회 회원 초인트 거래 리스트
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.7
      ***************************************/ -->
  <select id="selectMbrGroupPointTxnHistList" parameterType="mbrRequest" resultType="mbrGroupPointTxnHistListResponse">
    /*selectMbrGroupPointTxnHistList*/
    SELECT <!-- SQL_CALC_FOUND_ROWS STRAIGHT_JOIN -->
      lpt.RID_GROUP_MEM            AS ridGroupMem
      ,lpt.TXN_NUM                 AS txnNum
      , lpt.TXN_DATE               AS txnDate
      , lpt.PNT_TXN_TYPE_1_CD      AS pntTxnType1Cd
      , cc1.MARK_NAME              AS pntTxnType1
      , lpt.PNT_TXN_TYPE_2_CD      AS pntTxnType2Cd
      , cc2.MARK_NAME              AS pntTxnType2
      , lm.MBR_NO                  AS mbrNo
      , lc.CUST_NM                 AS custNm
      , lpt.PNT_AMT                AS pntAmt
      , lpt.PROD_UNIT_COST         AS prodUnitCost
      , lpt.PROD_QTY               AS prodQty
      , lpt.TXN_AMT                AS txnAmt
      , lpt.GROUP_PNT              AS groupPnt
      , lpt.RID_MBR                AS ridMbr
      , lm.RID_CUST                AS ridCust
    FROM loy.loy_pnt_txn lpt
    left join loy.loy_mbr lm on lpt.rid_mbr = lm.rid
    left join loy.loy_cust lc on lm.RID_CUST = lc.rid
    left join com.comm_code cc1 on cc1.code_name = lpt.PNT_TXN_TYPE_1_CD and cc1.group_name='PNT_TXN_TYPE' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
    left join com.comm_code cc2 on cc2.code_name = lpt.PNT_TXN_TYPE_2_CD and cc2.group_name='PNT_TXN_DTL_TYPE' AND cc2.lang=#{lang}  AND cc2.country  = #{country}
    WHERE lpt.RID_GROUP_MEM=#{rid}
    AND ${strSVCType}
      AND ${strWhere}
      <!-- AND lpt.flag = 1 -->
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 단체 회원 - 변경이력 조회
      -   설명                  : 단체 회원 - 변경이력 조회
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.7
      ***************************************/ -->
  <select id="selectMbrGroupCngList" parameterType="mbrRequest" resultType="mbrGroupCngListResponse">
    /*selectMbrGroupCngList*/
    SELECT
      lch.CREATE_DATE   AS createDate
      , e.name      AS createBy
      , lch.CHG_ITEM    AS chgItemCd
      , cc1.MARK_NAME   AS chgItem
      , lch.BCHNG_VAL   AS bchngVal
      , lch.ACHNG_VAL   AS achngVal
      , lch.CD_NM       AS cdNm
      , lch.DESC1       AS desc1
      , lch.RID_PARENT  AS ridParent
      <!-- , ${strColumn} -->
    FROM loy.loy_chg_hist lch
    INNER JOIN loy.loy_channel  lcn ON lch.RID_PARENT = lcn.RID
      INNER JOIN loy.loy_mbr lm ON lcn.RID = lm.RID_ORG
      left JOIN com.crm_user cu ON cu.rid = lch.CREATE_BY
        INNER JOIN com.employee e ON cu.ID_EMPLOYEE = e.id
        LEFT JOIN com.comm_code cc1 ON lch.CHG_ITEM = cc1.CODE_NAME AND cc1.GROUP_CODE = 'HISTORY_ACCOUNT_COLUMN' AND cc1.lang=#{lang}  AND cc1.country  = #{country}
    WHERE lm.RID=#{rid}
    AND ${strSVCType}
      AND ${strWhere}
      <!-- AND lch.flag = 1 -->
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 상세 정보 수정
      -   설명                  : 회원 상세 정보 수정
      -   결과형태              :
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.07
      ***************************************/ -->
  <update id="updateMbrDetail" parameterType="mbrItemRequest">
 <!--    UPDATE loy.loy_mbr lm
    LEFT JOIN loy.loy_cust lc on lm.rid_cust = lc.rid
      SET
       lc.BIRTH_DT = #{birthDt}
      , lc.LUNAR_GBN_CD = #{lunarGbnCd}
      , lm.ADDR1_ZIP = #{addr1Zip}
      , lm.ADDR1_DFLT = #{addr1Dflt}
      , lm.ADDR1_DTL = #{addr1Dtl}
      , lm.ADDR1_JI_DFLT = #{addr1JiDflt}
      , lm.ADDR1_JI_DTL = #{addr1JiDtl}
      , lm.ADDR1_JI_ZIP = #{addr1JiZip}
      , lm.H_CITY = #{hCity}
      , lm.H_GU  = #{hGu}
      , lm.MEM_DIV = #{memDiv}
      , lm.CORP_TAXI_YN = #{corpTaxiYn}
      , lm.OWNHOME_ADR_CHG_DT = #{ownhomeAdrChgDt}
      , lm.MKT_AGRE_PRV_INFO_OPT    =  #{mktAgrePrvInfoOpt}
      , lc.MARRY_YN = #{marryYn}
      , lc.MARRY_ANIV = #{marryAniv}
      , lm.EMAIL_ADDR = secu.fn_getEncrypt(#{cipherKey}, #{emailAddr})
      , lm.MODIFY_DATE = sysdate
      , lm.HHP_NO = secu.fn_getEncrypt(#{cipherKey}, #{hhpNo})
    WHERE 1=1
    AND lm.rid = #{rid}
     -->
   update loy.loy_mbr
   SET 		  ADDR1_ZIP		 = #{addr1Zip}
   			, ADDR1_DFLT     = #{addr1Dflt}
   			, ADDR1_DTL      = #{addr1Dtl}
   			, HHP_NO		 = secu.fn_getEncrypt(#{cipherKey}, #{hhpNo})
   			, hhp_no_tail    = #{hhpNoTail}
   			, EMAIL_ADDR     = secu.fn_getEncrypt(#{cipherKey}, #{emailAddr})
   			, MODIFY_DATE    = sysdate
   		<!-- 	,HHP_NO         = secu.fn_getEncrypt(#{cipherKey}, #{hhpNo}) -->
   where rid = #{rid}

  </update>

  	<update id="updateCustDetail" parameterType="mbrItemRequest">
	   	update loy.loy_cust
	   	SET
	   		  BIRTH_DT		= #{birthDt}
	   		, LUNAR_GBN_CD  = #{lunarGbnCd}
	   		, MARRY_YN     	= #{marryYn}
	   		, MARRY_ANIV    = #{marryAniv}
	   		, CUST_NM    	= #{custNm}
	   		, IDENTI_VAL 	= #{identiVal}
	   		, MODIFY_DATE    = sysdate
	   	where rid = #{ridCust}
	</update>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원  추가  상세 정보 수정
      -   설명                  : 회원 추가 상세 정보 수정
      -   결과형태              :
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.07

      - 다이소
      -   수정자                : jh.kim
      -   수정일                : 2018.10.24
      ***************************************/ -->
	<update id="updateLoyMbrInfo" parameterType="mbrDetailInfoRequest">
		update  loy.loy_mbr
		set
	        CHNL_AGRE_EMAIL_DT 		= CASE WHEN nvl(CHNL_AGRE_EMAIL,'N') =  #{chnlAgreEmail}  	THEN chnl_agre_email_dt 	ELSE sysdate END
	      , CHNL_AGRE_SMS_DT 		= CASE WHEN nvl(CHNL_AGRE_SMS,'N') =  #{chnlAgreSms}  		THEN chnl_agre_sms_dt 		ELSE sysdate END
	      , CHNL_AGRE_KAKAO_DT 		= CASE WHEN nvl(CHNL_AGRE_KAKAO, 'N') = #{chnlAgreKakao}	THEN CHNL_AGRE_KAKAO_DT 	ELSE sysdate END
	      , CHNL_AGRE_PUSH_DT 		= CASE WHEN nvl(CHNL_AGRE_PUSH, 'N') = #{chnlAgrePush} 		THEN CHNL_AGRE_PUSH_DT 		ELSE sysdate END

	      , MKT_AGRE_PRV_INFO_DT 	= CASE WHEN nvl(MKT_AGRE_PRV_INFO, 'N') = #{mktAgrePrvInfo} 	THEN MKT_AGRE_PRV_INFO_DT 		ELSE sysdate END
	      , MKT_AGRE_USE_DT 		= CASE WHEN nvl(MKT_AGRE_USE, 'N') = #{mktAgreUse} 				THEN MKT_AGRE_USE_DT 			ELSE sysdate END
	      , MKT_AGRE_LBS_BIZ_DT 	= CASE WHEN nvl(MKT_AGRE_LBS_BIZ, 'N') = #{mktAgreLbsBiz} 		THEN MKT_AGRE_LBS_BIZ_DT 		ELSE sysdate END
	      , MKT_AGRE_PRV_INFO       =  #{mktAgrePrvInfo} <!-- 개인정보 수집 및 이용동의 -->
	      , MKT_AGRE_USE       		=  #{mktAgreUse} <!-- 마케팅활용동의 -->
	      , MKT_AGRE_LBS_BIZ        =  #{mktAgreLbsBiz} <!-- 위치정보수집동의여부 -->

	      , E_RECEIPT_USE_YN        =  #{eReceiptUseYn}
	      , CHNL_AGRE_KAKAO         =  #{chnlAgreKakao}
	      , CHNL_AGRE_PUSH          =  #{chnlAgrePush}
	      <!-- 기념일 -->
<!-- 	      , lm.ANIV_DT                 = case when ANIV_DT != #{anivDt} THEN #{anivDt} ELSE ANIV_DT END -->
	      <!-- 기념일 변경일시 -->
<!-- 	      , lm.ANIV_UPD_DT             = case when ANIV_DT != #{anivDt} THEN sysdate ELSE ANIV_UPD_DT END -->
	      <!--
	      , OWNHOME_ADR_CHG_DT      =  #{ownhomeAdrChgDt}
	       -->
	      , ADDR1_ZIP               =  #{addr1Zip}
	      , ADDR1_DFLT              =  #{addr1Dflt}
	      , ADDR1_DTL               =  #{addr1Dtl}
	      , EMAIL_ADDR              =  secu.fn_getEncrypt(#{cipherKey}, #{emailAddr})
	      , CHNL_AGRE_SMS           =  #{chnlAgreSms}
	      , CHNL_AGRE_EMAIL         =  #{chnlAgreEmail}
	      , FRAUD_MEM_DIV           =  #{fraudMemDiv}
	      , MBR_TYPE_CD             =  #{mbrTypeCd}
	      , MBR_STAT_CD             =  #{mbrStatCd}

	      , pnt_acrl_yn 			= #{pntAcrlYn}
	      , pnt_use_yn 				= #{pntUseYn}
	      , pnt_acrl_n_msg 			= #{pntAcrlNMsg}
	      , pnt_use_n_msg 			= #{pntUserNMsg}

		where rid = #{rid}
	</update>
	<update id="updateLoyCustInfo" parameterType="mbrDetailInfoRequest">
		update  loy.loy_cust
		set
	        FOREIGN_CD              =  #{foreignCd}
	      , MARRY_ANIV              =  #{marryAniv}
	      , GEN_GBN_CD              =  #{genGbnCd}
		where rid = (select rid_cust from loy.loy_mbr where rid = #{rid})
	</update>


  	<update id="updateMbrDetailInfo" parameterType="mbrDetailInfoRequest">

	MERGE INTO loy.loy_mbr lm
		  USING loy.loy_cust lc
		  ON (lm.rid_cust = lc.rid and lm.rid = #{rid})
		  WHEN MATCHED THEN
		  	UPDATE     SET
		        lm.chnl_agre_email_dt =  CASE WHEN nvl(lm.CHNL_AGRE_EMAIL,'N') =  #{chnlAgreEmail}  THEN  lm.chnl_agre_email_dt
		              						  ELSE sysdate   END
		      , lm.chnl_agre_sms_dt =  CASE WHEN nvl(lm.CHNL_AGRE_SMS,'N') =  #{chnlAgreSms}  THEN  lm.chnl_agre_sms_dt
		                				    ELSE sysdate   END
		      , LM.MKT_AGRE_PRV_INFO_DT = CASE WHEN nvl(lm.MKT_AGRE_PRV_INFO, 'N') = #{mktAgrePrvInfo} THEN lm.MKT_AGRE_PRV_INFO_DT
		            					       ELSE sysdate END
		      , LM.CHNL_AGRE_KAKAO_DT = CASE WHEN nvl(lm.CHNL_AGRE_KAKAO, 'N') = #{chnlAgreKakao} THEN lm.CHNL_AGRE_KAKAO_DT
		            					     ELSE sysdate END
		      , LM.CHNL_AGRE_PUSH_DT = CASE WHEN nvl(lm.CHNL_AGRE_PUSH, 'N') = #{chnlAgrePush} THEN lm.CHNL_AGRE_PUSH_DT
		            					    ELSE sysdate END
		      , LM.MKT_AGRE_PRV_INFO       =  #{mktAgrePrvInfo}
		      , LM.E_RECEIPT_USE_YN        =  #{eReceiptUseYn}
		      , LM.CHNL_AGRE_KAKAO         =  #{chnlAgreKakao}
		      , LM.CHNL_AGRE_PUSH          =  #{chnlAgrePush}
		      , lm.ADDR1_ZIP               =  #{addr1Zip}
		      , lm.ADDR1_DFLT              =  #{addr1Dflt}
		      , lm.ADDR1_DTL               =  #{addr1Dtl}
		      <!--
		      , lm.OWNHOME_ADR_CHG_DT      =  #{ownhomeAdrChgDt}
		      , lm.RID_MNBSN_STN           =  #{ridMnbsnStn}
		      , lm.HP_CHG_DT               =  #{hpChgDt}
		       -->
		      , lm.EMAIL_ADDR              =  secu.fn_getEncrypt(#{cipherKey}, #{emailAddr})
		      <!--
		      , lm.EMAIL_CHG_DT            =  #{emailChgDt}
		       -->
		      , lm.CHNL_AGRE_SMS           =  #{chnlAgreSms}
		      , lm.CHNL_AGRE_EMAIL         =  #{chnlAgreEmail}
		      , lm.FRAUD_MEM_DIV           =  #{fraudMemDiv}
			  <!--
		      , lm.ADDR1_JI_DFLT           =  #{addr1JiDflt}
		      , lm.ADDR1_JI_DTL            =  #{addr1JiDtl}
		      , lm.ADDR1_JI_ZIP            =  #{addr1JiZip}
		      , lm.H_CITY                  =  #{hCity}
		      , lm.H_GU                    =  #{hGu}
		      , lm.PSTMATR_RECV_DESK       =  #{pstmatrRecvDesk}
		    	lm.mkt_agre_prm_evt_dt =  CASE WHEN nvl(lm.mkt_agre_prm_evt,'N') = #{mktAgrePrmEvt} THEN lm.mkt_agre_prm_evt_dt ELSE sysdate END
		      , lm.MKT_AGRE_PRV_INFO_OPT_dt =  CASE WHEN nvl(lm.MKT_AGRE_PRV_INFO_OPT,'N') =  #{mktAgrePrvInfoOpt}  THEN  lm.MKT_AGRE_PRV_INFO_OPT_DT ELSE sysdate   END
		      , lm.app_benefit_yn_dt =  CASE WHEN nvl(lm.APP_BENEFIT_YN,'N') =  #{appBenefitYn}  THEN  lm.app_benefit_yn_dt ELSE sysdate   END
		      , lm.app_news_yn_dt =  CASE WHEN nvl(lm.APP_NEWS_YN,'N') =  #{appNewsYn}  THEN  lm.app_news_yn_dt ELSE sysdate   END
		      , lm.chnl_agre_kkatlk_dt =  CASE WHEN nvl(lm.chnl_agre_kkatlk,'N') =  #{chnlAgreKkatlk}  THEN  lm.chnl_agre_kkatlk_dt ELSE sysdate   END
		      , lm.chnl_agre_dm_dt =  CASE WHEN nvl(lm.CHNL_AGRE_DM,'N') =  #{chnlAgreDm}  THEN  lm.chnl_agre_dm_dt ELSE sysdate   END
		      , lm.chnl_agre_tel_dt =  CASE WHEN nvl(lm.CHNL_AGRE_TEL,'N') =  #{chnlAgreTel}  THEN  lm.chnl_agre_tel_dt ELSE sysdate   END
		      , lm.ipark_info_prv_agree_yn_dt =  CASE WHEN nvl(lm.IPARK_INFO_PRV_AGREE_YN,'N') =  #{iparkInfoPrvAgreeYn}  THEN lm.ipark_info_prv_agree_yn_dt ELSE sysdate   END
		       -->
			  <!--
			  - 뭔지 모름 ( 해당 화면에 없음 )
		      , lm.SMARTPH_PSSN_YN         =  #{smartphPssnYn}
		      , lm.IPARK_INFO_PRV_AGREE_YN =  #{iparkInfoPrvAgreeYn}
		      , lm.PCLR_MTR                =  #{pclrMtr}
		      , lm.WB_SBSC_DT              =  #{wbSbscDt}
		      , lm.CAL_CENTR_SBSC_DT       =  #{calCentrSbscDt}
		      , lm.ACTN_DIV                =  #{actnDiv}

		      - 삭제됨
		      , lm.JOB                     =  #{job}
		      , lc.MARRY_YN                =  #{marryYn}
		      , lm.PH_CERTI_YN             =  #{phCertiYn}
		      , lm.HP_ERR_YN               =  #{hpErrYn}
		      , lm.EMAIL_ERR_YN            =  #{emailErrYn}
		      , lm.APP_NEWS_YN             =  #{appNewsYn}
		      , lm.APP_DOWNL_YN            =  #{appDownlYn}
		      , lm.APP_BENEFIT_YN          =  #{appBenefitYn}
		      , lm.AUTORDM_AGREE_YN        =  #{autordmAgreeYn}
		      , lm.AUTORDM_POINT           =  #{autordmPoint}
		      , lm.AUTORDM_CHG_DT          =  #{autordmChgDt}
		      , lm.WKPLC_NM                =  #{wkplcNm}
		      , lm.DEPT_NM                 =  #{deptNm}
		      , lm.ADDR2_JI_ZIP            =  #{addr2JiZip}
		      , lm.WKPLC_ADR_CHG_DT        =  #{wkplcAdrChgDt}
		      , lm.ADDR2_JI_DFLT           =  #{addr2JiDflt}
		      , lm.ADDR2_JI_DTL            =  #{addr2JiDtl}
		      , lm.INTRST_FILD_1           =  #{intrstFild1}
		      , lm.INTRST_FILD_2           =  #{intrstFild2}
		      , lm.WKPLC_ADR_CHG_DT        =  #{wkplcAdrChgDt}
		      , lm.ADDR2_DFLT              =  #{addr2Dflt}
		      , lm.ADDR2_DTL               =  #{addr2Dtl}
		      , lm.CMPN_TEL_ERR_YN         =  #{cmpnTelErrYn}
		      , lc.CHILD_FLG               =  #{childFlg}
		      , lm.CAM_TGT_MEM             =  #{camTgtMem}
		      , lm.IPADR                   =  #{ipadr}
		      , lm.RQT_NO                  =  #{rqtNo}
		      , lm.ALTR_VRF_MSG            =  #{altrVrfMsg}
		      , lc.AUTH_AGEGRD             =  #{authAgegrd}
		      , lm.INDV_TAXI_CONV_RQT      =  #{indvTaxiConvRqt}
		      , lc.IPIN_NO                 =  #{ipinNo}
		      , lc.AUTH_RESLT              =  #{authReslt}
		      , lm.PMON_CHARG_AMT          =  #{pmonChargAmt}
		      , lc.SPOUS_LUNAR_GBN_CD      =  #{spousLunarGbnCd}
		      , lm.CUST_VALUE              =  #{custValue}
		      , lm.MEM_LC_STAGE            =  #{memLcStage}
		      , lm.PMON_CHAGR_QNT          =  #{pmonChagrQnt}
		      , lc.SPOUS_BTHDAY            =  #{spousBthday}
		      , lm.OWNHOME_TEL_ERR_YN      =  #{ownhomeTelErrYn}
		      , lm.CAR_USE_PURP            =  #{carUsePurp}
		      , lm.CHNL_AGRE_DM            =  #{chnlAgreDm}
		      , lm.CHNL_AGRE_TEL           =  #{chnlAgreTel}
		       -->
		      <!-- , lm.OFF_TEL_NO                =  #{offTelNo} -->
		      <!-- , lm.FAX_NO                    =  #{faxNo} -->
		      <!-- , lc.REALNM_CERTI_YN           =  #{realnmCertiYn} -->
		      , lm.MBR_TYPE_CD             =  #{mbrTypeCd}
		      , lm.MBR_STAT_CD             =  #{mbrStatCd}
		      <!--
		      , lcn.CHNL_NM                =  #{chnlNm}
		       -->
		      , lc.FOREIGN_CD              =  #{foreignCd}
		      <!-- , lc.MARRY_ANIV              =  #{marryAniv} -->
		      <!-- 기념일 -->
		      , lm.ANIV_DT                 = case when lm.ANIV_DT != #{anivDt} THEN #{anivDt} ELSE lm.ANIV_DT END
		      <!-- 기념일 변경일시 -->
		      , lm.ANIV_UPD_DT             = case when lm.ANIV_DT != #{anivDt} THEN sysdate ELSE lm.ANIV_UPD_DT END
		      <!--
		      , lc.GEN_GBN_CD              =     #{genGbnCd}
		      , lc.IDENTI_TYPE_CD          =  #{identiTypeCd}
		      , lm.mkt_agre_prm_evt        =  #{mktAgrePrmEvt}
		      , lm.MKT_AGRE_PRV_INFO_OPT   =  #{mktAgrePrvInfoOpt}
		      , lm.chnl_agre_kkatlk        =  #{chnlAgreKkatlk}
		 	   -->
  	</update>

    <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원  추가  상세 정보 수정
      -   설명                  : 회원 추가 상세 정보 수정
      -   결과형태              :
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.07
      ***************************************/ -->
  <update id="updateMbrAppNewsDt" parameterType="mbrDetailInfoRequest">
    UPDATE loy.loy_mbr lm
    SET
    <if test="appNewsYn == &quot;Y&quot;">
    lm.APP_NEWS_YN_DT = sysdate
    </if>
    <if test="appNewsYn != &quot;Y&quot;">
    lm.APP_NEWS_YN_DT = NULL
    </if>
    WHERE 1=1
    AND lm.rid = #{rid}
  </update>
  <insert id="insertMbrAppNewDtHist" parameterType="mbrChgHistRequest">
    INSERT into loy.loy_mbr_chg_hist
      (RID,
      CREATE_BY,
      MODIFY_BY,
      CREATE_DATE,
      MODIFY_DATE,
      FLAG,
      COUNTRY,
      CURRENCY,
      APP_SERVICE_TYPE,
      ACCNT_ID,
      RID_MBR,
      CHG_PSTN,
      MEM_NO,
      RMARK,
      CHG_COL,
      BCHNG_DATA,
      ACHNG_DATA)
    VALUES
    (com.getNewID('A'),
      #{createBy},
      #{modifyBy},
      sysdate,
      sysdate,
      1,
      #{country},
      'KRW',
      #{appServiceId},
      #{accountId},
      #{ridMbr},
      NULL,
      #{mbrNo},
      NULL,
      "APP_NEWS_YN_DT",
      <if test="bchngData == null or bchngData == ''">
      null,
      sysdate
      </if>
      <if test="bchngData != null and bchngData != ''">
      (select APP_NEWS_YN_DT from loy.loy_mbr where rid=#{ridMbr}),
      null
      </if>

    )
  </insert>

  <update id="updateMbrGroupAddInfo" parameterType="mbrGroupAddInfoRequest">
    UPDATE loy.loy_mbr lm
    LEFT JOIN loy.loy_channel lc  ON lm.RID_ORG = lc.RID
    SET lc.CHNL_NM                  =#{chnlNm}
      , lc.MBRBS_CDADD            =#{mbrbsCdadd}
      , lc.ZIP_CD                 =#{zipCd}
      <!-- , lc.ADR_DTL                =#{adrDtl} -->
      , lc.JIBUN_ADDR_DTL         =#{adrDtl}
      , lc.road_nm_adr      =#{roadNmAdr}
      , lc.road_nm_adr_zipcd    =#{roadNmAdrZipCd}
      , lc.sido         =#{sido}
      , lc.gugun          =#{gugun}
      , lc.EMAIL                  =#{email}
      <!-- , lc.OU_TYPE_CD         =#{ouTypeCd} -->
      , lc.PAR_RID                =#{parRid}
      , lc.REPR_NM                =#{reprNm}
      , lc.BIZR_NO                =#{bizrNo}
      , lc.FAX_NO                 =#{faxNo}
      , lc.TEL_NO                 =#{telNo}
      , lc.HP_NO                  =secu.fn_getEncrypt(#{cipherKey}, #{hpNo})
      <if test="sbscDd != null and sbscDd != ''">
      , lc.SBSC_DD                =#{sbscDd}
      </if>
      , lc.RID_ACRL_RULE          =#{ridAcrlRule}
      <if test="trmnDd != null and trmnDd != ''">
      , lc.TRMN_DD                =#{trmnDd}
      </if>
      , lc.RMARK                  =#{rmark}
      <if test="dnatStartDay != null and dnatStartDay != ''">
      , lc.DNAT_START_DAY         =#{dnatStartDay}
      </if>
      <if test="dnatEndDay != null and dnatEndDay != ''">
      , lc.DNAT_END_DAY           =#{dnatEndDay}
      </if>
      <if test="fndDd != null and fndDd != ''">
      , lc.FND_DD                 =#{fndDd}
      </if>
      , lc.OPRT_PRPS              =#{oprtPrps}
      , lc.FRAUD_DIV              =#{fraudDiv}
      , lc.FRAUD_MBRBS_ACTN_DIV   =#{fraudMbrbsActnDiv}
      , lc.FRAUD_MBRBS_ACTN_DESC  =#{fraudMbrbsActnDesc}
    WHERE 1=1
    AND lm.rid = #{rid}

  </update>


  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 개인택시전환 리스트
      -   설명                  : 개인택시전환 리스트
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.27
      ***************************************/ -->
  <select id="selectChangeTaxiList" parameterType="mbrChangeTaxiListRequest" resultType="mbrChangeTaxiListResponse">
    /*selectChangeTaxiList*/
    SELECT
      ltc.CREATE_DATE  AS createDate
      , ltc.MBR_NO     AS mbrNo
      , lc.CUST_NM     AS custNm
      , ltc.MEM_DIV    AS memDiv
      , cc1.MARK_NAME  AS memDivCd
      , ltc.APV_STATUS AS apvStatusCd
      , cc2.MARK_NAME  AS apvStatus
      , ltc.RID_APV    AS ridApv
      , em1.name       AS apvNm
      , em2.name       AS createBy
      , ltc.RMARK      AS rmark
      , ltc.rid        as rid
      , lm.rid     as ridMbr
      <!-- , ${strColumn} -->
    FROM loy.loy_taxi_conv_rqt  ltc
    LEFT JOIN loy.loy_mbr 		lm  ON lm.MBR_NO = ltc.MBR_NO
    inner join loy.loy_cust 	lc  ON lm.RID_CUST = lc.rid
    LEFT JOIN com.employee 		em1 ON ltc.RID_APV = em1.id
    LEFT JOIN com.crm_user 		f   ON f.rid = ltc.CREATE_BY
    LEFT JOIN com.employee 		em2 ON f.ID_EMPLOYEE = em2.id
    LEFT JOIN com.comm_code cc1 ON cc1.CODE_NAME = ltc.MEM_DIV and cc1.GROUP_CODE = 'MEMBER_TYPE' and  cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 ON cc2.CODE_NAME = ltc.APV_STATUS and cc2.GROUP_CODE = 'REQ_TAXI_STATUS_CD' and cc2.lang=#{lang}  AND cc2.country  = #{country}
    WHERE lm.RID_ORG is null /*단채 회원 제외*/
    AND ${strCondWhere}
    AND ${strSVCType}
      AND ${strWhere}
      <!-- AND ltc.flag = 1 -->
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>

  <select id="selectMbrDiv" parameterType="mbrChangeTaxiListRequest" resultType="mbrChangeTaxiListResponse">
    select *
    from loy.loy_mbr where mbr_no = #{mbrNo} and MEM_DIV!='P'
  </select>

  <select id="selectMbrChangeTaxi" parameterType="mbrChangeTaxiListRequest" resultType="mbrChangeTaxiListResponse">
    select * from  loy.loy_taxi_conv_rqt where mbr_no = #{mbrNo} and APV_STATUS != '30' and APV_STATUS != '40' and APV_STATUS != '50'
  </select>

  <insert id="insertChangeTaxi" parameterType="mbrChangeTaxiListRequest">
    INSERT INTO loy.loy_taxi_conv_rqt
      (RID,
      CREATE_BY,
      MODIFY_BY,
      CREATE_DATE,
      MODIFY_DATE,
      FLAG,
      COUNTRY,
      CURRENCY,
      APP_SERVICE_TYPE,
      ACCNT_ID,
      MBR_NO,
      APV_STATUS,
      RID_APV,
      MEM_DIV,
      RMARK)
    VALUES
    ( com.getNewID('A'),
      #{createBy},
      #{modifyBy},
      sysdate,
      sysdate,
      1,
      #{country},
      'KRW',
      #{appServiceId},
      #{accountId},
      #{mbrNo},
      '10',
      #{ridApv},
      #{memDiv},
      #{rmark})

        <selectKey keyProperty="" resultType="java.lang.String">
           SELECT rid FROM loy.loy_taxi_conv_rqt WHERE mbr_no = #{mbrNo} limit 1
        </selectKey>
  </insert>

    <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 개인택시 전환 요청 여부 update
      -   설명                  : 회원 개인택시 전환 요청 여부 update
      -   결과형태              :
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2018.02.07
      ***************************************/ -->
  <update id="changeMbrIndvTaxiConvRqt" parameterType="mbrChangeTaxiListRequest">
    UPDATE loy.loy_mbr
    SET INDV_TAXI_CONV_RQT = #{indvTaxiConvRqt}
    WHERE 1=1
    AND rid = #{rid}
  </update>




    <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 개인택시 전환 결재 요청
      -   설명                  : 개인택시 전환 결재 요청
      -   결과형태              :
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.27
      ***************************************/ -->
  <update id="requestApprovTaxi" parameterType="mbrChangeTaxiListRequest">
    UPDATE loy.loy_taxi_conv_rqt lct
    SET
    lct.APV_STATUS = 20
    WHERE 1=1
    AND lct.rid = #{rid}
  </update>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 개인택시 전환 결재 요청 취소
      -   설명                  : 개인택시 전환 결재 요청 취소
      -   결과형태              :
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.27
      ***************************************/ -->
  <update id="unReqApprovTaxi" parameterType="mbrChangeTaxiListRequest">
    UPDATE loy.loy_taxi_conv_rqt lct
    SET
    lct.APV_STATUS = 50
    WHERE 1=1
    AND lct.rid = #{rid}
    AND (APV_STATUS = '10' OR APV_STATUS = '20')
  </update>



  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 제휴 TM동의 이력
      -   설명                  : 제휴 TM동의 이력
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.28
      ***************************************/ -->
  <select id="selectMbrTmAgrHistList" parameterType="mbrRequest" resultType="mbrTmAgrHistListResponse">
    /*selectMbrTmAgrHistList*/
    SELECT
      <!-- lct.CPRT_TYPE            AS cprtType -->
      cc1.MARK_NAME as cprtType
      <!-- , lct.CPRT_CMPN_DIV      AS cprtCmpnDiv -->
      , cc2.MARK_NAME as cprtCmpnDiv
      , lct.TM_AGREE_YN        AS tmAgreeYn
      <!-- , lct.TM_AGREE_RCP_CHNL  AS tmAgreeRcpChnl -->
      , cc3.MARK_NAME as tmAgreeRcpChnl
      , lct.TM_AGREE_DD        AS tmAgreeDd
      , lct.RID_CAM            AS ridCam
      , secu.fn_getDecrypt(#{cipherKey},
            lct.MEM_CNTC_DESK,
            'PHONE_NUM2') AS memCntcDesk
      , lct.CHNL_NO            AS chnlNo
      , lct.RMARK              AS rmark
      , lct.CPRT_CMPN_TRM_DT   AS cprtCmpnTrmDt
      , lct.RID_MBR            AS ridMbr
      , lct.rid                AS rid
      <!-- , ${strColumn} -->
    FROM loy.loy_cprt_tm lct
    LEFT JOIN com.comm_code cc1 ON cc1.CODE_NAME = lct.CPRT_TYPE and cc1.GROUP_CODE = 'ALLIANCE_TYPE' and  cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 ON cc2.CODE_NAME = lct.CPRT_CMPN_DIV and cc2.GROUP_CODE = 'ALLIANCE_COMPANY_TYPE' and  cc2.lang=#{lang}  AND cc2.country  = #{country}
    LEFT JOIN com.comm_code cc3 ON cc3.CODE_NAME = lct.TM_AGREE_RCP_CHNL and cc3.GROUP_CODE = 'ALI_TM_AGRE_CHNL' and  cc3.lang=#{lang}  AND cc3.country  = #{country}
    WHERE ${strCondWhere}
    AND ${strSVCType}
      AND ${strWhere}
      <!-- AND lct.flag = 1 -->
      AND lct.rid_mbr = #{rid}
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 회원 차량이력 변경
      -   설명                  : 회원 차량이력 변경
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.10.16
      ***************************************/ -->
  <update id="updateMbrCarHist" parameterType="mbrCarHistRequest">
    UPDATE loy.loy_car_info
            SET
                USE_YN       =#{useYn}
        , AUTO_YN      =#{autoYn}
        , DSPMT        =#{dspmt}
        , CAR_MODEL    =#{carModel}
        , CAR_NM       =#{carNm}
        , CAR_NO       =#{carNo}
        , MAKR         =#{makr}
        , DRIV_DIST    =#{drivDist}
        , MKNG_YY      =#{mkngYy}
        , USE_PRPS     =#{usePrps}
        <if test="insurDd != null and insurDd != ''">
        , INSUR_DD     =#{insurDd}
        </if>
        <if test="insurDd == null or insurDd == ''">
        , INSUR_DD     =null
        </if>
        , ICOM         =#{icom}
        <if test="puDd != null and puDd != ''">
        , PU_DD        =#{puDd}
        </if>
        <if test="puDd == null or puDd == ''">
        , PU_DD     =null
        </if>
                , modify_by =  #{modifyBy}
                , modify_date = sysdate
          WHERE 1=1
            AND rid = #{rid}

  </update>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 개인택시전환 변경
      -   설명                  : 개인택시전환 변경
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.11.29
      ***************************************/ -->
  <update id="updateChangeTaxi" parameterType="mbrChangeTaxiListRequest">
    UPDATE loy.loy_taxi_conv_rqt
            SET
              MBR_NO = #{mbrNo}
        , RID_APV = #{ridApv}
        , MEM_DIV = #{memDiv}
        , RMARK = #{rmark}
                , modify_by =  #{modifyBy}
                , modify_date = sysdate
          WHERE 1=1
            AND rid = #{rid}

  </update>

  <update id="dropMbrProc" parameterType="mbrProcRequest" statementType="CALLABLE">

     { CALL loy.procDeleteMbr('0','JAVA','LOYMbrDAO.java',#{createBy},'Y',#{pResultFlg,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT},
      #{loyProgramId},
      #{accountId},
      #{appServiceId},
      #{country},
      #{cipherKey},
      #{mbrNo},
      #{rsltMsg,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT}) }

  </update>

    <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 단체카드 추가 (사용안함)
      -   설명                  : 단체 카드 추가(사용안함)
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.12.06
      ***************************************/ -->
    <insert id="insertMbrGroupCard" parameterType="mbrGroupCardRequest">
        INSERT INTO loy.loy_mbr_card
      (RID,
      CREATE_BY,
      MODIFY_BY,
      CREATE_DATE,
      MODIFY_DATE,
      FLAG,
      COUNTRY,
      CURRENCY,
      APP_SERVICE_TYPE,
      ACCNT_ID,
      RID_MBR,
      CARD_NO,
      RID_CARD_KIND,
      STAT)
    VALUES
    ( com.getNewID('A'),
      #{createBy},
      #{modifyBy},
      sysdate,
      sysdate,
      1,
      #{country},
      'KRW',
      #{appServiceId},
      #{accountId},
      #{ridMbr},
      #{cardNo},
      (select rid from loy.loy_card_kind where card_type = #{cardKindCd}),
      #{stat})

        <selectKey keyProperty="" resultType="java.lang.String">
           SELECT rid FROM loy.loy_mbr_card WHERE RID_MBR = #{ridMbr} limit 1
        </selectKey>

    </insert>


  <update id="joinMbrProc" parameterType="mbrProcRequest" statementType="CALLABLE">
   { CALL loy.procJoinMbr('0','JAVA','LOYMbrDAO.java',#{createBy},'Y',#{pResultFlg ,mode=OUT ,javaType=java.lang.String,jdbcType=VARCHAR},
      #{loyProgramId}, #{accountId}, #{appServiceId}, #{country}, #{cipherKey}
      , #{name}
      , #{wbMemYn}
      , #{wbMemId}
      , #{identiTypeCd}
      , #{diNo}
      , #{identiVal}
      , #{ipinNo}
      , #{rqtNo}
      , #{authAgegrd}
      , #{altrVrfMsg}
      , #{authReslt}
      , #{ipadr}
      , #{foreignFlg}
      , #{sex}
      , #{ridMnbsnStn}
      , #{homeTelNo}
      , #{hhpNo}
      , #{emailAddr}
      , #{chnlAgreSms}
      , #{chnlAgreEmail}
      , #{addr1JiZip}
      , #{hCity}
      , #{hGu}
      , #{addr1JiDflt}
      , #{addr1JiDtl}
      , #{addr1Zip}
      , #{addr1Dflt}
      , #{addr1Dtl}
      , #{rdAddrConfirm}
      , #{pstmatrRecvDesk}
      , #{lunarGbnCd}
      , #{birthDay}
      , #{marryYn}
      , #{marryAniv}
      , #{spousLunarGbnCd}
      , #{spousBthday}
      , #{carModel}
      , #{mkngYy}
      , #{usePrps}
      , 'Y'
      , 'Y'
      , 'Y'
      , #{cprtCmpnDiv}
      , null
      , null
      , null
      , null
      , null
      , null
      , null
      , #{smartphPssnYn}
      , #{carNo}
      , #{pntUsePw}
      , #{phCertiYn}
      , #{sbscChnlCd}
      , #{pRslt,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT}
      , #{pRsltMsg,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT}
      , #{pMbrRid,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT}
      , #{pMbrNo,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT}
      ,'N'
      ,'N'
      ,'N'
      ,'N'
      ,null
      ,null
      ,null
      ,null
      ) }
  </update>




<!--
in  pIsConTran    int          /*필수: 1: 트랜젝션 처리 안함, 0:트랜젝션 start*/
, in  pParJobCd     varchar(200) /*본 프로시저를 호출한 프로그램(SP,JAVA...)명*/
, in  pJobGrpCd     varchar(24)  /*인터페이스 ID*/
, in  pCreateBy     varchar(100) /*최초 실행자 rid*/
, in  pPrintYn      varchar(1)   /*OUTPUT 파라미터조회 여부 (Y:조회,N:생략)*/
, out pResultFlg    char(2)      /*필수: 실행 결과 S:성공,F:실패*/
# ==========================================================================================
, in pRidPgm              varchar(32)
, in pAccountId             varchar(32)
, in pAppServiceId            varchar(32)
, in pCountry             varchar(2)
, in pCipherKey           varchar(100)

, in pMember_Name             varchar(400)  name
, in pWeb_Member_YN         varchar(1)    wbMemYn
, in pWeb_Login               varchar(100)  wbMemId
, in pIpin_Certification_Method     varchar(32)   identiTypeCd
, in pMember_Check_Code         varchar(200)  diNo
, in pMember_CI_Key             varchar(100)  identiVal
, in pI_Pin                 varchar(60)   ipinNo
, in pIpin_Request_Num            varchar(100)  rqtNo
, in pIpin_Age                  varchar(60)1  authAgegrd
, in pIpin_Certification_Msg        varchar(200)  altrVrfMsg
, in pIpin_Certification_Result     varchar(60)   authReslt
, in pIpin_Ip_Addr              varchar(100)  ipadr
, in pForeign_Flg             varchar(60)   foreignFlg
, in pSex_MF                varchar(32)   sex
, in pAccount_Code          varchar(32)   ridMnbsnStn
, in pHome_Phone              varchar(200)  homeTelNo
, in pCellular_Phone            varchar(200)  hhpNo
, in pEmail_Address           varchar(200)  emailAddr
, in pSuppress_SMS            varchar(1)    chnlAgreSms
, in pSuppress_All_Emails       varchar(1)    chnlAgreEmail
#, in pSuppress_APP_News        varchar(1)    appNewsYn
#, in pSuppress_APP_Benefit       varchar(1)    appBenefitYn
, in pHome_Zip_Code             varchar(60)   addr1JiZip
, in pHome_Addr1            varchar(100)  hCity
, in pHome_Addr2            varchar(100)  hGu
, in pHome_Addr3            varchar(200)  addr1JiDflt
, in pHome_Continent          varchar(200)  addr1JiDtl
, in pHome_RD_Zip_Code        varchar(60)   addr1Zip
, in pHome_RD_Addr3           varchar(200)  addr1Dflt
, in pHome_RD_Continent         varchar(320)  addr1Dtl
, in pHome_RD_Addr_Confirm        varchar(1)    rdAddrConfirm
, in pPost_Loc              varchar(60)   pstmatrRecvDesk
, in pBirthDay_Type           varchar(32)   lunarGbnCd
, in pBirthDay              varchar(8)    birthDay
, in pMarried_YN            varchar(1)    marryYn
, in pMarried_Date            varchar(8)    marryAniv
, in pPartner_Birthday_Type       varchar(60)   spousLunarGbnCd
, in pPartner_Birthday          varchar(8)    spousBthday
, in pCar_Model             varchar(60)   carModel
, in pCar_Year              varchar(100)  mkngYy
, in pCar_Use             varchar(1000) usePrps
, in pMy_Info_Dev_Agree_Flag      varchar(1)    mktAgreThirdSnd
, in pAgree_UseTerms          varchar(1)    termsAgreeFlg
, in pAgree_Privatetrust        varchar(1)    mktAgrePrvInfo
, in pAliance_Channel         varchar(60)   cprtCmpnDiv
, in pAlianceFlg_EI           varchar(1)    null
, in pAlianceFlg_HC           varchar(1)    null
, in pAlianceFlg_LC           varchar(1)    null
, in pAlianceFlg_IBK          varchar(1)    null
, in pAlianceFlg_KB           varchar(1)    null
, in pAlianceFlg_WOORI          varchar(1)    null
, in pAlianceFlg_HM           varchar(1)    null
, in pE1_Smart_Phone_Flag       varchar(1)    smartphPssnYn
, in pCar_Num             varchar(100)  carNo
, in pCardPassword            varchar(200)  pntUsePw
, in pE1_Cell_Phone_Certified_Flg    varchar(1)   phCertiYn
, in pE1_Cell_Phone_Certified_Date   datetime   phCertDt
, in pMember_Channel          varchar(60)   sbscChnlCd
, out pRslt               varchar(1)    pRslt
, out pRsltMsg            varchar(10000)  pRsltMsg
, out pMbrRid           varchar(32)   pMbrRid
, out pMbrNo            varchar(20)   pMbrNo
, in pAgree_LocationInfo        varchar(1)
, in pAgree_MktPrmEvt         varchar(1)
, in pSuppress_APP_PUSH       varchar(1)
, in pSuppress_KKaTlk       varchar(1)
-->




  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 단체회원 상태 변경
      -   설명                  : 단체회원 상태 변경
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2017.12.
      ***************************************/ -->
  <update id="updateMbrGroupStat" parameterType="mbrGroupAddInfoRequest">
    UPDATE loy.loy_mbr
            SET MBR_STAT_CD =  #{mbrStatCd}
                ,modify_by =  #{modifyBy}
                ,modify_date = sysdate
          WHERE 1=1
            AND rid = #{rid}
  </update>

	<!-- 암호화 필드인가? -->
 	<select id="checkIsIncodingCol" parameterType="mbrChgHistRequest" resultType="java.lang.String">
   <!--      SELECT concat('',(SELECT ATTRIB03
            FROM mkt.mkt_srch_col_list
            WHERE country = #{country}
              AND tbl_eng_nm IN ('loy_mbr' , 'loy_cust')
              AND col_eng_nm = #{chgCol}
            LIMIT 1) IS NULL) as isRtn -->
		SELECT
     		CASE WHEN   (SELECT ATTRIB03
            FROM mkt.mkt_srch_col_list
            WHERE country = #{country}
              AND LOWER(tbl_eng_nm) IN ('loy_mbr' , 'loy_cust')
              AND UPPER(col_eng_nm) = UPPER(#{chgCol})
             AND rownum =1)
         IS NULL THEN 1 ELSE 0 END AS  isRtn
             FROM dual
  	</select>

	<!-- 변경이력대상 컬럼인가? -->
  <select id="checkIsTargetCol" parameterType="mbrChgHistRequest" resultType="java.lang.String">
     <!--    SELECT concat('',(SELECT ATTRIB01
            FROM mkt.mkt_srch_col_list
            WHERE country = #{country}
              AND tbl_eng_nm IN ('loy_mbr' , 'loy_cust')
              AND col_eng_nm = #{chgCol}
            LIMIT 1) IS NULL) as isRtn -->
	SELECT
		CASE WHEN (
					SELECT ATTRIB01 FROM mkt.mkt_srch_col_list
		            WHERE country = #{country}
		              AND LOWER(tbl_eng_nm) IN ('loy_mbr' , 'loy_cust')
		              AND UPPER(col_eng_nm) = UPPER(#{chgCol})
		              AND rownum = 1
		     ) IS NULL THEN 1
             ELSE 0 END AS isRtn
	FROM dual

  </select>

  <select id="selectMbrValue" parameterType="mbrChgHistRequest" resultType="java.lang.String">
	select
		secu.fn_getDecrypt(
			  #{cipherKey}
			, (SELECT ${chgCol} FROM loy.loy_mbr lm LEFT JOIN loy.loy_cust lc ON lm.rid_cust = lc.rid WHERE lm.rid = #{ridMbr})
			, null) as retrnValue
	from dual
  </select>

  <update id="updateMbrTaxiApproValue" parameterType="mbrChangeTaxiListRequest">
    UPDATE loy.loy_taxi_conv_rqt ltc
    LEFT JOIN loy.loy_mbr lm on ltc.MBR_NO = lm.MBR_NO
    SET lm.MEM_DIV = 'T'
      , lm.TAXI_CH_DT = sysdate
      , ltc.APV_STATUS = '30'
      , ltc.RID_APV  = #{empId}
      , lm.INDV_TAXI_CONV_RQT = 'N'
    WHERE ltc.rid = #{rid}
  </update>

  <update id="updateTaxiValue" parameterType="mbrChangeTaxiListRequest">
    UPDATE loy.loy_taxi_conv_rqt ltc
    SET ltc.APV_STATUS = '40'
    WHERE ltc.rid = #{rid}
  </update>

  <update id="updateMbrTaxiCardValue" parameterType="mbrChangeTaxiListRequest">
    UPDATE loy.loy_mbr_card lmc
    SET lmc.TAXI_PNT_TRT_CD = 'A'
    WHERE 1=1
    AND lmc.RID_MBR = #{ridMbr}
    AND (nvl(lmc.CPRT_CARD_CD,'') != 'LC' or nvl(lmc.CPRT_CARD_ITEM_CD,'') != '2')
  </update>

  <insert id="insertMbrTaxiCngHist" parameterType="mbrChangeTaxiListRequest">
    INSERT INTO loy.loy_taxi_conv_hst(
      RID,
      CREATE_BY,
      MODIFY_BY,
      CREATE_DATE,
      MODIFY_DATE,
      FLAG,
      COUNTRY,
      CURRENCY,
      APP_SERVICE_TYPE,
      ACCNT_ID,
      CONV_SBST,
      CONV_DT,
      RID_MBR,
      LAST_MEM_STATUS
    ) VALUES(
      com.getNewID('A'),
        #{createBy},
        #{modifyBy},
        sysdate,
        sysdate,
        1,
        #{country},
        'KRW',
        #{appServiceId},
        #{accountId},
        #{convSbst},
        sysdate,
        #{ridMbr},
        #{lastMemStatus}
    )
  </insert>

  <update id="updateMemDivValue" parameterType="mbrItemRequest">
        update  loy.loy_mbr
           set  MEM_DIV = #{memDiv}
           , INDV_TAXI_CONV_RQT = 'N'
          where rid =  #{rid}
    </update>

    <insert id="insertMbrGroupUser" parameterType="mbrGroupClubResquest">
      INSERT INTO loy.loy_chnl_mbr
      (RID,
      CREATE_BY,
      MODIFY_BY,
      CREATE_DATE,
      MODIFY_DATE,
      FLAG,
      COUNTRY,
      APP_SERVICE_TYPE,
      ACCNT_ID,
      RID_MBR,
      RID_CHNL,
      REG_DT,
      ACTIVE_FLG)
    VALUES
      ( com.getNewID('A'),
          #{createBy},
          #{modifyBy},
          sysdate,
          sysdate,
          1,
          #{country},
          #{appServiceId},
          #{accountId},
      #{ridMbr},
      #{ridChnl},
      sysdate,
      #{activeFlg})
    <selectKey keyProperty="" resultType="java.lang.String">
       SELECT rid FROM loy.loy_chnl_mbr WHERE RID_CHNL = #{ridChnl} limit 1
    </selectKey>
    </insert>


  <update id="dropMbrGroupUser" parameterType="mbrGroupClubResquest">
        update  loy.loy_chnl_mbr
           set  ACTIVE_FLG = 'Y'
              , del_dt = sysdate
          where rid_chnl =  #{ridChnl}
          and   rid_mbr = #{ridMbr}
    </update>

    <select id="selectMbrGroupUser" parameterType="mbrGroupClubResquest" resultType="mbrGroupClubListResponse">
        select lcm.rid as rid
        FROM loy.loy_chnl_mbr lcm
        where rid_chnl =  #{ridChnl}
          and   rid_mbr = #{ridMbr}
  </select>

  <insert id="insertVocActyHist" parameterType="mbrChnlHistListRequest">
    INSERT INTO voc.voc_atvy_hist
      (RID,
      CREATE_BY,
      MODIFY_BY,
      CREATE_DATE,
      MODIFY_DATE,
      FLAG,
      COUNTRY,
      APP_SERVICE_TYPE,
      ACCNT_ID,
      ATVY_TYPE,
      ATVY_SUB_TYPE,
      <!-- ACD_CALL_DURATION, -->
      CREATOR_LOGIN,
      RID_CUST,
      CHNL_SEND_DT,
      <if test="chnlType == &quot;email&quot;">
      EMAIL_TRM_DT,
      MSG_SUBJECT,
      </if>
      <!-- EMAIL_OPEN_DT,
      EMAIL_TRM_FAIL_RSN, -->
      <if test="chnlType == &quot;sms&quot;">
      SMS_TRM_DT,
      </if>
      <!-- SMS_RPY_YN,
      SMS_RPY_FAIL_RSN, -->
      <!-- IVR_SVC_TYPE, -->
      CALL_ID,
      COMMENTS_LONG,
      RID_SVCREQ<!--
      SMS_RPY_MSG,
      SMS_RPY_DT, --><!--
      ACT_CREATED_DT,
      SMS_RPY_CD -->
      )
    VALUES
      ( #{rid},
          #{createBy},
          #{modifyBy},
          sysdate,
          sysdate,
          1,
          #{country},
          #{appServiceId},
          #{accountId},
      #{atvyType},
      #{atvySubType},
      <!-- #{acdCallDuration}, -->
      #{creatorLogin},
      #{ridCust},
      sysdate,
      <if test="chnlType == &quot;email&quot;">
      sysdate,
      #{msgSubject},
      </if>

      <!-- #{emailOpenDt},
      #{emailTrmFailRsn}, -->
      <if test="chnlType == &quot;sms&quot;">
      sysdate,
      </if>
      <!-- #{smsRpyYn},
      #{smsRpyFailRsn}, -->
      <!-- #{ivrSvcType}, -->
      #{callId},
      #{comments},
      #{ridSvcreq}<!--
      #{smsRpyMsg},
      #{smsRpyDt}, --><!--
      #{actCreatedDt},
      #{smsRpyCd} -->
      )
    </insert>




    <update id="updateMbrName" parameterType="mbrRenameRequest">
<!--            UPDATE loy.loy_mbr lm
           LEFT JOIN loy.loy_cust lc ON lm.RID_CUST = lc.rid
       SET lc.CUST_NM = #{newName}
       	 	,lc.modify_date = sysdate
       where lm.rid = #{rid} -->
       <!-- , lm.MBR_HID_NM = #{newName}
        , lr.modify_date = sysdate
       , lr.renm_yn = 'Y'
       where lr.rid = #{rid} -->

       UPDATE loy.loy_cust
       set cust_nm = #{newName}
          ,modify_date = sysdate
       where rid = (select rid_cust from loy.loy_mbr where rid = #{rid})
      </update>



      <select id="selectMbrRename" parameterType="mbrRenameRequest" resultType="mbrRenameResponse">
      SELECT lr.RID_MBR
      FROM loy.loy_renm_rqt lr
      WHERE lr.RID_MBR = #{ridMbr}
      AND lr.RENM_YN ='N'
      </select>

      <select id="selectapprovTaxiInfo" parameterType="mbrChangeTaxiListRequest" resultType="mbrChangeTaxiListResponse">
      SELECT lm.rid AS ridMbr
      , lm.MBR_NO AS mbrNo
      FROM loy.loy_taxi_conv_rqt ltc
      INNER JOIN loy.loy_mbr lm ON ltc.MBR_NO = lm.MBR_NO
      WHERE ltc.rid = #{rid}
      </select>

      <select id="selectTaxiInfo" parameterType="mbrChangeTaxiListRequest" resultType="changeTaxiResponse">
      SELECT
          ltc.MBR_NO AS mbrNo,
          lc.CUST_NM AS custNm,
          ltc.MEM_DIV AS memDiv,
          ltc.RID_APV AS ridApv,
          em1.name AS apvNm,
          em2.name AS createBy,
          ltc.RMARK AS rmark,
          ltc.APV_STATUS AS apvStatusCd,
          ltc.rid AS rid,
          lm.rid AS ridMbr
      FROM loy.loy_taxi_conv_rqt ltc
      LEFT JOIN loy.loy_mbr lm ON lm.MBR_NO = ltc.MBR_NO
      INNER JOIN loy.loy_cust lc ON lm.RID_CUST = lc.rid
      LEFT JOIN com.employee em1 ON ltc.RID_APV = em1.id
      LEFT JOIN com.crm_user f ON f.rid = ltc.CREATE_BY
      LEFT JOIN com.employee em2 ON f.ID_EMPLOYEE = em2.id
      WHERE ltc.rid = #{rid}
      </select>

      <insert id="insertMbrTmAgrHist" parameterType="mbrTmAgrHistRequest">
        INSERT INTO loy.loy_cprt_tm
        (RID,
        CREATE_BY,
        MODIFY_BY,
        CREATE_DATE,
        MODIFY_DATE,
        FLAG,
        COUNTRY,
        CURRENCY,
        APP_SERVICE_TYPE,
        ACCNT_ID,
        CPRT_CMPN_DIV,
        <if test="cprtCmpnTrmDt != null and cprtCmpnTrmDt != ''">
        CPRT_CMPN_TRM_DT,
        </if>
        CPRT_TYPE,
        RMARK,
        MEM_CNTC_DESK,
        <if test="tmAgreeYn == &quot;Y&quot;">
        TM_AGREE_DD,
        </if>
        TM_AGREE_YN,
        TM_AGREE_RCP_CHNL,
        RID_MBR,
        RID_CAM,
        CHNL_NO)
      VALUES
        (com.getNewID('A'),
        #{createBy},
        #{modifyBy},
        sysdate,
        sysdate,
        1,
        #{country},
        'KRW',
        #{appServiceId},
        #{accountId},
        #{cprtCmpnDiv},
        <if test="cprtCmpnTrmDt != null and cprtCmpnTrmDt != ''">
        #{cprtCmpnTrmDt},
        </if>
        #{cprtType},
        #{rmark},
        secu.fn_getEncrypt(#{cipherKey}, #{memCntcDesk}),
        <if test="tmAgreeYn == &quot;Y&quot;">
        sysdate,
        </if>
        #{tmAgreeYn},
        #{tmAgreeRcpChnl},
        #{ridMbr},
        #{ridCam},
        #{chnlNo} )

      </insert>


  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 제휴 TM동의 상세
      -   설명                  : 제휴 TM동의 상세
      -   결과형태              :
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2018.01.08
      ***************************************/ -->
  <select id="selectMbrTmAgrInfo" parameterType="MbrTmAgrHistRequest" resultType="mbrTmAgrHistListResponse">
    /*selectMbrTmAgrInfo*/
    SELECT
      lct.CPRT_TYPE            AS cprtType
      , lct.CPRT_CMPN_DIV      AS cprtCmpnDiv
      , lct.TM_AGREE_YN        AS tmAgreeYn
      , lct.TM_AGREE_RCP_CHNL  AS tmAgreeRcpChnl
      , lct.TM_AGREE_DD        AS tmAgreeDd
      , lct.RID_CAM            AS ridCam
      <!-- , lct.MEM_CNTC_DESK      AS memCntcDesk -->
      , secu.fn_getDecrypt(#{cipherKey},
            lct.MEM_CNTC_DESK,
            'PHONE_NUM2') AS memCntcDesk
      , lct.CHNL_NO            AS chnlNo
      , lct.RMARK              AS rmark
      , lct.CPRT_CMPN_TRM_DT   AS cprtCmpnTrmDt
      , lct.RID_MBR            AS ridMbr
      , lct.rid                AS rid
    FROM loy.loy_cprt_tm lct
    LEFT JOIN com.comm_code cc1 ON cc1.CODE_NAME = lct.CPRT_TYPE and cc1.GROUP_CODE = 'ALLIANCE_TYPE' and  cc1.lang=#{lang}  AND cc1.country  = #{country}
    LEFT JOIN com.comm_code cc2 ON cc2.CODE_NAME = lct.CPRT_CMPN_DIV and cc2.GROUP_CODE = 'ALLIANCE_COMPANY_TYPE' and  cc2.lang=#{lang}  AND cc2.country  = #{country}
    LEFT JOIN com.comm_code cc3 ON cc3.CODE_NAME = lct.TM_AGREE_RCP_CHNL and cc3.GROUP_CODE = 'ALI_TM_AGRE_CHNL' and  cc3.lang=#{lang}  AND cc3.country  = #{country}
    WHERE rid=#{rid}
  </select>


  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 제휴 TM동의 수정
      -   설명                  : 제휴 TM동의 수정
      -   결과형태              :
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2018.01.08
      ***************************************/ -->
  <update id="updateMbrTmAgrHist" parameterType="MbrTmAgrHistRequest">
    UPDATE loy.loy_cprt_tm lct
    SET lct.CPRT_TYPE = #{cprtType}
    , lct.CPRT_CMPN_DIV = #{cprtCmpnDiv}
    , lct.TM_AGREE_YN = #{tmAgreeYn}
    , lct.TM_AGREE_RCP_CHNL = #{tmAgreeRcpChnl}
    <if test="tmAgreeYn == &quot;Y&quot;">
    , lct.TM_AGREE_DD = sysdate
    </if>
    <if test="tmAgreeYn == &quot;N&quot;">
    , lct.TM_AGREE_DD = null
    </if>
    , lct.RID_CAM = #{ridCam}
    , lct.RMARK = #{rmark}
    WHERE lct.rid = #{rid}
  </update>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 제휴 TM동의 이력
      -   설명                  : 제휴 TM동의 이력
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : sw.lim
      -   작성일                : 2018.01.08
      ***************************************/ -->
  <select id="selectMbrSemiVipHistList" parameterType="mbrRequest" resultType="mbrSemiVipHistListResponse">
    /*selectMbrSemiVipHistList*/
    SELECT
      lvh.CREATE_DATE as createDate
      , lvh.START_DT as startDt
      , lvh.END_DT as endDt
      , lvh.EXPIRE_DT as  expireDt
      , lvh.rid as rid
      <!-- , ${strColumn} -->
    FROM loy.loy_semi_vip_hist lvh
    WHERE ${strCondWhere}
    AND ${strSVCType}
      AND ${strWhere}
      AND lvh.rid_mbr = #{rid}
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 캠페인 반응이력
      -   설명                  : 캠페인 반응 이력
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : 이성원
      -   작성일                : 2018. 2. 2.
      ***************************************/ -->
  <select id="selectMbrCampaignResListCnt" parameterType="mbrRequest" resultType="java.lang.Integer">
    /* LOYMbr.selectMbrCampaignResListCnt */

    select count(*)
    from (
      SELECT
         b.CAM_NM AS camNm
      ,b.OLD_CAM_SUB_TYPE_CD AS camType
      ,b.CAM_START_DD AS startDt
      ,b.CAM_END_DD AS endDt
      ,a.RESP_TYPE_CD_NM AS chnlType
      ,a.COMM_METHOD_NM AS recStatus
      ,a.OFCR_DIR_FLG AS emailOpenYn
      ,a.ASGN_DT AS respDt
      ,a.DESC_TEXT AS failDesc
      ,a.TRT_NAME AS chnlNm
      from mkt.HIST_CAM_I_RESP  a
      inner join mkt.mkt_cam_mst  b on a.disp_no = b.id
      inner join loy.loy_mbr  c  on a.mbr_no = c.MBR_NO
      AND c.rid  = #{rid}

      UNION ALL

      SELECT
               mcm.CAM_NM AS camNm
               ,mcm.CAM_TYPE_CD as camType
               ,mcm.CAM_START_DD AS startDt
               ,mcm.CAM_END_DD AS endDt
               ,mksl.MSG_SEND_TYPE AS chnlType
               ,(CASE WHEN mksl.SEND_SUCES_YN ='Y' then '전송성공' WHEN mksl.SEND_FAIL_YN ='Y' then '전송실패' END) AS recStatus
               ,'' AS emailOpenYn
               ,null as respDt
               ,mksl.SEND_FAIL_RSN AS failDesc
               ,mksl.MSG_SBST  AS chnlNm
    FROM mkt.mkt_kakao_send_log  mksl
    INNER JOIN mkt.mkt_cam_mst  mcm on mcm.id = mksl.cam_id
    INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mksl.RECV_MEM_ID
    WHERE lm.RID = #{rid}

    UNION ALL

    SELECT
               mcm.CAM_NM AS camNm
               ,mcm.CAM_TYPE_CD as camType
               ,mcm.CAM_START_DD AS startDt
               ,mcm.CAM_END_DD AS endDt
               ,'EMAIL' AS chnlType
               ,(CASE WHEN mesl.SEND_SUCES_YN ='Y' then '전송성공' WHEN mesl.SEND_FAIL_YN ='Y' then '전송실패' END) AS recStatus
               ,mesl.OPEN_SUCES_YN emailOpenYn
               ,mesl.OPEN_SUCES_DT respDt
               ,mesl.SEND_FAIL_RSN AS failDesc
               ,mesl.MSG_SBST  AS chnlNm
    FROM mkt.mkt_email_send_log  mesl
    INNER JOIN mkt.mkt_cam_mst  mcm on mcm.id = mesl.cam_id
    INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mesl.RECV_MEM_ID
    WHERE lm.RID = #{rid}

    UNION ALL

    SELECT
               mcm.CAM_NM AS camNm
               ,mcm.CAM_TYPE_CD as camType
               ,mcm.CAM_START_DD AS startDt
               ,mcm.CAM_END_DD AS endDt
               ,'PUSH' AS chnlType
               ,(CASE WHEN mpsl.SEND_SUCES_YN ='Y' then '전송성공' WHEN mpsl.SEND_FAIL_YN ='Y' then '전송실패' END) AS recStatus
               ,'' emailOpenYn
               ,null as respDt
               ,mpsl.SEND_FAIL_RSN AS failDesc
               ,mpsl.MSG_SBST  AS chnlNm
    FROM mkt.mkt_push_send_log  mpsl
    INNER JOIN mkt.mkt_cam_mst  mcm on mcm.id = mpsl.cam_id
    INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mpsl.RECV_MEM_ID
    WHERE lm.RID = #{rid}

    UNION ALL

    SELECT
               mcm.CAM_NM AS camNm
               ,mcm.CAM_TYPE_CD as camType
               ,mcm.CAM_START_DD AS startDt
               ,mcm.CAM_END_DD AS endDt
               ,mmsl.MSG_SEND_TYPE AS chnlType
               ,(CASE WHEN mmsl.SEND_SUCES_YN ='Y' then '전송성공' WHEN mmsl.SEND_FAIL_YN ='Y' then '전송실패' END) AS recStatus
               ,'' emailOpenYn
               ,null as respDt
               ,mmsl.SEND_FAIL_RSN AS failDesc
               ,mmsl.MSG_SBST  AS chnlNm
    FROM mkt.mkt_msg_send_log  mmsl
    INNER JOIN mkt.mkt_cam_mst  mcm on mcm.id = mmsl.cam_id
    INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mmsl.RECV_MEM_ID
    WHERE lm.RID = #{rid}
    ) a
  </select>

  <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 캠페인 반응이력
      -   설명                  : 캠페인 반응 이력
      -   결과형태              : 목록
      ============================================
      -   입력
      ============================================
      -   작성자                : 이성원
      -   작성일                : 2018. 2. 2.
      ***************************************/ -->
  <select id="selectMbrCampaignResList" parameterType="mbrRequest" resultType="MbrCampResResponse">
    /* LOYMbr.selectMbrCampaignResList */

    SELECT
         b.CAM_NM AS camNm
      ,b.OLD_CAM_SUB_TYPE_CD AS camType
      ,b.CAM_START_DD AS startDt
      ,b.CAM_END_DD AS endDt
      ,a.RESP_TYPE_CD_NM AS chnlType
      ,a.COMM_METHOD_NM AS recStatus
      ,a.OFCR_DIR_FLG AS emailOpenYn
      ,a.ASGN_DT AS respDt
      ,a.DESC_TEXT AS failDesc
      ,a.TRT_NAME AS chnlNm
      from mkt.HIST_CAM_I_RESP  a
      inner join mkt.mkt_cam_mst  b on a.disp_no = b.id
      inner join loy.loy_mbr  c  on a.mbr_no = c.MBR_NO
      AND c.rid  = #{rid}

      UNION ALL

      SELECT
               mcm.CAM_NM AS camNm
               ,mcm.CAM_TYPE_CD as camType
               ,mcm.CAM_START_DD AS startDt
               ,mcm.CAM_END_DD AS endDt
               ,mksl.MSG_SEND_TYPE AS chnlType
               ,(CASE WHEN mksl.SEND_SUCES_YN ='Y' then '전송성공' WHEN mksl.SEND_FAIL_YN ='Y' then '전송실패' END) AS recStatus
               ,'' AS emailOpenYn
               ,null as respDt
               ,mksl.SEND_FAIL_RSN AS failDesc
               ,mksl.MSG_SBST  AS chnlNm
    FROM mkt.mkt_kakao_send_log  mksl
    INNER JOIN mkt.mkt_cam_mst  mcm on mcm.id = mksl.cam_id
    INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mksl.RECV_MEM_ID
    WHERE lm.RID = #{rid}

    UNION ALL

    SELECT
               mcm.CAM_NM AS camNm
               ,mcm.CAM_TYPE_CD as camType
               ,mcm.CAM_START_DD AS startDt
               ,mcm.CAM_END_DD AS endDt
               ,'EMAIL' AS chnlType
               ,(CASE WHEN mesl.SEND_SUCES_YN ='Y' then '전송성공' WHEN mesl.SEND_FAIL_YN ='Y' then '전송실패' END) AS recStatus
               ,mesl.OPEN_SUCES_YN emailOpenYn
               ,mesl.OPEN_SUCES_DT respDt
               ,mesl.SEND_FAIL_RSN AS failDesc
               ,mesl.MSG_SBST  AS chnlNm
    FROM mkt.mkt_email_send_log  mesl
    INNER JOIN mkt.mkt_cam_mst  mcm on mcm.id = mesl.cam_id
    INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mesl.RECV_MEM_ID
    WHERE lm.RID = #{rid}

    UNION ALL

    SELECT
               mcm.CAM_NM AS camNm
               ,mcm.CAM_TYPE_CD as camType
               ,mcm.CAM_START_DD AS startDt
               ,mcm.CAM_END_DD AS endDt
               ,'PUSH' AS chnlType
               ,(CASE WHEN mpsl.SEND_SUCES_YN ='Y' then '전송성공' WHEN mpsl.SEND_FAIL_YN ='Y' then '전송실패' END) AS recStatus
               ,'' emailOpenYn
               ,null as respDt
               ,mpsl.SEND_FAIL_RSN AS failDesc
               ,mpsl.MSG_SBST  AS chnlNm
    FROM mkt.mkt_push_send_log  mpsl
    INNER JOIN mkt.mkt_cam_mst  mcm on mcm.id = mpsl.cam_id
    INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mpsl.RECV_MEM_ID
    WHERE lm.RID = #{rid}

    UNION ALL

    SELECT
               mcm.CAM_NM AS camNm
               ,mcm.CAM_TYPE_CD as camType
               ,mcm.CAM_START_DD AS startDt
               ,mcm.CAM_END_DD AS endDt
               ,mmsl.MSG_SEND_TYPE AS chnlType
               ,(CASE WHEN mmsl.SEND_SUCES_YN ='Y' then '전송성공' WHEN mmsl.SEND_FAIL_YN ='Y' then '전송실패' END) AS recStatus
               ,'' emailOpenYn
               ,null as respDt
               ,mmsl.SEND_FAIL_RSN AS failDesc
               ,mmsl.MSG_SBST  AS chnlNm
    FROM mkt.mkt_msg_send_log  mmsl
    INNER JOIN mkt.mkt_cam_mst  mcm on mcm.id = mmsl.cam_id
    INNER JOIN loy.loy_mbr  lm on lm.MBR_NO = mmsl.RECV_MEM_ID
    WHERE lm.RID = #{rid}
      <!-- AND ${strWhere} -->
      ${strEndPaging}


  </select>

  <select id="selectMbrCouponTrnsList" parameterType="mbrRequest" resultType="mbrCouponTrnsResponse">
    /* LOYMbr.selectMbrCouponTrnsList */
    SELECT
      t1.disp_no        AS dispNo
        , t1.CAM_NM       AS camNm
        , t3.COUPN_NM       AS coupnNm
        , t3.COUPN_USE_GDNC1  AS coupnUseGdnc1
        , t3.USE_START_DT     AS useStartDt
        , t3.USE_END_DT     AS useEndDt
        , t4.coupn_no       AS coupnNo
        , t4.USE_YN       AS useYn
        , t4.USE_DT       AS useDt
        <!-- , ${strColumn} -->
    FROM mkt.mkt_cam_mst t1
    JOIN loy.loy_coupn t3 ON t3.flag = 1 AND t3.rid_mkt_cam_mst = t1.id
    JOIN loy.loy_coupn_i t4 ON t4.flag = 1 AND t4.rid_coupn = t3.rid
    JOIN loy.loy_mbr lm ON lm.flag = 1 AND lm.rid = t4.rid_mbr
    WHERE ${strSVCType}
      AND ${strWhere}
      AND lm.MBR_NO  = #{mbrNo}
      ORDER BY ${strOrderby}
      ${strEndPaging}
  </select>

  <!-- 회원 전체 건수 -->
  <select id="selectMbrAllCount" resultType="java.lang.Integer">
    /* LoyMbr.selectMbrAllCount */
    select count(*)
      from loy.loy_mbr lm
     where lm.MBR_TYPE_CD = '10'
       and lm.MBR_STAT_CD &lt;&gt; '20'
  </select>

  <!-- 휴대폰 삭제 -->
  <update id="delPhoneNum" parameterType="mbrRequest">
         UPDATE loy.loy_mbr lm
     SET lm.HHP_NO = #{hhpNo}
     , lm.CHNL_AGRE_SMS = #{chnlAgreSms}
     , lm.modify_date = sysdate
     , lm.modify_by = #{modifyBy}
     where lm.rid = #{rid}
    </update>

	<!-- B2C 포인트 정보 조회 -->
	<!-- 소멸 예정월은 조회하는 달 -1월료 화면에 표시 바랍니다. 예시) 2018년 11월 -->
    <select id="selectPontBalanceB2c" parameterType="loyPontBalanceB2cRequest" statementType="CALLABLE">
        { call loy.PROC_POINT_BALANCE_B2C(
                #{rid},
                #{p_Rst,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT},
                #{p_RstCd,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT},
                #{p_RstMsg,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT},
                #{p_UsePnt,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT},
                #{p_AccrualPnt,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT},
                #{p_Expr1MonthPnt,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT},
                #{p_PreAcrlPnt,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT} )
        }
    </select>


    <!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java (addVocPntTxn)
    ============================================
    -   제목                  : VOC 포인트 등록
    -   설명                  : VOC 포인트 등록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : jh.kim
    -   작성일                : 2018-10-25
    ***************************************/ -->
	<insert id="insertVocPntTxn" parameterType="loyVocPntTxnRequest" >
		/* LOYMbr.insertVocPntTxn */
		insert into loy.loy_pnt_txn (
			  rid
			, create_by
			, modify_by
			, create_date
			, modify_date
			, flag
			, country
			, currency
			, app_service_type
			, type
			, accnt_id
			, rid_pgm
			, rid_mbr
			, pnt_amt 			<!-- 발생 포인트 -->
			, pnt_txn_type_1_cd <!-- 포인트유형  -->
			, pnt_txn_type_2_cd
			, mod_num
		)
		values (
			  #{rid}
			, #{createBy}
			, #{modifyBy}
			, sysdate
			, sysdate
			, 1
			, #{country}
			, (SELECT currency FROM com."LANGUAGE" WHERE lang = #{lang})
			, #{appServiceId}
			, #{type}
			, #{accountId}
			, #{ridPgm}
			, #{ridMbr}
			, #{pntAmt}
			, #{pntTxnType_1Cd}
			, #{pntTxnType_2Cd}
			, 0
		)
	</insert>

	<!-- 암호화 -->
	<select id="getEncryptValue" parameterType="loyEncryptRequest" resultType="java.lang.String">
		select
			secu.fn_getEncrypt(
				  #{cipherKey}
				, #{value}
				) as retrnValue
			from dual
	</select>

	<!-- 복호화 -->
	<select id="getDecryptValue" parameterType="loyEncryptRequest" resultType="java.lang.String">
		select
			secu.fn_getDecrypt(
				  #{cipherKey}
				, #{value}
				, #{decryptType}) as retrnValue
			from dual
	</select>

	<!-- 변경이력 저장 프로시저 실행 -->
	<update id="insertMbrCngHist" parameterType="loyMbrChgHistAddRequest" statementType="CALLABLE">
		/* LOYMbr.insertMbrCngHist */
		{
			CALL LOY.PROC_MBR_CHG_HIST_INS(
				  #{cipherKey}	/*암복호화키*/
				, #{createBy}	/*최초 실행자 rid*/
				, #{chgTbl}		/*변경 대상 테이블*/
				, #{bchngData}  /*변경전 데이터(Before Change Data)*/
				, #{bchngEnYn}  /*변경전 데이터 암호화 상태*/
				, #{achngData}  /*변경된 데이터(After Change Data)*/
				, #{achngEnYn}	/*변경된 데이터 암호화 상태*/
				, #{chgCol}     /*변경된 컬럼*/
				, #{rmark}     	/*비고*/
				, #{mbrNo}      /*변경이력등록대상 회원번호*/
				, #{chgColLov}  /*변경된 컬럼 LOV값*/
				, #{chgPstn}    /*변경 위치*/
				, #{rsltMsg,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT}
				, #{resultFlg,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT} /*필수: 실행 결과 S:성공,F:실패*/
			)
		}
	</update>

	<insert id="insertLoyIntactVoc" parameterType="LOYMbrLoyIntactVocRequest">
		/* LOYMbr.insertLoyIntactVoc */
		insert into loy.loy_intact_voc (
			rid
			, rid_intact_type
			, occu_date
			, rid_mbr
			, rid_chnl
			, calc_cmplt_date
			, cmplt_date
			, acrl_excpt_reas_cd
			, voc_no
			, voc_reas_cd
			, voc_reqby
			, rcpt_no
			, voc_req_amt
			, offer_id
			, voc_desc
			, pnt_txn_type
			, pnt_txn_dtl_type
			, accnt_id
			, app_service_type
			, country
			, create_by
			, modify_by
			, rid_mkt_cam_mst
		) values (
			#{rid}
			, (SELECT RID FROM loy.LOY_INTACT_TYPE WHERE INTACT_TYPE_1_CD = #{pntTxnType_1Cd} AND INTACT_TYPE_2_CD = #{pntTxnType_2Cd} AND FLAG = 1)
			, to_date(#{occuDate}, 'yyyy-mm-dd hh24:mi:ss')
			, #{ridMbr}
			, (select rid from loy.loy_channel where chnl_no = #{chnlNo})
			, #{calcCmpltDate}
			, #{cmpltDate}
			, #{acrlExcptReasCd}
			, #{vocNo}
			, #{vocReasCd}
			, #{vocReqby}
			, #{rcptNo}
			, #{vocReqAmt}
			, #{offerId}
			, #{vocDesc}
			, #{pntTxnType}
			, #{pntTxnDtlType}
			, #{accountId}
			, #{appServiceId}
			, #{country}
			, #{vocReqby}
			, #{vocReqby}
			, #{ridMktCamMst}
		)
	</insert>

	<select id="getIntactTypeRid" parameterType="LOYMbrLoyIntactVocRequest" resultType="java.lang.String">
		/* LOYMbr.getIntactTypeRid */
		SELECT RID
		FROM loy.LOY_INTACT_TYPE
		WHERE INTACT_TYPE_1_CD = #{pntTxnType_1Cd} AND INTACT_TYPE_2_CD = #{pntTxnType_2Cd} AND FLAG = 1
	</select>

	<!-- 회원 별 소멸된 포인트 목록 조회 -->
	<select id="selectDormancyPntListByMbr" parameterType="LOYMbrDormancyPntListRequest" resultType="LOYMbrDormancyPntListResponse">
		/* LOYMbr.selectDormancyPntListByMbr */
		select	lpt.rid 											as rid
				, lpt.modify_date 									as modifyDate
				, to_char(lpt.txn_dt, 'yyyy-mm-dd hh24:mi:ss') 		as txnDt
				, trunc(lpt.txn_amt, 0) 							as txnAmt
				, to_char(lpt.appr_dt, 'yyyy-mm-dd hh24:mi:ss') 	as apprDt
				, trunc(lpt.pnt_amt, 0) 							as pntAmt
				, CASE WHEN nvl(lpa.VALID_START_DATE,'') IS not null THEN to_char(lpa.VALID_START_DATE, 'YYYY-MM-DD') || ' ~ ' || to_char(lpa.VALID_END_DATE, 'YYYY-MM-DD') ELSE '' end as validDate
				, mcm.cam_nm 										as camNm
				, lc.chnl_nm 										as chnlNm
				, ${strColumn}
		from 	loy.loy_pnt_txn lpt
		left join 	loy.loy_pnt_acrl lpa on lpt.rid = lpa.rid_pnt_txn
		left join mkt.mkt_cam_mst mcm on mcm.disp_no = lpa.cam_no
		left join 	loy.loy_channel lc on lc.rid = lpt.rid_chnl
		where 	lpt.rid_mbr = #{ridMbr}
			and lpt.pnt_txn_type_1_cd = '200' <!-- 사용 -->
			and lpt.pnt_txn_type_2_cd in ('220', '263') <!-- 소멸 -->
			and ${strSVCType}
			and ${strWhere}
		ORDER BY ${strOrderby}
		${strEndPaging}
	</select>
	<select id="selectDupMbrList" parameterType="mbrRequest" resultType="LOYDupMbrListResponse">
		  SELECT   TO_CHAR (wmd.MEM_CREATEDATETIME,'YYYY-MM-DD HH:mm:ss')	  AS memcreDt	 	--회원가입일
		  		  ,c1.mark_name										  	  AS mbrStCd		--회원상태
		  		  ,wmd.AUTH_YN											  AS authYn			--본인인증여부
		  		  ,wmd.MBR_NO											  AS mbrNo			--회원번호
		  		  ,LOY.FN_GET_MBRNM_MASKING(wmd.CUST_NM)			      AS custNm			--고객명
		  		  ,secu.fn_getDecrypt(#{cipherKey},wmd.HHP_NO,'PHONE_NUM2')AS hpNo			--핸드폰번호
		  		  ,secu.fn_getDecrypt(#{cipherKey},wmd.EMAIL_ADDR, 'EML') AS emailaddr		--이메일
		  		  ,wmd.BIRTH_DT											  AS birthDt		--생년원일
		  		  ,TO_CHAR(wmd.SVR_LAST_DT,'YYYY-MM-DD HH:mm:ss')		  AS svrLastDt		--최종 서비스 일시
		  		  ,wmd.RID_MBR											  AS ridMbr
		  		  ,wmd.RID_CUST											  AS ridCust
		  		  ,TO_CHAR(wmd.LEAVE_DATE,'YYYY-MM-DD')					  AS leaveDt 		--탈퇴일시
		  		  ,wmd.LEAV_REAS_DESC									  AS leaveReas
		  		  ,wmd.CHNL_AGRE_PUSH									  AS chnlAgrePush
		  		  ,wmd.OLD_ID											  AS wpRid
		  		  ,wmd.CHNL_AGRE_SMS									  AS chnlAgreSms
		  		  ,TO_CHAR(wmd.CHNL_AGRE_SMS_DT,'YYYY-MM-DD')			  AS chnlAgreSmsDt
		  		  ,wmd.CHNL_AGRE_PUSH_DT								  AS chnlAgrePushDt
		  		  ,wmd.MKT_AGRE_USE										  AS mktAgrUse
		  		  ,(SELECT DECODE(COUNT(*),0,0,NVL(SUM(usePnt), 0))
                         FROM (SELECT SUM(CASE WHEN  lpaa.VALID_START_DATE &lt;=  TRUNC(sysdate) AND lpaa.VALID_END_DATE &gt;= TRUNC(sysdate) THEN lpaa.BALNC  ELSE 0 END ) AS usePnt
                                 FROM loy.loy_pnt_acrl lpaa
                                 WHERE 1=1
                                   AND lpaa.rid_mbr = wmd.RID_MBR
                                   AND lpaa.OFFER_TYPE_CD= 'POINT')) AS usePnt
                  ,(SELECT DECODE(COUNT(*),0,0,NVL(SUM(preAcrlPnt), 0))
                     	 FROM (SELECT SUM(CASE WHEN lpaa.VALID_START_DATE &gt; TRUNC(SYSDATE) THEN lpaa.BALNC ELSE 0  END ) AS preAcrlPnt
                              FROM loy.loy_pnt_acrl lpaa
                             WHERE 1=1
                               AND lpaa.rid_mbr = wmd.RID_MBR
                               AND lpaa.OFFER_TYPE_CD= 'POINT')) AS preAcrlPnt
		  		  , ${strColumn}
		  	FROM  batch.WIPOINT_MBR_DUP    wmd
		  	left outer join	 com.comm_code 			 c1 	on c1.group_code = 'LOY_MEM_STAT_CD' and c1.code_name = wmd.MBR_STAT_CD and c1.lang = #{lang} and c1.flag = 1
		   WHERE   ${strCondWhere}
		   	 AND wmd.MBR_STAT_CD='A'
		     AND   ${strWhere}<!--
		     AND   ${strSVCType} -->
		ORDER BY   ${strOrderby}
		${strEndPaging}

	</select>

	<select id="selectMbrTermsHistList" parameterType="LOYMbrTermsHistListRequest" resultType="LOYMbrTermsHistListResponse">
		/* LOYMbr.selectMbrTermsHistList */
		<!-- select	lmth.reg_dt as regDt
				, lmth.mkt_agre_prv_info as mktAgrePrvInfo
				, lmth.mkt_agre_lbs_biz as mktAgreLbsBiz
				, lmth.mkt_agre_lbs_svc as mktAgreLbsSvc
				, lmth.mkt_agre_third_snd as mktAgreThirdSnd
				, lmth.mkt_agre_use as mktAgreUse
				, lmth.mbr_terms_agre as mbrTermsAgre
				, lmth.chnl_agre_sms as chnlAgreSms
				, lmth.chnl_agre_tel as chnlAgreTel
				, lmth.chnl_agre_dm as chnlAgreDm
				, lmth.chnl_agre_push as chnlAgrePush
				, lmth.chnl_agre_email as chnlAgreEmail
				, lmth.chnl_agre_kakao as chnlAgreKakao
				, lmth.mkt_agre_prv_ref as mktAgrePrvRef
				, lmth.mkt_agre_parent as mktAgreParent
				, ${strColumn}
		from 	loy.loy_mbr_mkt_agre_hist lmth
		where 	rid_mbr = #{ridMbr}
			and ${strSVCType}
			and ${strWhere}
		ORDER BY ${strOrderby}
		${strEndPaging} -->
		SELECT T1.RID AS rid
		 	 , T1.AGRE_CD AS agreCd
		 	 , C1.MARK_NAME AS agreNm
		 	 , T1.AGRE_YN AS agreYn
		 	 , T2.RID AS ridTerms
		 	 , T2.TERMS_NM AS termsNm
		 	 , T2.VER AS termsVer
		 	 , T1.CREATE_DATE AS createDate
		 	 , ${strColumn}
		  FROM LOY.LOY_MBR_TERMS_HIST T1
		  LEFT OUTER JOIN LOY.LOY_TERMS T2 ON T2.FLAG = 1 AND T2.RID = T1.RID_TERMS
		  LEFT OUTER JOIN COM.COMM_CODE C1 ON C1.FLAG = 1 AND C1.LANG = #{lang} AND C1.GROUP_CODE = 'LOY_CUST_AGRE_TYPE_CD' AND C1.CODE_NAME = T1.AGRE_CD
		 WHERE T1.RID_MBR = #{ridMbr}
			AND ${strSVCType}
			AND ${strWhere}
		ORDER BY ${strOrderby}
		${strEndPaging}
	</select>

	<!-- 회원 포인트사용비밀번호 변경 -->
	<update id="updateMbrPntUsePw" parameterType="LOYMbrEditPntUsePwRequest">
		/* LOYMbr.updateMbrPntUsePw */
		update	loy.loy_mbr
		set 	pnt_use_pw = #{pntUsePw}
		where 	rid = #{ridMbr}
			and pnt_use_pw != #{pntUsePw}
	</update>

	<!-- 회원 기존 포인트사용비밀번호 조회 -->
	<select id="selectMbrPntUsePw" parameterType="LOYMbrEditPntUsePwRequest" resultType="java.lang.String">
		/* LOYMbr.updateMbrPntUsePw */
		select 	pnt_use_pw
		from 	loy.loy_mbr
		where 	rid = #{ridMbr}
	</select>
	<select id="clearDupMbr" parameterType="LOYDupMbrRequest" resultType="LOYDupMbrListResponse">
		SELECT    wmd.CUST_NM			      AS custNm			--고객명
		 		,secu.fn_getDecrypt(#{cipherKey},wmd.HHP_NO, null)		as hpNo
				,secu.fn_getDecrypt(#{cipherKey},wmd.EMAIL_ADDR, null)  as emailaddr
		  FROM  batch.WIPOINT_MBR_DUP    wmd
		  WHERE   wmd.RID_MBR =#{rid}
	</select>

	<select id="selectMbrNoByHhpNo" parameterType="java.lang.String" resultType="java.lang.String">
		/* LOYMbr.selectMbrNoByHhpNo */
		select	mbr_no
		from 	loy.loy_mbr
		where 	hhp_no = #{hhpNo}
	</select>
	<!-- 탈회 사유 등록 -->
	<insert id="insertDropReason" parameterType="LOYDropReasonRequest" >
		INSERT INTO LOY.LOY_MBR_DROP_REASON
				(RID,
				CREATE_BY,
				MODIFY_BY,
				CREATE_DATE,
				MODIFY_DATE,
				FLAG,
				COUNTRY,
				CURRENCY,
				APP_SERVICE_TYPE,
				ACCNT_ID,
				RID_MBR,
				REG_DT,
				RID_REG_USER,
				DROP_COMMNET)
		VALUES(
				#{rid},
				#{createBy},
				#{modifyBy},
				sysdate,
				sysdate,
				1 ,
				#{country},
				'KRW',
				#{appServiceId},
				#{accountId},
				#{ridMbr},
				sysdate,
				#{modifyBy},
				#{dropReason})
	</insert>

	<select id="selectMbrPntAcrlUseYn" parameterType="LOYMbrPntYnRequest" resultType="LOYMbrPntYnResponse">
		/* LOYMbr.selectMbrPntAcrlUseYn */
		select 	pnt_acrl_yn as pntAcrlYn
				, pnt_use_yn as pntUseYn
		from 	loy.loy_mbr
		where 	mbr_no = #{mbrNo}
	</select>

	<select id="selectMbrFamliyInfo" parameterType="LOYMbrFamliyInfoRequest" resultType="LOYMbrFamliyInfoResponse">
		/* LOYMbr.selectMbrFamliyInfo */
		SELECT   famNm		,
			 	 famNo		,
				 to_char(eventDt,'YYYY-MM-DD HH24:MI:SS') AS 	eventDt,
			 	 status     ,
			 	 rid,
			 	 ridMbr,
			 	 txnYm,
			 	 ${strColumn}
		 FROM (
				SELECT b.FAM_NM	     AS famNm,
				       b.FAM_NO      AS famNo,
					   a.REQ_DT      AS eventDt ,
					   '초대'		     AS status,
					   b.rid		 as rid,
					   a.RID_MBR	 AS ridMbr,
					   lfb.TXN_YM	 AS txnYm
				FROM   LOY.LOY_FAMILY_MBR  a
		  INNER JOIN LOY.LOY_FAMILY b ON a.RID_FAM = b.RID
		  LEFT OUTER JOIN LOY.LOY_FAMILY_BNFT_HIST lfb  ON lfb.RID_FAM_MBR =a.RID
				WHERE a.RID_MBR = #{ridMbr}
				AND a.REQ_DT IS NOT NULL
				UNION ALL
				SELECT b.FAM_NM 	 AS famNm,
					   b.FAM_NO 	 AS famNo,
					   a.APPROVAL_DT AS eventDt,
				 	   '가입'			 AS status,
				 	   b.rid		 as rid,
				 	   a.RID_MBR	 AS ridMbr,
				 	   lfb.TXN_YM	 AS txnYm
				FROM   LOY.LOY_FAMILY_MBR  a
		  INNER JOIN LOY.LOY_FAMILY b ON a.RID_FAM = b.RID
		  LEFT OUTER JOIN LOY.LOY_FAMILY_BNFT_HIST lfb  ON lfb.RID_FAM_MBR =a.RID
				WHERE a.RID_MBR = #{ridMbr}
				AND a.APPROVAL_DT IS NOT NULL
				UNION ALL
				SELECT b.FAM_NM 	 AS famNm,
					   b.FAM_NO 	 AS famNo,
					   a.REJECT_DT 	 AS eventDt ,
					   '거절'			 AS status,
					   b.rid		 as rid,
					   a.RID_MBR	 AS ridMbr,
					   lfb.TXN_YM	 AS txnYm
				FROM  LOY.LOY_FAMILY_MBR  a
		  INNER JOIN  LOY.LOY_FAMILY b ON a.RID_FAM = b.RID
		  LEFT OUTER JOIN LOY.LOY_FAMILY_BNFT_HIST lfb  ON lfb.RID_FAM_MBR =a.RID
				WHERE a.RID_MBR = #{ridMbr}
				  AND a.REJECT_DT IS NOT NULL
				UNION ALL
				SELECT b.FAM_NM 	 AS famNm,
					   b.FAM_NO 	 AS famNo,
					   a.LEAVE_DT    AS eventDt ,
					   '탈퇴'			 AS status,
					   b.rid		 as rid,
					   a.RID_MBR	 AS ridMbr,
					   lfb.TXN_YM	 AS txnYm
				FROM  LOY.LOY_FAMILY_MBR  a
		  INNER JOIN  LOY.LOY_FAMILY b ON a.RID_FAM = b.RID
		  LEFT OUTER JOIN LOY.LOY_FAMILY_BNFT_HIST lfb  ON lfb.RID_FAM_MBR =a.RID
				WHERE a.RID_MBR = #{ridMbr}
				  AND a.LEAVE_DT IS NOT NULL
			  )
			  ORDER BY ${strOrderby}
						${strEndPaging}
	</select>
	<select id="selectfamOfferList" parameterType="LOYMbrFamliyInfoRequest" resultType="LOYFamilyMbrOfferResponse">

		SELECT   a.RID_FAM  		AS ridFam,
		             a.BNFT_DATE 		AS bnftDate ,
		             b.CAM_NM  		AS camNm,
		             a.TXN_YM 		AS txnYm,
		             SUM(ACRL_PNT) 	AS acrlPnt   /*적립포인트*/,
		             SUM(TXN_SUM) 	AS txnSum   /*누적구매금액*/,
		             SUM(TXN_CNT)  	AS txnCnt   /*누적구매횟수*/,
		             ${strColumn}
		      FROM loy.LOY_FAMILY_BNFT_HIST a
		      INNER JOIN mkt.MKT_CAM_MST b ON a.CAM_NO = b.DISP_NO
		      WHERE RID_MBR = #{ridMbr}
		      GROUP BY RID_FAM ,
		             BNFT_DATE ,
		             b.CAM_NM ,
		             a.TXN_YM
			  ORDER BY ${strOrderby}
			  ${strEndPaging}
<!-- 		SELECT 	 a.RID_FAM 		AS ridFam		,  -->
<!-- 	             a.BNFT_DATE 	AS bnftDate		, -->
<!-- 	             b.CAM_NM  		AS camNm		, -->
<!-- 	             c.MBR_NO 		AS mbrNo 		,  -->
<!-- 	             d.CUST_NM      AS custNm  		,  -->
<!-- 	             a.ACRL_PNT	 	AS acrlPnt 		, -->
<!-- 	             a.TXN_SUM 		AS txnSum 		,              -->
<!-- 	             a.TXN_CNT  	AS txnCnt   	, -->
<!-- 	             lfb.TXN_YM	 	AS txnYm		, -->
<!-- 	             ${strColumn} -->
<!-- 	      FROM  loy.LOY_FAMILY_BNFT_HIST a -->
<!-- 	      INNER JOIN mkt.MKT_CAM_MST b ON a.CAM_NO = b.DISP_NO -->
<!-- 	      INNER JOIN loy.loy_mbr c ON a.RID_MBR = c.RID -->
<!-- 	      INNER JOIN loy.loy_cust d ON c.RID_CUST = d.RID -->
<!-- 	      WHERE a.RID_FAM =#{ridFam} -->
<!-- 	      AND   a.RID_MBR =#{ridMbr} -->
<!-- 	      AND  a.TXN_YM = #{txnYm} -->
<!-- 	      ${strEndPaging} -->

	</select>



	 <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 포인트 이관 대상자 조회
      -   설명                  : 포인트 이관 대상자 조회
      -   결과형태              :
      ============================================
      -   입력
      ============================================
      - 다이소
      -   작성자                : mj.kim
      -   작성일                : 2019.02.11
      ***************************************/ -->
	<select id="selectTransPoint" parameterType="LOYTransPointListRequest" resultType="LOYTransPointListResponse">


		SELECT a.*
		      ,${strColumn}
		FROM (
		 SELECT   lm.RID                   AS   ridMbr
		                     ,cc.MARK_NAME            AS   mbrStatCd
		                      ,lc.CUST_NM               AS   custNm
		                      ,secu.fn_getDecrypt(#{cipherKey}, lm.HHP_NO, 'PHONE_NUM2')  AS   hhpNo
		                     ,secu.fn_getDecrypt(#{cipherKey}, lm.email_addr, 'EML')          AS    emailAddr
		                     ,lc.BIRTH_DT               AS   birthDt
		                     ,lm.MBR_NO               AS   mbrNo
		                     ,(SELECT DECODE(COUNT(*),0,0,NVL(SUM(usePnt), 0))
		                         FROM (SELECT SUM(CASE WHEN  lpaa.VALID_START_DATE &lt;=  TRUNC(sysdate) AND lpaa.VALID_END_DATE &gt;= TRUNC(sysdate) THEN lpaa.BALNC  ELSE 0 END ) AS usePnt
		                                 FROM loy.loy_pnt_acrl lpaa
		                                 WHERE 1=1
		                                   AND lpaa.rid_mbr = lm.RID
		                                   AND lpaa.OFFER_TYPE_CD= 'POINT')) AS pntUse
		                       ,(SELECT DECODE(COUNT(*),0,0,NVL(SUM(preAcrlPnt), 0))
		                         FROM (SELECT SUM(CASE WHEN lpaa.VALID_START_DATE &gt;TRUNC(SYSDATE) THEN lpaa.BALNC ELSE 0  END ) AS preAcrlPnt
		                                 FROM loy.loy_pnt_acrl lpaa
		                                 WHERE 1=1
		                                   AND lpaa.rid_mbr = lm.RID
		                                   AND lpaa.OFFER_TYPE_CD= 'POINT')) AS pntPreUse
		                       ,lm.MBR_STAT_CD             AS   cdFlag
		                 FROM   loy.LOY_MBR       lm
		                 JOIN  loy.LOY_CUST      lc      ON lc.RID=lm.RID_CUST   AND LM.MBR_STAT_CD='A'
		         LEFT OUTER JOIN  com.COMM_CODE cc ON cc.GROUP_CODE='PNT_TRANS_MBR_CD1' AND lm.MBR_STAT_CD=cc.CODE_NAME
		                WHERE  ${strCondWhere}
		               <!--########################	  중복 테이블 조회      ########################-->
		             UNION ALL
		                SELECT    lc.RID_MBR                AS  ridMbr
		                      ,CASE WHEN lc.MBR_STAT_CD ='A' THEN '중복회원'
		                            WHEN lc.MBR_STAT_CD =NULL THEN '중복회원' END AS  mbrStatCd
		                      ,lc.CUST_NM                  AS  custNm
		                      ,secu.fn_getDecrypt(#{cipherKey}, lc.HHP_NO, 'PHONE_NUM2') AS hhpNo
		                     ,secu.fn_getDecrypt(#{cipherKey}, lc.email_addr, 'EML')    AS emailAddr
		                     ,lc.BIRTH_DT               AS   birthDt
		                     ,lc.MBR_NO                  AS   mbrNo
		                     ,(SELECT DECODE(COUNT(*),0,0,NVL(SUM(usePnt), 0))
		                         FROM (SELECT SUM(CASE WHEN  lpaa.VALID_START_DATE &lt;=  TRUNC(sysdate) AND lpaa.VALID_END_DATE &gt;= TRUNC(sysdate) THEN lpaa.BALNC  ELSE 0 END ) AS usePnt
		                                 FROM loy.loy_pnt_acrl lpaa
		                                 WHERE 1=1
		                                   AND lpaa.rid_mbr = lc.RID_MBR
		                                   AND lpaa.OFFER_TYPE_CD= 'POINT')) AS pntUse
		                       ,(SELECT DECODE(COUNT(*),0,0,NVL(SUM(preAcrlPnt), 0))
		                         FROM (SELECT SUM(CASE WHEN lpaa.VALID_START_DATE &gt; TRUNC(SYSDATE) THEN lpaa.BALNC ELSE 0  END ) AS preAcrlPnt
		                                 FROM loy.loy_pnt_acrl lpaa
		                                 WHERE 1=1
		                                   AND lpaa.rid_mbr = lc.RID_MBR
		                                   AND lpaa.OFFER_TYPE_CD= 'POINT')) AS pntPreUse
		                     ,lc.MBR_STAT_CD||1       AS   cdFlag
		                  FROM   BATCH.WIPOINT_MBR_DUP    lc
		                  WHERE  ${strCondWhere}
		                  <!--########################	  휴면 테이블 조회      ########################-->
<!-- 		                  UNION ALL  -->
<!-- 		                  SELECT    lc.RID_MBR                AS  ridMbr  -->
<!-- 		                      ,'휴면회원'  					AS  mbrStatCd -->
<!-- 		                      ,lc.CUST_NM               AS  custNm -->
<!-- 		                      ,secu.fn_getDecrypt('', lc.HHP_NO, 'PHONE_NUM2') AS hhpNo -->
<!-- 		                     ,secu.fn_getDecrypt('', lc.email_addr, 'EML')    AS emailAddr -->
<!-- 		                     ,lc.BIRTH_DT               AS   birthDt -->
<!-- 		                     ,lc.MBR_NO                 AS   mbrNo -->
<!-- 		                     ,(SELECT DECODE(COUNT(*),0,0,NVL(SUM(usePnt), 0))  -->
<!-- 		                         FROM (SELECT SUM(CASE WHEN  lpaa.VALID_START_DATE &lt;=  TRUNC(sysdate) AND lpaa.VALID_END_DATE &gt;= TRUNC(sysdate) THEN lpaa.BALNC  ELSE 0 END ) AS usePnt  -->
<!-- 		                                 FROM loy.loy_pnt_acrl lpaa -->
<!-- 		                                 WHERE 1=1 -->
<!-- 		                                   AND lpaa.rid_mbr = lc.RID_MBR -->
<!-- 		                                   AND lpaa.OFFER_TYPE_CD= 'POINT')) AS pntUse -->
<!-- 		                       ,(SELECT DECODE(COUNT(*),0,0,NVL(SUM(preAcrlPnt), 0)) -->
<!-- 		                         FROM (SELECT SUM(CASE WHEN lpaa.VALID_START_DATE &gt; TRUNC(SYSDATE) THEN lpaa.BALNC ELSE 0  END ) AS preAcrlPnt -->
<!-- 		                                 FROM loy.loy_pnt_acrl lpaa -->
<!-- 		                                 WHERE 1=1 -->
<!-- 		                                   AND lpaa.rid_mbr = lc.RID_MBR -->
<!-- 		                                   AND lpaa.OFFER_TYPE_CD= 'POINT')) AS pntPreUse -->
<!-- 		                     ,'휴면'||1       AS   cdFlag -->
<!-- 		                  FROM   dor.DOR_MBR_INFO    lc -->
<!-- 		                  WHERE  ${strCondWhere} -->
		                  ) a
								${strEndPaging}

	</select>

	 <!-- /**************************************
      -   관련 파일             : LOYMbrDAO.java
      ============================================
      -   제목                  : 포인트 이관 이력 삽입
      -   설명                  : 포인트 이관 이력  삽입
      -   결과형태              :
      ============================================
      -   입력
      ============================================
      - 다이소
      -   작성자                : mj.kim
      -   작성일                : 2019.02.11
      ***************************************/ -->
	<insert id="insertTransHist" parameterType="LOYDropReasonRequest" useGeneratedKeys="false" >
		INSERT INTO LOY.LOY_MBR_PNT_MERGE_HIST
			(RID,
			CREATE_BY,
			CREATE_DATE,
			RID_MBR_SRC,  --차감 대상
			RID_MBR_TGT,  --적립 대상
			PNT,
			REG_USER_ID,
			REG_DT,
			REASON)
		VALUES(
			com.getNewId('A'),
			#{createBy},
			SYSDATE,
			#{srgMbr}, 			--차감대상
			#{tgtMbr}, 			--적립대상
			#{pnt},
			#{accountId},
			sysdate,
			#{reasonData})
	</insert>

	 <select id="transPointExec" parameterType="LOYTransPointListRequest" statementType="CALLABLE">
        { call loy.PROC_MBR_PNT_TRANS(
                #{pRidMbrRcv}, --받는 회원
                #{pRidMbrGiv}, --주는 회원
                #{pDropMbrYn}, --YN
                #{pModifyBy},  --담당자
                #{pReason} ,
                #{pRslt,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT},
                #{pRsltCd,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT},
                #{pRsltMsg,javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT})
        }

    </select>
	<select id="selectTransPntHist" parameterType="LOYTransPointListRequest" resultType="LOYTransPntHistResponse">

		 SELECT 		 a.REG_DT   	 AS regDt ,
   			    		case when c1.rid is not null then c1.cust_nm else e.cust_nm end 		AS srcMbr,
   			    		c2.cust_nm 		AS tgtMbr,
   			    		a.pnt 			AS pnt ,
   			    		cu.user_id       AS regUser,
   			    		a.REASON		AS  reason,
   			    		a.rid			AS rid,
   			    		case when b.rid is not null then cc1.MARK_NAME else cc2.MARK_NAME end	as srcMbrCd,
   			    		${strColumn}
		      FROM LOY.LOY_MBR_PNT_MERGE_HIST a
		LEFT OUTER JOIN loy.loy_mbr b ON a.RID_MBR_SRC = b.rid
		LEFT OUTER JOIN batch.WIPOINT_MBR_DUP  e ON a.RID_MBR_SRC = e.rid_mbr
		LEFT OUTER JOIN loy.loy_cust c1 ON b.rid_cust = c1.rid
		INNER JOIN loy.loy_mbr d ON a.RID_MBR_TGT = d.rid
		INNER JOIN loy.loy_cust c2 ON d.rid_cust = c2.rid
		LEFT OUTER JOIN com.crm_user cu ON cu.rid = a.CREATE_BY
		LEFT OUTER JOIN com.COMM_CODE cc1  ON cc1.GROUP_CODE ='LOY_MEM_STAT_CD' AND b.MBR_STAT_CD = cc1.CODE_NAME
		LEFT OUTER JOIN com.COMM_CODE cc2  ON cc2.GROUP_CODE ='LOY_MEM_STAT_CD' AND e.MBR_STAT_CD = cc2.CODE_NAME
		WHERE a.RID_MBR_SRC =#{ridMbr}
		  OR a.RID_MBR_TGT =#{ridMbr}
		  ORDER BY a.reg_dt desc
		  ${strEndPaging}
<!-- 		SELECT   DISTINCT  -->
<!-- 				 lmpmh.REG_DT			AS regDt  , -->
<!-- 				 (SELECT CUST_NM FROM loy.LOY_CUST  lc   WHERE rid = lm.RID_CUST AND lm.RID=LMPMH.RID_MBR_TGT  ) 			AS tgtMbr , -->
<!-- 				 (SELECT CUST_NM FROM loy.LOY_CUST  lc   WHERE rid = lm.RID_CUST AND lm.RID=LMPMH.RID_MBR_SRC  )			AS srcMbr , -->
<!-- 				 lmpmh.PNT				AS pnt    , -->
<!-- 				 cu.USER_ID    		    AS regUser, -->
<!-- 				 lmpmh.REASON			AS reason, -->
<!-- 				 lmpmh.RID 				AS rid, -->
<!-- 				 ${strColumn} -->
<!-- 		  FROM   LOY.LOY_MBR						lm  -->
<!-- 		  JOIN 	 LOY.LOY_MBR_PNT_MERGE_HIST			lmpmh 		ON lmpmh.RID_MBR_TGT = lm.rid OR lmpmh.RID_MBR_SRC=lm.RID -->
<!-- 	 LEFT JOIN   com.CRM_USER						cu				ON cu.rid = lmpmh.CREATE_BY   -->
<!-- 		 WHERE   1=1  -->
<!-- 		   AND	 lm.rid = #{ridMbr} -->
<!-- 				${strEndPaging} -->
	</select>


	<!--  회원 로그인 비밀번호 조회 -->
    <select id="selectMbrLoginPwd" parameterType="mbrPasswordRequest" resultType="java.lang.String">
        /* LOYMbr.selectMbrLoginPwd */

        SELECT
          	WEB_PWD	as webPwd
        FROM loy.loy_mbr
        WHERE flag = 1
          AND rid = #{rid}

    </select>

	<select id="mbrPwdLockCheck" parameterType="java.lang.String" resultType="java.lang.Integer">
		SELECT count(*) as cnt
		FROM loy.LOY_MBR_ACCESS_INFO
		WHERE rid_mbr =#{rid}
		AND PW_LOCK_DT IS NOT null
	</select>

	<update id="mbrPwdUnLock" parameterType="java.lang.String">
		UPDATE loy.LOY_MBR_ACCESS_INFO
		SET PW_LOCK_CNT	= 0
		, PW_LOCK_DT = NULL
		WHERE RID_MBR = #{rid}
	</update>

	<delete id="deleteMbrDrop" parameterType="mbrRequest">
		DELETE
		FROM LOY.LOY_MBR_DROP
		WHERE rid_mbr = #{rid}
	</delete>

	<!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 선물하기 이력 조회
    -   설명                  : 선물하기 이력 조회
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    - 다이소
    -   작성자                : hy.jun
    -   작성일                : 2019.02.26
    ***************************************/ -->
	<select id="getMbrPntGiftHistList" parameterType="LOYMbrPntGiftHistListRequest" resultType="LOYMbrPntGiftHistListResponse">
		/* LOYMbr.getMbrPntGiftHistList */
		select 	t1.txnDt
				, SECU.FN_GET_DEC_AES(null, t1.custNm, 'CUST_NM') AS custNm
				, t1.mbrNo
				, t1.webId
				, t1.mbrStatCdNm
				, t1.pntTxnType1CdNm
				, t1.giftPnt
				, ${strColumn}
		from 	(
			SELECT 		TO_CHAR(CASE WHEN lpgh.RID_FROM_MBR = #{ridMbr} THEN lptRdm.TXN_DT ELSE lptAcrl.TXN_DT END, 'yyyy-mm-dd hh24:mi:ss') 	AS txnDt
						, CASE 	WHEN lpgh.RID_FROM_MBR = #{ridMbr} THEN lcTo.CUST_NM ELSE lcFrom.CUST_NM 	END 								AS custNm
						, CASE 	WHEN lpgh.RID_FROM_MBR = #{ridMbr} THEN lmTo.MBR_NO ELSE lmFrom.MBR_NO 		END 								AS mbrNo
						, CASE 	WHEN lpgh.RID_FROM_MBR = #{ridMbr} THEN lmTo.WEB_ID ELSE lmFrom.WEB_ID 		END 								AS webId
						, CASE 	WHEN lpgh.RID_FROM_MBR = #{ridMbr}
								THEN (SELECT CASE WHEN lmTo.MBR_LOCK_YN = 'Y' THEN '휴면' ELSE MARK_NAME END FROM COM.COMM_CODE WHERE GROUP_CODE = 'LOY_MEM_STAT_CD' AND CODE_NAME = lmTo.MBR_STAT_CD AND LANG = #{lang} AND FLAG = 1)
								ELSE (SELECT CASE WHEN lmFrom.MBR_LOCK_YN = 'Y' THEN '휴면' ELSE MARK_NAME END FROM COM.COMM_CODE WHERE GROUP_CODE = 'LOY_MEM_STAT_CD' AND CODE_NAME = lmFrom.MBR_STAT_CD AND LANG = #{lang} AND FLAG = 1)
								END 																											AS mbrStatCdNm
						, CASE 	WHEN lpgh.RID_FROM_MBR = #{ridMbr}
								THEN (SELECT MARK_NAME FROM COM.COMM_CODE WHERE GROUP_CODE = 'PNT_TXN_TYPE' AND CODE_NAME = lptRdm.PNT_TXN_TYPE_1_CD AND LANG = #{lang} AND FLAG = 1)
								ELSE (SELECT MARK_NAME FROM COM.COMM_CODE WHERE GROUP_CODE = 'PNT_TXN_TYPE' AND CODE_NAME = lptAcrl.PNT_TXN_TYPE_1_CD AND LANG = #{lang} AND FLAG = 1)
								END 																											AS pntTxnType1CdNm
						, CASE 	WHEN lpgh.RID_FROM_MBR = #{ridMbr} THEN '-' || to_char(lpgh.GIFT_PNT) ELSE to_char(lpgh.GIFT_PNT) END 			AS giftPnt
						, ${strColumn}
			FROM 		LOY.LOY_PNT_GIFT_HIST lpgh
			LEFT JOIN 	LOY.LOY_MBR lmFrom ON lpgh.RID_FROM_MBR = lmFrom.RID
			LEFT JOIN	LOY.LOY_CUST lcFrom ON lmFrom.RID_CUST = lcFrom.RID
			LEFT JOIN 	LOY.LOY_MBR lmTo ON lpgh.RID_TO_MBR = lmTo.RID
			LEFT JOIN	LOY.LOY_CUST lcTo ON lmTo.RID_CUST = lcTo.RID
			JOIN 		LOY.LOY_PNT_TXN lptAcrl ON lptAcrl.RID = lpgh.RID_ACRL_PNT_TXN
			JOIN 		LOY.LOY_PNT_TXN lptRdm ON lptRdm.RID = lpgh.RID_RDM_PNT_TXN
			WHERE 		1=1
					AND (lpgh.RID_FROM_MBR = #{ridMbr} OR lpgh.RID_TO_MBR = #{ridMbr})
		) t1
		WHERE ${strWhere}
		ORDER BY ${strOrderby}
		${strEndPaging}
	</select>

	<!-- 식별값 중복체크 -->
	<select id="checkDupIdentiVal" parameterType="mbrItemRequest" resultType="java.lang.Integer">
		select 	count(1)
		from 	loy.loy_cust lc
		join 	loy.loy_mbr lm on lc.rid = lm.rid_cust
		where 	lc.identi_val = #{identiVal}
			and lm.rid_pgm = #{loyProgramId}
			and lm.rid != #{rid}
	</select>


	<!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 스탬프 이력 조회
    -   설명                  : 스탬프 이력 조회
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    - 다이소
    -   작성자                : hy.jun
    -   작성일                : 2019.03.26
    ***************************************/ -->
	<select id="getMbrStmpHistList" parameterType="infavor.loyalty.member.mbr.dto.request.LOYMbrStmpHistListRequestDTO"
	resultType="infavor.loyalty.member.mbr.dto.response.LOYMbrStmpHistListResponseDTO">
		/* LOYMbr.getMbrStmpHistList */
		SELECT 	t2.stmpNo
				, t2.stmpNm
				, t2.regDt
				, to_char(t2.modifyDate,'yyyy-mm-dd hh24:mi:ss') AS stmpLastAcrlDt /*최근이용일시*/
				, t2.stmpItemNo
				, t2.stmpBnftAmt
				, t2.stmpMbrStatus
				, t2.purAmt
				, t2.purCnt
				, t2.ridStmp
				, t2.ridStmpMbr
				, t2.ridStmpBnft
				, t3.totalCount
		FROM 	(
			SELECT 	t1.stmpNo
					, t1.stmpNm
					, to_char(t1.regDt,'yyyy-mm-dd hh24:mi:ss')	AS regDt /*참여일시*/
					, t1.stmpItemNo
					, nvl(t1.stmpBnftAmt,0)						AS stmpBnftAmt /*혜택금액*/
					, DECODE(t1.stmpFinishDt, NULL, CASE WHEN t1.stmpEndDt <![CDATA[<]]> sysdate THEN '기간만료' ELSE '진행중' END, '완료') 	AS stmpMbrStatus /*스탬프진행상태*/
					, to_char(LOY.PKG_APPRO_STMP.GET_STMP_PUR_AMT_SUM(t1.ridMbr, t1.ridStmp)) 	AS purAmt /*구매금액*/
					, to_char(LOY.PKG_APPRO_STMP.GET_STMP_PUR_CNT_SUM(t1.ridMbr, t1.ridStmp)) 	AS purCnt /*구매횟수*/
					, t1.ridStmp
					, t1.ridStmpMbr
					, t1.ridStmpBnft
					, t1.modifyDate
			FROM 	(
				SELECT 	/*+ use_nl(mcm mcor mom) */
						ls.STMP_NO 				AS stmpNo
						, ls.STMP_NM 			AS stmpNm
						, lsm.REG_DT 			AS regDt
						, lsm.STMP_ITEM_NO 		AS stmpItemNo /*스탬프수*/
						, SUM(mom.SELF_TOT_AMT) OVER(PARTITION BY lsm.RID_STMP) AS stmpBnftAmt
						, ROW_NUMBER() OVER(PARTITION BY lsm.RID_STMP ORDER BY lsmb.REG_DT DESC) rn
						, lsm.STMP_FINISH_DT 	AS stmpFinishDt
						, ls.STMP_END_DT 		AS stmpEndDt
						, lsm.RID_MBR 			AS ridMbr
						, lsm.RID_STMP 			AS ridStmp
						, lsm.RID 				AS ridStmpMbr
						, lsmb.RID 				AS ridStmpBnft
						, lsm.MODIFY_DATE		AS modifyDate
				FROM 	LOY.LOY_STMP_MBR lsm
				JOIN 	LOY.LOY_STMP ls ON ls.RID = lsm.RID_STMP AND ls.FLAG = 1
				LEFT JOIN LOY.LOY_STMP_MBR_BNFT lsmb ON lsmb.RID_STMP_MBR = lsm.RID AND lsmb.FLAG = 1
				LEFT JOIN MKT.MKT_CAM_MST mcm ON mcm.DISP_NO = lsmb.CAM_NO AND mcm.FLAG = 1
				LEFT JOIN MKT.MKT_CAM_OFFER_REL mcor ON mcor.CAM_ID = mcm.ID AND mcor.FLAG = 1
				LEFT JOIN MKT.MKT_OFFER_MST mom ON mom.ID = mcor.OFFER_ID AND mom.FLAG = 1
				WHERE 	lsm.RID_MBR = #{ridMbr}
					AND lsm.FLAG = 1
			) t1
			WHERE 	t1.rn = 1
		) t2,
	    (
		    SELECT 	count(1) AS totalCount
		    FROM 	LOY.LOY_STMP_MBR
		    WHERE 	RID_MBR = #{ridMbr}
			    AND FLAG = 1
	    ) t3
		WHERE 	${strWhere}
		ORDER BY ${strOrderby}
		${strEndPaging}
	</select>

	<!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 스탬프 혜택 이력 조회
    -   설명                  : 스탬프 혜택 이력 조회
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    - 다이소
    -   작성자                : hy.jun
    -   작성일                : 2019.03.26
    ***************************************/ -->
	<select id="getMbrStmpBnftHistList" parameterType="infavor.loyalty.member.mbr.dto.request.LOYMbrStmpBnftHistListRequestDTO"
	resultType="infavor.loyalty.member.mbr.dto.response.LOYMbrStmpBnftHistListResponseDTO">
		/* LOYMbr.getMbrStmpBnftHistList */
		SELECT 	/*+ use_nl(mcm mcor mom) */
				lsmb.CAM_NO 													AS camNo
				, mcm.CAM_NM 													AS camNm
				, c1.CODE_NAME 													AS offerTypeCd 		/*오퍼유형*/
				, c1.MARK_NAME 													AS offerTypeCdNm 	/*오퍼유형명*/
				, c2.CODE_NAME 													AS offerSubTypeCd 	/*오퍼유형상세*/
				, c2.MARK_NAME 													AS offerSubTypeCdNm /*오퍼유형상세명*/
				, lsmb.STMP_ITEM_NO 											AS stmpItemNo 		/*스탬프번호*/
				, to_char(lci.RECP_DT,'yyyy-mm-dd hh24:mi:ss') 					AS recpDt 			/*일시*/
				, mom.SELF_TOT_AMT 												AS stmpBnftAmt 		/*금액*/
				, nvl2(lci.USE_DT, to_char(lci.USE_DT,'yyyy-mm-dd hh24:mi:ss'), '') 	AS useDt 	/*수령일시*/
				, ${strColumn}
		FROM 	LOY.LOY_STMP_MBR_BNFT lsmb
		JOIN 	MKT.MKT_CAM_MST mcm ON mcm.DISP_NO = lsmb.CAM_NO AND mcm.FLAG = 1
		JOIN 	MKT.MKT_CAM_OFFER_REL mcor ON mcor.CAM_ID = mcm.ID AND mcor.FLAG = 1
		JOIN 	MKT.MKT_OFFER_MST mom ON mom.ID = mcor.OFFER_ID AND mom.FLAG = 1
		JOIN 	LOY.LOY_COUPN_I lci ON lci.RID_MBR = lsmb.RID_MBR AND lci.REQ_TYPE_CD = 'STMP' AND lci.REQ_TYPE_KEY = lsmb.RID AND lci.FLAG = 1
		JOIN 	COM.COMM_CODE c1 ON c1.GROUP_CODE = 'OFFER_TYPE_CD' AND c1.CODE_NAME = mom.OFFER_TYPE_CD AND c1.LANG = #{lang} AND c1.FLAG = 1
		JOIN 	COM.COMM_CODE c2 ON c2.GROUP_CODE = 'OFFER_SUB_TYPE_CD' AND c2.CODE_NAME = mom.OFFER_SUB_TYPE_CD AND c2.LANG = #{lang} AND c2.FLAG = 1
		WHERE 	${strWhere}
			AND lsmb.RID_STMP_MBR = #{ridStmpMbr}
			AND lsmb.FLAG = 1
		ORDER BY ${strOrderby}
		${strEndPaging}
	</select>

	<!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 스탬프 혜택 이력 상세 조회
    -   설명                  : 스탬프 혜택 이력 상세 조회
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    - 다이소
    -   작성자                : hy.jun
    -   작성일                : 2019.03.27
    ***************************************/ -->
	<select id="getMbrStmpHistListDetail" parameterType="infavor.loyalty.member.mbr.dto.request.LOYMbrStmpHistListDetailRequestDTO"
	resultType="infavor.loyalty.member.mbr.dto.response.LOYMbrStmpHistListDetailResponseDTO">
		/* LOYMbr.getMbrStmpHistListDetail */
		SELECT 	t1.stmpMbrHistStatus
				, t1.stmpTxnNo
				, t1.stmpItemNo
				, to_char(t1.regDt,'yyyy-mm-dd hh24:mi:ss') AS regDt
				, ${strColumn}
		FROM (
			SELECT  CASE WHEN lsmh.PUR_AMT > 0 THEN '적립' ELSE '취소' END 	AS stmpMbrHistStatus
					, lst.STMP_TXN_NO 										AS stmpTxnNo
					, lsmh.STMP_ITEM_NO 									AS stmpItemNo
					, lsmh.REG_DT 											AS regDt
					, lsmh.MODIFY_DATE 										AS modifyDate
					, ${strColumn}
			FROM 	loy.LOY_STMP_MBR_HIST lsmh
			JOIN 	loy.LOY_STMP_TXN lst ON lsmh.RID_STMP_TXN = lst.RID AND lst.FLAG = 1
			WHERE 	lsmh.RID_STMP_MBR = #{ridStmpMbr}
				AND lsmh.FLAG = 1
		) t1
		WHERE 	${strWhere}
		ORDER BY ${strOrderby}
		${strEndPaging}
	</select>

	<!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 스탬프 거래 이력 상세 조회
    -   설명                  : 스탬프 거래 이력 상세 조회
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    - 다이소
    -   작성자                : hy.jun
    -   작성일                : 2019.03.29
    ***************************************/ -->
	<select id="getMbrStmpTxnList" parameterType="infavor.loyalty.member.mbr.dto.request.LOYMbrStmpTxnListRequestDTO"
	resultType="infavor.loyalty.member.mbr.dto.response.LOYMbrStmpTxnListResponseDTO">
		/* LOYMbr.getMbrStmpTxnList */
		SELECT 	lst.STMP_TXN_NO 								AS stmpTxnNo
				, lc.CHNL_NO 									AS chnlNo
				, lc.CHNL_NM 									AS chnlNm
				, lst.PUR_AMT 									AS purAmt
				, to_char(lst.REG_DT,'yyyy-mm-dd hh24:mi:ss') 	AS regDt
				, c1.MARK_NAME 									AS stmpTxnStatusNm
				, to_char(lpt.APPR_DT,'yyyy-mm-dd hh24:mi:ss') 	AS apprDt
				, lsmh.STMP_ITEM_NO 							AS stmpItemNo
				, lpt.RCPT_NO									AS rcptNo
				, lpt2.RCPT_NO									AS orgRcptNo /*원거래 영수증번호*/
				, ${strColumn}
		FROM 	loy.LOY_STMP_MBR_HIST lsmh
		JOIN 	loy.LOY_STMP_TXN lst ON lsmh.RID_STMP_TXN = lst.RID AND lst.FLAG = 1
		JOIN 	loy.LOY_CHANNEL lc ON lc.RID = lst.RID_CHNL AND lc.FLAG = 1
		JOIN 	loy.LOY_PNT_TXN lpt ON lpt.RID = lst.RID_PNT_TXN AND lpt.FLAG = 1
		LEFT JOIN 	loy.LOY_PNT_TXN lpt2 ON lpt2.RID = lst.RID_ORG_PNT_TXN AND lpt2.FLAG = 1
		JOIN 	com.COMM_CODE c1 ON c1.GROUP_CODE = 'LOY_STMP_TXN_STATUS_CD' AND c1.CODE_NAME = lst.STMP_TXN_STATUS AND c1.LANG = #{lang} AND c1.FLAG = 1
		WHERE 	lsmh.RID_STMP = #{ridStmp}
			AND lsmh.RID_MBR = #{ridMbr}
			AND lsmh.FLAG = 1
			AND ${strWhere}
		ORDER BY ${strOrderby}
		${strEndPaging}
	</select>

	<select id="getMbrPointCouponList" parameterType="infavor.loyalty.member.mbr.dto.request.LOYMbrCouponListRequestDTO" resultType="infavor.loyalty.member.mbr.dto.response.LOYMbrCouponListResponseDTO">
	select coupnRid,
		   couponNm,
		   useStartDt,
		   useEndDt,
		   selfTotAmt,
		   useYn,
		   recpDt,
		   pointDt,
		   pointStartDt,
		   pointEndDt,
		   totalCount
	from (SELECT 	lc.RID				AS coupnRid
		  , lc.COUPN_NM			AS couponNm
		  , to_char(lci.APLY_START_DD,'YYYY-MM-DD')	AS useStartDt
		  , to_char(lci.APLY_END_DD , 'YYYY-MM-DD')	AS useEndDt
		  , mom.SELF_TOT_AMT	AS selfTotAmt
		  , lci.USE_YN AS useYn
		  , to_char(lci.RECP_DT , 'YYYY-MM-DD HH24:mm') 	AS recpDt
	      , to_char(lpt.APPR_DT,'YYYY-MM-DD HH24:mm')		AS pointDt
	      , to_char(lpa.VALID_START_DATE,'YYYY-MM-DD')		AS pointStartDt
	      , TO_CHAR(lpa.VALID_END_DATE,'YYYY-MM-DD')		AS pointEndDt
	   	  ,  CEIL(COUNT(1) OVER()) as totalCount
	FROM mkt.MKT_OFFER_MST mom
	JOIN loy.LOY_COUPN lc ON lc.RID_OFFER_MST = mom.ID AND mom.FLAG = 1
	JOIN loy.LOY_COUPN_I lci ON lc.RID = lci.RID_COUPN AND lci.FLAG = 1
	LEFT OUTER JOIN loy.LOY_PNT_TXN lpt ON lpt.TXN_UNIQ_NO = lci.COUPN_NO
	LEFT OUTER JOIN loy.LOY_PNT_ACRL lpa ON  lpa.RID_PNT_TXN = lpt.RID
	WHERE lci.RID_MBR = #{ridMbr})
	  WHERE ${strWhere}
	ORDER BY ${strOrderby}
		 ${strEndPaging}
	</select>

	<select id="getMbrPointCouponDetail" parameterType="infavor.loyalty.member.mbr.dto.request.LOYMbrCouponListRequestDTO" resultType="infavor.loyalty.offer.dto.response.LOYMbrCouponPopResponseDTO">
	SELECT COUPN_USE_GDNC1 AS coupnUsegdnc1,
	   	   COUPN_USE_GDNC2 AS coupnUsegdnc2,
	       COUPN_USE_GDNC3 AS coupnUsegdnc3
	FROM loy.LOY_COUPN
	WHERE RID = #{coupnRid}
	</select>

	<!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 등급 이력 조회
    -   설명                  : 등급 이력 조회
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    - 다이소
    -   작성자                : hy.jun
    -   작성일                : 2019.04.18
    ***************************************/ -->
	<select id="getMbrTierHistList2" parameterType="infavor.loyalty.member.mbr.dto.request.LOYMbrTierHistListRequestDTO"
	resultType="infavor.loyalty.member.mbr.dto.response.LOYMbrTierHistListResponseDTO">
		/* LOYMbr.getMbrTierHistList2 */
		SELECT 	lt.TIER_NM 																AS tierNm
				, lt.TIER_CD 															AS tierCd
				, to_char(to_date(lmth.VALID_START_DT, 'yymmdd'), 'yyyy-mm-dd') 		AS validStartDt
				, to_char(to_date(lmth.VALID_END_DT, 'yymmdd'), 'yyyy-mm-dd') 			AS validEndDt
				, to_char(to_date(lmth.RSLT_EXTR_START_DT, 'yymmdd'), 'yyyy-mm-dd') 	AS rsltExtrStartDt
				, to_char(to_date(lmth.RSLT_EXTR_END_DT, 'yymmdd'), 'yyyy-mm-dd') 		AS rsltExtrEndDt
				, to_char(lmth.TIER_CALC_DATE, 'yyyy-mm-dd hh24:mi:ss') 				AS tierCalcDate
				, lmth.TIER_CHG_DESC 													AS tierChgDesc
				, ${strColumn}
		FROM 	LOY.LOY_MBR_TIER_HIST lmth
		JOIN 	LOY.LOY_TIERS lt ON lt.RID = lmth.RID_TIER_CUR
		WHERE 	lmth.RID_MBR = #{ridMbr}
			AND ${strWhere}
		ORDER BY ${strOrderby}
		${strEndPaging}
	</select>

	<!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 스탬프 적립처리
    -   설명                  : 회원 스탬프 적립처리
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    - 다이소
    -   작성자                : hy.jun
    -   작성일                : 2019.04.18
    ***************************************/ -->
    <select id="acrlStmp" parameterType="infavor.loyalty.member.mbr.dto.request.LOYMbrAcrlStmpRequestDTO" statementType="CALLABLE">
    	/* LOYMbr.acrlStmp */
        {
			CALL LOY.PKG_APPRO_STMP.PROC_STMP_MAIN (
				#{mbrNo}
				, #{apprDate}
				, #{apprNo}
				, #{rst,		javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT}
				, #{rstCd,		javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT}
				, #{rstMsg,		javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT}
				, #{pushMsgH,	javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT}
				, #{pushMsgB,	javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT}
				, #{mbrNoAcrl,	javaType=java.lang.String,jdbcType=VARCHAR,mode=OUT}
			)
        }
    </select>

	<!-- /**************************************
    -   관련 파일             : LOYMbrDAO.java
    ============================================
    -   제목                  : 회원 스탬프 적립처리 전 포인트거래정보 조회
    -   설명                  : 회원 스탬프 적립처리 전 포인트거래정보 조회
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    - 다이소
    -   작성자                : hy.jun
    -   작성일                : 2019.04.18
    ***************************************/ -->
    <select id="getPntTxnInfoBeforeAcrlStmp" parameterType="infavor.loyalty.member.mbr.dto.request.LOYMbrAcrlStmpRequestDTO"
    resultType="infavor.loyalty.member.mbr.dto.request.LOYMbrAcrlStmpRequestDTO">
    	/* LOYMbr.getPntTxnInfoBeforeAcrlStmp */
		SELECT  lpt.RID 				AS rid
				, lpt.PNT_TXN_TYPE_1_CD AS pntTxnType1Cd
				, lpt.PNT_TXN_TYPE_2_CD AS pntTxnType2Cd
				, lpt.APPR_DATE 		AS apprDate
				, lpt.APPR_NO 			AS apprNo
				, lm.MBR_NO 			AS mbrNo
		FROM LOY.LOY_PNT_TXN lpt
		JOIN LOY.LOY_MBR lm ON lm.RID = lpt.RID_MBR
		WHERE lpt.RID = #{rid}
    </select>

    <select id="selectMbrDivList" parameterType="infavor.loyalty.member.mbr.dto.request.LOYMbrDivListRequestDTO" resultType="infavor.loyalty.member.mbr.dto.response.LOYMbrDivListResponseDTO">
		/*LOYMbr.selectMbrDivList*/
		select 	DISTINCT lmu.rid as rid
			<!-- 	, c1.code_name as uploadTypeCd
				, c1.mark_name as uploadTypeCdNm
				, c2.code_name as procTypeCd
				, c2.mark_name as procTypeCdNm -->
				, c3.code_name as batchResultCd
				, c3.mark_name as batchResultCdNm
				, lmu.file_path as filePath
				, lmu.file_name as fileName
				, TO_CHAR(lmu.file_upload_dt, 'yyyy-mm-dd hh24:mi:ss') as fileUploadDt
				, lmu.file_upload_user_rid as fileUploadUserRid
				, emp1.name as fileUploadUserRidNm
				, TO_CHAR(TO_DATE(lmu.pnt_apply_dt, 'YYYYMM'), 'YYYY-MM') as pntApplyDt
				, lmu.confirm_dt as confirmDt
				, CASE WHEN lmu.confirm_dt IS NOT NULL THEN '확정' ELSE '미확정' END as confirmDtNm
				, lmu.confirm_user_rid as confirmUserRid
				, emp2.name as confirmUserRidNm
				, lmu.upload_cnt as uploadCnt
<!-- 				, COUNT(lmui.rid) OVER(PARTITION BY lmu.rid) as uploadSuccessCnt -->
<!-- 				, lmu.upload_cnt - COUNT(lmui.rid) OVER(PARTITION BY lmu.rid) as uploadFailCnt -->
				, lmu.batch_success_cnt as batchSuccessCnt
				, lmu.batch_fail_cnt as batchFailCnt
<!-- 				, lmu.rid_cam as ridCam -->
<!-- 				, lmu.rid_offer as ridOffer -->
				, lmu.batch_error_desc as batchErrorDesc
<!-- 				, sum(nvl(lmui.acrl_amt,0)) over(partition by lmui.rid_mbr_upload) as totalAcrlAmt -->
				, lmu.total_acrl_amt as totalAcrlAmt
				,  CEIL(COUNT(distinct lmu.rid) OVER()) totalCount
		from 	LOY.LOY_MBR_UPLOAD lmu
<!-- 		left outer join LOY.LOY_PNT_UPLOAD_ITEM lmui on lmui.rid_mbr_upload = lmu.rid and lmui.flag = 1 -->
		<!-- join com.comm_code c1 on c1.group_code = 'OFFER_TYPE_CD' and c1.code_name = lmu.upload_type_cd and c1.lang = #{lang} and c1.flag = 1
		join com.comm_code c2 on c2.group_code = 'DAISO_EXCEL_UP_TYPE' and c2.code_name = lmu.proc_type_cd and c2.lang = #{lang} and c2.flag = 1 -->
		left outer join com.comm_code c3 on c3.group_code = 'PNT_UPLOAD_BATCH_STATUS_CD' and c3.code_name = lmu.batch_result_cd and c3.lang = #{lang} and c3.flag = 1
		join 	com.crm_user cu1 on cu1.rid = lmu.file_upload_user_rid
		join 	com.employee emp1 on emp1.id = cu1.id_employee
		left outer join com.crm_user cu2 on cu2.rid = lmu.confirm_user_rid
		left outer join com.employee emp2 on emp2.id = cu2.id_employee
		where 	${strCondWhere}
			and ${strSVCType}
			and ${strWhere}
			<!-- and ${strDataAuthWhere} -->
			and lmu.flag = 1
		ORDER BY ${strOrderby}
		${strEndPaging}
	</select>


	<select id="selectMbrUpldItemList" parameterType="infavor.loyalty.member.mbr.dto.request.LOYMbrUploadItemRequestDTO" resultType="infavor.loyalty.member.mbr.dto.response.LOYMbrUploadItemResponseDTO">
		/*LOYMbr.selectMbrUpldItemList*/
		select	/*+ ordered no_merge(lmui) push_pred(lmui) INDEX(lmui rid_mbr_upload_IDX lopd LOY_OFFER_PNT_DTL_IX01) use_nl(lmui mcm r o lopd lm lc) */
				lmui.rid as rid
				, lmui.mbr_no as mbrNo
				, lmui.target_nm as targetNm
				, SECU.FN_GETDECRYPT(#{cipherKey}, lmui.target_hhp_no, 'PHONE_NUM2') as targetHhpNo
				, TO_CHAR(lmui.acrl_amt, '999,999,999,999,999') as acrlAmt
				, TO_CHAR(lmui.valid_start_date, 'YYYY-MM-DD') as validStartDate
				, TO_CHAR(lmui.valid_end_date, 'YYYY-MM-DD') as validEndDate
				, lmui.batch_result_cd as batchResultCd
				, c1.mark_name as batchResultCdNm
				, lmui.batch_error_desc as batchErrorDesc
				, lm.mbr_no as mbrNoChk
				, lc.cust_nm as custNmChk
				, lm.mbr_stat_cd as mbrStatCdChk
				, c2.mark_name as mbrStatCdNmChk
				, lmui.rid_mbr as ridMbr
				, mcm.cam_nm as camNm
				, c13.mark_name as validStartdtBasCdNm <!-- 기준일자유형 -->
				, lopd.VALID_START_DTNUM as validStartDtnum <!-- 혜택시작일 -->
				, lopd.VALID_END_DTNUM as validEndDtnum <!-- 소멸예정월 -->
				, lc.chnl_nm as dividorChnlNm <!-- 재원부서명 -->
				, mcm.PNT_ACCNT_CODE_VAL as pntAccntCodeVal <!-- 회계코드 -->
				, c9.mark_name as pntAccntBigTypeCd <!-- 지급계정 대분류 -->
				, c10.mark_name as pntAccntMidTypeCd <!-- 지급계정 중분류 -->
				, c11.mark_name as pntAccntSmlTypeCd <!-- 지급계정 소분류 -->
				, c12.mark_name as pntAccntDetailTypeCd <!-- 지급계정 세분류 -->
				, lmui.acrl_date as acrlDate <!-- 적립일시 -->
				, lmui.seq as seq <!-- 순서 -->
				, lmui.CI AS ci
				, t1.totalCount
		from 	(	select 	*
					from 	LOY.LOY_MBR_UPLOAD_ITEM lmui
					where 	${strCondWhere}
						and ${strSVCType}
						<!-- and ${strDataAuthWhere} -->
						and lmui.rid_mbr_upload = #{ridMbrUpload}
						and lmui.flag = 1
						<if test="batchResultCd != null and batchResultCd != ''">
						and lmui.batch_result_cd = #{batchResultCd}
						</if>
					<if test="sidx == 'lmui.seq' or sidx == 'lmui.acrl_date' or sidx == 'lmui.mbr_no' or sidx == 'lmui.target_nm'
							or sidx == 'lmui.target_hhp_no' or sidx == 'lmui.acrl_amt' or sidx == 'lmui.batch_error_desc'
							or sidx == 'lmui.rid' or sidx == 'lmui.batch_result_cd'">
						ORDER BY ${strOrderby}
						${strEndPaging}
					</if>
				) lmui
<!-- 		join 	LOY.LOY_PNT_UPLOAD lpu on lpu.rid = lmui.rid_mbr_upload and lpu.flag = 1 -->
		left join com.comm_code c1 on c1.group_code = 'PNT_UPLOAD_ITEM_BATCH_STATUS_CD' and c1.code_name = lmui.batch_result_cd and c1.lang = #{lang} and c1.flag = 1
		left join loy.loy_mbr lm on lm.rid = lmui.rid_mbr
		left join loy.loy_cust lc on lc.rid = lm.rid_cust
		left join com.comm_code c2 on c2.group_code = 'LOY_MEM_STAT_CD' and c2.code_name = lm.mbr_stat_cd and c2.lang = #{lang} and c2.flag = 1

		left join mkt.mkt_cam_mst mcm on mcm.id = lmui.rid_cam and mcm.flag = 1
		left join mkt.mkt_cam_offer_rel r on r.flag = 1 and r.cam_id = mcm.id
		left join mkt.mkt_offer_mst     o on r.offer_id = o.id and o.flag = 1
		left join loy.LOY_OFFER_EXP_DIVID loed on o.id = loed.rid_mkt_offer_mst and loed.flag = 1
		left join loy.LOY_OFFER_PNT_DTL lopd on o.id = lopd.rid_mkt_offer_mst and lopd.flag = 1
		left join loy.loy_channel lc on lc.rid = loed.RID_DIVIDOR_CHNL and lc.flag = 1

		left join com.comm_code c9
			on c9.flag = 1 and c9.lang = #{lang} and c9.code_name = mcm.PNT_ACCNT_BIG_TYPE_CD and c9.group_code = 'PNT_TXN_TYPE'
		left join com.comm_code c10
			on c10.flag = 1 and c10.lang = #{lang} and c10.code_name = mcm.PNT_ACCNT_MID_TYPE_CD and c10.group_code = 'PNT_TXN_DTL_TYPE'
		left join com.comm_code c11
			on c11.flag = 1 and c11.lang = #{lang} and c11.code_name = mcm.PNT_ACCNT_SML_TYPE_CD and c11.group_code = 'DA_PNT_ACCNT_SML_TYPE'
		left join com.comm_code c12
			on c12.flag = 1 and c12.lang = #{lang} and c12.code_name = mcm.PNT_ACCNT_DETAIL_TYPE_CD and c12.group_code = 'DA_PNT_ACCNT_DETAIL_TYPE'
		left join com.comm_code c13
			on c13.flag = 1 and c13.lang = #{lang} and c13.code_name = lopd.VALID_STARTDT_BAS_CD and c13.group_code = 'LOY_VALID_STARTDT_BAS_CD'
		, (
			select 	/*+ INDEX(lmui rid_mbr_upload_IDX) */
					count(1) AS totalCount
			from 	loy.LOY_MBR_UPLOAD_ITEM lmui
			where 	lmui.rid_mbr_upload = #{ridMbrUpload}
				and flag = 1
		) t1
		where 	${strWhere}
		<if test="sidx == 'c1.mark_name' or sidx == 'mcm.cam_nm' or sidx == 'c13.mark_name' or sidx == 'lopd.VALID_START_DTNUM'
				or sidx == 'lopd.VALID_END_DTNUM' or sidx == 'lc.chnl_nm' or sidx == 'mcm.PNT_ACCNT_CODE_VAL'
				or sidx == 'c9.mark_name' or sidx == 'c10.mark_name' or sidx == 'c11.mark_name' or sidx == 'c12.mark_name'
				or sidx == 'lm.mbr_no' or sidx == 'lc.cust_nm' or sidx == 'c2.mark_name' or sidx == 'lm.mbr_stat_cd'">
			ORDER BY ${strOrderby}
			${strEndPaging}
		</if>
		<if test="sidx != null and sidx.startsWith('lmui')">
			ORDER BY ${strOrderby}
		</if>
	</select>

	<select id="selectMbrRecomHistoryList" parameterType="mbrRecomHistoryRequest" resultType="mbrRecomHistoryResponse">
	  select  fr.rcmmHist as rcmmHist
	  		, fr.rcmType as rcmType
	  		, LOY.FN_GET_MBRNM_MASKING(fr.custNm)	 as custNm
	  		, fr.mbrNo	 as mbrNo
	  		, fr.mbrStatCd as mbrStatCd
	  		, fr.joinDate as joinDate
	  		, fr.rid as rid
	  		, fr.ridMbr as ridMbr
	  		, ${strColumn}
	    from(
		  SELECT  '추천 함' AS rcmmHist
		  	   ,  '가입'    AS rcmType			--유형
			   ,  LOY.FN_GET_MBRNM_MASKING(secu.fn_getDecrypt(#{cipherKey},LC2.CUST_NM)) AS custNm			--회원명
			   ,  lm2.MBR_NO	 AS mbrNo			--회원ID
			   ,  t1.mark_name AS mbrStatCd		--회원상태
			   ,  TO_CHAR(lm1.JOIN_DATE,'YYYY-MM-DD HH24:MI') AS joinDate --등록일시
			   ,  lm2.rid as rid
			   ,  lm2.rid as ridMbr
		     FROM LOY.LOY_MBR LM1
 			 JOIN LOY.LOY_MBR LM2 ON LM2.RID = LM1.RID_JOIN_RCMMD
  			 JOIN LOY.LOY_CUST LC2 ON LC2.RID = LM2.RID_CUST
  LEFT OUTER JOIN com.comm_code t1 ON t1.group_code = 'LOY_MEM_STAT_CD' AND t1.FLAG = 1 AND t1.code_name = lm2.MBR_STAT_CD
		    WHERE lm1.FLAG = 1
			  AND lm1.RID = #{rid}

		   UNION ALL

		   SELECT  '추천 받음' AS rcmmHist
		  	    ,  '가입' 	  AS rcmType
		  		,  LOY.FN_GET_MBRNM_MASKING(secu.fn_getDecrypt(#{cipherKey},LC2.CUST_NM)) AS custNm
		  		,  lm2.mbr_No  AS mbrNo
		  		,  t1.mark_name AS mbrStatCd
		  		,  TO_CHAR(lm2.JOIN_DATE,'YYYY-MM-DD HH24:MI') AS joinDate
		  		,  lm2.rid as rid
		  		,  lm2.rid as ridMbr
  			FROM LOY.LOY_MBR LM1
  			JOIN LOY.LOY_MBR LM2 ON LM2.RID_JOIN_RCMMD = LM1.RID
  			JOIN LOY.LOY_CUST LC2 ON LC2.RID = LM2.RID_CUST
  			LEFT OUTER JOIN com.comm_code t1 ON t1.group_code = 'LOY_MEM_STAT_CD' AND t1.FLAG = 1 AND t1.code_name = LM2.MBR_STAT_CD
  			WHERE LM1.FLAG = 1
		      AND LM1.RID = #{rid}
		      
		   ) fr
		WHERE ${strWhere}
     ORDER BY ${strOrderby}
	     	  ${strEndPaging}
	</select>

	<!-- 추천인 마스킹 해제 -->
	<select id="clearMaskRecomm" parameterType="mbrRecomHistoryRequest" resultType="mbrRecomHistoryResponse">
	  select  fr.rcmmHist as rcmmHist
	  		, fr.rcmType as rcmType
	  		, fr.custNm AS custNm
	  		, fr.mbrNo	 as mbrNo
	  		, fr.mbrStatCd as mbrStatCd
	  		, fr.joinDate as joinDate
	  		, fr.rid as rid
	  		, fr.ridMbr as ridMbr
	    from(
		  SELECT  '추천 함' AS rcmmHist
		  	   ,  '가입'    AS rcmType			--유형
			   ,  secu.fn_getDecrypt(#{cipherKey},LC2.CUST_NM) AS custNm			--회원명
			   ,  lm2.MBR_NO	 AS mbrNo			--회원ID
			   ,  t1.mark_name AS mbrStatCd		--회원상태
			   ,  TO_CHAR(lm1.JOIN_DATE,'YYYY-MM-DD HH24:MI') AS joinDate --등록일시
			   ,  lm2.rid as rid
			   ,  lm2.rid as ridMbr
		     FROM LOY.LOY_MBR LM1
 			 JOIN LOY.LOY_MBR LM2 ON LM2.RID = LM1.RID_JOIN_RCMMD
  			 JOIN LOY.LOY_CUST LC2 ON LC2.RID = LM2.RID_CUST
  LEFT OUTER JOIN com.comm_code t1 ON t1.group_code = 'LOY_MEM_STAT_CD' AND t1.FLAG = 1 AND t1.code_name = lm2.MBR_STAT_CD
		    WHERE lm1.FLAG = 1
			  AND lm1.RID = #{rid}

		   UNION ALL

		   SELECT  '추천 받음' AS rcmmHist
		  	    ,  '가입' 	  AS rcmType
		  		,  secu.fn_getDecrypt(#{cipherKey},LC2.CUST_NM) AS custNm
		  		,  lm2.mbr_No  AS mbrNo
		  		,  t1.mark_name AS mbrStatCd
		  		,  TO_CHAR(lm2.JOIN_DATE,'YYYY-MM-DD HH24:MI') AS joinDate
		  		,  lm2.rid as rid
		  		,  lm2.rid as ridMbr
  			FROM LOY.LOY_MBR LM1
  			JOIN LOY.LOY_MBR LM2 ON LM2.RID_JOIN_RCMMD = LM1.RID
  			JOIN LOY.LOY_CUST LC2 ON LC2.RID = LM2.RID_CUST
  			LEFT OUTER JOIN com.comm_code t1 ON t1.group_code = 'LOY_MEM_STAT_CD' AND t1.FLAG = 1 AND t1.code_name = LM2.MBR_STAT_CD
  			WHERE LM1.FLAG = 1
		      AND LM1.RID = #{rid}
		      
		   ) fr
		   WHERE fr.rid = #{recomRid}
	</select>


	<update id="updateResetfailCnt" parameterType="mbrRecomHistoryRequest">
		UPDATE loy.LOY_MBR
		   SET DEVICE_FAIL_CNT = 0
		     , DEVICE_FAIL_DT = NULL
		 WHERE rid = #{rid}
	</update>

	<!-- 등급 목록 조회 -->
    <select id="selectMbrAllTierList" parameterType="infavor.loyalty.member.mbr.dto.request.LOYMbrTierRequestDTO" resultType="infavor.loyalty.member.mbr.dto.response.LOYMbrTierResponseDTO">
    	select
    		lt.tier_nm as tierNm
    		,lt.tier_cd as tierCd
    		,lt.rid as rid
    	from loy.loy_tiers lt
    	join loy.loy_tier_group t1 on t1.flag = 1 and t1.rid = lt.rid_tier_group
    	where 1=1
    	and lt.tier_cd_stat_cd = 'A'
    	and lt.flag = 1
    	and lt.rid not in (select rid_tier_cur from loy.loy_mbr where rid = #{ridMbr} )
    </select>

	<parameterMap id="callProcMbrTierUpdMap" type="map">
		<parameter property="ridMbr" 	jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="rid" 		jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="desc" 		jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
		<parameter property="rst" 		jdbcType="VARCHAR" javaType="java.lang.String" mode="OUT"/>
		<parameter property="rstCd" 	jdbcType="VARCHAR" javaType="java.lang.String" mode="OUT"/>
		<parameter property="rstMsg" 	jdbcType="VARCHAR" javaType="java.lang.String" mode="OUT"/>
 	</parameterMap>
	<update id="callProcMbrTierUpd" parameterMap="callProcMbrTierUpdMap" statementType="CALLABLE">
	/* LOYEventPlan.callProcMbrTierUpd */
	{
		CALL  LOY.PKG_LOY_TIER.PROC_MBR_TIER_UPD(?, ?, ?, ?, ?, ?)
	}
	</update>

	<select id="selectMaxPointLabel" parameterType="mbrPointAuthRequest" resultType="mbrPointAuthResponse">
		/* LOYMbr.selectMaxPointLabel */
		 SELECT max(CASE WHEN T6.ATTR_VAL = 'Y' THEN t5.ATTR_VAL ELSE 'N' END) as maxPoint
 	  	   FROM com.CRM_USER t1
     	   JOIN com.AUTH_USER_REL t2 ON t2.FLAG = 1 AND t2.RID_USER = t1.RID
      	   JOIN com.AUTH_GROUP t3 ON t3.FLAG = 1 AND t3.ID = t2.AUT_GROUP_ID
      	   JOIN loy.LOY_OPER_BASE t4 ON t4.FLAG = 1 AND t4.ATTR_VAL = t3.TYPE AND t4.CTG = 'SYSTEM' AND t4.TYPE_CD = 'CS_POINT_ACRL' AND t4.ATTR = 'AUTH_GROUP_TYPE'
LEFT OUTER JOIN loy.LOY_OPER_BASE_DTL t5 ON t5.FLAG = 1 AND t5.RID_OPER_BASE = t4.RID
  		   JOIN (SELECT ATTR_VAL FROM loy.LOY_OPER_BASE WHERE FLAG = 1 AND CTG = 'SYSTEM' AND TYPE_CD = 'CS_POINT_ACRL' AND ATTR = 'AMT_LIMIT_YN') T6 ON 1=1
          WHERE t1.RID = #{rid}
	</select>

	<select id="selectOneYearBeforeAcrlPoint" parameterType="mbrItemRequest" resultType="mbrItemResponse">
	/* LOYMbr.selectOneYearBeforeAcrlPoint*/
	   SELECT nvl(EXTR_PNT_AMT,0) AS oneYearBeforeAcrlPoint
         FROM LOY.LOY_MBR_TIER_HIST
        WHERE TIER_CALC_GB ='UP'
           AND TIER_CALC_DATE >= TRUNC(SYSDATE, 'MM')
          AND RID_MBR = #{rid}
          AND ROWNUM = 1
	</select>

	<select id="selectLastYearBeforeAcrlPoint" parameterType="mbrItemRequest" resultType="mbrItemResponse">
	/* LOYMbr.selectLastYearBeforeAcrlPoint */
	SELECT
       		nvl(EXTR_PNT_AMT,0) as lastYearBeforeAcrlPoint
         FROM   LOY.LOY_MBR_TIER_HIST
        WHERE TIER_CALC_GB = 'DOWN'
          AND TIER_CALC_DATE >= TRUNC(SYSDATE, 'YYYY')
          AND RID_MBR = #{rid}
          AND ROWNUM = 1
	</select>

	<!-- 로그인 이력 -->
	<select id="selectMbrLoginHistoryList" parameterType="mbrLoginHistoryRequest" resultType="mbrLoginHistoryResponse">
		/* LOYMbr.selectMbrLoginHistoryList */
	SELECT  fr.RID AS rid, lc2.chnl_nm AS ridChnl,
	to_char(fr.ACCESS_DT,'YYYY-MM-DD HH24:MI:SS') AS accessDt
    , ${strColumn}
	FROM loy.LOY_MBR_ACCESS_HIST fr
	LEFT OUTER JOIN loy.Loy_mbr b ON b.rid=fr.RID_MBR
    LEFT OUTER JOIN LOY.LOY_CHANNEL lc2 on lc2.flag = 1 AND fr.RID_CHNL=lc2.rid
	WHERE b.rid=#{rid}
	AND 1=1
	ORDER BY ${strOrderby}
	 ${strEndPaging}
	</select>

	<!-- 출석 이벤트 이력 -->
	<select id="selectMbrAttendEventHistList" parameterType="mbrAttendEventHistoryRequest" resultType="mbrAttendEventHistoryResponse">
	/* LOYMbr.selectMbrAttendEventHistList */
	SELECT
		  TO_CHAR(TO_DATE(lpme.PST_DT,'YYYY-MM-DD'), 'YYYY-MM-DD') AS pstDt
		, TO_CHAR(lpme.MODIFY_DATE, 'YYYY-MM-DD HH24:MI:SS') AS modifyDate
		, lpme.PNT_AMT AS pntAmt
		, lpme.TXN_UNIQ_NO AS txnUniqNo
		, ${strColumn}
	FROM loy.LOY_PST_MBR_EVT lpme
	WHERE lpme.RID_MBR=#{ridMbr}
	  AND lpme.FLAG = 1
	ORDER BY ${strOrderby}
		     ${strEndPaging}
	</select>

	<update id="updateRdmNo" parameterType="mbrRecomHistoryRequest">
	UPDATE LOY.LOY_PROD
	   SET RANDOM_REG_YN = 'Y'
	     , MODIFY_BY = #{modifyBy}
	 WHERE RANDOM_YN = 'Y'
	   AND flag = 1
	   AND PROD_ID = #{serialNo}
	</update>

	<select id="getmbrPollPrtcpStts" parameterType="LOYMbrPollPrtcpSttsRequest" resultType="LOYMbrPollPrtcpSttsResponse">
	/* LOYMbr.getmbrPollPrtcpStts */
	SELECT lp.poll_nm   as pollNm
	, lpi.item_no       as itemNo
	, lpi.item_nm       as itemNm
	, lpi.item_img      as itemImg
	, TO_CHAR(lpa.reg_dt, 'YYYY-MM-DD HH24:MI:SS') as regDt
	, TO_CHAR(lpt.APPR_DT, 'YYYY-MM-DD HH24:MI:SS') AS apprDt
	, lpt.PNT_AMT AS pntAmt
	, lp.POLL_TYPE_CD AS pollTypeCd
	,${strColumn}
	FROM loy.loy_poll lp
	JOIN loy.LOY_POLL_ITEM lpi ON lp.rid = lpi.RID_POLL AND lp.FLAG=1
	JOIN loy.LOY_POLL_ACT lpa ON lpi.RID = lpa.RID_POLL_ITEM AND lpi.FLAG=1
	LEFT OUTER JOIN loy.loy_pnt_txn lpt ON lpt.rid=lpa.RID_PNT_TXN AND lpt.FLAG=1
	WHERE ${strWhere}
	and lpa.rid_mbr =#{rid}
	AND lpa.FLAG=1
	order by ${strOrderby} ${strEndPaging}
	</select>
	
	<select id="getAlertList" parameterType="LOYMbrNoticeListRequest" resultType="LOYMbrNoticeListResponse">
	/* LOYMbr.getAlertList */
	<![CDATA[ 
	SELECT ${strColumn}
	,lbam.rid_mbr as rid
	,cc.MARK_NAME AS nType
	, REPLACE(lbam.MSG, '\n', '<P>') AS msg
	, LBAM.SHOW_YN AS showYn
	, TO_CHAR(LBAM.ACTION_DT,'YYYY-MM-DD')  AS actionDt 
	, TO_CHAR(LBAM.CONFIRM_DT,'YYYY-MM-DD hh24:mi:ss') AS confirmDt
	FROM loy.LOY_MBR_ALERT_MSG lbam
	LEFT OUTER JOIN com.COMM_CODE cc ON CC.CODE_NAME = lbam.MSG_TYPE   AND cc.GROUP_CODE = 'ALT_MSG_TYPE_CD' AND cc.FLAG =1 
	WHERE lbam.rid_mbr=#{rid} and lbam.FLAG=1 
	]]>
	</select>
	
	<!-- 회원상세 포인트거래이력 엑셀다운로드 -->
   	<select id="excelMbrPointTxnList" parameterType="mbrPtnTxnHistRequest" resultType="mbrPtnTxnHistResponse">
		/* LOYMbr.excelMbrPointTxnList */
       	SELECT    /*+ index(lpt loy_pnt_txn_ix03)*/
			  lpt.txn_uniq_no  							    AS txnUniqNo
          	, to_char(lpt.TXN_DT,'YYYY-MM-DD HH24:MI:SS')    AS txnDt
          	, to_char(lpt.APPR_DT,'YYYY-MM-DD HH24:MI:SS')   AS apprDate
          	, TRUNC(lpt.TOTAL_PNT_AVL,0) 				AS totalPntAvl
          	, cc.MARK_NAME								AS pntTxnType1Cd
          	, cc1.MARK_NAME								AS pntTxnType2Cd
<!--           	, case when mcm.id is null then '' else c11.MARK_NAME end							AS pntTxnType3Cd -->
<!--           	, case when mcm.id is null then '' else c12.MARK_NAME end							AS pntTxnType4Cd -->
          	, lm.MBR_NO 								AS mbrNo
            , lct.CUST_NM 								AS custNm
          	<!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
          	, cc2.MARK_NAME AS memDiv
          	 -->
          	, cc3.MARK_NAME 							AS memGrade
          	<!--
          	, case when CARD_NUM is null or CARD_NUM = '' then CARD_NUM
                   when lpt.card_type_cd='10' or lpt.card_type_cd='30' then com.fn_getCardNum(secu.fn_getDecrypt(#{cipherKey} ,CARD_NUM, null ))
                   else secu.fn_getDecrypt(#{cipherKey} ,CARD_NUM, 'CARD_NUM')
              end as cardNoDecoding -->
            , case when lpt.pnt_txn_type_1_cd = '200' then '-' || TRUNC(lpt.PNT_AMT,0) else to_char(TRUNC(lpt.PNT_AMT,0)) end AS pntAmt <!-- 거래유형 '사용'인 경우 '-' prefix -->
            , TRUNC(lpt.USE_PNT,0) 		AS usePnt
            , TRUNC(lpt.GIFT_PNT,0) 	AS giftPnt
<!--             , lp.PROD_NM 				AS prodNm -->
            , NVL(lpt.TXN_AMT,0) 		AS txnAmt
            , lc.rid   					AS ridChnl
            , lc.CHNL_NO 				AS chnlNo
            , lc.CHNL_NM 				AS chnlNm
            , lpt.rid 					AS rid
            , lm.rid 					AS ridMbr
            , lck.card_type 			AS mbrType
            , lmc.cprt_card_cd 			AS cprtCardCd
            , cc4.mark_name           	AS cardKndNm
            , d.mark_name             	AS cprtCard
            , nvl((SELECT TRUNC(sum(acrl_amt),0) FROM loy.loy_pnt_acrl WHERE RID_PNT_TXN = lpt.rid group by rid_pnt_txn),0) AS promoCnt
            , lpt.APPR_NO 				AS dtlApprNo
            , lpt.rcpt_no				AS rcptNo
            , lpt.txn_type_dtl_desc		AS txnTypeDtlDesc
            , liv.voc_desc 				AS acrlDesc
<!--             , CASE WHEN nvl(lpa.VALID_START_DATE,'') IS not null THEN to_char(lpa.VALID_START_DATE, 'YYYY-MM-DD') || ' ~ ' || to_char(lpa.VALID_END_DATE, 'YYYY-MM-DD') ELSE '' end as validDate -->
			,lpt.orgn_appr_no			AS orgnApprNo
			,case when lpt.orgn_appr_date is not null then to_char(to_date(lpt.orgn_appr_date, 'YYYY-MM-DD'), 'YYYY-MM-DD') else '' end as orgnApprDate <!-- 원 승인번호 -->
            ,lpt.TXN_STAT_CD  as txnStatCd
            ,lpt.APPR_DATE    AS apprDateYYYYMMDD
            ,lpt.PNT_TXN_TYPE_1_CD as pntTxnType1code
			,lpt.PNT_TXN_TYPE_2_CD as pntTxnType2code
			,cc5.MARK_NAME 				AS txnStat
            , ${strColumn}
      	FROM <if test="pntTxnDateType == &quot;A&quot;">loy.loy_pnt_txn</if>
      		<if test="pntTxnDateType != &quot;A&quot;">loy.loy_pnt_txn_archive</if> lpt
      	join loy.loy_mbr lm on lpt.RID_MBR = lm.RID and lm.flag = 1

<!--       	left outer join loy.loy_pnt_acrl lpa on lpa.rid_pnt_txn = lpt.rid -->
<!--       	left outer join mkt.mkt_cam_mst mcm on mcm.disp_no = lpa.cam_no  -->

      	JOIN loy.loy_cust lct on lct.rid= lm.RID_CUST and lct.flag = 1
<!--       	left outer join loy.loy_prod lp on lp.rid= lpt.RID_PROD -->
      	left outer join loy.loy_channel lc on lc.rid= lpt.rid_chnl and lc.flag = 1
      	LEFT OUTER JOIN loy.loy_mbr_card lmc on lmc.card_no = lpt.card_num  and lmc.flag = 1
      	LEFT OUTER JOIN loy.loy_card_kind lck on lck.rid = lmc.RID_CARD_KIND and lck.flag = 1
      	left outer join com.comm_code d  on lmc.cprt_card_cd = d.code_name  and d.group_code = 'CARD_CORP_TYPE' and d.flag  = 1  and d.lang=#{lang} and d.country = #{country}
      	inner join com.comm_code cc  on cc.CODE_NAME = lpt.PNT_TXN_TYPE_1_CD  AND cc.lang = #{lang}   AND cc.GROUP_CODE  ='PNT_TXN_TYPE' and cc.flag = 1	  <!-- asis = 'TXN_TYPE_CD_TM'  -->
      	inner join com.comm_code cc1 on cc1.CODE_NAME = lpt.PNT_TXN_TYPE_2_CD AND cc1.lang = #{lang}  AND cc1.GROUP_CODE ='PNT_TXN_DTL_TYPE' and cc1.flag = 1  <!-- asis = 'TXN_SUB_TYPE_CD' -->
        <!-- 2018.10.23.jhkim.다이소에서 사용하지 않음
        left outer join com.comm_code cc2 on cc2.CODE_NAME = lpt.MEM_DIV AND cc2.lang = #{lang}  AND cc2.GROUP_CODE='MEMBER_TYPE'
         -->
      	left outer join com.comm_code cc3 on cc3.CODE_NAME = lpt.MEM_GRADE AND cc3.lang = #{lang}  AND cc3.GROUP_CODE='MEMBER_GRADE' and cc3.flag = 1
      	left outer join com.comm_code cc4 on cc4.CODE_NAME = lpt.CARD_TYPE_CD AND cc4.lang = #{lang}  AND cc4.GROUP_CODE='MEMBER_CARD_CD' and cc4.flag = 1
      	left outer join com.comm_code cc5 on cc5.CODE_NAME = lpt.TXN_STAT_CD AND cc5.lang = #{lang}  AND cc5.GROUP_CODE='PNT_TXN_STAT_CD' and cc5.flag = 1
		LEFT OUTER JOIN loy.loy_intact_voc liv on liv.flag = 1 and liv.rid = lpt.rid_intact_data
<!--           left outer join com.comm_code c9 -->
<!--             on c9.flag = 1 and c9.lang = #{lang} and c9.code_name = mcm.PNT_ACCNT_BIG_TYPE_CD and c9.group_code = 'PNT_TXN_TYPE' -->
<!--           left outer join com.comm_code c10 -->
<!--             on c10.flag = 1 and c10.lang = #{lang} and c10.code_name = mcm.PNT_ACCNT_MID_TYPE_CD and c10.group_code = 'PNT_TXN_DTL_TYPE' -->
<!--           left outer join com.comm_code c11 -->
<!--             on c11.flag = 1 and c11.lang = #{lang} and c11.code_name = mcm.PNT_ACCNT_SML_TYPE_CD and c11.group_code = 'DA_PNT_ACCNT_SML_TYPE' -->
<!--           left outer join com.comm_code c12 -->
<!--             on c12.flag = 1 and c12.lang = #{lang} and c12.code_name = mcm.PNT_ACCNT_DETAIL_TYPE_CD and c12.group_code = 'DA_PNT_ACCNT_DETAIL_TYPE' -->

      	where ${strWhere}
          and lm.rid = #{rid}
            <if test="searchType == &quot;DATE&quot;">
             and lpt.TXN_DT BETWEEN TO_DATE(#{startDt},'YYYY-MM-DD') AND TO_DATE(#{endDt},'YYYY-MM-DD')
            </if>
            <if test="searchType == &quot;ACRL&quot;">
          and lpt.PNT_TXN_TYPE_1_CD = '100'
            </if>
            <if test="searchType == &quot;RDM&quot;">
              and lpt.PNT_TXN_TYPE_1_CD ='200'
            </if>
            <if test="searchType == &quot;PARTNER&quot;">
              and lmc.cprt_card_cd is not null and  lmc.cprt_card_cd !=''
            </if>
            <if test="searchType == &quot;BUTANE&quot;">
              and lpt.RID_PROD ='1-VGCR'
            </if>
	  order by ${strOrderby}, lpt.rowid DESC <!-- , lpa.rid -->
	  ${strEndPaging}
    </select>
	
</mapper>