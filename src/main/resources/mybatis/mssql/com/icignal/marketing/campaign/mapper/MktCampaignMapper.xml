<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Wed May 02 13:32:29 KST 2018 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.icignal.marketing.campaign.mapper.MktCampaignMapper">


    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : 캠페인 기획/실행 목록
    -   설명                  : 캠페인 기획/실행 목록 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.09.23
    ***************************************/ -->
    <select id="selectCampaignList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignListResDto">
        /* MktCampaignMapper.selectCampaignList */
        select c.ID
        , c.CREATE_BY as createBy
        , c.MODIFY_BY as modifyBy
        , c.CREATE_DATE as createDate
        , c.MODIFY_DATE as modifyDate
--         , c.OFFER_ID as offerId
        , c.DISP_NO as dispNo
        , c2.CODE_NAME as campaignStatusCode
        , c2.MARK_NAME as campaignStatusCodeName
        , c.CAM_NM as campaignName
        , c.CAM_DESC as description
        , com.TO_CHAR(c.CAM_START_DD,'YYYY-MM-DD') as campaignStartDate
        , com.TO_CHAR(c.CAM_END_DD,'YYYY-MM-DD') as campaignEndDate
        , c.CAM_PLAN_ORG_CD as planOrgCode
        , d1.div_nm as planOrgCodeName
        , c4.CODE_NAME as exeOrgLvlCode
        , c4.MARK_NAME as exeOrgLvlCodeName
        , c.CAM_PLNER as campaignPlanner
        , mo.name as campaignPlannerName
        , c5.CODE_NAME as campaignPurposeCode
        , c5.MARK_NAME as campaignPurposeCodeName
        , c6.CODE_NAME as campaignMethodCode
        , c6.MARK_NAME as campaignMethodCodeName
        , c.CAM_METH_DESC as campaignMethodDesc
        , c7.CODE_NAME as channelTypeCode
        , c7.MARK_NAME as channelTypeCodeName
        , c8.CODE_NAME as campaignTypeCode
        , c8.MARK_NAME as campaignTypeCodeName
        , c9.CODE_NAME as campaignApprovalStatusCode
        , c9.MARK_NAME as campaignApprovalStatusCodeName
        , c.PAR_CAM_ID as parCampaignId
        , c.PROGRAM_ID as programId
        , c.PLAN_ID as planId
        , c.cam_scope_type_cd as camScopeTypeCd
        , c10.MARK_NAME as camScopeTypeNm
        , c.plan_group_cd as planGroupCd
        , c11.MARK_NAME as planGroupNm
        , c.type as type
        , c.prom_yn as promYn
        , ea.elec_aprv_type_cd as aprvType
        , ea.cam_id 		   as recordRid
        , ea.id                as aprvId
        , c.OFFER_CHECK_TYPE_CD as offerCheckTypeCd
        , c14.MARK_NAME         as offerCheckTypeName
        , mkt.FN_GET_CAM_CHNL(c.ID) as concatChnlType
        , FORMAT(mkt.FN_GET_RECENT_SEND_DT(c.ID), 'yyyy-MM-dd hh:mm:ss') as recentSendDt
        , ${strColumn}
        from mkt.mkt_cam_mst c WITH (NOLOCK)
        left outer join com.comm_code c2
        WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.code_name = c.CAM_STATUS_CD and c2.group_code = 'MKT_CAM_STAT'
        left outer join com.comm_code c4
        WITH (NOLOCK) on c4.flag = 1 and c4.lang = #{lang} and c4.code_name = c.EXE_ORG_LVL_CD and c4.group_code = 'ORG_LEVEL_CD'
        left outer join com.comm_code c5
        WITH (NOLOCK) on c5.flag = 1 and c5.lang = #{lang} and c5.code_name = c.CAM_PRPS_CD and c5.group_code = 'MKT_CAM_GOAL_CD'
        left outer join com.comm_code c6
        WITH (NOLOCK) on c6.flag = 1 and c6.lang = #{lang} and c6.code_name = c.CAM_METH_CD and c6.group_code = 'MKT_CAM_SUB_GOAL_CD'
        left outer join com.comm_code c7
        WITH (NOLOCK) on c7.flag = 1 and c7.lang = #{lang} and c7.code_name = c.CHNL_TYPE_CD and c7.group_code = 'MKT_CAM_CHNL_TYPE_CD'
        left outer join com.comm_code c8
        WITH (NOLOCK) on c8.flag = 1 and c8.lang = #{lang} and c8.code_name = c.CAM_TYPE_CD and c8.group_code = 'MKT_CAM_TYPE_CD'
        left outer join com.employee e WITH (NOLOCK) on e.id = c.REQUEST_PLNER
        left outer join com.crm_division d1 WITH (NOLOCK) on d1.rid = e.rid_division
        left outer join com.com_elec_aprv ea WITH (NOLOCK) on ea.flag = 1 and ea.cam_id = c.id
        left outer join com.comm_code c9 WITH (NOLOCK) on c9.flag = 1 and c9.lang = #{lang} and c9.code_name = ea.ELEC_APRV_STATUS_CD and c9.group_code = 'EL_APPROVAL_STATUS_CD'
        left outer join com.comm_code c10     <!-- 캠페인 범위 -->
        WITH (NOLOCK) on c10.flag = 1 and c10.lang = #{lang} and c10.code_name = c.cam_scope_type_cd and c10.group_code = 'CAM_SCOPE_TYPE_CD'
        left outer join com.comm_code c11     <!-- 기획그룹 -->
        WITH (NOLOCK) on c11.flag = 1 and c11.lang = #{lang} and c11.code_name = c.plan_group_cd and c11.group_code = 'PLAN_GROUP_CD'
        LEFT OUTER JOIN com.employee mo WITH (NOLOCK) ON c.REQUEST_PLNER = mo.id AND mo.flag = '1'
        left outer join com.comm_code c12     <!-- 유형 -->
        WITH (NOLOCK) on c12.flag = 1 and c12.lang = #{lang} and c12.code_name = e.TYPE and c12.group_code = 'EMPLOYEE_TYPE'
        left outer join com.comm_code c13     <!-- 유형 -->
        WITH (NOLOCK) on c13.flag = 1 and c13.lang = #{lang} and c13.code_name = e.X_AUTH_TYPE and c13.group_code = 'EMPLOYEE_AUTH_TYPE'
        left outer join com.comm_code c14
        WITH (NOLOCK) on c14.flag = 1 and c14.lang = #{lang} and c14.code_name = c.OFFER_CHECK_TYPE_CD and c14.group_code = 'OFFER_CHECK_TYPE_CD'
        where ${strCondWhere}
        and ${strSVCType}
        and ${strWhere}
        and c.flag = 1
        and c.type = #{type}
        <if test='authType != "A" '>
            and d1.X_BRAND_CD = #{brandCd}
            <if test='authType != "B" '>
                and c.OWNER_EMPLOYEE = #{empId}
            </if>
        </if>
        order by ${strOrderby}
        ${strEndPaging}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : 캠페인 결재 목록
    -   설명                  : 캠페인 결재 목록 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 정수지
    -   작성일                : 2021.01.05
    ***************************************/ -->
    <select id="selectCampaignApprList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignListResDto">
        /* MktCampaignMapper.selectCampaignApprList */
        select c.ID
        , c.CREATE_BY as createBy
        , c.MODIFY_BY as modifyBy
        , c.CREATE_DATE as createDate
        , c.MODIFY_DATE as modifyDate

        , c.OFFER_ID as offerId
        <!-- , o.OFFER_NM as offerName -->
        <!-- , c1.MARK_NAME as offerTypeName -->

        , c.DISP_NO as dispNo

        , c2.CODE_NAME as campaignStatusCode
        , c2.MARK_NAME as campaignStatusCodeName

        , c.CAM_NM as campaignName
        , c.CAM_DESC as description
        , com.TO_CHAR(c.CAM_START_DD,'YYYY-MM-DD') as campaignStartDate
        , com.TO_CHAR(c.CAM_END_DD,'YYYY-MM-DD') as campaignEndDate

        , c.CAM_PLAN_ORG_CD as planOrgCode
        , d1.div_nm as planOrgCodeName

        , c4.CODE_NAME as exeOrgLvlCode
        , c4.MARK_NAME as exeOrgLvlCodeName

        , c.CAM_PLNER as campaignPlanner
        , mo.name as campaignPlannerName

        , c5.CODE_NAME as campaignPurposeCode
        , c5.MARK_NAME as campaignPurposeCodeName

        , c6.CODE_NAME as campaignMethodCode
        , c6.MARK_NAME as campaignMethodCodeName
        , c.CAM_METH_DESC as campaignMethodDesc

        , c7.CODE_NAME as channelTypeCode
        , c7.MARK_NAME as channelTypeCodeName

        , c8.CODE_NAME as campaignTypeCode
        , c8.MARK_NAME as campaignTypeCodeName

        , c9.CODE_NAME as campaignApprovalStatusCode
        , c9.MARK_NAME as campaignApprovalStatusCodeName

        , c.PAR_CAM_ID as parCampaignId
        , c.PROGRAM_ID as programId

        , c.PLAN_ID as planId
        , c.cam_scope_type_cd as camScopeTypeCd
        , c10.MARK_NAME as camScopeTypeNm
        , c.plan_group_cd as planGroupCd
        , c11.MARK_NAME as planGroupNm
        , c.type as type
        , c.prom_yn as promYn

        , h.elec_aprv_seq      as seq
        , h.id				   as itemId
        , h.apvr_type_cd       as apvrTypeCd
        , ea.elec_aprv_type_cd as aprvType
        , ea.cam_id 		   as recordRid
        , ea.id                as aprvId

        , mcc.chnl_type_cd as chnlTypeCd

        , com.nvl(th.CAM_TGT_CNT, 0)      as campaignTargetCount
        , ${strColumn}
        from mkt.mkt_cam_mst c WITH (NOLOCK)
        <!--   left outer join mkt.mkt_cam_offer_rel r on r.flag = 1 and r.cam_id = c.id
          left outer join mkt.mkt_offer_mst     o on r.OFFER_ID = o.id -
          left outer join com.comm_code c1
            on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = o.OFFER_TYPE_CD and c1.group_code = 'OFFER_TYPE_CD'-->
        left outer join com.comm_code c2
        WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.code_name = c.CAM_STATUS_CD and c2.group_code = 'MKT_CAM_STAT'
        left outer join com.comm_code c4
        WITH (NOLOCK) on c4.flag = 1 and c4.lang = #{lang} and c4.code_name = c.EXE_ORG_LVL_CD and c4.group_code = 'ORG_LEVEL_CD'
        left outer join com.comm_code c5
        WITH (NOLOCK) on c5.flag = 1 and c5.lang = #{lang} and c5.code_name = c.CAM_PRPS_CD and c5.group_code = 'MKT_CAM_GOAL_CD'
        left outer join com.comm_code c6
        WITH (NOLOCK) on c6.flag = 1 and c6.lang = #{lang} and c6.code_name = c.CAM_METH_CD and c6.group_code = 'MKT_CAM_SUB_GOAL_CD'
        left outer join com.comm_code c7
        WITH (NOLOCK) on c7.flag = 1 and c7.lang = #{lang} and c7.code_name = c.CHNL_TYPE_CD and c7.group_code = 'MKT_CAM_CHNL_TYPE_CD'
        left outer join com.comm_code c8
        WITH (NOLOCK) on c8.flag = 1 and c8.lang = #{lang} and c8.code_name = c.CAM_TYPE_CD and c8.group_code = 'MKT_CAM_TYPE_CD'
        left outer join com.employee e WITH (NOLOCK) on e.id = c.CAM_PLNER
        left outer join com.crm_division d1 WITH (NOLOCK) on d1.rid = e.rid_division
        left outer join com.com_elec_aprv ea WITH (NOLOCK) on ea.flag = 1 and ea.cam_id = c.id
        left outer join com.comm_code c9 WITH (NOLOCK) on c9.flag = 1 and c9.lang = #{lang} and c9.code_name = ea.ELEC_APRV_STATUS_CD and c9.group_code = 'EL_APPROVAL_STATUS_CD'
        left outer join com.comm_code c10     <!-- 캠페인 범위 -->
        WITH (NOLOCK) on c10.flag = 1 and c10.lang = #{lang} and c10.code_name = c.cam_scope_type_cd and c10.group_code = 'CAM_SCOPE_TYPE_CD'
        left outer join com.comm_code c11     <!-- 기획그룹 -->
        WITH (NOLOCK) on c11.flag = 1 and c11.lang = #{lang} and c11.code_name = c.plan_group_cd and c11.group_code = 'PLAN_GROUP_CD'
        LEFT OUTER JOIN com.crm_user cu WITH (NOLOCK) ON c.CREATE_BY = cu.RID
        LEFT OUTER JOIN com.employee mo WITH (NOLOCK) ON cu.ID_EMPLOYEE = mo.id AND mo.flag = '1'
        LEFT OUTER JOIN com.com_elec_aprv_item h on h.elec_aprv_id = ea.id and h.flag = '1'
        LEFT OUTER JOIN com.mkt_conts_chnl_rel mccr WITH (NOLOCK) ON mccr.CAM_ID = c.id
        LEFT OUTER JOIN mkt.mkt_chnl mcc WITH (NOLOCK) on mcc.id = mccr.MKT_CHNL_ID
        LEFT OUTER JOIN mkt.mkt_tgt_had th WITH (NOLOCK) on th.CAM_ID = c.ID
        where ${strCondWhere}<!-- 공통조회조건 파라미터 -->
        and ${strSVCType}<!-- list 기본 파라미터 -->
        and ${strWhere}<!-- 그리드 검색 파라미터 -->
        <!-- 데이터 권한 파라미터 -->
        <!--            and ${strDataAuthWhere} -->
        and c.flag = 1
        and c.type = #{type}
        and c9.CODE_NAME is not null
        order by ${strOrderby}<!-- 그리드에서 파라미터를 받아서 order by를 함. -->
        ${strEndPaging}<!-- 그리드 페이징1,2,3,... -->
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (getCampaignWorkflowStatusList)
    ============================================
    -   제목                  : 캠페인 워크플로우 진행현황 목록
    -   설명                  : 캠페인 워크플로우 진행현황 목록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.09.23
    ***************************************/ -->
    <select id="selectCampaignWorkflowStatusList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWorkflowStatusReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignWorkflowStatusListResDto">
        /* MktCampaignMapper.selectCampaignWorkflowStatusList */
        select wfc.ID
        , wfc.CREATE_BY as createBy
        , wfc.MODIFY_BY as modifyBy
        , wfc.CREATE_DATE as createDate
        , wfc.MODIFY_DATE as modifyDate

        , wfc.CAM_ID as campaignId
        , wfc.WF_ID as workflowId

        , c1.CODE_NAME as statusCode
        , c1.MARK_NAME as statusCodeName

        , wfc.TASK_ID as taskId
        , wfc.TASK_NM as taskName
        , wfc.TASK_DESC as taskDesc

        , c2.CODE_NAME as taskTypeCode
        , c2.MARK_NAME as taskTypeCodeName

        , c3.CODE_NAME as nodeTypeCode
        , c3.MARK_NAME as nodeTypeCodeName

        , wfc.ACT_TASK_ID as actualTaskId

        from mkt.mkt_cam_wf_rel wfc WITH (NOLOCK)
        left outer join com.comm_code c1
        WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = wfc.TASK_PROGR_STATUS_CD and c1.group_code = 'MKT_TASK_TYPE'
        left outer join com.comm_code c2
        WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.code_name = wfc.TASK_TYPE_CD and c2.group_code = 'MKT_WF_NODE_TYPE'
        left outer join com.wf_task_node wtn
        WITH (NOLOCK) on wtn.id = wfc.task_id
        left outer join com.wf_node_mst wn
        WITH (NOLOCK) on wn.id = wtn.node_id
        left outer join com.comm_code c3
        WITH (NOLOCK) on c3.flag = 1 and c3.lang = #{lang} and c3.code_name = wn.NODE_TYPE_CD and c3.group_code = 'MKT_WF_NODE_TYPE'
        where ${strSVCType}
        and wfc.flag = 1
        <if test="workflowId != null and workflowId != ''">AND
            wfc.WF_ID = #{workflowId}
        </if>
        <if test="workflowId == null or workflowId == ''">AND
            wfc.CAM_ID = #{campaignId}
        </if>
        order by c3.SEQ
    </select>


    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : 캠페인 워크플로우 진행현황 등록
    -   설명                  : 캠페인 워크플로우 진행현황 등록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.09.23
    ***************************************/ -->
    <insert id="insertCampaignWorkflowStatus" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWorkflowStatusReqDto">
        /* MktCampaignMapper.insertCampaignWorkflowStatus */
        insert into mkt.mkt_cam_wf_rel
        ( ID
        , CREATE_BY
        , MODIFY_BY
        , CREATE_DATE
        , MODIFY_DATE
        , FLAG
        , CAM_ID
        , WF_ID
        , TASK_NM
        , TASK_PROGR_STATUS_CD
        , TASK_ID
        , TASK_TYPE_CD
        , TASK_DESC
        , ACT_TASK_ID
        , PAR_TASK_ID
        , CNCTR_TYPE_CD)
        values ( com.getNewID('')
               , #{createBy}
               , #{modifyBy}
               , GETDATE()
               , GETDATE()
               , 1
               , #{campaignId}
               , #{workflowId}
               , #{taskName}
               , #{statusCode}
               , #{taskId}
               , #{taskTypeCode}
               , #{taskDesc}
               , #{actualTaskId}
               , #{parTaskId}
               , #{cnctrTypeCd})
    </insert>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (editCampaignWorkflowStatus)
    ============================================
    -   제목                  : 캠페인 워크플로우 진행현황 수정
    -   설명                  : 캠페인 워크플로우 진행현황 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.09.23
    ***************************************/ -->
    <update id="updateCampaignWorkflowStatus" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWorkflowStatusReqDto">
        /* MktCampaignMapper.updateCampaignWorkflowStatus */
        update mkt.mkt_cam_wf_rel
        set MODIFY_BY            = #{modifyBy}
          , MODIFY_DATE          = GETDATE()
          , FLAG                 = 1
          , CAM_ID               = #{campaignId}
          , TASK_NM              = #{taskName}
          , TASK_PROGR_STATUS_CD = #{statusCode}
          , TASK_ID              = #{taskId}
          , TASK_TYPE_CD         = #{taskTypeCode}
          , TASK_DESC            = #{taskDesc}
          , ACT_TASK_ID          = #{actualTaskId}
          , PAR_TASK_ID          = #{parTaskId}
          , CNCTR_TYPE_CD        = #{cnctrTypeCd}
        where id = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (removeAllCampaignWorkflowStatusByWorkflowId)
    ============================================
    -   제목                  : 캠페인 워크플로우 진행현황 삭제 By workflow ID
    -   설명                  : 캠페인 워크플로우 진행현황 삭제 By workflow ID
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.09.23
    ***************************************/ -->
    <update id="deleteAllCampaignWorkflowStatusByWorkflowId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWorkflowStatusReqDto">
        /* MktCampaignMapper.deleteAllCampaignWorkflowStatusByWorkflowId */
        update mkt.mkt_cam_wf_rel
        set flag        = flag + 1
          , MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
        where WF_ID = #{workflowId}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : 캠페인 기본정보
    -   설명                  : 캠페인 기본정보 조회
    -   결과형태              :
    ============================================
    -   입력
    -   id                    : 캠페인 아이디
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.09.23
    ***************************************/ -->
    <select id="selectCampaignDefaultInfo" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignDefaultInfoResDto">
        /* MktCampaignMapper.selectCampaignDefaultInfo */
        select c.ID
             , c.CREATE_BY                                         as createBy
             , c.MODIFY_BY                                         as modifyBy
             , com.TO_CHAR(c.CREATE_DATE, 'YYYY-MM-DD HH24:MI:SS') as createDate
             , com.TO_CHAR(c.MODIFY_DATE, 'YYYY-MM-DD HH24:MI:SS') as modifyDate
             , c.OFFER_ID                                          as offerId
             , o.OFFER_NM                                          as offerName
             , c1.MARK_NAME                                        as offerTypeCodeName
             , c.DISP_NO                                           as dispNo
             , c.CAM_STATUS_CD                                     as campaignStatusCode
             , c2.MARK_NAME                                        as campaignStatusCodeName
             , c.CAM_NM                                            as campaignName
             , c.CAM_DESC                                          as description
             , com.TO_CHAR(c.CAM_START_DD, 'YYYY-MM-DD')           as campaignStartDate
             , com.TO_CHAR(c.CAM_END_DD, 'YYYY-MM-DD')             as campaignEndDate
             , c.CAM_PLAN_ORG_CD                                   as planOrgCode
             , acc.DIV_NM                                          as planOrgCodeName
             , c.EXE_ORG_LVL_CD                                    as exeOrgLvlCode
             , c4.MARK_NAME                                        as exeOrgLvlCodeName
             , c.CAM_PLNER                                         as campaignPlanner
             , mo.NAME                                             as campaignPlannerName
             , mo.emp_no                                           as campaignPlannerEmpNo
             , c.CAM_PRPS_CD                                       as campaignPurposeCode
             , c5.MARK_NAME                                        as campaignPurposeCodeName
             , c.CAM_METH_CD                                       as campaignMethodCode
             , c6.MARK_NAME                                        as campaignMethodCodeName
             , c.CAM_METH_DESC                                     as campaignMethodDesc
             , c.CHNL_TYPE_CD                                      as channelTypeCode
             , c7.MARK_NAME                                        as channelTypeCodeName
             , c8.CODE_NAME                                        as campaignTypeCode
             , c8.MARK_NAME                                        as campaignTypeCodeName
             , c.PAR_CAM_ID                                        as parCampaignId
             , t1.disp_no                                          as parDispNo
             , c.PROGRAM_ID                                        as programId
             , p.CAM_PROG_NM                                       as programName
             , c.CAM_TEMP_USE_YN                                   as camTemplateUseYn
             , c.FATI_EXCEPT_YN                                    as fatigueExceptYn
             , c.CAM_CTG_CD_ID                                     as campaignCategoryCodeId
             , c.prom_type                                         as promType
             , c11.mark_name                                       as promTypeNm
             , c.prom_sub_type                                     as promSubType
             , c12.mark_name                                       as promSubTypeNm
             , c.exec_type                                         as execType
             , c13.mark_name                                       as execTypeNm
             , c.rule_prod_type                                    as ruleProdType
             , c14.mark_name                                       as ruleProdTypeNm
             , c.PLAN_ID                                           as planId
             , mp.PLAN_NM                                          as planNm
             , c.cam_scope_type_cd                                 as camScopeTypeCd
             , c.plan_group_cd                                     as planGroupCd
             , c.prms_except_yn                                    as prmsExceptYn
             , c.prom_yn                                           as promYn
             , c15.CODE_NAME                                       as campaignApprovalStatusCode
             , c15.MARK_NAME                                       as campaignApprovalStatusCodeName
             , c.type                                              as type
             , c.b2c_ref_key                                       as b2cRefKey
             , c.event_yn                                          as eventYn
             , c.PNT_ACCNT_BIG_TYPE_CD                             as pntAccntBigTypeCd
             , c.PNT_ACCNT_MID_TYPE_CD                             as pntAccntMidTypeCd
             , c.PNT_ACCNT_SML_TYPE_CD                             as pntAccntSmlTypeCd
             , c.PNT_ACCNT_DETAIL_TYPE_CD                          as pntAccntDetailTypeCd
             , c.PNT_ACCNT_CUST_DISP_TXT                           as pntAccntCustDispTxt
             , c.PNT_ACCNT_CODE_VAL                                as pntAccntCodeVal
             , lit.INTACT_TYPE_2_CD                                as intactType2Code
             , c16.MARK_NAME                                       AS intactType2CodeName
             , moRequest.NAME                                      as campaignRequestName
             , c.REQUEST_PLNER                                     as campaignRequest
             , c.GA_TAG_VAL                                        as gaTagVal
        from mkt.mkt_cam_mst c WITH (NOLOCK)
                 LEFT OUTER JOIN mkt.MKT_INTACT_TYPE lit WITH (NOLOCK) ON lit.rid = c.RID_INTACT_TYPE AND lit.FLAG = 1
                 LEFT OUTER JOIN com.COMM_CODE c16 WITH (NOLOCK) ON c16.GROUP_CODE = 'MKT_INTACT_DTL_TYPE' AND c16.CODE_NAME = lit.INTACT_TYPE_2_CD AND c16.flag = 1
                 left outer join mkt.mkt_cam_offer_rel r WITH (NOLOCK) on r.flag = 1 and r.cam_id = c.id
                 left outer join mkt.mkt_offer_mst o WITH (NOLOCK) on r.OFFER_ID = o.id
                 left outer join com.comm_code c1
            WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = o.OFFER_TYPE_CD and c1.group_code = 'OFFER_TYPE_CD'
                 left outer join com.comm_code c2
            WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.code_name = c.CAM_STATUS_CD and c2.group_code = 'MKT_CAM_STAT'
                 left outer join com.comm_code c4
            WITH (NOLOCK) on c4.flag = 1 and c4.lang = #{lang} and c4.code_name = c.EXE_ORG_LVL_CD and c4.group_code = 'ORG_LEVEL_CD'
                 left outer join com.comm_code c5
            WITH (NOLOCK) on c5.flag = 1 and c5.lang = #{lang} and c5.code_name = c.CAM_PRPS_CD and c5.group_code = 'MKT_CAM_GOAL_CD'
                 left outer join com.comm_code c6
            WITH (NOLOCK) on c6.flag = 1 and c6.lang = #{lang} and c6.code_name = c.CAM_METH_CD and c6.group_code = 'MKT_CAM_SUB_GOAL_CD'
                 left outer join com.comm_code c7
            WITH (NOLOCK) on c7.flag = 1 and c7.lang = #{lang} and c7.code_name = c.CHNL_TYPE_CD and c7.group_code = 'MKT_CAM_CHNL_TYPE_CD'
                 left outer join com.comm_code c8
            WITH (NOLOCK) on c8.flag = 1 and c8.lang = #{lang} and c8.code_name = c.CAM_TYPE_CD and c8.group_code = 'MKT_CAM_TYPE_CD'
                 left outer join com.employee e WITH (NOLOCK) on e.id = c.CAM_PLNER
                 left outer join mkt.mkt_prog p WITH (NOLOCK) on p.id = c.PROGRAM_ID
                 left outer join com.crm_division acc WITH (NOLOCK) on acc.rid = c.CAM_PLAN_ORG_CD
                 left outer join com.com_elec_aprv ea WITH (NOLOCK) on ea.flag = 1 and ea.cam_id = c.id
                 left outer join mkt.mkt_plan mp WITH (NOLOCK) on mp.id = c.plan_id
                 left outer join mkt.mkt_cam_mst t1 WITH (NOLOCK) on t1.id = c.par_cam_id
                 left outer join com.comm_code c11
            WITH (NOLOCK) on c11.flag = 1 and c11.lang = #{lang} and c11.code_name = c.prom_type and c11.group_code = 'LOY_PROM_TYPE'
                 left outer join com.comm_code c12
            WITH (NOLOCK) on c12.flag = 1 and c12.lang = #{lang} and c12.code_name = c.prom_sub_type and c12.group_code = 'LOY_PROM_SUB_TYPE'
                 left outer join com.comm_code c13
            WITH (NOLOCK) on c13.flag = 1 and c13.lang = #{lang} and c13.code_name = c.exec_type and c13.group_code = 'LOY_EXEC_TYPE'
                 left outer join com.comm_code c14
            WITH (NOLOCK) ON c14.flag = 1 and c14.lang = #{lang} and c14.code_name = c.rule_prod_type and c14.group_code = 'RULE_PROD_TYPE'
                 left outer join com.comm_code c15
            WITH (NOLOCK) on c15.flag = 1 and c15.lang = #{lang} and c15.code_name = ea.ELEC_APRV_STATUS_CD and c15.group_code = 'EL_APPROVAL_STATUS_CD'
                 LEFT OUTER JOIN com.employee mo WITH (NOLOCK) ON c.CAM_PLNER = mo.id AND mo.flag = '1'
                 LEFT OUTER JOIN com.employee moRequest WITH (NOLOCK) ON c.REQUEST_PLNER = moRequest.id AND mo.flag = '1'
        where c.id = #{id}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getCampaignIdCheck)
    ============================================
    -   제목                  : 캠페인 아이디 확인
    -   설명                  : 캠페인 아이디 확인
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.16
    ***************************************/ -->
    <select id="selectCampaignIdCheck" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignDefaultInfoReqDto" resultType="java.lang.Integer">
        /* MKTWorkflow.selectCampaignIdCheck */
        select count(1)
        from mkt.mkt_cam_mst
        where id = #{id}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(addCampaignDefaultInfo)
    ============================================
    -   제목                  : 캠페인 마스터 등록
    -   설명                  : 캠페인 마스터 등록(캠페인 기본정보 등록)
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.16
    ***************************************/ -->
    <insert id="insertCampaignMaster" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignDefaultInfoReqDto" useGeneratedKeys="false">
        /* MktCampaignMapper.insertCampaignMaster */

        <selectKey keyProperty="getCampaignNo" resultType="java.lang.String" statementType="CALLABLE" order="BEFORE">
            declare @OUTDATA NVARCHAR(MAX)
            EXEC mkt.getCampaignNo @OUTDATA OUTPUT;
            SELECT @OUTDATA as getCampaignNo
        </selectKey>
<!--
        <selectKey keyProperty="employeeId, divisionId" resultType="java.lang.String" order="BEFORE">
            select e.id as employeeId, cd.rid as divisionId
            from com.CRM_USER cu
            left outer join com.EMPLOYEE e on cu.ID_EMPLOYEE = e.ID
            left outer join com.CRM_DIVISION cd on e.RID_DIVISION = cd.RID
            where cu.rid = #{id}
        </selectKey>-->

        insert into mkt.mkt_cam_mst (
        ID
        , CREATE_BY
        , MODIFY_BY
        , CREATE_DATE
        , MODIFY_DATE
        , FLAG
        , OFFER_ID
        , DISP_NO
        , CAM_STATUS_CD
        , CAM_NM
        , CAM_DESC
        <if test="campaignStartDate != null and campaignStartDate != ''">
            , CAM_START_DD
        </if>
        <if test="campaignEndDate != null and campaignEndDate != ''">
            , CAM_END_DD
        </if>
        , CAM_PLAN_ORG_CD
        , EXE_ORG_LVL_CD
        , CAM_PLNER
        , CAM_PRPS_CD
        , CAM_METH_CD
        , CAM_METH_DESC
        , CHNL_TYPE_CD
        , CAM_TYPE_CD
        , PAR_CAM_ID
        , PROGRAM_ID
        <!-- , CAM_TEMP_USE_YN -->
        , FATI_EXCEPT_YN
        , RID_INTACT_TYPE
        , RID_PGM
        , TYPE
        , PRMS_EXCEPT_YN
        , PROM_YN
        , PLAN_ID
        , CAM_SCOPE_TYPE_CD
        , PLAN_GROUP_CD
        , b2c_ref_key
        , event_yn
        , PNT_ACCNT_BIG_TYPE_CD
        , PNT_ACCNT_MID_TYPE_CD
        , PNT_ACCNT_SML_TYPE_CD
        , PNT_ACCNT_DETAIL_TYPE_CD
        , PNT_ACCNT_CUST_DISP_TXT
        , PNT_ACCNT_CODE_VAL
        , OWNER_DIVISION
        , OWNER_EMPLOYEE
        , REQUEST_PLNER
        , GA_TAG_VAL
        )
        select
        #{id}
        , #{createBy}
        , #{modifyBy}
        , GETDATE()
        , GETDATE()
        , 1
        , #{offerId}
        , #{getCampaignNo}
        , #{campaignStatusCode}
        , #{campaignName}
        , #{description}
        <if test="campaignStartDate != null and campaignStartDate != ''">
            , com.TO_DATE(#{campaignStartDate} + ' 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
        </if>
        <if test="campaignEndDate != null and campaignEndDate != ''">
            , com.TO_DATE(#{campaignEndDate} + ' 23:59:59', 'YYYY-MM-DD HH24:MI:SS')
        </if>
        , #{planOrgCode}
        , #{exeOrgLvlCode}
        , #{campaignPlanner}
        , #{campaignPurposeCode}
        , #{campaignMethodCode}
        , #{campaignMethodDesc}
        , #{channelTypeCode}
        , #{campaignTypeCode}
        , #{parCampaignId}
        , #{programId}
        <!-- , #{camTemplateUseYn} -->
        , #{fatigueExceptYn}
        , #{ridIntactType}
        , #{loyProgramId}
        , #{type}
        , #{prmsExceptYn}
        , #{promYn}
        , #{planId}
        , #{camScopeTypeCd}
        , #{planGroupCd}
        , #{b2cRefKey}
        , #{eventYn}
        , #{pntAccntBigTypeCd}
        , #{pntAccntMidTypeCd}
        , #{pntAccntSmlTypeCd}
        , #{pntAccntDetailTypeCd}
        , #{pntAccntCustDispTxt}
        , #{pntAccntCodeVal}
        , (select cd.rid
        from com.CRM_USER cu
        left outer join com.EMPLOYEE e on cu.ID_EMPLOYEE = e.ID
        left outer join com.CRM_DIVISION cd on e.RID_DIVISION = cd.RID
        where cu.rid = #{createBy}) as divisionId
        , (select e.id
            from com.CRM_USER cu
            left outer join com.EMPLOYEE e on cu.ID_EMPLOYEE = e.ID
            where cu.rid = #{createBy})   as employeeId
        ,#{campaignRequestName}
        ,#{gaTagVal}
    </insert>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(editCampaignDefaultInfo)
    ============================================
    -   제목                  : 캠페인 마스터 수정
    -   설명                  : 캠페인 마스터 수정(캠페인 기본정보 수정)
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.16
    ***************************************/ -->
    <update id="updateCampaignMaster" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignDefaultInfoReqDto">
        /* MktCampaignMapper.updateCampaignMaster */
        update mkt.mkt_cam_mst
        set
        MODIFY_BY = #{modifyBy}
        , MODIFY_DATE = GETDATE()
        , FLAG = 1
        , TYPE = #{type}
        , OFFER_ID = #{offerId}
        , CAM_STATUS_CD = #{campaignStatusCode}
        , CAM_NM = #{campaignName}
        , CAM_DESC = #{description}
        <if test="campaignStartDate != null and campaignStartDate != ''">
            , CAM_START_DD = com.TO_DATE(#{campaignStartDate} + ' 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
        </if>
        <if test="campaignEndDate != null and campaignEndDate != ''">
            , CAM_END_DD = com.TO_DATE(#{campaignEndDate} + ' 23:59:59', 'YYYY-MM-DD HH24:MI:SS')
        </if>
        <!-- , CAM_PLAN_ORG_CD = #{planOrgCode} -->
        , EXE_ORG_LVL_CD = #{exeOrgLvlCode}
        , CAM_PRPS_CD = #{campaignPurposeCode}
        , CAM_METH_CD = #{campaignMethodCode}
        , CAM_METH_DESC = #{campaignMethodDesc}
        , CHNL_TYPE_CD = #{channelTypeCode}
        , CAM_TYPE_CD = #{campaignTypeCode}
        , PAR_CAM_ID = #{parCampaignId}
        , PROGRAM_ID = #{programId}
        <!-- , CAM_TEMP_USE_YN = #{camTemplateUseYn} -->
        , FATI_EXCEPT_YN = #{fatigueExceptYn}
        , PRMS_EXCEPT_YN = #{prmsExceptYn}
        , PROM_YN = #{promYn}
        , PLAN_ID = #{planId}
        , PLAN_GROUP_CD = #{planGroupCd}

        , b2c_ref_key = #{b2cRefKey}
        , event_yn = #{eventYn}

        , RID_INTACT_TYPE = #{ridIntactType}
        , PNT_ACCNT_BIG_TYPE_CD = #{pntAccntBigTypeCd}
        , PNT_ACCNT_MID_TYPE_CD = #{pntAccntMidTypeCd}
        , PNT_ACCNT_SML_TYPE_CD = #{pntAccntSmlTypeCd}
        , PNT_ACCNT_DETAIL_TYPE_CD = #{pntAccntDetailTypeCd}
        , PNT_ACCNT_CUST_DISP_TXT = #{pntAccntCustDispTxt}

        , PNT_ACCNT_CODE_VAL = #{pntAccntCodeVal}
        , REQUEST_PLNER = #{campaignRequestName}
        , GA_TAG_VAL = #{gaTagVal}
        where ID = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(editCampaignWorkflowRel)
    ============================================
    -   제목                  : 캠페인 워크플로우 관계 수정
    -   설명                  : 캠페인 워크플로우 관계 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.16
    ***************************************/ -->
    <update id="updateCampaignWorkflowRel" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWorkflowReqDto">
        /* MktCampaignMapper.updateCampaignWorkflowRel */
        update com.wf_task_had
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , PAR_ID      = #{campaignId}
        where id = #{workflowId}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(editCampaignWorkflowRel)
    ============================================
    -   제목                  : 캠페인 워크플로우 상태 수정
    -   설명                  : 캠페인 워크플로우 상태 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="updateCampaignStatus" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignDefaultInfoReqDto">
        /* MktCampaignMapper.updateCampaignStatus */
        update mkt.mkt_cam_mst
        set MODIFY_BY     = #{modifyBy}
          , MODIFY_DATE   = GETDATE()
          , CAM_STATUS_CD = #{campaignStatusCode}
        where ID = #{id}
    </update>

    <!-- 캠페인 실행정보아이템 수정(활성) -->
    <update id="updateCampaignExeInfoStatusActive" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignDefaultInfoReqDto">
        /* MktCampaignMapper.updateCampaignStatus */
        update mkt.mkt_exe_info_item
        set exe_info_status_cd = 'A'
          , modify_by          = #{modifyBy}
          , modify_date        = GETDATE()
        where flag = 1
          and exe_info_status_cd = 'W'
          and cam_id = #{id}
    </update>

    <!-- 캠페인 실행정보아이템 (중지) -->
    <update id="updateCampaignExeInfoStatusStop" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignDefaultInfoReqDto">
        /* MktCampaignMapper.updateCampaignExeInfoStatusStop */
        update mkt.mkt_exe_info_item
        set exe_info_status_cd = 'C'
          , modify_by          = #{modifyBy}
          , modify_date        = GETDATE()
        where flag = 1
          and exe_info_status_cd IN ('A', 'W')
          and cam_id = #{id}
    </update>

    <!-- 캠페인 실행정보채널 (중지) -->
    <update id="updateCampaignExeInfoChnlStatusStop" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignDefaultInfoReqDto">
        /* MktCampaignMapper.updateCampaignExeInfoChnlStatusStop */
        update mkt.mkt_exe_info_chnl
        set exe_info_status_cd = 'C'
          , modify_by          = #{modifyBy}
          , modify_date        = GETDATE()
        where flag = 1
          and exe_info_status_cd IN ('A', 'W')
          and cam_id = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getCampaignProgramList)
    ============================================
    -   제목                  : 캠페인 프로그램 목록 조회
    -   설명                  : 캠페인 프로그램 목록 조회
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.27
    ***************************************/ -->
    <select id="selectCampaignProgramList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignProgramReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignProgramListResDto">
        /* MktCampaignMapper.selectCampaignProgramList */
        select p.ID            as id
             , p.CREATE_BY     as createBy
             , p.MODIFY_BY     as modifyBy
             , p.CREATE_DATE   as createDate
             , p.MODIFY_DATE   as modifyDate

             , p.CAM_PROG_NO   as campaignProgramNo
             , p.CAM_PROG_NM   as campaignProgramName
             , p.CAM_PROG_DESC as campaignProgramDesc
        from mkt.mkt_prog p WITH (NOLOCK)
        where ${strWhere}
          and ${strSVCType}
          and p.flag = 1
        order by ${strOrderby} ${strEndPaging}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getCampaignProgNo)
    ============================================
    -   제목                  : 캠페인 표시번호
    -   설명                  : 캠페인 표시번호
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.16
    ***************************************/ -->
    <select id="selectCampaignProgNo" resultType="java.lang.String">
        /* MKTWorkflow.selectCampaignProgNo */
        select CONCAT('P', replace(SUBSTRING(com.TO_CHAR(GETDATE(), 'YYYY-MM-DD HH24:MI:SS'), 1, 4), '-', ''),
                      com.nvl(LPAD(MAX(SUBSTRING(cam_prog_no, 5)) + 1, 5, '0'), '00001')) as camProgNo
        from mkt.mkt_prog WITH (NOLOCK)
        where cam_prog_no like concat(concat('P', replace(SUBSTRING(com.TO_CHAR(GETDATE(), 'YYYY-MM-DD HH24:MI:SS'), 1, 4), '-', '')), '%')
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(addCampaignProgram)
    ============================================
    -   제목                  : 캠페인 프로그램 등록
    -   설명                  : 캠페인 프로그램 등록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.27
    ***************************************/ -->
    <insert id="insertCampaignProgram" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignProgramReqDto">
        /* MktCampaignMapper.insertCampaignProgram */
        insert into mkt.mkt_prog
        ( ID
        , CREATE_BY
        , MODIFY_BY
        , CREATE_DATE
        , MODIFY_DATE
        , FLAG
        , CAM_PROG_NO
        , CAM_PROG_NM
        , CAM_PROG_DESC )
        values
        ( #{id}
        , #{createBy}
        , #{modifyBy}
        , GETDATE()
        , GETDATE()
        , 1
        , #{campaignProgramNo}
        , #{campaignProgramName}
        , #{campaignProgramDesc} )

        <selectKey keyProperty="" resultType="java.lang.String">
            select TOP 1 id from mkt.mkt_prog where id = #{id}
        </selectKey>
    </insert>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignProgram)
    ============================================
    -   제목                  : 캠페인 프로그램 등록
    -   설명                  : 캠페인 프로그램 등록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.27
    ***************************************/ -->
    <update id="deleteCampaignProgram" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignProgramReqDto">
        /* MktCampaignMapper.deleteCampaignProgram */
        update mkt.mkt_prog
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where id = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getCampaignTargetTotalCount)
    ============================================
    -   제목                  : 캠페인 대상자 헤더 전체건수
    -   설명                  : 캠페인 대상자 헤더 전체건수
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <select id="selectCampaignTargetTotalCount" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignTargetTotalCountResDto">
        /* MktCampaignMapper.selectCampaignTargetTotalCount */
        select t.campaignId,
        isnull(sum(campaignTargetTotalCount), 0) as campaignTargetTotalCount,
        isnull(sum(duplicateRemoveCount), 0) as duplicateRemoveCount,
        isnull(sum(fatigueCheckRemoveTotalCount), 0) as fatigueCheckRemoveTotalCount,
        isnull(sum(authorityCheckRemoveTotalCount), 0) as authorityCheckRemoveTotalCount,
        isnull(sum(oneCaseRemoveTotalCount), 0) as oneCaseRemoveTotalCounts,
        isnull(sum(controlGroupCount), 0) as controlGroupCount,
        isnull(case when finalCount > 0 then finalCount else 0 end, 0) as finalCount,
        t.tgtGroupId
        from (select th.CAM_ID as campaignId,
        isnull(cast(th.CAM_TGT_CNT as int), 0) as campaignTargetTotalCount,
        isnull(cast(th.DUP_RMV_CNT as int), 0) as duplicateRemoveCount,
        isnull(cast(th.FATI_CHK_RMV_CNT as int), 0) as fatigueCheckRemoveTotalCount,
        isnull(cast(th.AUTH_CHK_RMV_CNT as int), 0) as authorityCheckRemoveTotalCount,
        isnull(cast(th.ONE_CASE_RMV_CNT as int), 0) as oneCaseRemoveTotalCount,
        isnull(cast(th.CTRL_GROUP_CNT as int), 0) as controlGroupCount,
        case when th.cam_tgt_type_cd = 'IMP'
        then isnull(th.CAM_TGT_CNT, 0) - (select count(*) from mkt.mkt_tgt_dtl where flag = 1 and cam_tgt_had_id = th.id and (except_yn = 'Y' or dup_del_yn = 'Y')) -
        isnull(th.CTRL_GROUP_CNT, 0)
        else isnull(cast(th.CAM_TGT_CNT as int), 0) - isnull(cast(th.CTRL_GROUP_CNT as int), 0) end AS finalCount,
        th.tgt_group_id as tgtGroupId
        from mkt.mkt_tgt_had th WITH (NOLOCK)
        left outer join com.comm_code c1
        WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = th.CTRL_GROUP_UNIT_CD and c1.group_code = 'MKT_CNTRL_GRP_UOM'
        where ${strSVCType}
        and th.flag = 1
        <if test="campaignId != null and campaignId != ''">AND
            th.CAM_ID = #{campaignId}
        </if>
        <if test="id != null and id != ''">AND
            th.ID = #{id}
        </if>
        ) t
        where 1=1
        GROUP BY t.campaignId
        , campaignTargetTotalCount
        , duplicateRemoveCount
        , fatigueCheckRemoveTotalCount
        , authorityCheckRemoveTotalCount
        , oneCaseRemoveTotalCount
        , controlGroupCount
        , finalCount
        , t.tgtGroupId
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getCampaignTarget)
    ============================================
    -   제목                  : 캠페인 대상자 헤더
    -   설명                  : 캠페인 대상자 헤더
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <select id="selectCampaignTarget" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignTargetResDto">
        /* MktCampaignMapper.selectCampaignTarget */
        select th.ID                           as id
             , e.NAME                          as createBy
             , th.MODIFY_BY                    as modifyBy
             , th.CREATE_DATE                  as createDate
             , th.MODIFY_DATE                  as modifyDate
             , th.CAM_ID                       as campaignId
             , c1.CODE_NAME                    as campaignTargetTypeCode
             , c1.MARK_NAME                    as campaignTargetTypeCodeName
             , com.nvl(th.CAM_TGT_CNT, 0)      as campaignTargetCount
             , com.nvl(th.CTRL_GROUP_CNT, 0)   as controlGroupCount
             , th.CTRL_GROUP_AMT               as controlGroupAmt
             , c2.CODE_NAME                    as controlGroupUnitCode
             , c2.MARK_NAME                    as controlGroupUnitCodeName
             , com.nvl(th.DUP_RMV_CNT, 0)      as duplicateRemoveCount
             , com.nvl(th.FATI_CHK_RMV_CNT, 0) as fatigueCheckRemoveCount
             , com.nvl(th.AUTH_CHK_RMV_CNT, 0) as authorityCheckRemoveCount
             , com.nvl(th.ONE_CASE_RMV_CNT, 0) as oneCaseRemoveTotalCount
             , th.CAM_SEND_TGT_CNT             as finalCount
             , th.SEG_ID                       as segmentId
             , th.SEG_NM                       as segmentName
             , th.CAM_TGT_DESC                 as campaignTargetDesc
             , th.CAM_TGT_FILE_NM              as campaignTargetFileName
             , th.SEG_TGT_INC_YN               as segmentTargetIncYn
             , th.TGT_GROUP_ID                 as tgtGroupId
             , th.CTRL_GROUP_ID                as ctrlGroupId
             , tg.TGT_GROUP_NO                 as tgtGroupNo
             , tg.TGT_GROUP_NM                 AS tgtGroupNm
        from mkt.mkt_tgt_had th WITH (NOLOCK)
                 left outer join com.comm_code c1
            WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = th.CAM_TGT_TYPE_CD and c1.group_code = 'MKT_TGT_TYPE'
                 left outer join com.comm_code c2
            WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.code_name = th.CTRL_GROUP_UNIT_CD and c2.group_code = 'MKT_CNTRL_GRP_UOM'
                 left outer join com.crm_user u
            WITH (NOLOCK) on th.create_by = u.rid
                 left outer join com.employee e
            WITH (NOLOCK) on e.id = u.id_employee
                 left outer join anl.anl_tgt_group tg
            WITH (NOLOCK) on tg.id = th.CTRL_GROUP_ID
        where ${strSVCType}
          and th.flag = 1
          and th.CAM_ID = #{campaignId}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getCampaignTargetList)
    ============================================
    -   제목                  : 캠페인 대상자 헤더 목록
    -   설명                  : 캠페인 대상자 헤더 목록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <select id="selectCampaignTargetList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignTargetListResDto">
        /* MktCampaignMapper.selectCampaignTargetList */
        select ${strColumn}
             , th.ID                           as id
             , e.NAME                          as createBy
             , th.MODIFY_BY                    as modifyBy
             , th.CREATE_DATE                  as createDate
             , th.MODIFY_DATE                  as modifyDate
             , th.CAM_ID                       as campaignId
             , c1.CODE_NAME                    as campaignTargetTypeCode
             , c1.MARK_NAME                    as campaignTargetTypeCodeName
             , com.nvl(th.CAM_TGT_CNT, 0)      as campaignTargetCount
             , com.nvl(th.CTRL_GROUP_CNT, 0)   as controlGroupCount
             , th.CTRL_GROUP_AMT               as controlGroupAmt
             , c2.CODE_NAME                    as controlGroupUnitCode
             , c2.MARK_NAME                    as controlGroupUnitCodeName
             , com.nvl(th.DUP_RMV_CNT, 0)      as duplicateRemoveCount
             , com.nvl(th.FATI_CHK_RMV_CNT, 0) as fatigueCheckRemoveCount
             , com.nvl(th.AUTH_CHK_RMV_CNT, 0) as authorityCheckRemoveCount
             , com.nvl(th.ONE_CASE_RMV_CNT, 0) as oneCaseRemoveTotalCount
             , th.SEG_ID                       as segmentId
             , th.SEG_NM                       as segmentName
             , th.CAM_TGT_DESC                 as campaignTargetDesc
             , th.CAM_TGT_FILE_NM              as campaignTargetFileName
             , th.SEG_TGT_INC_YN               as segmentTargetIncYn
        from mkt.mkt_tgt_had th WITH (NOLOCK)
                 left outer join com.comm_code c1
            WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = th.CAM_TGT_TYPE_CD and c1.group_code = 'MKT_TGT_TYPE'
                 left outer join com.comm_code c2
            WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.code_name = th.CTRL_GROUP_UNIT_CD and c2.group_code = 'MKT_CNTRL_GRP_UOM'
                 left outer join com.crm_user u
            WITH (NOLOCK) on th.create_by = u.rid
                 left outer join com.employee e
            WITH (NOLOCK) on e.id = u.id_employee
        where ${strWhere}
          and ${strSVCType}
          and th.flag = 1
          and th.CAM_ID = #{campaignId}
        order by ${strOrderby} ${strEndPaging}
    </select>

    <!-- 캠페인 타겟 목록 -->
    <select id="selectCampaignTargetList2" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignTargetListResDto">
        /* MKTCampaign.selectCampaignTargetList2 */
        select th.ID                           as id
             , e.NAME                          as createBy
             , th.MODIFY_BY                    as modifyBy
             , th.CREATE_DATE                  as createDate
             , th.MODIFY_DATE                  as modifyDate

             , th.CAM_ID                       as campaignId

             , c1.CODE_NAME                    as campaignTargetTypeCode
             , c1.MARK_NAME                    as campaignTargetTypeCodeName

             , com.nvl(th.CAM_TGT_CNT, 0)      as campaignTargetCount
             , com.nvl(th.CTRL_GROUP_CNT, 0)   as controlGroupCount
             , th.CTRL_GROUP_AMT               as controlGroupAmt

             , c2.CODE_NAME                    as controlGroupUnitCode
             , c2.MARK_NAME                    as controlGroupUnitCodeName

             , com.nvl(th.DUP_RMV_CNT, 0)      as duplicateRemoveCount
             , com.nvl(th.FATI_CHK_RMV_CNT, 0) as fatigueCheckRemoveCount
             , com.nvl(th.AUTH_CHK_RMV_CNT, 0) as authorityCheckRemoveCount
             , com.nvl(th.ONE_CASE_RMV_CNT, 0) as oneCaseRemoveTotalCount
             , th.SEG_ID                       as segmentId
             , th.SEG_NM                       as segmentName
             , th.CAM_TGT_DESC                 as campaignTargetDesc
             , th.CAM_TGT_FILE_NM              as campaignTargetFileName
             , th.SEG_TGT_INC_YN               as segmentTargetIncYn
             , ${strColumn}
        from mkt.mkt_tgt_had th WITH (NOLOCK)
                 left outer join com.comm_code c1
            WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = th.CAM_TGT_TYPE_CD and c1.group_code = 'MKT_TGT_TYPE'
                 left outer join com.comm_code c2
            WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.code_name = th.CTRL_GROUP_UNIT_CD and c2.group_code = 'MKT_CNTRL_GRP_UOM'
                 left outer join com.crm_user u
            WITH (NOLOCK) on th.create_by = u.rid
                 left outer join com.employee e
            WITH (NOLOCK) on e.id = u.id_employee
        where 1 = 1
          and ${strSVCType}
          and th.flag = 1
          and th.CAM_ID = #{campaignId}
        order by th.MODIFY_DATE DESC
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getCampaignTargetDtlList)
    ============================================
    -   제목                  : 캠페인 대상자 상세 목록
    -   설명                  : 캠페인 대상자 상세 목록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <select id="selectCampaignTargetDtlList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetDtlReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignTargetDtlListResDto">
        /* MktCampaignMapper.selectCampaignTargetDtlList */
        select ${strColumn}
             , td.ID               as id
             , td.CREATE_BY        as createBy
             , td.MODIFY_BY        as modifyBy
             , td.CREATE_DATE      as createDate
             , td.MODIFY_DATE      as modifyDate

             , td.CAM_ID           as campaignId
             , td.ITEM_SEQ         as itemSeq
             , td.CAM_TGT_HAD_ID   as campaignTargetHeaderId
             , td.EXE_INFO_ITEM_ID as exeInfoItemId

             , td.MEM_ID           as memberId
             , td.CTRL_GROUP_YN    as controlGroupYn
             , td.EXCEPT_YN        as exceptionYn
             , td.DUP_DEL_YN       as duplicateDeleteYn
             , td.PRMS_CHK_DEL_YN  as permissionCheckDeleteYn
             , td.FATI_CHK_DEL_YN  as fatigueCheckDeleteYn

             , c1.CODE_NAME        as exceptionReasonCode
             , c1.MARK_NAME        as exceptionReasonCodeName

             , td.SEG_TGT_ID       as segmentTargetId

             , td.ATTRIP01         as attrip01
             , td.ATTRIP02         as attrip02
             , td.ATTRIP03         as attrip03
             , td.ATTRIP04         as attrip04
             , td.ATTRIP05         as attrip05
        from mkt.mkt_tgt_dtl td WITH (NOLOCK)
                 left outer join com.comm_code c1
            WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = td.EXPT_RSN_CD and c1.group_code = 'MKT_EXCEPT_RSN'
        where ${strWhere}
          and ${strSVCType}
          and td.flag = 1
          and td.CAM_TGT_HAD_ID = #{campaignTargetHeaderId}
          and td.CAM_ID = #{campaignId}
        order by ${strOrderby} ${strEndPaging}
    </select>

    <!-- 대상자 상세 목록  -->
    <select id="selectCampaignTargetDtlList2" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetDtlReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignTargetDtlListResDto">
        /* MktCampaignMapper.selectCampaignTargetDtlList2 */
        select ${strColumn}
        , td.ID as id
        , td.CREATE_BY as createBy
        , td.MODIFY_BY as modifyBy
        , com.TO_CHAR(td.CREATE_DATE,'YYYY-MM-DD') as createDate
        , td.MODIFY_DATE as modifyDate

        , td.CAM_ID as campaignId
        , td.ITEM_SEQ as itemSeq
        , td.CAM_TGT_HAD_ID as campaignTargetHeaderId
        , td.EXE_INFO_ITEM_ID as exeInfoItemId

        , td.MEM_ID as memberId
        , td.CTRL_GROUP_YN as controlGroupYn
        , td.EXCEPT_YN as exceptionYn
        , td.DUP_DEL_YN as duplicateDeleteYn
        , td.PRMS_CHK_DEL_YN as permissionCheckDeleteYn
        , td.FATI_CHK_DEL_YN as fatigueCheckDeleteYn

        , c1.CODE_NAME as exceptionReasonCode
        , c1.MARK_NAME as exceptionReasonCodeName

        , td.SEG_TGT_ID as segmentTargetId
        , th.SEG_NM as segmentName

        , td.ATTRIP01 as attrip01
        , td.ATTRIP02 as attrip02
        , td.ATTRIP03 as attrip03
        , td.ATTRIP04 as attrip04
        , td.ATTRIP05 as attrip05
        from mkt.mkt_tgt_dtl td WITH (NOLOCK)
        left outer join com.comm_code c1
        WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = td.EXPT_RSN_CD and c1.group_code = 'MKT_EXCEPT_RSN'
        left outer join mkt.mkt_tgt_had th
        WITH (NOLOCK) on th.flag = 1 and th.ID = td.CAM_TGT_HAD_ID
        where ${strSVCType}
        and td.flag = 1
        <if test="campaignTargetHeaderId != null and campaignTargetHeaderId != ''">AND
            td.CAM_TGT_HAD_ID = #{campaignTargetHeaderId}
        </if>
        <if test="campaignId != null and campaignId != ''">AND
            td.CAM_ID = #{campaignId}
        </if>
    </select>

    <!-- 캠페인 헤더 저장 -->
    <insert id="insertCampaignTargetHad" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTgtHadReqDto">
        /* MktCampaignMapper.insertTargetHad */
        insert into mkt.mkt_tgt_had(
        id
        , create_by
        , modify_by
        , create_date
        , modify_date
        , flag
        , cam_id
        , cam_tgt_type_cd
        , cam_tgt_cnt
        , dup_rmv_cnt
        , fati_chk_rmv_cnt
        , auth_chk_rmv_cnt
        <if test="segType == &quot;IMP&quot;">
            , cam_tgt_file_nm
        </if>
        , seg_nm
        , cal_type_cd
        , tgt_group_id
        , ctrl_group_unit_cd
        , ctrl_group_amt
        , ctrl_group_cnt
        , ctrl_group_id
        , cafe24_yn
        )
        values(
        #{targetId}
        , #{createBy}
        , #{modifyBy}
        , GETDATE()
        , GETDATE()
        , 1
        , #{camId}
        , #{segType}
        , #{targetCustCnt}
        , #{dupCnt}
        , #{fatiCnt}
        , #{prmsCnt}
        <if test="segType == &quot;IMP&quot;">
            , #{fileName}
        </if>
        , #{segName}
        , #{calType}
        , #{targetGroupId}
        , #{ctrlGroupUnitCd}
        <if test="ctrlGroupAmt != ''">
            ,#{ctrlGroupAmt}
        </if>
        <if test="ctrlGroupAmt == ''">
            ,0
        </if>
        <if test="ctrlGroupCnt != null">
            ,#{ctrlGroupCnt}
        </if>
        <if test="ctrlGroupCnt == null">
            ,0
        </if>
        , #{ctrlGroupId}
        , (select cafe24_yn from anl.anl_tgt_group where id = #{targetGroupId})
        )
    </insert>

    <!-- 대상자 헤더 아이디 조회 -->
    <select id="selectCampaignTargetHadId" parameterType="java.lang.String" resultType="java.lang.String">
        /* selectCampaignTargetHadId.insertTargetHad */
        select id
        from mkt.mkt_tgt_had
        where cam_id = #{camId}
          and flag = 1
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignTarget)
    ============================================
    -   제목                  : 캠페인 대상자 헤더 삭제
    -   설명                  : 캠페인 대상자 헤더 삭제
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteCampaignTarget" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetReqDto">
        /* MktCampaignMapper.deleteCampaignTarget */
        update mkt.mkt_tgt_had
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where ID = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignTarget)
    ============================================
    -   제목                  : 캠페인 대상자 상세 삭제 By campaignTargetHeaderId
    -   설명                  : 캠페인 대상자 상세 삭제 By campaignTargetHeaderId
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteCampaignTargetDtlByTargetHeaderId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetDtlReqDto">
        /* MktCampaignMapper.deleteCampaignTargetDtlByTargetHeaderId */
        update mkt.mkt_tgt_dtl
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where CAM_TGT_HAD_ID = #{campaignTargetHeaderId}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignTarget)
    ============================================
    -   제목                  : 캠페인 대상자 업로드 삭제 By campaignTargetHeaderId
    -   설명                  : 캠페인 대상자 업로드 삭제 By campaignTargetHeaderId
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteCampaignTargetFileUploadByTargetHeaderId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetDtlReqDto">
        /* MktCampaignMapper.deleteCampaignTargetFileUploadByTargetHeaderId */
        update mkt.mkt_upload_tgt_had
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where CAM_TGT_HAD_ID = #{campaignTargetHeaderId}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignTargetDtl)
    ============================================
    -   제목                  : 캠페인 대상자 상세 건삭제
    -   설명                  : 캠페인 대상자 상세 건삭제
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteCampaignTargetDtl" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetDtlReqDto">
        /* MktCampaignMapper.deleteCampaignTargetDtl */
        update mkt.mkt_tgt_dtl
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , EXCEPT_YN   = 1
        where ID = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignTargetDtl)
    ============================================
    -   제목                  : 캠페인 대상자 상세 건삭제 취소
    -   설명                  : 캠페인 대상자 상세 건삭제 취소
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteCancelCampaignTargetDtl" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetDtlReqDto">
        /* MktCampaignMapper.deleteCampaignTargetDtl */
        update mkt.mkt_tgt_dtl
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , EXCEPT_YN   = 0
        where ID = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignTargetDtl)
    ============================================
    -   제목                  : 캠페인 대상자 헤더 건삭제 count
    -   설명                  : 캠페인 대상자 헤더 건삭제 count
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="setCampaignTargetOneCaseRemoveCount" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetDtlReqDto">
        /* MKTChecker.setCampaignTargetOneCaseRemoveCount */
        update mkt.mkt_tgt_had
        set MODIFY_BY = #{modifyBy},
            MODIFY_DATE = GETDATE(),
            ONE_CASE_RMV_CNT = (select count(1) from mkt.mkt_tgt_dtl where FLAG = 1 and  EXCEPT_YN = 'Y' and CAM_TGT_HAD_ID = ID)
         where 1=1
           and CAM_ID = #{campaignId}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignTargetByCampaignId)
    ============================================
    -   제목                  : 캠페인 대상자 삭제 By CampaignId
    -   설명                  : 캠페인 대상자 삭제 By CampaignId
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteCampaignTargetByCampaignId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetReqDto">
        /* MktCampaignMapper.deleteCampaignTargetByCampaignId */
        update mkt.mkt_tgt_had
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where CAM_ID = #{campaignId}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignTargetDtlByCampaignId)
    ============================================
    -   제목                  : 캠페인 대상자 상세 삭제 By CampaignId
    -   설명                  : 캠페인 대상자 상세 삭제 By CampaignId
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteCampaignTargetDtlByCampaignId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetDtlReqDto">
        /* MktCampaignMapper.deleteCampaignTargetDtlByCampaignId */
        update mkt.mkt_tgt_dtl
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where CAM_TGT_HAD_ID IN (select id from mkt.mkt_tgt_had where cam_id = #{campaignId})
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(setControlGroup)
    ============================================
    -   제목                  : 캠페인 대상자 상세 제어그룹 설정
    -   설명                  : 캠페인 대상자 상세 제어그룹 설정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="reSetCampaignTargetControlGroup" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetReqDto">
        /* MKTChecker.reSetCampaignTargetControlGroup */
        update mkt.mkt_tgt_dtl
        set MODIFY_BY = #{modifyBy}
        , MODIFY_DATE = GETDATE()
        , CTRL_GROUP_YN = 'Y'
        where 1=1
        <if test="id != null and id != ''">AND
            CAM_TGT_HAD_ID = #{id}
        </if>
        and CAM_ID = #{campaignId}
    </update>

    <!-- 캠페인 대상자 상세 제어그룹 설정 -->
    <update id="setCampaignTargetControlGroup" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetReqDto">
        /* MKTChecker.setCampaignTargetControlGroup */
        update mkt.mkt_tgt_dtl td,
            (select t.ID
            from mkt.mkt_tgt_dtl t
            where t.FLAG = 1
            and t.EXCEPT_YN = 'N'
            and t.DUP_DEL_YN = 'N'
            and t.FATI_CHK_DEL_YN = 'N'
            and t.CAM_TGT_HAD_ID = #{id}
            offset 0 rows fetch next ${controlGroupCount} rows ONLY) td2
        set
            td.MODIFY_BY = #{modifyBy} , td.MODIFY_DATE = GETDATE()
               , td.CTRL_GROUP_YN = 1
         where td.FLAG = 1
           and td.id = td2.id
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(setControlGroup)
    ============================================
    -   제목                  : 캠페인 대상자 헤더 제어그룹 Count
    -   설명                  : 캠페인 대상자 헤더 제어그룹 Count
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="setCampaignTargetControlGroupCount" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetReqDto">
        /* MKTChecker.setCampaignTargetControlGroupCount */
        update mkt.mkt_tgt_had td
        set
            MODIFY_BY = #{modifyBy} , MODIFY_DATE = GETDATE()
               , CTRL_GROUP_CNT = #{controlGroupCount}
            , CTRL_GROUP_AMT = #{controlGroupAmt}
            , CTRL_GROUP_UNIT_CD = #{controlGroupUnitCode}
            , td.CTRL_GROUP_CNT = (select count (1) from mkt.mkt_tgt_dtl where FLAG = 1 and CTRL_GROUP_YN = 'Y' and CAM_TGT_HAD_ID = td.ID)
            where 1=1
            and td.ID = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(setCampaignTargetDelCount)
    ============================================
    -   제목                  : 캠페인 대상자 헤더 제거 컬럼 Count
    -   설명                  : 캠페인 대상자 헤더 제거 컬럼 Count
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.12. 3.
    ***************************************/ -->
    <update id="updateCampaignTargetDelCount" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTargetReqDto">
        /* MKTCampaign.setCampaignTargetDelCount */
        MERGE INTO mkt.mkt_tgt_had td
        USING(
        select CAM_TGT_HAD_ID
        , sum(case when EXCEPT_YN = 'Y' then 1 else 0 end) as ONE_CASE_RMV_CNT
        , sum(case when DUP_DEL_YN = 'Y' then 1 else 0 end) as DUP_RMV_CNT
        , sum(case when FATI_CHK_DEL_YN = 'Y' then 1 else 0 end) as FATI_CHK_RMV_CNT
        , sum(case when PRMS_CHK_DEL_YN = 'Y' then 1 else 0 end) as AUTH_CHK_RMV_CNT
        , sum(1) as CAM_TGT_CNT
        , sum(case when EXCEPT_YN = 'N' and DUP_DEL_YN = 'N' and FATI_CHK_DEL_YN = 'N' and PRMS_CHK_DEL_YN = 'N' and CTRL_GROUP_YN = 'N' then 1 else 0 end) as CAM_SEND_TGT_CNT
        from mkt.mkt_tgt_dtl
        where FLAG = 1
        <if test="segmentId != null and segmentId != ''">
            and cam_tgt_had_id = #{segmentId}
        </if>
        <if test="campaignId != null and campaignId != ''">
            and cam_id = #{campaignId}
        </if>
        group by CAM_TGT_HAD_ID
        ) cnt on (cnt.CAM_TGT_HAD_ID = td.ID)
        WHEN MATCHED THEN
        UPDATE SET
        MODIFY_BY = #{modifyBy}
        , MODIFY_DATE = GETDATE()
        , td.CAM_TGT_CNT = cnt.CAM_TGT_CNT
        , td.ONE_CASE_RMV_CNT = cnt.ONE_CASE_RMV_CNT
        , td.DUP_RMV_CNT = cnt.DUP_RMV_CNT
        , td.FATI_CHK_RMV_CNT = cnt.FATI_CHK_RMV_CNT
        , td.AUTH_CHK_RMV_CNT = cnt.AUTH_CHK_RMV_CNT
        , td.CAM_SEND_TGT_CNT = cnt.CAM_SEND_TGT_CNT
        where 1=1
        and td.FLAG = 1
        <if test="segmentId != null and segmentId != ''">
            and cam_tgt_had_id = #{segmentId}
        </if>
        <if test="campaignId != null and campaignId != ''">
            and td.CAM_ID = #{campaignId}
        </if>
    </update>

    <!-- /**************************************
	-	관련 파일				: MKTQuickCampaignDAO.java(ediTargetAll)
	============================================
	-	제목					: 세그먼트 수정
	-	설명					: 세그먼트 마스터 정보 수정
	-	결과형태				: 단일
	============================================
	-	입력
		segId				    : 세그먼트 아이디
		targetId			    : 타겟 헤더 아이디
		tempId				    : 템플릿 아이디
		segName				    : 세그먼트 명
	============================================
	-	작성자					: jh.kim
	-	작성일					: 2018.03.07.
    ***************************************/ -->
    <!-- <update id="updateTargetAll" parameterType="MKTsetSegmentRequest">
		update mkt.mkt_tgt_had
        set
              modify_by           = #{empId}
            , modify_date         = GETDATE()
            , cam_id              = #{camId}
            , cam_tgt_type_cd     = #{segType}
            , cam_tgt_cnt         = #{targetCustCnt}
            , dup_rmv_cnt         = #{dupCnt}
            , fati_chk_rmv_cnt    = #{fatiCnt}
            , auth_chk_rmv_cnt    = #{prmsCnt}
            , cam_tgt_file_nm     = #{fileName}
            , seg_nm              = #{segName}
            , cal_type_cd         = #{calType}
            , tgt_group_id        = #{targetGroupId}
            , ctrl_group_unit_cd  = #{ctrlGroupUnitCd}
            , ctrl_group_amt      = #{ctrlGroupAmt}
            , ctrl_group_cnt      = #{ctrlGroupCnt}
        where id = #{targetId}
	</update> -->

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getExecutionInfo)
    ============================================
    -   제목                  : 실행정보
    -   설명                  : 실행정보
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <select id="selectExecutionInfo" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignExecutionInfoResDto">
        /* MktCampaignMapper.selectExecutionInfo */
        select TOP 1
        ei.ID as id
        , ei.CREATE_BY as createBy
        , ei.MODIFY_BY as modifyBy
        , ei.CREATE_DATE as createDate
        , ei.MODIFY_DATE as modifyDate
        , ei.TYPE as type
        , ei.CAM_ID as campaignId
        , ei.CONTS_CHNL_REL_ID as camContsChnlRelId
        , ei.EXE_INFO_NM as exeInfoName
        , ei.EXE_INFO_DESC as exeInfoDesc
        , c1.CODE_NAME as exeCycleTypeCode
        , c1.MARK_NAME as exeCycleTypeCodeName
        , ei.EXE_MONTH_TYPE_CD as exeMonthTypeCode
        , ei.EXE_SUN_YN as exeSunYn
        , ei.EXE_MON_YN as exeMonYn
        , ei.EXE_TUE_YN as exeTueYn
        , ei.EXE_WED_YN as exeWedYn
        , ei.EXE_THU_YN as exeThuYn
        , ei.EXE_FRI_YN as exeFriYn
        , ei.EXE_SAT_YN as exeSatYn
        , ei.EXE_DD as exeDd
        , ei.EXE_DAY as exeDay
        , ei.EXE_HOUR as exeHour
        , ei.EXE_MNUT as exeMinute
        , com.TO_CHAR(ei.EXE_START_DD, 'YYYY-MM-DD') as exeStartDate
        , com.TO_CHAR(ei.EXE_END_DD, 'YYYY-MM-DD') as exeEndDate
        , ei.DIV_SEND_TIME as divSendTime
        , ei.DIV_SEND_CNT as divSendCnt
        , ei.MAX_SEND_CNT as maxSendCnt
        from mkt.mkt_exe_info ei WITH (NOLOCK)
        left outer join com.comm_code c1 WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = ei.EXE_CYCL_TYPE_CD and c1.group_code = 'MKT_EXE_CYCL_TYPE'
        where 1=1
        and ei.FLAG = 1
        and ei.CAM_ID = #{campaignId}
        <!-- OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY -->
    </select>


    <select id="selectExecutionInfoById" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignExecutionInfoResDto">
        /* MktCampaignMapper.selectExecutionInfo */
        select TOP 1
        ei.ID as id
        , ei.CREATE_BY as createBy
        , ei.MODIFY_BY as modifyBy
        , ei.CREATE_DATE as createDate
        , ei.MODIFY_DATE as modifyDate
        , ei.TYPE as type
        , ei.CAM_ID as campaignId
        , ei.CONTS_CHNL_REL_ID as camContsChnlRelId
        , ei.EXE_INFO_NM as exeInfoName
        , ei.EXE_INFO_DESC as exeInfoDesc
        , c1.CODE_NAME as exeCycleTypeCode
        , c1.MARK_NAME as exeCycleTypeCodeName
        , ei.EXE_MONTH_TYPE_CD as exeMonthTypeCode
        , ei.EXE_SUN_YN as exeSunYn
        , ei.EXE_MON_YN as exeMonYn
        , ei.EXE_TUE_YN as exeTueYn
        , ei.EXE_WED_YN as exeWedYn
        , ei.EXE_THU_YN as exeThuYn
        , ei.EXE_FRI_YN as exeFriYn
        , ei.EXE_SAT_YN as exeSatYn
        , ei.EXE_DD as exeDd
        , ei.EXE_DAY as exeDay
        , ei.EXE_HOUR as exeHour
        , ei.EXE_MNUT as exeMinute
        , com.TO_CHAR(ei.EXE_START_DD, 'YYYY-MM-DD') as exeStartDate
        , com.TO_CHAR(ei.EXE_END_DD, 'YYYY-MM-DD') as exeEndDate
        , ei.DIV_SEND_TIME as divSendTime
        , ei.DIV_SEND_CNT as divSendCnt
        , ei.MAX_SEND_CNT as maxSendCnt
        from mkt.mkt_exe_info ei WITH (NOLOCK)
        left outer join com.comm_code c1 WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = ei.EXE_CYCL_TYPE_CD and c1.group_code = 'MKT_EXE_CYCL_TYPE'
        where 1=1
        and ei.ID = #{id}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getExecutionInfoList)
    ============================================
    -   제목                  : 실행정보 등록
    -   설명                  : 실행정보 등록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <insert id="insertExecutionInfo" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoReqDto">
        /* MktCampaignMapper.insertExecutionInfo */
        insert into mkt.mkt_exe_info
        ( ID
        , CREATE_BY
        , MODIFY_BY
        , CREATE_DATE
        , MODIFY_DATE
        , FLAG
        , TYPE
        , CAM_ID
        , CONTS_CHNL_REL_ID
        , EXE_INFO_NM
        , EXE_INFO_DESC
        , EXE_CYCL_TYPE_CD
        , EXE_MONTH_TYPE_CD
        , EXE_SUN_YN
        , EXE_MON_YN
        , EXE_TUE_YN
        , EXE_WED_YN
        , EXE_THU_YN
        , EXE_FRI_YN
        , EXE_SAT_YN
        , EXE_DD
        , EXE_DAY
        , EXE_HOUR
        , EXE_MNUT
        <if test="exeStartDate != null and exeStartDate != ''">
            , EXE_START_DD
        </if>
        <if test="exeEndDate != null and exeEndDate != ''">
            , EXE_END_DD
        </if>
        , DIV_SEND_TIME
        , DIV_SEND_CNT
        , MAX_SEND_CNT
        )
        values
        ( #{id}
        , #{createBy}
        , #{modifyBy}
        , GETDATE()
        , GETDATE()
        , 1
        , #{type}
        , #{campaignId}
        , #{camContsChnlRelId}
        , #{exeInfoName}
        , #{exeInfoDesc}
        , #{exeCycleTypeCode}    <!-- com.getCommCodeIdByGroupCodeCodeName('MKT_EXE_CYCL_TYPE',  #{exeCycleTypeCode}, #{lang}) -->
        , #{exeMonthTypeCode}
        , #{exeSunYn}
        , #{exeMonYn}
        , #{exeTueYn}
        , #{exeWedYn}
        , #{exeThuYn}
        , #{exeFriYn}
        , #{exeSatYn}
        , #{exeDd}
        , #{exeDay}
        , #{exeHour}
        , #{exeMinute}
        <if test="exeStartDate != null and exeStartDate != ''">
            , com.TO_DATE(#{exeStartDate}, 'YYYY-MM-DD')
        </if>
        <if test="exeEndDate != null and exeEndDate != ''">
            , com.TO_DATE(#{exeEndDate}, 'YYYY-MM-DD')
        </if>
        , #{divSendTime}
        , #{divSendCnt}
        , #{maxSendCnt}
        )

        <selectKey keyProperty="" resultType="java.lang.String">
            select id from mkt.mkt_exe_info where id = #{id} OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY
        </selectKey>
    </insert>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(editExecutionInfo)
    ============================================
    -   제목                  : 실행정보 수정
    -   설명                  : 실행정보 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="updateExecutionInfo" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoReqDto">
        /* MktCampaignMapper.updateExecutionInfo */
        update mkt.mkt_exe_info
        set
        MODIFY_BY = #{modifyBy}
        , MODIFY_DATE = GETDATE()
        , FLAG = 1
        , TYPE = #{type}
        , CAM_ID = #{campaignId}
        , CONTS_CHNL_REL_ID = #{camContsChnlRelId}
        , EXE_INFO_NM = #{exeInfoName}
        , EXE_INFO_DESC = #{exeInfoDesc}
        , EXE_CYCL_TYPE_CD = #{exeCycleTypeCode}
        <!--
             , EXE_CYCL_TYPE_CD = com.getCommCodeIdByGroupCodeCodeName('MKT_EXE_CYCL_TYPE', #{exeCycleTypeCode}, #{lang})
              -->
        , EXE_MONTH_TYPE_CD = #{exeMonthTypeCode}
        , EXE_SUN_YN = #{exeSunYn}
        , EXE_MON_YN = #{exeMonYn}
        , EXE_TUE_YN = #{exeTueYn}
        , EXE_WED_YN = #{exeWedYn}
        , EXE_THU_YN = #{exeThuYn}
        , EXE_FRI_YN = #{exeFriYn}
        , EXE_SAT_YN = #{exeSatYn}
        , EXE_DD = #{exeDd}
        , EXE_DAY = #{exeDay}
        , EXE_HOUR = #{exeHour}
        , EXE_MNUT = #{exeMinute}
        <if test="exeStartDate != null and exeStartDate != ''">
            , EXE_START_DD = com.TO_DATE(#{exeStartDate}, 'YYYY-MM-DD')
        </if>
        <if test="exeEndDate != null and exeEndDate != ''">
            , EXE_END_DD = com.TO_DATE(#{exeEndDate}, 'YYYY-MM-DD')
        </if>
        , DIV_SEND_TIME = #{divSendTime}
        , DIV_SEND_CNT = #{divSendCnt}
        , MAX_SEND_CNT = #{maxSendCnt}

        where ID = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeExecutionInfo)
    ============================================
    -   제목                  : 실행정보 삭제
    -   설명                  : 실행정보 삭제
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteExecutionInfo" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoReqDto">
        /* MktCampaignMapper.deleteExecutionInfo */
        update mkt.mkt_exe_info
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where ID = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeExecutionInfoByCampaignId)
    ============================================
    -   제목                  : 실행정보 삭제 By CampaignId
    -   설명                  : 실행정보 삭제 By CampaignId
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteExecutionInfoByCampaignId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoReqDto">
        /* MktCampaignMapper.deleteExecutionInfoByCampaignId */
        update mkt.mkt_exe_info
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where CAM_ID = #{campaignId}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getExecutionInfoItemList)
    ============================================
    -   제목                  : 실행정보 아이템 목록
    -   설명                  : 실행정보 아이템 목록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <select id="selectExecutionInfoItemList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoItemGridReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignExecutionInfoItemListResDto">
        /* MktCampaignMapper.selectExecutionInfoItemList */
        select ${strColumn}
             , eii.ID                                        as id
             , eii.CREATE_BY                                 as createBy
             , eii.MODIFY_BY                                 as modifyBy
             , eii.CREATE_DATE                               as createDate
             , eii.MODIFY_DATE                               as modifyDate

             , eii.EXE_INFO_ID                               as exeInfoId

             , ei.CAM_ID                                     as campaignId
             , ei.CONTS_CHNL_REL_ID                          as camContsChnlRelId

             , eii.EXE_SEQ                                   as exeSeq
             , ei.EXE_INFO_NM                                as exeInfoName
             , eii.EXE_TGT_AMT                               as exeTargetAmt

             , c1.CODE_NAME                                  as exeTargetUnitCode
             , c1.MARK_NAME                                  as exeTargetUnitCodeName

             , eii.EXE_TGT_SEND_CNT                          as exeTargetSendCount

             , c2.CODE_NAME                                  as exeInfoStatusCode
             , c2.MARK_NAME                                  as exeInfoStatusCodeName

             , ei.EXE_MONTH_TYPE_CD                          as exeMonthTypeCode

             , com.TO_CHAR(eii.EXE_DT, 'YYYY-MM-DD HH24:MI') as exeDate

             , eii.EXE_INFO_DESC                             as exeInfoDesc

             , c3.CODE_NAME                                  as exeCycleTypeCode
             , c3.MARK_NAME                                  as exeCycleTypeCodeName

             , ei.EXE_SUN_YN                                 as exeSunYn
             , ei.EXE_MON_YN                                 as exeMonYn
             , ei.EXE_TUE_YN                                 as exeTueYn
             , ei.EXE_WED_YN                                 as exeWedYn
             , ei.EXE_THU_YN                                 as exeThuYn
             , ei.EXE_FRI_YN                                 as exeFriYn
             , ei.EXE_SAT_YN                                 as exeSatYn
             , ei.EXE_DD                                     as exeDd
             , ei.EXE_DAY                                    as exeDay
             , ei.EXE_HOUR                                   as exeHour
             , ei.EXE_MNUT                                   as exeMinute
             , com.TO_CHAR(ei.EXE_START_DD, 'YYYY-MM-DD')    as exeStartDate
             , com.TO_CHAR(ei.EXE_END_DD, 'YYYY-MM-DD')      as exeEndDate
        from mkt.mkt_exe_info_item eii WITH (NOLOCK)
                 inner join mkt.mkt_exe_info ei
            WITH (NOLOCK) on ei.flag = 1 and ei.ID = eii.EXE_INFO_ID
                 left outer join com.comm_code c1
            WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = eii.EXE_TGT_UNIT_CD and c1.group_code = 'MKT_CNTRL_GRP_UOM'
                 left outer join com.comm_code c2
            WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.code_name = eii.EXE_INFO_STATUS_CD and c2.group_code = 'MKT_EXEC_STATUS'
                 left outer join com.comm_code c3
            WITH (NOLOCK) on c3.flag = 1 and c3.lang = #{lang} and c3.code_name = ei.EXE_CYCL_TYPE_CD and c3.group_code = 'MKT_EXE_CYCL_TYPE'
        where ${strWhere}
          and ${strSVCType}
          and eii.type != 'PROM'
          and eii.flag = 1
          and ei.CAM_ID = #{campaignId}
        order by ${strOrderby} ${strEndPaging}
    </select>

    <!-- 실행정보 아이템 목록 -->
    <select id="selectExecutionInfoItemList2" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoItemReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignExecutionInfoItemListResDto">
        /* MktCampaignMapper.selectExecutionInfoItemList */
        select eii.ID                                        as id
             , eii.CREATE_BY                                 as createBy
             , eii.MODIFY_BY                                 as modifyBy
             , eii.CREATE_DATE                               as createDate
             , eii.MODIFY_DATE                               as modifyDate

             , eii.EXE_INFO_ID                               as exeInfoId

             , ei.CAM_ID                                     as campaignId
             , ei.CONTS_CHNL_REL_ID                          as camContsChnlRelId

             , eii.EXE_SEQ                                   as exeSeq
             , ei.EXE_INFO_NM                                as exeInfoName
             , eii.EXE_TGT_AMT                               as exeTargetAmt

             , c1.CODE_NAME                                  as exeTargetUnitCode
             , c1.MARK_NAME                                  as exeTargetUnitCodeName

             , eii.EXE_TGT_SEND_CNT                          as exeTargetSendCount

             , c2.CODE_NAME                                  as exeInfoStatusCode
             , c2.MARK_NAME                                  as exeInfoStatusCodeName

             , com.TO_CHAR(eii.EXE_DT, 'YYYY-MM-DD HH24:MI') as exeDate

             , eii.EXE_INFO_DESC                             as exeInfoDesc

             , c3.CODE_NAME                                  as exeCycleTypeCode
             , c3.MARK_NAME                                  as exeCycleTypeCodeName

             , ei.EXE_SUN_YN                                 as exeSunYn
             , ei.EXE_MON_YN                                 as exeMonYn
             , ei.EXE_TUE_YN                                 as exeTueYn
             , ei.EXE_WED_YN                                 as exeWedYn
             , ei.EXE_THU_YN                                 as exeThuYn
             , ei.EXE_FRI_YN                                 as exeFriYn
             , ei.EXE_SAT_YN                                 as exeSatYn
             , ei.EXE_DD                                     as exeDd
             , ei.EXE_DAY                                    as exeDay
             , ei.EXE_HOUR                                   as exeHour
             , ei.EXE_MNUT                                   as exeMinute
             , com.TO_CHAR(ei.EXE_START_DD, 'YYYY-MM-DD')    as exeStartDate
             , com.TO_CHAR(ei.EXE_END_DD, 'YYYY-MM-DD')      as exeEndDate
        from mkt.mkt_exe_info_item eii WITH (NOLOCK)
                 inner join mkt.mkt_exe_info ei
            WITH (NOLOCK) on ei.flag = 1 and ei.ID = eii.EXE_INFO_ID
                 left outer join com.comm_code c1
            WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = eii.EXE_TGT_UNIT_CD and c1.group_code = 'MKT_CNTRL_GRP_UOM'
                 left outer join com.comm_code c2
            WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.code_name = eii.EXE_INFO_STATUS_CD and c2.group_code = 'MKT_EXEC_STATUS'
                 left outer join com.comm_code c3
            WITH (NOLOCK) on c3.flag = 1 and c3.lang = #{lang} and c3.code_name = ei.EXE_CYCL_TYPE_CD and c3.group_code = 'MKT_EXE_CYCL_TYPE'
        where 1 = 1
          and ((eii.type is null OR eii.type = '') or eii.type != 'PROM')
          and ${strSVCType}
          and eii.flag = 1
          and eii.EXE_INFO_ID = #{exeInfoId}
        order by eii.CREATE_DATE desc
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(addExecutionInfoItem)
    ============================================
    -   제목                  : 실행정보 아이템 등록
    -   설명                  : 실행정보 아이템 등록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <insert id="insertExecutionInfoItem" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoItemReqDto">
        /* MktCampaignMapper.insertExecutionInfoItem */
        insert into mkt.mkt_exe_info_item
        ( ID
        , CREATE_BY
        , MODIFY_BY
        , CREATE_DATE
        , MODIFY_DATE
        , FLAG
        , TYPE
        , EXE_INFO_ID
        , EXE_SEQ
        , EXE_TGT_AMT
        , EXE_TGT_UNIT_CD
        , EXE_TGT_SEND_CNT
        , EXE_INFO_STATUS_CD
        , EXE_INFO_DESC
        , EXE_DT
        , CAM_ID
        , RID_RULESET
        , EXE_INFO_PROM_ID )
        values
        ( #{id}
        , #{createBy}
        , #{modifyBy}
        , GETDATE()
        , GETDATE()
        , 1
        , #{type}
        , #{exeInfoId}
        , #{exeSeq}
        , #{exeTargetAmt}
        , #{exeTargetUnitCode}
        , #{exeTargetSendCount}
        , #{exeInfoStatusCode}
        , #{exeInfoDesc}
        , com.TO_DATE(#{exeDate}, 'YYYY-MM-DD HH24:MI:SS')
        , #{campaignId}
        , #{ridRuleset}
        , #{exeInfoPromId} )

        <selectKey keyProperty="" resultType="java.lang.String">
            select id from mkt.mkt_exe_info_item where id = #{id} OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY
        </selectKey>
    </insert>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(editExecutionInfoItem)
    ============================================
    -   제목                  : 실행정보 아이템 수정
    -   설명                  : 실행정보 아이템 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="updateExecutionInfoItem" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoItemReqDto">
        /* MktCampaignMapper.updateExecutionInfoItem */
        update mkt.mkt_exe_info_item
        set MODIFY_BY          = #{modifyBy}
          , MODIFY_DATE        = GETDATE()
          , FLAG               = 1
          , EXE_SEQ            = #{exeSeq}
          , EXE_TGT_AMT        = #{exeTargetAmt}
          , EXE_TGT_UNIT_CD    = #{exeTargetUnitCode}
          , EXE_TGT_SEND_CNT   = #{exeTargetSendCount}
          , EXE_INFO_STATUS_CD = #{exeInfoStatusCode}
          , EXE_INFO_DESC      = #{exeInfoDesc}
          , EXE_DT             = com.TO_DATE(#{exeDate}, 'yyyy-mm-dd hh24:mi:ss')
        where ID = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeExecutionInfoItem)
    ============================================
    -   제목                  : 실행정보 아이템 삭제
    -   설명                  : 실행정보 아이템 삭제
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteExecutionInfoItem" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoItemReqDto">
        /* MktCampaignMapper.deleteExecutionInfoItem */
        update mkt.mkt_exe_info_item
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where ID = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeExecutionInfoItemByCampaignId)
    ============================================
    -   제목                  : 실행정보 아이템 삭제 By CampaignId
    -   설명                  : 실행정보 아이템 삭제 By CampaignId
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteExecutionInfoItemByCampaignId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoItemReqDto">
        /* MktCampaignMapper.deleteExecutionInfoItemByCampaignId */
        update mkt.mkt_exe_info_item
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where 1 = 1
          and EXE_INFO_ID IN (select t.id from mkt.mkt_exe_info t where t.cam_id = #{campaignId})
          and exe_info_status_cd = 'W'
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeExecutionInfo)
    ============================================
    -   제목                  : 실행정보 아이템 삭제 By ExeInfoId
    -   설명                  : 실행정보 아이템 삭제 By ExeInfoId
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteExecutionInfoItemByExeInfoId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoItemReqDto">
        /* MktCampaignMapper.deleteExecutionInfoItemByExeInfoId */
        update mkt.mkt_exe_info_item
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where 1 = 1
          and EXE_INFO_ID = #{exeInfoId}
          and exe_info_status_cd = 'W'
    </update>


    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeTargetDtlExecutionInfoItemRel)
    ============================================
    -   제목                  : 실행정보 아이템과 대상자 상세 관계 초기화
    -   설명                  : 실행정보 아이템과 대상자 상세 관계 초기화
                                실행정보 아이템 상태가 발송완료(D)가 아닌것
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.10.29
    ***************************************/ -->
    <update id="deleteTargetDtlExecutionInfoItemRel" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoReqDto">
        /* MktCampaignMapper.deleteTargetDtlExecutionInfoItemRel */
        update mkt.mkt_tgt_dtl td
        set
            MODIFY_BY = #{modifyBy} , MODIFY_DATE = GETDATE()
               , EXE_INFO_ITEM_ID = NULL
         where 1=1
           and td.FLAG = 1
           and td.EXE_INFO_ITEM_ID in (
                                      select eii.id
                                        from mkt.mkt_exe_info_item eii
                                        left join mkt.mkt_exe_info ei
                                          on ei.id = eii.exe_info_id and cam_id = #{campaignId}
            where eii.EXE_INFO_STATUS_CD != 'D'
            )
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getCampaignContentsChnnelRel)
    ============================================
    -   제목                  : 캠페인 콘텐츠 채널 관계
    -   설명                  : 캠페인 콘텐츠 채널 관계
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.11.27
    ***************************************/ -->
    <select id="selectCampaignContentsChnnelRel" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignContentsChnnelRelResDto">
        /* MktCampaignMapper.selectCampaignContentsChnnelRel */
        select ccr.ID          as id
             , ccr.CREATE_BY   as createBy
             , ccr.MODIFY_BY   as modifyBy
             , ccr.CREATE_DATE as createDate
             , ccr.MODIFY_DATE as modifyDate
             , ccr.CAM_ID      as campaignId
             , ccr.CONTENTS_ID as contentsId
             , ccr.MKT_CHNL_ID as chnnelId
             , ccr.URL_INFO    as urlInfo
             , ccr.ATCM_DESC   as attachmentDesc
             , ccr.TRT_DESC    as treatmentDesc
             , cm.CONTS_NM     as contentsName
             , ccr.EXE_DT      as exeDt
             , ccr.EXE_TM      as exeTm
        from com.mkt_conts_chnl_rel ccr WITH (NOLOCK)
                 left outer join com.mkt_conts_mst cm
            WITH (NOLOCK) on ccr.CONTENTS_ID = cm.ID
        where 1 = 1
          and ccr.ID = #{id}
        order by ccr.MODIFY_DATE desc
        OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(addCampaignContentsChnnelRel)
    ============================================
    -   제목                  : 캠페인 콘텐츠 채널 관계 등록
    -   설명                  : 캠페인 콘텐츠 채널 관계 등록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.11.27
    ***************************************/ -->
    <insert id="insertCampaignContentsChnnelRel" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto">
        /* MktCampaignMapper.insertCampaignContentsChnnelRel */
        insert into com.mkt_conts_chnl_rel
        ( ID
        , CREATE_BY
        , MODIFY_BY
        , CREATE_DATE
        , MODIFY_DATE
        , FLAG
        , CAM_ID
        , CONTENTS_ID
        , MKT_CHNL_ID
        , URL_INFO
        , ATCM_DESC
        , TRT_DESC
        , EXE_DT
        , EXE_TM)
        values
        ( #{id}
        , #{createBy}
        , #{modifyBy}
        , GETDATE()
        , GETDATE()
        , 1
        , #{campaignId}
        , #{contentsId}
        , (select id from mkt.mkt_chnl where flag = 1 and chnl_type_cd = (select exe_chnl_type_cd from com.mkt_conts_mst where id = #{contentsId}) and flag =1)
        <!-- , #{chnnelId} -->
        , #{urlInfo}
        , #{attachmentDesc}
        , #{treatmentDesc}
        , #{exeDt}
        , #{exeTm})

        <selectKey keyProperty="" resultType="java.lang.String">
            select id from com.mkt_conts_chnl_rel where id = #{id} OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY
        </selectKey>
    </insert>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(editCampaignContentsChnnelRel)
    ============================================
    -   제목                  : 캠페인 콘텐츠 채널 관계 수정
    -   설명                  : 캠페인 콘텐츠 채널 관계 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.11.27
    ***************************************/ -->
    <update id="updateCampaignContentsChnnelRel" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto">
        /* MktCampaignMapper.updateCampaignContentsChnnelRel */
        update com.mkt_conts_chnl_rel
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , FLAG        = 1
          , CAM_ID      = #{campaignId}
          , CONTENTS_ID = #{contentsId}
          , MKT_CHNL_ID = (select id from mkt.mkt_chnl where flag = 1 and chnl_type_cd = (select exe_chnl_type_cd from com.mkt_conts_mst where id = #{contentsId}))
          , URL_INFO    = #{urlInfo}
          , ATCM_DESC   = #{attachmentDesc}
          , TRT_DESC    = #{treatmentDesc}
          , EXE_DT      = #{exeDt}
          , EXE_TM      = #{exeTm}
        where ID = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(editCampaignContentsChnnelRel)
    ============================================
    -   제목                  : 캠페인 콘텐츠 채널 수정
    -   설명                  : 캠페인 콘텐츠 채널 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.11.27
    ***************************************/ -->
    <update id="updateCampaignContents" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto">
        /* MktCampaignMapper.updateCampaignContents */
        update com.mkt_conts_mst
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , FLAG        = 1
        where 1 = 1
          and ID in (select ccr.CONTENTS_ID from com.mkt_conts_chnl_rel ccr where ccr.ID = #{id})
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignContentsChnnelRel)
    ============================================
    -   제목                  : 캠페인 콘텐츠 채널 관계 삭제
    -   설명                  : 캠페인 콘텐츠 채널 관계 삭제
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.11.27
    ***************************************/ -->
    <update id="deleteCampaignContentsChnnelRel" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto">
        /* MktCampaignMapper.deleteCampaignContentsChnnelRel */
        update com.mkt_conts_chnl_rel
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where 1 = 1
          and ID = #{id}
          and flag = 1
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignContentsChnnelRel)
    ============================================
    -   제목                  : 캠페인 콘텐츠 채널 삭제
    -   설명                  : 캠페인 콘텐츠 채널 삭제
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.12.28
    ***************************************/ -->
    <update id="deleteCampaignContents" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto">
        /* MktCampaignMapper.deleteCampaignContents */
        update com.mkt_conts_mst
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where 1 = 1
          and ID in (select ccr.CONTENTS_ID from com.mkt_conts_chnl_rel ccr where ccr.ID = #{id})
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignContentsChnnelRelByCampaignId)
    ============================================
    -   제목                  : 캠페인 콘텐츠 채널 관계 삭제 By Campaign ID
    -   설명                  : 캠페인 콘텐츠 채널 관계 삭제 By Campaign ID
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.11.27
    ***************************************/ -->
    <update id="deleteCampaignContentsChnnelRelByCampaignId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto">
        /* MktCampaignMapper.deleteCampaignContentsChnnelRelByCampaignId */
        update com.mkt_conts_chnl_rel
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where 1 = 1
          and CAM_ID = #{campaignId}
          and FLAG = 1
    </update>
    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getTempNodeList)
    ============================================
    -   제목                  : 템플릿에 등록된 작업노드 리스트 조회
    -   설명                  : 템플릿 선택시 템플릿 아이디 기반으로 조회
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 안형욱
    -   작성일                : 2015.11.25
    ***************************************/ -->
    <select id="selectTempNodeList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignGetTempNodeListReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignGetTempNodeListResDto">
        /* MktCampaignMapper.getTempNodeList */
        select mwtm.wf_nm    as taskTitle
             , mwtm.wf_desc  as taskDesc
             , cc.mark_name  as camTypeCd
             , cc2.mark_name as nodeTypeCodeName
             , cc2.mark_code as taskTypeCode
        from mkt.mkt_wf_template_mst mwtm WITH (NOLOCK)
                 join com.wf_task_had wth
            WITH (NOLOCK) on wth.id = mwtm.wf_id and wth.flag = 1
                 join com.comm_code cc
            WITH (NOLOCK) on mwtm.wf_cam_type_cd = cc.code_name and cc.flag = 1 and cc.lang = #{lang} and cc.group_code = 'MKT_CAM_TYPE_CD'
                 join com.wf_task_node wtn
            WITH (NOLOCK) on wth.id = wtn.task_had_id and wtn.flag = 1
                 join com.wf_node_mst wnm
            WITH (NOLOCK) on wnm.id = wtn.node_id and wnm.flag = 1
                 join com.comm_code cc2
            WITH (NOLOCK) on cc2.code_name = wnm.node_type_cd and cc2.flag = 1 and cc2.lang = #{lang} and cc2.group_code = 'MKT_WF_NODE_TYPE'
        where mwtm.id = #{tempMstId}
          and mwtm.flag = 1
          and ${strSVCType}
        order by cc2.seq asc
    </select>


    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getTemp)
    ============================================
    -   제목                  : 등록된 템플릿 리스트 조회
    -   설명                  : 등록된 템플릿 리스트 전체조회
    -   결과형태              : 복수
    ============================================
    -   입력                  : camTypeCd 캠페인 유형
                        camPrpsCd 캠페인 목적
    ============================================
    -   작성자                : 안형욱
    -   작성일                : 2015.11.25
    ***************************************/ -->
    <select id="selectTemp" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignGetTempNodeListReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignGetTempNodeListResDto">
        /* MktCampaignMapper.selectTemp */
        select mwtm.id as tempMstId
        , mwtm.wf_nm as taskTitle
        , mwtm.wf_desc as taskDesc
        , cc.id as camTypeCd
        , cc.mark_name as camTypeCdName
        , mwtm.wf_id as workflowId
        , mwtm.cam_id as campaignId
        from mkt.mkt_wf_template_mst mwtm WITH (NOLOCK)
        left outer join com.comm_code cc WITH (NOLOCK) on mwtm.wf_cam_type_cd = cc.code_name and cc.flag=1 and cc.lang = #{lang} and cc.group_code = 'MKT_CAM_TYPE_CD'
        left outer join com.comm_code cc2 WITH (NOLOCK) on mwtm.wf_cam_prps_cd = cc2.code_name and cc2.flag=1 and cc2.lang = #{lang} and cc2.group_code = 'MKT_CAM_GOAL_CD'
        left outer join mkt.MKT_CAM_MST mcm on mwtm.CAM_ID = mcm.ID
        left outer join com.MKT_CONTS_CHNL_REL mccr on mcm.ID = mccr.CAM_ID and mccr.FLAG =1
        left outer join com.MKT_CONTS_MST mcm2 on mccr.CONTENTS_ID = mcm2.ID and mcm2.FLAG =1
        left outer join com.employee e WITH (NOLOCK) on e.id = mcm.CAM_PLNER
        left outer join com.crm_division d1 WITH (NOLOCK) on d1.rid = e.rid_division
        left outer join mkt.MKT_TGT_HAD mth with (nolock) on mcm.ID = mth.CAM_ID and mth.FLAG  =1
        left outer join anl.ANL_TGT_GROUP atg with (nolock) on mth.TGT_GROUP_ID = atg.ID and atg.FLAG =1
        where 1=1
        and mwtm.flag = 1
        <if test="camTypeCd != null and camTypeCd != ''">
            and cc.code_name = #{camTypeCd}
        </if>
        <if test="camPrpsCd != null and camPrpsCd != ''">
            and cc2.code_name = #{camPrpsCd}
        </if>
        <if test="empType != null and empType != ''">
            <if test='empType != "H" '>
                and mwtm.STORE_YN = 'Y'
                and mwtm.division_brand_cd in (#{brandCd}, 'A')
                AND (atg.id is null or atg.TYPE = 'CND')
                and (mcm2.ID is null or mcm2.RID_OFR is NULL)
                and (mcm2.ID is null or mcm2.RID_SURV is null)
            </if>
        </if>
        and ${strSVCType}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getCampaignApproval)
    ============================================
    -   제목                  : 캠페인 전자결재 조회
    -   설명                  : 캠페인 전자결재 조회
    -   결과형태              : 단일
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2015.12.07
    ***************************************/ -->
    <select id="selectCampaignApproval" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignApprovalReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignApprovalResDto">
        /* MktCampaignMapper.selectCampaignApproval */
        select id as id
        , id as approvalId
        , modify_date as modifyDate
        from com.com_elec_aprv ea WITH (NOLOCK)
        where 1=1
        and ea.cam_id = #{campaignId}
        and ea.flag = 1
        <!--          OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY -->
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getCampaignWorkflowTemplateCount)
    ============================================
    -   제목                  : 캠페인 워크플로우 템플릿 Count
    -   설명                  : 캠페인 워크플로우 템플릿 Count
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2016.01.05
    ***************************************/ -->
    <select id="selectCampaignWorkflowTemplateCount" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWorkflowTemplateReqDto" resultType="java.lang.Integer">
        /* MktCampaignMapper.selectCampaignWorkflowTemplateCount */
        select count(1)
        from mkt.mkt_wf_template_mst
        where 1 = 1
          and flag = 1
          and cam_id = #{campaignId}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(addCampaignWorkflowTemplate)
    ============================================
    -   제목                  : 캠페인 워크플로우 템플릿 등록
    -   설명                  : 캠페인 워크플로우 템플릿 등록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2016.01.05
    ***************************************/ -->
    <insert id="insertCampaignWorkflowTemplate" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWorkflowTemplateReqDto">
        /* MktCampaignMapper.insertCampaignWorkflowTemplate */
        insert into mkt.mkt_wf_template_mst
        ( ID
        , CREATE_BY
        , MODIFY_BY
        , CREATE_DATE
        , MODIFY_DATE
        , FLAG
        , WF_CAM_TYPE_CD
        , WF_CAM_PRPS_CD
        , WF_NM
        , WF_DESC
        , WF_DTL_DESC
        , CAM_ID
        , WF_ID
        , STORE_YN
        , DIVISION_BRAND_CD)
        values
        ( #{id}
        , #{createBy}
        , #{modifyBy}
        , GETDATE()
        , GETDATE()
        , 1
        , #{wfCamTypeCode}
        , #{wfCamPrpsCode}
        , #{wfName}
        , #{wfDesc}
        , #{wfDtlDesc}
        , #{campaignId}
        , #{workflowId}
        , #{storeYn}
        , #{brandCd})

        <selectKey keyProperty="" resultType="java.lang.String">
            select id from mkt.mkt_wf_template_mst where id = #{id} OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY
        </selectKey>
    </insert>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(editCampaignWorkflowTemplate)
    ============================================
    -   제목                  : 캠페인 워크플로우 템플릿 수정
    -   설명                  : 캠페인 워크플로우 템플릿 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2016.01.05
    ***************************************/ -->
    <update id="updateCampaignWorkflowTemplate" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWorkflowTemplateReqDto">
        /* MktCampaignMapper.updateCampaignWorkflowTemplate */
        update mkt.mkt_wf_template_mst
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , WF_ID       = #{workflowId}
        where 1 = 1
          and CAM_ID = #{campaignId}
          and flag = 1
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(removeCampaignWorkflowTemplate)
    ============================================
    -   제목                  : 캠페인 워크플로우 템플릿 삭제
    -   설명                  : 캠페인 워크플로우 템플릿 삭제
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2016.01.05
    ***************************************/ -->
    <update id="deleteCampaignWorkflowTemplate" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWorkflowTemplateReqDto">
        /* MktCampaignMapper.deleteCampaignWorkflowTemplate */
        update mkt.mkt_wf_template_mst
        set MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
          , flag        = flag + 1
        where 1 = 1
          and CAM_ID = #{campaignId}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(getCampaignStatus)
    ============================================
    -   제목                  : 캠페인 상태 조회
    -   설명                  : 캠페인 상태 조회
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2016.03.18
    ***************************************/ -->
    <select id="selectCampaignStatus" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignReqDto" resultType="java.lang.String">
        /* MktCampaignMapper.selectCampaignStatus */
        select c1.code_name
        from mkt.mkt_cam_mst c
                 inner join com.comm_code c1 WITH (NOLOCK)
                            on c1.flag = 1 and c1.lang = #{lang} and c.cam_status_cd = c1.code_name and c1.group_code = 'MKT_CAM_STAT'
        where c.id = #{id}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(addCampaignWorkflowTemplate, removeCampaignWorkflowTemplate)
    ============================================
    -   제목                  : 캠페인 템플릿 사용여부 수정
    -   설명                  : 캠페인 템플릿 사용여부 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2016.03.21
    ***************************************/ -->
    <update id="updateCampaignTemplateFlag" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWorkflowTemplateReqDto">
        /* MktCampaignMapper.updateCampaignTemplateFlag */
        update mkt.mkt_cam_mst
        set MODIFY_BY       = #{modifyBy}
          , MODIFY_DATE     = GETDATE()
          , CAM_TEMP_USE_YN = #{templateUseFlag}
        where id = #{campaignId}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java(editCampaignDefaultInfoDesc)
    ============================================
    -   제목                  : 캠페인 기본정보 비고 수정
    -   설명                  : 캠페인 기본정보 비고 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2016.03.21
    ***************************************/ -->
    <update id="updateCampaignDefaultInfoDesc" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignDefaultInfoReqDto">
        /* MktCampaignMapper.updateCampaignDefaultInfoDesc */
        update mkt.mkt_cam_mst c
        set
            MODIFY_BY = #{modifyBy} , MODIFY_DATE = GETDATE()
               , c.cam_desc = #{description}
            where c.id = #{id}
    </update>


    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : 캠페인 현황 목록
    -   설명                  : 캠페인 현황 목록 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 송원희
    -   작성일                : 2016.04.08
    ***************************************/ -->
    <select id="selectCampaignStatusList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignStatusReqDto"
            resultType="com.icignal.marketing.campaign.dto.request.MktCampaignStatusReqDto">
        /* MktCampaignMapper.selectCampaignStatusList */
        select
        a.CAM_NM
        , b.MARK_NAME as CAM_TYPE_CD
        , com.TO_CHAR(a.CAM_START_DD,'YYYY-MM-DD') as CAM_START_DD
        , com.TO_CHAR(a.CAM_END_DD,'YYYY-MM-DD') as CAM_END_DD
        , c.MARK_NAME as CAM_STATUS_CD
        , case when (d.mark_name is null OR d.mark_name = '') then '' else d.mark_name end as APPROVAL
        , g.MARK_NAME as CHNL_TYPE_NM
        , case when m.tgt_tot_cnt is null then 0 else m.tgt_tot_cnt end as TGT_TOT_CNT
        , case when k.CTRL_GROUP_CNT is null then 0 else k.CTRL_GROUP_CNT end as CTRL_GROUP_CNT
        , case when m.send_tot_cnt is null then 0 else m.send_tot_cnt end as SEND_TOT_CNT
        , case when (p.OFFER_NM is null OR p.OFFER_NM = '') then '' else p.OFFER_NM end OFFER_NM
        , a.id as CAM_ID
        , g.CODE_NAME as CHNL_TYPE
        , j.CODE_NAME as OFFER_TYPE
        from mkt.mkt_cam_mst a WITH (NOLOCK)
        inner join com.comm_code b WITH (NOLOCK) on a.CAM_TYPE_CD = b.code_name and b.group_code = 'MKT_CAM_TYPE_CD' and b.lang = #{lang}
        inner join com.comm_code c WITH (NOLOCK) on a.CAM_STATUS_CD = c.code_name and c.group_code = 'MKT_CAM_STAT' and c.lang = #{lang} and c.CODE_NAME in ('A','E')
        left outer join
        (select a.cam_id, b.mark_name, b.code_name
        from com.com_elec_aprv a WITH (NOLOCK)
        inner join com.comm_code b WITH (NOLOCK) on a.ELEC_APRV_STATUS_CD = b.code_name and b.group_code = 'EL_APPROVAL_STATUS_CD' and b.lang = #{lang}
        where a.flag = 1
        ) d on a.id = d.CAM_ID
        left outer join
        (
        select e.CAM_ID, g.MARK_NAME, g.CODE_NAME
        from com.mkt_conts_chnl_rel e WITH (NOLOCK)
        inner join mkt.mkt_chnl f WITH (NOLOCK) on e.MKT_CHNL_ID = f.id and f.FLAG = 1
        inner join com.comm_code g WITH (NOLOCK) on f.CHNL_TYPE_CD = g.code_name and g.group_code = 'MKT_CAM_CHNL_TYPE_CD' and g.LANG = #{lang}
        where 1=1
        and e.flag = 1
        ) g on a.id = g.CAM_ID
        left outer join mkt.mkt_tgt_had k WITH (NOLOCK) on a.id = k.CAM_ID and k.flag = 1
        left outer join mkt.mkt_cam_offer_rel h WITH (NOLOCK) on h.FLAG = 1 and a.id = h.CAM_ID
        left outer join mkt.mkt_offer_mst i WITH (NOLOCK) on i.FLAG = 1 and h.OFFER_ID = i.ID
        left outer join com.comm_code j WITH (NOLOCK) on i.OFFER_TYPE_CD = j.code_name and j.group_code = 'OFFER_TYPE_CD' and j.lang = #{lang}
        left outer join(
        select CAM_ID, count(MEM_ID) as tgt_tot_cnt,
        count(case when CTRL_GROUP_YN = 0 and EXCEPT_YN = 0 and DUP_DEL_YN = 0 and PRMS_CHK_DEL_YN = 0 and FATI_CHK_DEL_YN = 0 then MEM_ID
        else null end ) as send_tot_cnt
        from mkt.mkt_tgt_dtl WITH (NOLOCK)
        where flag = 1
        group by cam_id
        ) m on a.ID = m.CAM_ID
        left outer join
        (
        select a.cam_id, b.OFFER_NO, b.OFFER_NM
        from mkt.mkt_cam_offer_rel a WITH (NOLOCK)
        inner join mkt.mkt_offer_mst b on a.OFFER_ID = b.id
        where 1=1
        and a.flag = 1
        and b.flag = 1
        ) p on a.id = p.CAM_ID
        where 1=1
        and a.FLAG = 1
        <if test="cam_id != null and cam_id != ''">AND
            a.id = #{cam_id}
        </if>
        <!--         and a.type = #{type} -->
        and ${strCondWhere}
        and ${strWhere}
        order by ${strOrderby}
        ${strEndPaging}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : 캠페인 현황 실행 목록
    -   설명                  : 캠페인 현황 실행 목록 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 송원희
    -   작성일                : 2016.04.08
    ***************************************/ -->
    <select id="selectCampaignStatusDetailList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignStatusReqDto"
            resultType="com.icignal.marketing.campaign.dto.request.MktCampaignStatusReqDto">
        /* MktCampaignMapper.selectCampaignStatusDetailList */
        select b.EXE_SEQ
             , b.EXE_DT
             , case when c.tgt_tot_cnt is null then 0 else c.tgt_tot_cnt end                    as                         TGT_TOT_CNT
             , case when d.send_tot_cnt is null then 0 else d.send_tot_cnt end                  as                         SEND_TOT_CNT
             , case when (d.mark_name is null OR d.mark_name = '') then '' else d.mark_name end as                         EXE_INFO_STATUS_CD
             , case when (e.mark_name is null OR e.mark_name = '') then '' else e.mark_name end as                         EXE_INFO_STATUS_BAT_DTL_CD
             , b.EXE_DT                                                                         as                         EXE_DT
             , e.MIN_START_DT
             , e.MAX_END_DT
             , case when e.bat_status = 0 then 'SUCCESS' else case when e.Min_start_dt is null then '' else 'FAIL' end end bat_status
             , b.id                                                                             as                         EXE_INFO_ITEM_ID
        from mkt.mkt_exe_info a WITH (NOLOCK)
                 inner join mkt.mkt_exe_info_item b WITH (NOLOCK) on a.id = b.EXE_INFO_ID
                 left outer join
             (
                 select CAM_ID, EXE_INFO_ITEM_ID, count(MEM_ID) as tgt_tot_cnt
                 from mkt.mkt_tgt_dtl WITH (NOLOCK)
                 where flag = 1
                   and cam_id = #{cam_id}
                 group by cam_id, EXE_INFO_ITEM_ID
             ) c on (a.ID = c.CAM_ID or b.id = c.EXE_INFO_ITEM_ID)
                 left outer join(
            select CAM_ID, EXE_INFO_ITEM_ID, count(MEM_ID) as send_tot_cnt
            from mkt.mkt_tgt_dtl WITH (NOLOCK)
            where flag = 1
              and (CTRL_GROUP_YN = 0 and EXCEPT_YN = 0 and DUP_DEL_YN = 0 and PRMS_CHK_DEL_YN = 0 and FATI_CHK_DEL_YN = 0)
              and cam_id = #{cam_id}
            group by cam_id, EXE_INFO_ITEM_ID
        ) d on (a.ID = d.CAM_ID or b.id = d.EXE_INFO_ITEM_ID)
                 left outer join com.comm_code d WITH (NOLOCK) on b.EXE_INFO_STATUS_CD = d.code_name and d.lang = #{lang}and d.group_code = 'MKT_EXEC_STATUS'
          left outer join com.comm_code e
        WITH (NOLOCK) on b.EXE_INFO_STATUS_BAT_DTL_CD = e.code_name and e.lang = #{lang} and e.group_code = 'MKT_EXEC_STATUS_BAT_DETAIL'
            left outer join
            (
            select b.CAM_ID, b.MKT_EXE_INFO_ITEM_ID, min (b.START_DT) as Min_start_dt, max (b.END_DT) as Max_end_dt
                , sum (case when b.BATCH_STATUS_DTL = 'S' then 0 else 1 end) as bat_status
            from mkt.mkt_batch_exe_log_dtl b WITH (NOLOCK)
            where 1=1
            and b.CAM_ID = #{cam_id}
            and LEN(b.MKT_EXE_INFO_ITEM_ID) != 0
            group by b.CAM_ID, b.MKT_EXE_INFO_ITEM_ID
            ) e
        on a.CAM_ID = e.CAM_ID and b.ID = e.MKT_EXE_INFO_ITEM_ID
        where 1=1
          and a.FLAG = 1
          and b.flag = 1
          and a.CAM_ID = #{cam_id}
        order by ${strOrderby} ${strEndPaging}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : 캠페인 기획완료 체크
    -   설명                  : 캠페인 기획완료 체크
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.06
    ***************************************/ -->
    <select id="selectChnlChk" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTgtChnlChkReqDto" resultType="java.lang.String">
        SELECT cm.exe_chnl_type_cd as exeChnlTypeCd
        FROM mkt.mkt_cam_mst mcm WITH (NOLOCK)
                 join com.mkt_conts_chnl_rel ccr on mcm.id = ccr.cam_id and ccr.flag = 1
                 left outer join com.mkt_conts_mst cm on ccr.contents_id = cm.id and cm.flag = 1
        where ${strSVCType}
          and mcm.id = #{id}
          and mcm.flag = 1
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : 캠페인 기획완료 체크
    -   설명                  : 캠페인 기획완료 체크
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : 이원준
    -   작성일                : 2016.12.06
    ***************************************/ -->
    <select id="selectTgtChk" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignTgtChnlChkReqDto" resultType="java.lang.String">
        SELECT T.memType
        FROM (
                 SELECT DISTINCT mst.id  AS camId,
                                 CASE
                                     WHEN 1 = 0 THEN 'external'
                                     ELSE 'internal'
                                     END AS memType
                 from mkt.mkt_cam_mst mst WITH (NOLOCK)
                          join mkt.mkt_exe_info mei WITH (NOLOCK) on mst.id = mei.cam_id and mei.flag = 1
                          join mkt.mkt_exe_info_item meii WITH (NOLOCK) on mei.id = meii.exe_info_id and meii.flag = 1
                          join mkt.mkt_tgt_dtl mtd WITH (NOLOCK) on meii.id = mtd.exe_info_item_id and mtd.flag = 1
                 where ${strSVCType}
                   and mst.id = #{id}
                   and mst.flag = 1
             ) T
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : 메세지 발송 중지
    -   설명                  : 메세지 발송 중지
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.12.06
    ***************************************/ -->
    <update id="updateStopSendingMessagesByCampaignId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignDefaultInfoReqDto">
        /* MktCampaignMapper.updateStopSendingMessagesByCampaignId */
        update mkt.mkt_msg_send_log
        set MODIFY_BY       = #{modifyBy}
          , MODIFY_DATE     = GETDATE()
          , BAT_SEND_STATUS = 'C'
        where CAM_ID = #{id}
          and BAT_SEND_STATUS = 'N'
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : 이메일 발송 중지
    -   설명                  : 이메일 발송 중지
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.12.06
    ***************************************/ -->
    <update id="updateStopSendingEmailByCampaignId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignDefaultInfoReqDto">
        /* MktCampaignMapper.updateStopSendingEmailByCampaignId */
        update mkt.mkt_email_send_log
        set MODIFY_BY       = #{modifyBy}
          , MODIFY_DATE     = GETDATE()
          , BAT_SEND_STATUS = 'C'
        where CAM_ID = #{id}
          and BAT_SEND_STATUS = 'N'
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : PUSH 발송 중지
    -   설명                  : PUSH 발송 중지
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.12.06
    ***************************************/ -->
    <update id="updateStopSendingPushByCampaignId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignDefaultInfoReqDto">
        /* MktCampaignMapper.updateStopSendingPushByCampaignId */
        update mkt.mkt_push_send_log
        set MODIFY_BY       = #{modifyBy}
          , MODIFY_DATE     = GETDATE()
          , BAT_SEND_STATUS = 'C'
        where CAM_ID = #{id}
          and BAT_SEND_STATUS = 'N'
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : 카카오 친구톡 발송 중지
    -   설명                  : 카카오 친구톡 발송 중지
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : jh.kim
    -   작성일                : 2018.01.11
    ***************************************/ -->
    <update id="updateStopSendingKakaoByCampaignId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignDefaultInfoReqDto">
        /* MktCampaignMapper.updateStopSendingKakaoByCampaignId */
        update mkt.mkt_kakao_send_log
        set MODIFY_BY       = #{modifyBy}
          , MODIFY_DATE     = GETDATE()
          , BAT_SEND_STATUS = 'C'
        where CAM_ID = #{id}
          and BAT_SEND_STATUS = 'N'
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java
    ============================================
    -   제목                  : camid로 conid 조회
    -   제목                  : camid로 conid 조회
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : jun.lee
    -   작성일                : 2017.06.22
    ***************************************/ -->
    <select id="selectConidByCamid" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignGetConidByCamidReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignGetConidByCamidResDto">
        /* MktCampaignMapper.selectConidByCamid */
        select mccr.contents_id as conid
             , mcc.chnl_type_cd as chnlTypeCd
        from com.mkt_conts_chnl_rel mccr WITH (NOLOCK)
                 left join mkt.mkt_chnl mcc on mcc.id = mccr.MKT_CHNL_ID
        where ${strSVCType}
          and mccr.cam_id = #{camid}
          and mccr.flag = '1'
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (deleteCampaign)
    ============================================
    -   제목                  : 캠페인 삭제
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : jh.kim
    -   작성일                : 2017.11.29
    ***************************************/ -->
    <update id="deleteCampaign" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignRemoveReqDto">
        /* MktCampaignMapper.deleteCampaign */
        update mkt.mkt_cam_mst
        set flag        = flag + 1
          , modify_date = GETDATE()
          , modify_by   = #{modifyBy}
        where id = #{id}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (getCampaignLastExeDate)
    ============================================
    -   제목                  : 캠페인 마지막 실행 일자
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : jh.kim
    -   작성일                : 2017.12.15.
    ***************************************/ -->
    <select id="selectCampaignLastExeDate" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutionInfoReqDto" resultType="java.lang.String">
        /* MktCampaignMapper.selectCampaignLastExeDate */
        select com.TO_CHAR(t2.EXE_DT, 'YYYY-MM-DD HH24:MI:SS') as exeDate
        from mkt.mkt_cam_mst t1 WITH (NOLOCK)
                 join mkt.mkt_exe_info_item t2 on t2.flag = 1 and t2.cam_id = t1.id
        where t1.flag = 1
          and t1.id = #{campaignId}
        order by t2.exe_dt desc
        OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (isExecutableUser)
    ============================================
    -   제목                  : 활성 권한 조회
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : jh.kim
    -   작성일                : 2018.01.22
    ***************************************/ -->
    <select id="isExecutableUser" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignExecutableUserReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignExecutableUserResDto">
        /* MktCampaignMapper.isExecutableUser */
        select
        <!-- 활성권한을 가진 권한 그룹원인가?  -->
        com.nvl((SELECT 'Y' FROM DUAL WHERE #{createBy} in (
        select usr.rid
        from com.auth_user_rel rel WITH (NOLOCK)
        left join com.auth_group aut on aut.flag = 1 and aut.id = rel.aut_group_id
        left join com.crm_user usr on usr.flag = 1 and usr.rid = rel.rid_user
        where aut.type = 'MKT_MASTER'
        and rel.flag = 1
        )),0) as authGroupUserYN,

        <!-- 작성자인가? -->
        com.nvl((SELECT 'Y' FROM DUAL WHERE #{createBy} = (
        select create_by
        from mkt.mkt_cam_mst WITH (NOLOCK)
        where id = #{camId}
        )),0) as createUserYN,

        <!-- 요청자인가? -->
        com.nvl((SELECT 'Y' FROM DUAL WHERE #{createBy} = (
        select ELEC_APRV_RQTR_ID
        from com.com_elec_aprv WITH (NOLOCK)
        where CAM_ID = #{camId}
        and flag = 1
        )),0) as rqtrUserYN

        from dual
    </select>

    <!--  캠페인 복사 -->
    <select id="callProcCamCopy" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignReqDto"
           resultType="com.icignal.marketing.campaign.dto.response.MktCampaignListResDto" statementType="CALLABLE">
        DECLARE @RST VARCHAR(MAX)
        DECLARE @RST_MSG VARCHAR(MAX)
        exec mkt.PROC_CAM_COPY
            #{id}
            , #{createBy}
            , @RST OUT
            , @RST_MSG OUT
        SELECT @RST AS resultCd
               ,@RST_MSG AS resultMsg
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (getCampaignListExcludeMyCam)
    ============================================
    -   제목                  : 캠페인 목록 조회 (내 캠페인 제외 조회)
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : jh.kim
    -   작성일                : 2018.02.26
    ***************************************/ -->
    <select id="selectCampaignListExcludeMyCam" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignListResDto">
        /* MktCampaignMapper.selectCampaignListExcludeMyCam */
        select c.ID
             , c.OFFER_ID                                as offerId
             , o.OFFER_NM                                as offerName
             , c1.MARK_NAME                              as offerTypeName
             , c.DISP_NO                                 as dispNo
             , c2.CODE_NAME                              as campaignStatusCode
             , c2.MARK_NAME                              as campaignStatusCodeName
             , c.CAM_NM                                  as campaignName
             , c.CAM_DESC                                as description
             , com.TO_CHAR(c.CAM_START_DD, 'YYYY-MM-DD') as campaignStartDate
             , com.TO_CHAR(c.CAM_END_DD, 'YYYY-MM-DD')   as campaignEndDate
             , c.CAM_PLAN_ORG_CD                         as planOrgCode
             , d1.div_nm                                 as planOrgCodeName
             , c4.CODE_NAME                              as exeOrgLvlCode
             , c4.MARK_NAME                              as exeOrgLvlCodeName
             , c.CAM_PLNER                               as campaignPlanner
             , e.NAME                                    as campaignPlannerName
             , c5.CODE_NAME                              as campaignPurposeCode
             , c5.MARK_NAME                              as campaignPurposeCodeName
             , c6.CODE_NAME                              as campaignMethodCode
             , c6.MARK_NAME                              as campaignMethodCodeName
             , c.CAM_METH_DESC                           as campaignMethodDesc
             , c7.CODE_NAME                              as channelTypeCode
             , c7.MARK_NAME                              as channelTypeCodeName
             , c8.CODE_NAME                              as campaignTypeCode
             , c8.MARK_NAME                              as campaignTypeCodeName
             , c9.CODE_NAME                              as campaignApprovalStatusCode
             , c9.MARK_NAME                              as campaignApprovalStatusCodeName
             , c.PAR_CAM_ID                              as parCampaignId
             , c.PROGRAM_ID                              as programId
             , c.PLAN_ID                                 as planId
             , c.cam_scope_type_cd                       as camScopeTypeCd
             , c.type                                    as type
             , c.prom_yn                                 as promYn
             , c.event_yn                                as eventYn
        from mkt.mkt_cam_mst c WITH (NOLOCK)
                 left outer join mkt.mkt_cam_offer_rel r WITH (NOLOCK) on r.flag = 1 and r.cam_id = c.id
                 left outer join mkt.mkt_offer_mst o WITH (NOLOCK) on r.OFFER_ID = o.id
                 left outer join com.comm_code c1 WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.code_name = o.OFFER_TYPE_CD and c1.group_code = 'OFFER_TYPE_CD'
                 left outer join com.comm_code c2 WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.code_name = c.CAM_STATUS_CD and c2.group_code = 'MKT_CAM_STAT'
                 left outer join com.comm_code c4 WITH (NOLOCK) on c4.flag = 1 and c4.lang = #{lang} and c4.code_name = c.EXE_ORG_LVL_CD and c4.group_code = 'ORG_LEVEL_CD'
                 left outer join com.comm_code c5 WITH (NOLOCK) on c5.flag = 1 and c5.lang = #{lang} and c5.code_name = c.CAM_PRPS_CD and c5.group_code = 'MKT_CAM_GOAL_CD'
                 left outer join com.comm_code c6 WITH (NOLOCK) on c6.flag = 1 and c6.lang = #{lang} and c6.code_name = c.CAM_METH_CD and c6.group_code = 'MKT_CAM_SUB_GOAL_CD'
                 left outer join com.comm_code c7 WITH (NOLOCK) on c7.flag = 1 and c7.lang = #{lang} and c7.code_name = c.CHNL_TYPE_CD and c7.group_code = 'MKT_CAM_CHNL_TYPE_CD'
                 left outer join com.comm_code c8 WITH (NOLOCK) on c8.flag = 1 and c8.lang = #{lang} and c8.code_name = c.CAM_TYPE_CD and c8.group_code = 'MKT_CAM_TYPE_CD'
                 left outer join com.employee e WITH (NOLOCK) on e.id = c.CAM_PLNER
                 left outer join com.crm_division d1 WITH (NOLOCK) on d1.rid = e.rid_division
                 left outer join com.com_elec_aprv ea WITH (NOLOCK) on ea.flag = 1 and ea.cam_id = c.id
                 left outer join com.comm_code c9 WITH (NOLOCK)
                                 on c9.flag = 1 and c9.lang = #{lang} and c9.code_name = ea.ELEC_APRV_STATUS_CD and c9.group_code = 'EL_APPROVAL_STATUS_CD'
                 left outer join com.comm_code c10 WITH (NOLOCK) on c10.flag = 1
            and c10.lang = #{lang}
            and c10.code_name = c.cam_scope_type_cd
            and c10.group_code = 'CAM_SCOPE_TYPE_CD'
                 left outer join com.comm_code c11 WITH (NOLOCK) on c11.flag = 1
            and c11.lang = #{lang}
            and c11.code_name = c.plan_group_cd
            and c11.group_code = 'PLAN_GROUP_CD'
        where ${strCondWhere}
          and ${strSVCType}
          and ${strWhere}
          and c.flag = 1
          and c.id != #{id}
        order by ${strOrderby} ${strEndPaging}

    </select>

    <!-- 템플릿 삭제 -->
    <update id="deleteCampaignTemplates" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignRemoveReqDto">
        /* MktCampaignMapper.removeCampaignTemplates */
        update mkt.mkt_wf_template_mst
        set flag        = flag + 1
          , modify_date = GETDATE()
        where cam_id = #{id}
          and flag = 1
    </update>

    <!-- 채널 기간 확인 -->
    <select id="chnlTimeValidCheck" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignScheduleCheckReqDto" resultType="java.lang.Integer">
        /* MktCampaignMapper.chnlTimeValidCheck */
        SELECT count(*)
        FROM com.mkt_conts_chnl_rel mcc
                 JOIN mkt.MKT_CHNL mc ON mcc.MKT_CHNL_ID = mc.ID AND mc.FLAG = 1
                 JOIN mkt.MKT_EXE_INFO_ITEM mei ON mei.CAM_ID = mcc.CAM_ID AND mei.FLAG = 1
        WHERE mcc.CAM_ID = #{camId}
          AND mcc.FLAG = 1
          AND mc.CHNL_TYPE_CD = #{chnlType}
          AND (mc.SENDABLE_START_TIME <![CDATA[>]]> com.TO_CHAR(mei.EXE_DT, 'hh24miss')
            OR mc.SENDABLE_END_TIME <![CDATA[<]]> com.TO_CHAR(mei.EXE_DT, 'hh24miss'))
    </select>

    <!-- 채널 유형 확인 -->
    <select id="chnlTypeCheck" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignScheduleCheckReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignScheduleCheckResDto">
        /* MktCampaignMapper.chnlTypeCheck */
        SELECT mc.CHNL_TYPE_CD as chnlType
        FROM com.mkt_conts_chnl_rel mcc WITH (NOLOCK)
                 JOIN mkt.MKT_CHNL mc ON mcc.MKT_CHNL_ID = mc.ID AND mc.FLAG = 1
        WHERE mcc.FLAG = 1
          AND mcc.CAM_ID = #{camId}
    </select>

    <!-- 채널 정보 확인 -->
    <select id="checkChnlInfo" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignStatusCheckReqDto" resultType="java.lang.Integer">
        /* MktCampaignMapper.checkChnlInfo */
        select count(1) as cnt
        from mkt.mkt_cam_mst mcm
                 join com.mkt_conts_chnl_rel mccr on mccr.flag = 1 and mcm.id = mccr.cam_id
        where mcm.id = #{camId}
    </select>

    <!-- 실행정보 아이템 확인 -->
    <select id="checkExeInfoItemId" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignStatusCheckReqDto" resultType="java.lang.Integer">
        /* MktCampaignMapper.checkExeInfoItemId */
        select count(1) as cnt
        from mkt.mkt_exe_info_item meii
                 join mkt.mkt_exe_info mei on meii.exe_info_Id = mei.id and mei.flag = 1
        where mei.cam_id = #{camId}
          and meii.flag = 1
          AND meii.EXE_INFO_STATUS_CD in ('W', 'A')
    </select>

    <!-- 캠페인 유형 확인 -->
    <select id="checkCamTypeCd" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignStatusCheckReqDto" resultType="java.lang.String">
        select cam_type_cd as camTypeCd
        from mkt.mkt_cam_mst WITH (NOLOCK)
        where id = #{camId}
    </select>

    <!-- 캠페인 대상자 확인 -->
    <select id="checkCamTgtDtl" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignStatusCheckReqDto" resultType="java.lang.Integer">
        select count(1) as cnt
        from mkt.mkt_tgt_had
        where flag = 1
          and cam_id = #{camId}
    </select>

    <!-- 결제 상태 확인 -->
    <select id="checkElecAprov" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignStatusCheckReqDto" resultType="java.lang.String">
        select case when cc.code_name = '090' then 'true' else 'false' end as checkVal
        from mkt.mkt_cam_mst mcm WITH (NOLOCK)
        left outer join com.com_elec_aprv mea on mcm.id = mea.cam_id and mea.flag = 1
        left outer join com.comm_code cc on cc.code_name = mea.elec_aprv_status_cd and cc.lang = #{lang} and cc.group_code = 'EL_APPROVAL_STATUS_CD'
        where mcm.id = #{camId}
    </select>
    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (getETCampaignNode)
    ============================================
    -   제목                  : et 캠페인 노드 조회
    -   설명                  : et 캠페인 노드 조회
    -   결과형태              : 단일
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <select id="selectETCampaignNode" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignNodeReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktETCampaignNodeResDto">
        /* MKTCampaign.selectETCampaignNode */
        select t1.rid               as rid
             , t1.rid_mkt_cam_mst   as ridMktCamMst
             , t1.rid_node_type     as ridNodeType
             , t1.rid_node_sub_type as ridNodeSubType
             , t1.title             as title
             , t1.type              as type
             , t1.desctxt           as desctxt
             , t1.x_coord           as xCoord
             , t1.y_coord           as yCoord
             , t1.exec_seq          as execSeq
             , e.name               as createByNm
             , t1.create_date       as createDate
             , t1.modify_date       as modifyDate

             , t2.node_type_cd      as nodeTypeCd
             , c1.mark_name         as nodeTypeCdNm
             , t2.dsp_val           as dspVal
             , t2.icon_nm           as iconNm
             , t2.size_             as "size"
             , t2.input_scrn        as inputScrn

             , t3.sub_type_cd       as subTypeCd
             , c2.mark_name         as subTypeCdNm
             , t3.exec_cls          as execCls
             , t3.exec_mthd         as execMthd
             , t3.input_scrn        as subInputScrn
             , t3.desctxt           as subDesctxt
        from mkt.mkt_cam_node t1 WITH (NOLOCK)
                 left outer join mkt.mkt_node_type t2 WITH (NOLOCK) on t2.flag = 1 and t2.rid = t1.rid_node_type
                 left outer join mkt.mkt_node_sub_type t3 WITH (NOLOCK) on t3.flag = 1 and t3.rid = t1.rid_node_sub_type
                 left outer join com.crm_user u WITH (NOLOCK) on u.rid = t1.create_by
                 left outer join com.employee e WITH (NOLOCK) on e.flag = 1 and e.id = u.id_employee
                 left outer join com.comm_code c1 WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.group_code = 'MKT_NODE_TYPE_CD' and c1.code_name = t2.node_type_cd
                 left outer join com.comm_code c2 WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.group_code = 'MKT_CAM_NODE_TYPE' and c2.code_name = t3.sub_type_cd
        where ${strSVCType}
          and t1.flag = 1
          and t1.rid = #{rid}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (getETCampaignCondValList)
    ============================================
    -   제목                  : et 조건값 목록 조회
    -   설명                  : et 조건값 목록 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <select id="selectETCampaignCondValList" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignCondValReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktETCampaignCondValListResDto">
        /* MKTCampaign.selectETCampaignCondValList */
        select t1.rid                 as rid
             , t1.rid_cam_node        as ridCamNode
             , t1.seq                 as seq
             , t1.lgcl_cmpnt_id       as lgclCmpntId
             , t1.lgcl_fld            as lgclFld
             , t1.lc_logic_oper       as lcLogicOper
             , t1.lc_leftbrkt         as lcLeftbrkt
             , t1.lc_rightbrkt        as lcRightbrkt
             , t1.lc_comp_val_type    as lcCompValType
             , t1.lc_comp_val         as lcCompVal
             , t1.lc_comp_oper        as lcCompOper
             , t1.irreglr_exec_cls    as irreglrExecCls
             , t1.irreglr_exec_mthd   as irreglrExecMthd
             , t1.irreglr_rtn_fld     as irreglrRtnFld
             , t1.irreglr_rtn_fld_val as irreglrRtnFldVal
             , t1.irreglr_comp_oper   as irreglrCompOper
             , t1.irreglr_logic_oper  as irreglrLogicOper
             , t1.irreglr_comp_val    as irreglrCompVal
             , t2.lgc_comp_nm         as lgcCompNm
             , t3.dp_nm               as fieldDpNm
        from mkt.mkt_cam_cond_val t1 WITH (NOLOCK)
                 left outer join anl.anl_lgc_comp_mst t2 WITH (NOLOCK) on t2.flag = 1 and t2.id = t1.lgcl_cmpnt_id
                 left outer join anl.anl_atrib_group_column t3 WITH (NOLOCK) on t3.flag = 1 and t3.id = t1.lgcl_fld
                 left outer join com.comm_code c1 WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.group_code = 'MKT_TARGET_SERC_OPRT_TYPE' and c1.code_name = t1.lc_logic_oper
        where ${strSVCType}
          and t1.flag = 1
          and t1.rid_cam_node = #{ridCamNode}
        order by t1.seq
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (getETCampaignActVal)
    ============================================
    -   제목                  : et 캠페인 활동값 조회
    -   설명                  : et 캠페인 활동값 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <select id="selectETCampaignActVal" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignActValReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktETCampaignActValResDto">
        /* MKTCampaign.selectETCampaignActValList */
        select t1.rid               as rid
             , t1.rid_cam_node      as ridCamNode
             , t1.logic_oper        as logicOper
             , t1.comp_val_type     as compValType
             , t1.comp_val          as compVal
             , t1.comp_oper         as compOper
             , t1.rid_mkt_offer_mst as ridMktOfferMst
             , t1.acrl_type         as acrlType
             , c1.mark_name         as acrlTypeNm
             , t1.bnft_lc_bas       as bnftLcBas
             , t1.bnft_acrl_amt     as bnftAcrlAmt
             , t1.snd_chnl_cd       as sndChnlCd
             , t1.tgt_tbl_input_yn  as tgtTblInputYn
             , t1.if_call_yn        as ifCallYn
             , t2.offer_nm          as offerNm
             , t2.offer_type_cd     as offerTypeCd
             , c2.mark_name         as offerTypeCdNm
             , t1.lgcl_cmpnt_id     as lgclCmpntId
             , t3.lgc_comp_nm       as lgcCompNm
        from mkt.mkt_cam_act_val t1 WITH (NOLOCK)
                 left outer join mkt.mkt_offer_mst t2 WITH (NOLOCK) on t2.flag = 1 and t2.id = t1.rid_mkt_offer_mst
                 left outer join anl.anl_lgc_comp_mst t3 WITH (NOLOCK) on t3.flag = 1 and t3.id = t1.lgcl_cmpnt_id
                 left outer join com.comm_code c1 WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.group_code = 'LOY_ACRL_TYPE' and c1.code_name = t1.acrl_type
                 left outer join com.comm_code c2 WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.group_code = 'OFFER_TYPE_CD' and c2.code_name = t2.offer_type_cd
        where ${strSVCType}
          and t1.flag = 1
          and t1.rid_cam_node = #{ridCamNode}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (getETCampaignActVal)
    ============================================
    -   제목                  : et 캠페인 Action param 조회
    -   설명                  : et 캠페인 Action param 조회
    -   결과형태              : 목록
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <select id="selectETCampaignActParamList" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignActParamReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktETCampaignActParamResDto">
        /* MKTCampaign.selectETCampaignActParamList */
        select t1.rid          as rid
             , t1.rid_cam_node as ridCamNode
             , t1.param_type   as paramType
             , t1.param_nm     as paramNm
             , t1.param_val    as paramVal
             , t1.param_desc   as paramDesc
        from mkt.mkt_cam_act_param t1 WITH (NOLOCK)
        where ${strSVCType}
          and t1.flag = 1
          and t1.rid_cam_node = #{ridCamNode}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (addETCampaignNode)
    ============================================
    -   제목                  : et 캠페인 노드 등록
    -   설명                  : et 캠페인 노드 등록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <insert id="insertETCampaignNode" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignNodeReqDto">
        /* MKTCampaign.insertETCampaignNode */
        insert into mkt.mkt_cam_node (
        rid
        , rid_mkt_cam_mst
        , rid_node_type
        , rid_node_sub_type
        , title
        , type
        , desctxt
        , x_coord
        , y_coord
        , exec_seq
        , flag
        , mod_num
        , create_date
        , create_by
        , modify_date
        , modify_by
        )
        values (
        #{rid}
        , #{ridMktCamMst}
        , (select rid from mkt.mkt_node_type where flag = 1 and node_type_cd = #{ridNodeType})
        <choose>
            <when test="'STRUC'.equals(type)">
                , (select t1.rid from mkt.mkt_node_sub_type t1 join mkt.mkt_node_type t2 on t2.flag = 1 and t1.rid_node_type = t2.rid where t1.flag = 1 and t2.node_type_cd =
                #{ridNodeType} and t1.sub_type_cd = #{ridNodeSubType} and t1.rid_pgm = #{ridPgm})
            </when>
            <otherwise>
                , #{ridNodeSubType}
            </otherwise>
        </choose>
        , #{title}
        , #{type}
        , #{desctxt}
        , #{xCoord}
        , #{yCoord}
        , #{execSeq}
        , 1
        , 0
        , GETDATE()
        , #{createBy}
        , GETDATE()
        , #{modifyBy}
        )
        <selectKey keyProperty="" resultType="java.lang.String">
            select rid from mkt.mkt_cam_node where rid = #{rid} OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY
        </selectKey>
    </insert>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (editETCampaignNode)
    ============================================
    -   제목                  : 로얄티 캠페인 노드 수정
    -   설명                  : 로얄티 캠페인 노드 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <update id="updateETCampaignNode" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignNodeReqDto">
        /* MKTCampaign.updateETCampaignNode */
        update mkt.mkt_cam_node
        set
        rid_mkt_cam_mst = #{ridMktCamMst}
        , rid_node_type = (select rid from mkt.mkt_node_type where flag = 1 and node_type_cd = #{ridNodeType})
        <if test="type == &quot;STRUC&quot;">
            , rid_node_sub_type = (select t1.rid from mkt.mkt_node_sub_type t1 join mkt.mkt_node_type t2 on t2.flag = 1 and t1.rid_node_type = t2.rid where t1.flag = 1 and
            t2.node_type_cd = #{ridNodeType} and t1.sub_type_cd = #{ridNodeSubType} and t1.rid_pgm = #{ridPgm})
        </if>
        <if test="type != &quot;STRUC&quot;">
            , rid_node_sub_type = #{ridNodeSubType}
        </if>
        , title = #{title}
        , type = #{type}
        , desctxt = #{desctxt}
        , x_coord = #{xCoord}
        , y_coord = #{yCoord}
        , exec_seq = #{execSeq}
        , flag = 1
        , mod_num = mod_num + 1
        , modify_date = GETDATE()
        , modify_by = #{modifyBy}
        where rid = #{rid}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (removeETCampaignNode)
    ============================================
    -   제목                  : et 캠페인 노드 삭제
    -   설명                  : et 캠페인 노드 삭제
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <update id="deleteETCampaignNode" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignNodeReqDto">
        /* MKTCampaign.deleteETCampaignNode */
        update mkt.mkt_cam_node
        set flag        = flag + 1
          , modify_date = GETDATE()
          , modify_by   = #{modifyBy}
        where rid = #{rid}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (addETCampaignCondVal)
    ============================================
    -   제목                  : et 캠페인 조건값 등록
    -   설명                  : et 캠페인 조건값 등록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <insert id="insertETCampaignCondVal" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignCondValReqDto">
        /* MKTCampaign.insertETCampaignCondVal */
        insert into mkt.mkt_cam_cond_val (
        rid
        , rid_cam_node
        , seq
        , lgcl_cmpnt_id
        , lgcl_fld
        , lc_logic_oper
        , lc_leftbrkt
        , lc_rightbrkt
        , lc_comp_val_type
        , lc_comp_val
        , lc_comp_oper
        , irreglr_exec_cls
        , irreglr_exec_mthd
        , irreglr_rtn_fld
        , irreglr_rtn_fld_val
        , irreglr_comp_oper
        , irreglr_logic_oper
        , irreglr_comp_val
        , flag
        , mod_num
        , create_date
        , create_by
        , modify_date
        , modify_by )
        values (
        #{rid}
        , #{ridCamNode}
        , #{seq}
        , #{lgclCmpntId}
        , #{lgclFld}
        , #{lcLogicOper}
        , #{lcLeftbrkt}
        , #{lcRightbrkt}
        , #{lcCompValType}
        , #{lcCompVal}
        , #{lcCompOper}
        , #{irreglrExecCls}
        , #{irreglrExecMthd}
        , #{irreglrRtnFld}
        , #{irreglrRtnFldVal}
        , #{irreglrCompOper}
        , #{irreglrLogicOper}
        , #{irreglrCompVal}
        , 1
        , 0
        , GETDATE()
        , #{createBy}
        , GETDATE()
        , #{modifyBy} )

        <selectKey keyProperty="" resultType="java.lang.String">
            select rid from mkt.mkt_cam_cond_val where rid = #{rid} OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY
        </selectKey>
    </insert>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (editETCampaignCondVal)
    ============================================
    -   제목                  : et 캠페인 조건값 수정
    -   설명                  : et 캠페인 조건값 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <update id="updateETCampaignCondVal" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignCondValReqDto">
        /* MKTCampaign.updateETCampaignCondVal */
        update mkt.mkt_cam_cond_val
        set rid_cam_node        = #{ridCamNode}
          , seq                 = #{seq}
          , lgcl_cmpnt_id       = #{lgclCmpntId}
          , lgcl_fld            = #{lgclFld}
          , lc_logic_oper       = #{lcLogicOper}
          , lc_leftbrkt         = #{lcLeftbrkt}
          , lc_rightbrkt        = #{lcRightbrkt}
          , lc_comp_val_type    = #{lcCompValType}
          , lc_comp_val         = #{lcCompVal}
          , lc_comp_oper        = #{lcCompOper}
          , irreglr_exec_cls    = #{irreglrExecCls}
          , irreglr_exec_mthd   = #{irreglrExecMthd}
          , irreglr_rtn_fld     = #{irreglrRtnFld}
          , irreglr_rtn_fld_val = #{irreglrRtnFldVal}
          , irreglr_comp_oper   = #{irreglrCompOper}
          , irreglr_logic_oper  = #{irreglrLogicOper}
          , irreglr_comp_val    = #{irreglrCompVal}
          , flag                = 1
          , mod_num             = mod_num + 1
          , modify_date         = GETDATE()
          , modify_by           = #{modifyBy}
        where rid = #{rid}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (removeETCampaignCondVal)
    ============================================
    -   제목                  : et 캠페인 조건값 삭제
    -   설명                  : et 캠페인 조건값 삭제
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <update id="deleteETCampaignCondVal" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignCondValReqDto">
        /* MKTCampaign.deleteETCampaignCondVal */
        update mkt.mkt_cam_cond_val
        set flag        = flag + 1
          , modify_date = GETDATE()
          , modify_by   = #{modifyBy}
        where rid = #{rid}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (removeETCampaignCondVal)
    ============================================
    -   제목                  : et 캠페인 조건값 삭제 By ridCamNode
    -   설명                  : et 캠페인 조건값 삭제 By ridCamNode
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <update id="deleteETCampaignCondValByRidCamNode" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignCondValReqDto">
        /* MKTCampaign.deleteETCampaignCondVal */
        update mkt.mkt_cam_cond_val
        set flag        = flag + 1
          , modify_date = GETDATE()
          , modify_by   = #{modifyBy}
        where rid_cam_node = #{ridCamNode}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (addETCampaignActVal)
    ============================================
    -   제목                  : et 캠페인 활동값 등록
    -   설명                  : et 캠페인 활동값 등록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <insert id="insertETCampaignActVal" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignActValReqDto">
        /* MKTCampaign.insertETCampaignActVal */
        insert into mkt.mkt_cam_act_val (
        rid
        , rid_cam_node
        , logic_oper
        , comp_val_type
        , comp_val
        , comp_oper
        , rid_mkt_offer_mst
        , acrl_type
        , bnft_lc_bas
        , bnft_acrl_amt
        , snd_chnl_cd
        , tgt_tbl_input_yn
        , if_call_yn
        , flag
        , mod_num
        , create_date
        , create_by
        , modify_date
        , modify_by
        , lgcl_cmpnt_id
        )
        values (
        #{rid}
        , #{ridCamNode}
        , #{logicOper}
        , #{compValType}
        , #{compVal}
        , #{compOper}
        , #{ridMktOfferMst}
        , #{acrlType}
        , #{bnftLcBas}
        , #{bnftAcrlAmt}
        , #{sndChnlCd}
        , #{tgtTblInputYn}
        , #{ifCallYn}
        , 1
        , 0
        , GETDATE()
        , #{createBy}
        , GETDATE()
        , #{modifyBy}
        , #{lgclCmpntId}
        )

        <selectKey keyProperty="" resultType="java.lang.String">
            select TOP 1 rid from mkt.mkt_cam_act_val where rid = #{rid}
        </selectKey>
    </insert>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (editETCampaignActVal)
    ============================================
    -   제목                  : et 캠페인 활동값 수정
    -   설명                  : et 캠페인 활동값 수정
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <update id="updateETCampaignActVal" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignActValReqDto">
        /* MKTCampaign.updateETCampaignActVal */
        update mkt.mkt_cam_act_val
        set logic_oper        = #{logicOper}
          , comp_val_type     = #{compValType}
          , comp_val          = #{compVal}
          , comp_oper         = #{compOper}
          , rid_mkt_offer_mst = #{ridMktOfferMst}
          , acrl_type         = #{acrlType}
          , bnft_lc_bas       = #{bnftLcBas}
          , bnft_acrl_amt     = #{bnftAcrlAmt}
          , snd_chnl_cd       = #{sndChnlCd}
          , tgt_tbl_input_yn  = #{tgtTblInputYn}
          , if_call_yn        = #{ifCallYn}
          , flag              = 1
          , mod_num           = mod_num + 1
          , modify_date       = GETDATE()
          , modify_by         = #{modifyBy}
          , lgcl_cmpnt_id     = #{lgclCmpntId}
        where rid = #{rid}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (addETCampaignActVal)
    ============================================
    -   제목                  : et 캠페인 Action param 등록
    -   설명                  : et 캠페인 Action param 등록
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <insert id="insertETCampaignActParam" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignActParamReqDto">
        /* MKTCampaign.insertETCampaignActParam */
        insert into mkt.mkt_cam_act_param ( rid
                                          , create_date
                                          , create_by
                                          , modify_date
                                          , modify_by
                                          , flag
                                          , rid_cam_node
                                          , param_type
                                          , param_nm
                                          , param_val
                                          , param_desc)
        values ( com.getNewID('')
               , GETDATE()
               , #{createBy}
               , GETDATE()
               , #{modifyBy}
               , 1
               , #{ridCamNode}
               , #{paramType}
               , #{paramNm}
               , #{paramVal}
               , #{paramDesc})
    </insert>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (removeETCampaignActVal)
    ============================================
    -   제목                  : et 캠페인 활동값 삭제
    -   설명                  : et 캠페인 활동값 삭제
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <update id="deleteETCampaignActVal" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignActValReqDto">
        /* MKTCampaign.deleteETCampaignActVal */
        update mkt.mkt_cam_act_val
        set flag        = flag + 1
          , modify_date = GETDATE()
          , modify_by   = #{modifyBy}
        where rid = #{rid}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (removeETCampaignActValByRidCamNode)
    ============================================
    -   제목                  : et 캠페인 활동값 삭제 By ridCamNode
    -   설명                  : et 캠페인 활동값 삭제 By ridCamNode
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <update id="deleteETCampaignActValByRidCamNode" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignActValReqDto">
        /* MKTCampaign.deleteETCampaignActVal */
        update mkt.mkt_cam_act_val
        set flag        = flag + 1
          , modify_date = GETDATE()
          , modify_by   = #{modifyBy}
        where rid_cam_node = #{ridCamNode}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (removeETCampaignActValByRidCamNode)
    ============================================
    -   제목                  : et 캠페인 Action Param 삭제 By ridCamNode
    -   설명                  : et 캠페인 Action Param 삭제 By ridCamNode
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : dg.ryu
    -   작성일                : 2016.11.16
    ***************************************/ -->
    <update id="deleteETCampaignActParamByRidCamNode" parameterType="com.icignal.marketing.campaign.dto.request.MktETCampaignActParamReqDto">
        /* MKTCampaign.deleteETCampaignActVal */
        update mkt.mkt_cam_act_param
        set flag        = flag + 1
          , modify_date = GETDATE()
          , modify_by   = #{modifyBy}
        where rid_cam_node = #{ridCamNode}
    </update>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (getETLogicalComponentList)
    ============================== ==============
    -   제목                  : et 캠페인 로지컬 컴포넌트 목록 조회
    -   설명                  : et 캠페인 로지컬 컴포넌트 목록 조회
    -   결과형태              : 복수
    ============================================
    -   입력                :   accountId
    -   출력                :
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2016.06.21
    ***************************************/ -->
    <select id="selectETLogicalComponentList" parameterType="com.icignal.marketing.campaign.dto.request.MktETLogicalComponentListReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktETLogicalComponentListResDto">
        /* MKTCampaign.selectETLogicalComponentList */
        select l.ID                 as logicalCompId
             , e.NAME               as createByName
             , l.CREATE_DATE        as createDate
             , l.LGC_COMP_NM        as logicalCompName
             , l.LGC_DESC           as logicalCompDesc
             , l.logicalCompUseFlag as logicalCompUseFlag
             , ${strColumn}
        from (select t.*
                   , (case when t.CMPLT_YN = '1' and g.cnt = 1 then 'Y' else 'N' end) as logicalCompUseFlag
              from anl.anl_lgc_comp_mst t WITH (NOLOCK)
                       left outer join (select t2.lgc_comp_id, count(*) as cnt
                                        from anl.anl_atrib_group t2 WITH (NOLOCK)
                                                 join anl.anl_atrib_group_column t3 WITH (NOLOCK) on t3.flag = 1 and t3.atrib_group_id = t2.id and t3.seg_key_yn = '1'
                                        where t2.flag = 1
                                        group by t2.lgc_comp_id) g on g.lgc_comp_id = t.id
              where t.flag = 1) l
                 left outer join com.employee e on e.flag = 1 and l.create_by = e.id
        where ${strSVCType}
          and ${strWhere}
          and l.flag = 1
        order by ${strOrderby} ${strEndPaging}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (getETLogicalComponentColumnList)
    ============================== ==============
    -   제목                  : et 로지컬 컴포넌트 컬럼 목록
    -   설명                  : et 로지컬 컴포넌트 컬럼 목록
    -   결과형태              :
    ============================================
    -   입력              :
    -   출력              :
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2016.07.13
    ***************************************/ -->
    <select id="selectETLogicalComponentColumnList" parameterType="com.icignal.marketing.campaign.dto.request.MktETLogicalComponentColumnListReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktETLogicalComponentColumnListResDto">
        /* MKTCampaign.selectETLogicalComponentColumnList */
        select t3.id
             , concat(concat(t5.tbl_alias, '.'), t4.col_nm)                          as columnName
             , (case when LEN(t3.dim_col_id) &gt; 0 then t4.dp_nm else t3.dp_nm end) as displayName
             , t3.col_alias                                                          as alias
        from anl.anl_lgc_comp_mst t1 WITH (NOLOCK)
                 join anl.anl_atrib_group t2 WITH (NOLOCK) on t2.flag = 1 and t2.lgc_comp_id = t1.id
                 join anl.anl_atrib_group_column t3 WITH (NOLOCK) on t3.flag = 1 and t3.atrib_group_id = t2.id
                 join anl.anl_column_mst t4 WITH (NOLOCK) on t4.flag = 1 and t4.id = (case when LEN(t3.dim_col_id) &gt; 0 then t3.dim_col_id else t3.col_id end)
                 join anl.anl_lgc_comp_table_rel t5 WITH (NOLOCK) on t5.flag = 1 and t5.tbl_id = t4.tbl_id and t5.lgc_comp_id = t1.id
        where t1.id = #{logicalCompId}
        order by t3.seq, t3.seq
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (getETFunctionList)
    ============================== ==============
    -   제목                  : et function 목록 조회
    -   설명                  : et function 목록 조회
    -   결과형태              :
    ============================================
    -   입력              :
    -   출력              :
    ============================================
    -   작성자                : 류동균
    -   작성일                : 2016.07.13
    ***************************************/ -->
    <select id="selectETFunctionList" parameterType="com.icignal.marketing.campaign.dto.request.MktETFunctionListReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktETFunctionListResDto">
        /* MKTCampaign.selectETFunctionList */
        select t1.node_type_cd as nodeTypeCd
             , c1.mark_name    as nodeTypeCdNm
             , t1.dsp_val      as dspVal
             , t1.icon_nm      as iconNm
             , t1.size_        as "size"
             , t1.input_scrn   as inputScrn

             , t2.rid          as rid
             , t2.sub_type_cd  as subTypeCd
             , c2.mark_name    as subTypeCdNm
             , t2.exec_cls     as execCls
             , t2.exec_mthd    as execMthd
             , t2.input_scrn   as subInputScrn
             , t2.desctxt      as subDesctxt

             , e.name          as createByNm
             , t2.create_date  as createDate
        from mkt.mkt_node_type t1 WITH (NOLOCK)
                 left outer join mkt.mkt_node_sub_type t2 WITH (NOLOCK) on t2.flag = 1 and t2.rid_node_type = t1.rid
                 left outer join com.crm_user u WITH (NOLOCK) on u.rid = t2.create_by
                 left outer join com.employee e WITH (NOLOCK) on e.flag = 1 and e.id = u.id_employee
                 left outer join com.comm_code c1 WITH (NOLOCK) on c1.flag = 1 and c1.lang = #{lang} and c1.group_code = 'MKT_NODE_TYPE_CD' and c1.code_name = t1.node_type_cd
                 left outer join com.comm_code c2 WITH (NOLOCK) on c2.flag = 1 and c2.lang = #{lang} and c2.group_code = 'MKT_CAM_NODE_TYPE' and c2.code_name = t2.sub_type_cd
        where ${strSVCType}
          and ${strWhere}
          and t2.flag = 1
          and t1.node_type_cd = #{nodeTypeCd}
          and t2.sub_type_cd = #{subTypeCd}
        order by ${strOrderby} ${strEndPaging}
    </select>

    <!-- /**************************************
    -   관련 파일             : MKTCampaignDAO.java (getCampaignPromotonDate)
    ============================================
    -   제목                  :
    -   결과형태              :
    ============================================
    -   입력
    ============================================
    -   작성자                : jh.kim
    -   작성일                : 2018.01.11
    ***************************************/ -->
    <select id="selectCampaignPromotionDate" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignPromotionDateReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignPromotionDateResDto">
        /* MKTCampaign.selectCampaignPromotonDate */

        select cam.id                                                 as camId
             , com.TO_CHAR(cam.cam_start_dd, 'YYYY-MM-DD')            as camStartDd
             , com.TO_CHAR(cam.cam_end_dd, 'YYYY-MM-DD')              as camEndDd
             , ru.rid                                                 as rulesetId
             , com.TO_CHAR(ru.prom_start_dt, 'YYYY-MM-DD HH24:MI:SS') as promStartDt
             , com.TO_CHAR(ru.prom_end_dt, 'YYYY-MM-DD HH24:MI:SS')   as promEndDt

        from mkt.mkt_cam_mst cam WITH (NOLOCK)
                 left join loy.loy_ruleset ru WITH (NOLOCK) on ru.flag = 1 and cam.id = ru.rid_mkt_cam_mst

        where cam.flag = 1
          and cam.id = #{camId}
    </select>

    <!-- 캠페인 Wait 조회 -->
    <select id="selectCampaignWait" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWaitReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignWaitResDto">
        /* MktCampaignMapper.selectCampaignWait */
        SELECT ID              AS id
             , CAM_ID          AS camId
             , EXE_DT          AS exeDt
             , EXE_TM          AS exeTm
             , MODIFY_DATE     AS modifyDate
             , TGT_TYPE_CD     AS tgtTypeCd
             , TGT_DTL_TYPE_CD AS tgtDtlTypeCd
             , TGT_CNT         AS tgtCnt
        FROM MKT.MKT_CAM_WAIT WITH (NOLOCK)
        WHERE ID = #{id}
    </select>

    <!-- 캠페인 Wait 등록 -->
    <insert id="insertCampaignWait" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWaitReqDto">
        /* MktCampaignMapper.insertCamWait */
        INSERT INTO MKT.MKT_CAM_WAIT
        ( ID
        , CREATE_BY
        , MODIFY_BY
        , CREATE_DATE
        , MODIFY_DATE
        , FLAG
        , CAM_ID
        , EXE_DT
        , EXE_TM
        , EXE_STAT_CD
        , TGT_TYPE_CD
        , TGT_DTL_TYPE_CD
        , TGT_CNT)
        VALUES ( #{id}
               , #{createBy}
               , #{modifyBy}
               , GETDATE()
               , GETDATE()
               , 1
               , #{camId}
               , #{exeDt}
               , #{exeTm}
               , 'R'
               , #{tgtTypeCd}
               , #{tgtDtlTypeCd}
               , #{tgtCnt})
    </insert>

    <!-- 캠페인 Wait 수정 -->
    <update id="updateCampaignWait" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWaitReqDto">
        /* MktCampaignMapper.updateCamWait */
        UPDATE MKT.MKT_CAM_WAIT
        SET MODIFY_DATE     = GETDATE()
          , MODIFY_BY       = #{modifyBy}
          , EXE_DT          = #{exeDt}
          , EXE_TM          = #{exeTm}
          , TGT_TYPE_CD     = #{tgtTypeCd}
          , TGT_DTL_TYPE_CD = #{tgtDtlTypeCd}
          , TGT_CNT         = #{tgtCnt}
        WHERE ID = #{id}
    </update>

    <!-- 캠페인 Wait 삭제 -->
    <update id="deleteCampaignWait" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignWaitReqDto">
        /* MktCampaignMapper.deleteCamWait */
        UPDATE MKT.MKT_CAM_WAIT
        SET MODIFY_DATE = GETDATE()
          , MODIFY_BY   = #{modifyBy}
          , flag        = flag + 1
        WHERE ID = #{id}
    </update>

    <!-- 반응상품리스트 -->
    <select id="selectProdList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignProdReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignProdResDto">
        /*MktCampaignMapper.selectProdList*/
        SELECT cp.ID      AS id
             , cp.PROD_NO AS prodNo
             , lp.PROD_NM AS prodNm
             , pc.CAT_NM  AS catNm
             , lc.CHNL_NM AS chnlNm
             , ${strColumn}
        FROM MKT.MKT_CAM_PROD cp WITH (NOLOCK)
                 JOIN loy.LOY_PROD lp WITH (NOLOCK) ON lp.RID = cp.RID_PROD AND lp.FLAG = 1
                 JOIN loy.LOY_PROD_CATEGORY pc WITH (NOLOCK) ON lp.RID_PROD_CAT = pc.RID AND pc.FLAG = 1
                 LEFT OUTER JOIN loy.LOY_CHNL lc WITH (NOLOCK) ON lc.rid = lp.RID_CHNL and lc.flag = 1
        WHERE cp.flag = 1
          AND cp.CAM_ID = #{id}
          AND ${strWhere}
          AND ${strSVCType}
        order by ${strOrderby} ${strEndPaging}
    </select>

    <!-- 반응상품 트리조회 -->
    <select id="selectProdTreeList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignProdReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignProdResDto">
        /*MktCampaignMapper.selectProdTreeList*/
        select T1.rid                      as id
             , ''                          as parent
             , T1.cat_id + ' ' + T1.cat_nm as text
             , T1.cat_nm                   as name
             , 'C'                         as type
             , ''                          AS prodId
        from loy.LOY_PROD_CATEGORY T1 WITH (NOLOCK)
                 join loy.LOY_PROD T2 WITH (NOLOCK) ON T2.flag = 1 AND T2.rid_prod_cat = T1.rid
            AND t2.RID NOT in (SELECT mcp.RID_PROD FROM mkt.MKT_CAM_PROD mcp WITH (NOLOCK) WHERE cam_id = #{camId} AND flag = 1)
        union
        select rid                     as id
             , rid_prod_cat            as parent
             , prod_id + ' ' + prod_nm as text
             , prod_nm                 as name
             , 'P'                     as type
             , prod_id                 AS prodId
        from loy.LOY_PROD WITH (NOLOCK)
        where flag = 1
          and rid_prod_cat is not null
          AND rid NOT in (SELECT mcp.rid_prod FROM mkt.MKT_CAM_PROD mcp WITH (NOLOCK) WHERE cam_id = #{camId} AND flag = 1)

    </select>

    <!-- 반응상품 신규 -->
    <insert id="insertCampaignProd" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignProdReqDto">
        <foreach collection="prodList" item="item" open="insert all" close="select 1 from dual" separator=" ">
            INTO mkt.MKT_CAM_PROD
            (id
            , CREATE_BY
            , MODIFY_BY
            , CREATE_DATE
            , MODIFY_DATE
            , FLAG
            , CAM_ID
            , PROD_NO
            , RID_PROD
            )
            VALUES(
            com.getNewId('')
            , #{createBy}
            , #{modifyBy}
            , GETDATE()
            , GETDATE()
            , 1
            , #{camId}
            , #{item.prodId}
            , #{item.id}
            )
        </foreach>
    </insert>

    <!-- 반응상품 트리 검색-->
    <select id="selectProdTreeSearchList" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignProdReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignProdResDto">
        /*MktCampaignMapper.selectProdTreeSearchList*/
        select T1.rid as id
        , '' as parent
        , T1.cat_id + ' ' + T1.cat_nm as text
        , T1.cat_nm as name
        , 'C' as type
        , '' AS prodId
        from loy.LOY_PROD_CATEGORY T1
        join loy.LOY_PROD T2 ON T2.flag = 1 AND T2.rid_prod_cat = T1.rid
        AND t2.RID NOT in(SELECT mcp.RID_PROD FROM mkt.MKT_CAM_PROD mcp WHERE cam_id = #{camId} AND flag = 1)
        <if test="name != null and name != ''">
            AND T2.PROD_NM LIKE '%' + #{name} + '%'
        </if>
        <if test="prodId != null and prodId != ''">
            AND T2.PROD_ID = #{prodId}
        </if>
        union
        select rid as id
        , rid_prod_cat as parent
        , prod_id + ' ' + prod_nm as text
        , prod_nm as name
        , 'P' as type
        , prod_id AS prodId
        from loy.LOY_PROD
        where flag = 1
        and rid_prod_cat is not null
        AND rid NOT in(SELECT mcp.rid_prod FROM mkt.MKT_CAM_PROD mcp WHERE cam_id = #{camId} AND flag = 1)
        <if test="name != null and name != ''">
            AND PROD_NM LIKE '%' + #{name} + '%'
        </if>
        <if test="prodId != null and prodId != ''">
            AND PROD_ID = #{prodId}
        </if>

    </select>

    <!-- 반응상품 삭제 -->
    <update id="deleteProd" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignProdReqDto">
        /*MktCampaignMapper.deleteProd*/
        UPDATE mkt.MKT_CAM_PROD
        SET flag        = flag + 1
          , MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
        WHERE ID = #{id}
    </update>

    <!-- 반응상품 전체삭제 -->
    <update id="deleteAllProd" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignProdReqDto">
        /*MktCampaignMapper.deleteAllProd*/
        UPDATE mkt.MKT_CAM_PROD
        SET flag        = flag + 1
          , MODIFY_BY   = #{modifyBy}
          , MODIFY_DATE = GETDATE()
        WHERE CAM_ID = #{id}
    </update>

    <!-- 캠페인 오퍼수 조회 -->
    <select id="selectCampaignOfferCount" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto" resultType="Integer">
        /* MktCampaignMapper.selectCampaignOfferCount */
        SELECT COUNT(1) AS CNT
        FROM MKT.MKT_CAM_MST T1
        JOIN COM.MKT_CONTS_CHNL_REL T2 ON T2.FLAG = 1 AND T2.CAM_ID = T1.ID
        JOIN COM.MKT_CONTS_MST T3 ON T3.FLAG = 1 AND T3.ID = T2.CONTENTS_ID
        WHERE T1.FLAG = 1
        AND T1.ID = #{campaignId}
        <if test='@com.icignal.common.util.StringUtil@isNotEmpty(contentsId)'>
            AND T3.ID != #{contentsId}
        </if>
        AND (RTRIM(ISNULL(T3.RID_OFR, '')) != ''
        or RTRIM(ISNULL(T3.RID_SURV, '')) != '')
    </select>

    <!-- 캠페인 불러오기시 오퍼에 쿠폰이 있는지에 대한 여부 체크-->
    <select id="getCampaignLoadOfferCount" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto" resultType="Integer">
        /* MktCampaignMapper.getCampaignLoadOfferCount */
        select count(1) as cnt1
        from com.MKT_CONTS_MST mcm
        where 1=1
            and mcm.flag = 1
            and mcm.ID = #{contentsId}
            and ((RTRIM(ISNULL(mcm.RID_OFR, '')) != ''
            or RTRIM(ISNULL(mcm.RID_SURV, '')) != '')
            and mcm.EXE_CHNL_TYPE_CD != ( select top 1 mcm.EXE_CHNL_TYPE_CD
                                     from com.MKT_CONTS_MST mcm
                                              join com.MKT_CONTS_CHNL_REL mccr on mcm.ID = mccr.CONTENTS_ID and mccr.FLAG =1
                                     where 1=1
                                       and mcm.flag = 1
                                       and mccr.CAM_ID = #{campaignId}
                                                               and (RTRIM(ISNULL(mcm.RID_OFR, '')) != ''
                                                                 or RTRIM(ISNULL(mcm.RID_SURV, '')) != '')
         ))
    </select>

    <!-- 캠페인 컨텐츠 오퍼 팝업시 쿠폰 체크-->
    <select id="getCampaignLoadOfferPopCount" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto" resultType="Integer">
        /* MktCampaignMapper.getCampaignLoadOfferPopCount */
        select count(1) as cnt1
        from com.MKT_CONTS_MST mcm
        where 1=1
          and mcm.flag = 1
          and mcm.ID = #{contentsId}
            and mcm.EXE_CHNL_TYPE_CD != RTRIM(ISNULL(( select top 1 mcm.EXE_CHNL_TYPE_CD
                                                       from com.MKT_CONTS_MST mcm
                                                                join com.MKT_CONTS_CHNL_REL mccr on mcm.ID = mccr.CONTENTS_ID and mccr.FLAG =1
                                                       where 1=1
                                                         and mcm.flag = 1
                                                         and mccr.CAM_ID = #{campaignId}
                                                         and (RTRIM(ISNULL(mcm.RID_OFR, '')) != ''
                                                           or RTRIM(ISNULL(mcm.RID_SURV, '')) != '')
                                                     ),null))
    </select>

    <!-- 캠페인 권한 조회-->
    <select id="selectCampaignAuth" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktCampaignListResDto">
        /* MktCampaignMapper.selectCampaignAuth */
        select e.ID             as empId
             , e.TYPE           as empType
             , e.X_AUTH_TYPE    as authType
             , cd.RID           as divRid
             , cd.X_BRAND_CD    as brandCd
        from com.CRM_USER cu
            left outer join com.EMPLOYEE e on cu.ID_EMPLOYEE = e.ID
            left outer join com.CRM_DIVISION cd on e.RID_DIVISION = cd.RID
        where cu.rid = #{createBy}
    </select>

    <!-- 캠페인 실행 가능 시간 조회-->
    <select id="getSchedulingPermitTime" parameterType="com.icignal.marketing.campaign.dto.request.MktSchePermitReqDto"
            resultType="com.icignal.marketing.campaign.dto.response.MktSchePermitResDto">
        /* MktCampaignMapper.getSchedulingPermitTime */
        SELECT 	top 1 concat(left(mc.SENDABLE_START_TIME,2),':',SUBSTRING(mc.SENDABLE_START_TIME,3,2),':',right(mc.SENDABLE_START_TIME,2)) as campaignExecPermitStartTime
                    ,concat(left(mc.SENDABLE_END_TIME,2),':',SUBSTRING(mc.SENDABLE_END_TIME,3,2),':',right(mc.SENDABLE_END_TIME,2)) as campaignExecPermitEndTime
        FROM mkt.MKT_CHNL mc
        WHERE mc.FLAG = 1
    </select>

    <!-- 캠페인 쿠폰/포인트 여부 -->
    <select id="camCpPoCheck" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignStatusCheckReqDto" resultType="java.lang.String">
        select top 1 case when mcm.COM_OFR_TYPE = 'C'
                              then 'true'
                          WHEN mcm.COM_OFR_TYPE = 'RC'
                              THEN 'true'
                          else 'false' end
        from com.MKT_CONTS_MST mcm WITH (NOLOCK)
                 join com.MKT_CONTS_CHNL_REL mccr with(nolock) on mcm.ID = mccr.CONTENTS_ID and mccr.FLAG =1
        where 1=1
          and mcm.FLAG = 1
          and mccr.CAM_ID = #{camId}
        order by 1 desc
    </select>

    <select id="selectCamAprvCheck" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignReqDto" resultType="java.lang.String">
        select cea.ELEC_APRV_STATUS_CD
        from mkt.MKT_CAM_MST mcm
        left outer join com.com_elec_aprv cea on mcm.id = cea.CAM_ID and cea.FLAG =1
        where 1=1
        and mcm.FLAG =1
        and mcm.id = #{id}
    </select>

    <select id="selectCamOfferForReqData" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignReqDto" resultType="com.icignal.marketing.campaign.dto.request.MktCampaignOfferCallResDto">
        select top 1
                mth.TGT_GROUP_ID         as tgtGroupId
               , di.id                  as dbId
               , di.con_ip              as conIp
               , di.con_port            as conPort
               , di.con_id              as conId
               , di.con_pw              as conPassword
               , di.con_url             as conUrl
               , c.code_name            as conDbType
               , c.attrib01             as conDbClass
               , atg.FILTER_SQL         as filterSql
               , atg.FILTER_SQL_COUNT   as filterSqlCount
               , atg.CNT                as tgtCnt
               , e.NAME                 as createBy
               , e.NAME                 as modifyBy
               , cmcm.COM_OFR_TYPE      as offerTypeCodeName
               , mcm.id                 as camId
               , mcm.DISP_NO            as camNo
        from mkt.MKT_CAM_MST mcm with(nolock)
        join mkt.mkt_tgt_had mth with(nolock) on mcm.ID = mth.CAM_ID and mth.FLAG =1
        join anl.ANL_TGT_GROUP atg with(nolock) on mth.TGT_GROUP_ID = atg.ID and atg.FLAG =1
        join anl.anl_lgc_comp_mst alcm with(nolock) on atg.LGC_COMP_ID = alcm.ID and alcm.FLAG =1
        join anl.anl_db_inform di with(nolock)  ON alcm.DB_INFORM_ID  = di.ID AND di.FLAG =1
        join com.comm_code c with(nolock)  on c.flag = 1 and c.code_name = di.con_db_type and c.lang = 'ko' and c.group_code = 'ANL_DB_TYPE_CD'
        join com.CRM_USER cu with(nolock) on mcm.MODIFY_BY = cu.RID
        join com.EMPLOYEE e with(nolock) on cu.ID_EMPLOYEE = e.ID
        join com.MKT_CONTS_CHNL_REL mccr on mcm.ID = mccr.CAM_ID and mccr.FLAG = 1
        join com.MKT_CONTS_MST cmcm on mccr.CONTENTS_ID = cmcm.ID and cmcm.FLAG = 1
        where 1=1
        and mcm.FLAG =1
        and mcm.ID = #{id}
    </select>

    <select id="selectCamOfferForEshopDbInfo" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignReqDto" resultType="com.icignal.marketing.campaign.dto.request.MktCampaignOfferCallResDto">
        select top 1
                   di.id                  as dbId
                   , di.con_ip              as conIp
                   , di.con_port            as conPort
                   , di.con_id              as conId
                   , di.con_pw              as conPassword
                   , di.con_url             as conUrl
                   , c.code_name            as conDbType
                   , c.attrib01             as conDbClass
        from anl.anl_db_inform di with(nolock)
        join com.comm_code c with(nolock)  on c.flag = 1 and c.code_name = di.con_db_type and c.lang = 'ko' and c.group_code = 'ANL_DB_TYPE_CD'
        where 1=1
          and di.FLAG =1
          and di.CON_ID ='IF_CRM'

    </select>


    <select id="selectCamOfferDetail"
            parameterType="com.icignal.offer.dto.request.OfferReqDto"
            resultType="com.icignal.offer.dto.response.OfferResDto">
        SELECT top 1 A.RID               as rid
                   , A.OFR_NO            AS ofrNo
                   , A.OFR_VAL_AMT       as ofrValAmt
                   , D.USE_EXPIR_TYPE    AS useExpirType
                   , D.USE_EXPIR_DAY_CNT as useExpirDay
                   , A.OFR_SUB_TYPE      as ofrSubType
                   , D.DESC_TEXT 	     as descText
                   , CASE
                         WHEN USE_EXPIR_TYPE = 'YEAR'
                             THEN CONVERT(CHAR(19),  DATEADD(SS,-1,DATEADD(YEAR,  D.USE_EXPIR_DAY_CNT, DATEADD( dd, DATEDIFF(dd, 0, GETDATE()+1), 0))), 20)
                         WHEN USE_EXPIR_TYPE = 'MONTH'
                             THEN CONVERT(CHAR(19),  DATEADD(SS,-1,DATEADD(MONTH ,  D.USE_EXPIR_DAY_CNT, DATEADD( dd, DATEDIFF(dd, 0, GETDATE()+1), 0))), 20)
                         WHEN USE_EXPIR_TYPE = 'DAY'
                             THEN CONVERT(CHAR(19),  DATEADD(SS,-1,DATEADD(DAY,  D.USE_EXPIR_DAY_CNT, DATEADD( dd, DATEDIFF(dd, 0, GETDATE()+1), 0))), 20)
                         WHEN USE_EXPIR_TYPE = 'FIX'
                             THEN CONVERT(CHAR(19), DATEADD(SS,-1,D.USE_FIX_END_DATE+1), 20)
                         WHEN USE_EXPIR_TYPE = 'EOM'
                             THEN CONVERT(CHAR(19),  DATEADD(SS,-1,DATEADD(MONTH, D.USE_EXPIR_DAY_CNT, DATEADD( dd, DATEDIFF(dd, 0, GETDATE()+1), 0))) - DAY(GETDATE()), 20)
                         WHEN USE_EXPIR_TYPE = 'EOY'
                             THEN CONVERT(CHAR(19), DATEADD(SS,-1,DATEADD(YEAR, DATEDIFF(yy, 0, GETDATE()) + D.USE_EXPIR_DAY_CNT, 0)), 20)
                         WHEN USE_EXPIR_TYPE = 'NA'
                             THEN CONVERT(CHAR(19), A.VALID_END_DATE, 20) END  AS useExpirDayCnt
        FROM mkt.MKT_CAM_MST mcm
                 join com.MKT_CONTS_CHNL_REL mccr on mcm.ID = mccr.CAM_ID and mccr.FLAG = 1
                 join com.MKT_CONTS_MST mcm2 on mccr.CONTENTS_ID = mcm2.ID and mcm2.FLAG = 1
                 join LOY.LOY_OFR A on mcm2.RID_OFR = A.RID and A.FLAG = 1
                 left JOIN LOY.LOY_CPN D ON D.RID_OFR = A.RID AND D.FLAG = 1
        WHERE 1 = 1
          and mcm.FLAG =1
          AND mcm.id = #{rid}
    </select>
    <select id="selectTgtOfferCount" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignReqDto" resultType="java.lang.Integer">
        select top 1
            isnull(atg.CNT,0)                as tgtCnt
        from mkt.MKT_CAM_MST mcm with(nolock)
        join mkt.mkt_tgt_had mth with(nolock) on mcm.ID = mth.CAM_ID and mth.FLAG =1
        join anl.ANL_TGT_GROUP atg with(nolock) on mth.TGT_GROUP_ID = atg.ID and atg.FLAG =1
        where 1=1
        and mcm.FLAG =1
        and mcm.ID = #{id}
    </select>

    <update id="updateOfferSendStatus" parameterType="java.lang.String">
        update mkt.MKT_CAM_MST
        set OFFER_CHECK_TYPE_CD = 'CALL'
        where id = #{camId}
    </update>

    <update id="updateOfferWaitStatus" parameterType="java.lang.String">
        update mkt.MKT_CAM_MST
        set OFFER_CHECK_TYPE_CD = 'WAIT'
        where id = #{campaignId}
        and CAM_TYPE_CD = 'TARGET'
    </update>

    <select id="checkContentOffer" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto" resultType="java.lang.Integer">
        select isnull(count(*),0) as cnt
        from com.MKT_CONTS_MST
        where FLAG =1
        and id = #{contentsId}
        and RID_OFR is not null
    </select>


    <select id="checkExecItem" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto" resultType="java.lang.Integer">
        select count(t.EXE_DT) as cnt
        from (select top 1 exe_dt
              from mkt.MKT_CAM_MST mcm
                       join mkt.MKT_EXE_INFO_ITEM meii on mcm.ID = meii.CAM_ID and meii.FLAG = 1
              where 1 = 1
                and mcm.FLAG = 1
                and mcm.ID = #{camId}
                and meii.EXE_DT >= convert(datetime,concat(DATEPART(YEAR, GETDATE()),'-',DATEPART(MONTH, GETDATE()),'-',DATEPART(DAY, GETDATE()) ,' ',DATEPART(HOUR, GETDATE()),':', DATEPART(MINUTE, GETDATE())))
              order by meii.EXE_DT asc
             ) t
    </select>

    <update id="camTempPlanerUpdate" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignReqDto">
        /* MktCampaignMapper.camTempPlanerUpdate */
        update mkt.mkt_cam_mst
        set CAM_PLNER = #{empId}
        , OWNER_DIVISION = #{planOrgCode}
        , OWNER_EMPLOYEE = #{empId}
        , CAM_SCOPE_TYPE_CD = #{planOrgCodeName}
        where flag = 1
          and id = #{id}
    </update>

    <select id="checkTgtExecItem" parameterType="com.icignal.marketing.campaign.dto.request.MktCampaignContentsChnnelRelReqDto" resultType="java.lang.Integer">
        select count(atg.TARGET_EXE_YN) as cnt
        from mkt.MKT_CAM_MST mcm
                 join mkt.MKT_TGT_HAD mth on mcm.ID  = mth.CAM_ID and mth.FLAG  =1
                 join anl.ANL_TGT_GROUP atg on mth.TGT_GROUP_ID = atg.ID and atg.FLAG =1
        where mcm.FLAG =1
          and atg.TARGET_EXE_YN ='Y'
          and mcm.ID =#{camId}
    </select>

    <select id="selectCamOfferCheck"
            parameterType="com.icignal.offer.dto.request.OfferReqDto"
            resultType="com.icignal.offer.dto.response.OfferResDto">
        SELECT top 1 A.RID               as rid
                   , mcm2.COM_OFR_TYPE as offerTypeCodeName
        FROM mkt.MKT_CAM_MST mcm
                 join com.MKT_CONTS_CHNL_REL mccr on mcm.ID = mccr.CAM_ID and mccr.FLAG = 1
                 join com.MKT_CONTS_MST mcm2 on mccr.CONTENTS_ID = mcm2.ID and mcm2.FLAG = 1
                 join LOY.LOY_OFR A on mcm2.RID_OFR = A.RID and A.FLAG = 1
                 left JOIN LOY.LOY_CPN D ON D.RID_OFR = A.RID AND D.FLAG = 1
        WHERE 1 = 1
          and mcm.FLAG =1
          AND mcm.id = #{rid}
    </select>

    <select id="selectTargetCntByCamId" parameterType="java.lang.String" resultType="java.lang.String">
        SELECT TOP 1 ATG.CNT
        FROM mkt.MKT_TGT_HAD MTH
        INNER JOIN anl.ANL_TGT_GROUP ATG ON ATG.ID = MTH.TGT_GROUP_ID AND ATG.FLAG = 1
        WHERE MTH.FLAG = 1
          AND MTH.CAM_ID = #{camId}
    </select>
</mapper>
